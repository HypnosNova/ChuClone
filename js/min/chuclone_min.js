var DAT=DAT||{};
DAT.GUI=function(b){b==void 0&&(b={});var c=!1;b.height==void 0?b.height=300:c=!0;var d=[],e=[],f=!0,g,h,j=this,m=!0,n=280;if(b.width!=void 0)n=b.width;var t=!1,o,w,u=0,A;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=n+"px";var C=b.height,p=document.createElement("div");p.setAttribute("class","guidat-controllers");p.style.height=C+"px";p.addEventListener("DOMMouseScroll",function(b){var c=this.scrollTop;b.wheelDelta?c+=b.wheelDelta:
b.detail&&(c+=b.detail);b.preventDefault&&b.preventDefault();b.returnValue=!1;p.scrollTop=c},!1);var x=document.createElement("a");x.setAttribute("class","guidat-toggle");x.setAttribute("href","#");x.innerHTML=m?"Close Controls":"Open Controls";var H=!1,B=0,I=0,D=!1,F,T,L,M,N=function(b){T=F;M=L;F=b.pageY;L=b.pageX;b=F-T;if(!m)if(b>0)m=!0,C=o=1,x.innerHTML=w||"Close Controls";else return;var c=M-L;if(b>0&&C>h){var d=DAT.GUI.map(C,h,h+100,1,0);b*=d}H=!0;B+=b;o+=b;C+=b;p.style.height=o+"px";I+=c;n+=
c;n=DAT.GUI.constrain(n,240,500);j.domElement.style.width=n+"px";J()};x.addEventListener("mousedown",function(b){T=F=b.pageY;M=L=b.pageX;D=!0;b.preventDefault();B=I=0;document.addEventListener("mousemove",N,!1);return!1},!1);x.addEventListener("click",function(b){b.preventDefault();return!1},!1);document.addEventListener("mouseup",function(b){D&&!H&&j.toggle();if(D&&H)if(I==0&&K(),o>h)clearTimeout(A),o=u=h,P();else if(p.children.length>=1){var c=p.children[0].offsetHeight;clearTimeout(A);u=Math.round(C/
c)*c-1;u<=0?(j.close(),o=c*2):(o=u,P())}document.removeEventListener("mousemove",N,!1);b.preventDefault();return D=H=!1},!1);this.domElement.appendChild(p);this.domElement.appendChild(x);if(b.domElement)b.domElement.appendChild(this.domElement);else if(DAT.GUI.autoPlace){if(DAT.GUI.autoPlaceContainer==null)DAT.GUI.autoPlaceContainer=document.createElement("div"),DAT.GUI.autoPlaceContainer.setAttribute("id","guidat"),document.body.appendChild(DAT.GUI.autoPlaceContainer);DAT.GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var S=function(){g=setInterval(function(){j.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(b){(f=b)?e.length>0&&S():clearInterval(g)});this.__defineGetter__("autoListen",function(){return f});this.listenTo=function(b){e.length==0&&S();e.push(b)};this.unlistenTo=function(b){for(var c=0;c<e.length;c++)e[c]==b&&e.splice(c,1);e.length<=0&&clearInterval(g)};this.listen=function(b){var b=b||e,c;for(c in b)b[c].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var v=function(b,c){function d(){return b.apply(this,c)}d.prototype=b.prototype;return new d};this.add=function(){if(arguments.length==1){var b=[],e;for(e in arguments[0])b.push(j.add(arguments[0],e));return b}b=arguments[0];e=arguments[1];a:for(var f in d)if(d[f].object==b&&d[f].propertyName==e)break a;f=b[e];if(f==void 0)DAT.GUI.error(b+" either has no property '"+e+"', or the property is inaccessible.");else if(b=typeof f,f=k[b],f==void 0)DAT.GUI.error("Cannot create controller for data type '"+
b+"'");else{for(var g=[this],G=0;G<arguments.length;G++)g.push(arguments[G]);if(f=v(f,g)){p.appendChild(f.domElement);d.push(f);DAT.GUI.allControllers.push(f);b!="function"&&DAT.GUI.saveIndex<DAT.GUI.savedValues.length&&(f.setValue(DAT.GUI.savedValues[DAT.GUI.saveIndex]),DAT.GUI.saveIndex++);J();t||(o=h);if(!c)try{if(arguments.callee.caller==window.onload)C=u=o=h,p.style.height=C+"px"}catch(m){}return f}else DAT.GUI.error("Error creating controller for '"+e+"'.")}};var J=function(){h=0;for(var b in d)h+=
d[b].domElement.offsetHeight;p.style.overflowY=h-1>o?"auto":"hidden"},k={number:DAT.GUI.ControllerNumber,string:DAT.GUI.ControllerString,"boolean":DAT.GUI.ControllerBoolean,"function":DAT.GUI.ControllerFunction};this.reset=function(){};this.toggle=function(){m?this.close():this.open()};this.open=function(){x.innerHTML=w||"Close Controls";u=o;clearTimeout(A);P();K();m=!0};this.close=function(){x.innerHTML=w||"Open Controls";u=0;clearTimeout(A);P();K();m=!1};this.name=function(b){w=b;x.innerHTML=b};
this.appearanceVars=function(){return[m,n,o,p.scrollTop]};var P=function(){C=p.offsetHeight;C+=(u-C)*0.6;Math.abs(C-u)<1?C=u:A=setTimeout(P,1E3/30);p.style.height=Math.round(C)+"px";J()},K=function(){j.domElement.style.width=n-1+"px";setTimeout(function(){j.domElement.style.width=n+"px"},1)};if(DAT.GUI.guiIndex<DAT.GUI.savedAppearanceVars.length){n=parseInt(DAT.GUI.savedAppearanceVars[DAT.GUI.guiIndex][1]);j.domElement.style.width=n+"px";o=parseInt(DAT.GUI.savedAppearanceVars[DAT.GUI.guiIndex][2]);
t=!0;if(eval(DAT.GUI.savedAppearanceVars[DAT.GUI.guiIndex][0])==!0){var C=o,U=DAT.GUI.savedAppearanceVars[DAT.GUI.guiIndex][3];setTimeout(function(){p.scrollTop=U},0);if(DAT.GUI.scrollTop>-1)document.body.scrollTop=DAT.GUI.scrollTop;u=o;this.open()}DAT.GUI.guiIndex++}DAT.GUI.allGuis.push(this);if(DAT.GUI.allGuis.length==1&&(window.addEventListener("keyup",function(b){!DAT.GUI.supressHotKeys&&b.keyCode==72&&DAT.GUI.toggleHide()},!1),DAT.GUI.inlineCSS))b=document.createElement("style"),b.setAttribute("type",
"text/css"),b.innerHTML=DAT.GUI.inlineCSS,document.head.insertBefore(b,document.head.firstChild)};DAT.GUI.hidden=!1;DAT.GUI.autoPlace=!0;DAT.GUI.autoPlaceContainer=null;DAT.GUI.allControllers=[];DAT.GUI.allGuis=[];DAT.GUI.supressHotKeys=!1;DAT.GUI.toggleHide=function(){DAT.GUI.hidden?DAT.GUI.open():DAT.GUI.close()};DAT.GUI.open=function(){DAT.GUI.hidden=!1;for(var b in DAT.GUI.allGuis)DAT.GUI.allGuis[b].domElement.style.display="block"};
DAT.GUI.close=function(){DAT.GUI.hidden=!0;for(var b in DAT.GUI.allGuis)DAT.GUI.allGuis[b].domElement.style.display="none"};DAT.GUI.saveURL=function(){var b=DAT.GUI.replaceGetVar("saveString",DAT.GUI.getSaveString());window.location=b};DAT.GUI.scrollTop=-1;DAT.GUI.load=function(b){var b=b.split(","),c=parseInt(b[0]);DAT.GUI.scrollTop=parseInt(b[1]);for(var d=0;d<c;d++){var e=b.splice(2,4);DAT.GUI.savedAppearanceVars.push(e)}DAT.GUI.savedValues=b.splice(2,b.length)};DAT.GUI.savedValues=[];
DAT.GUI.savedAppearanceVars=[];DAT.GUI.getSaveString=function(){var b=[],c;b.push(DAT.GUI.allGuis.length);b.push(document.body.scrollTop);for(c in DAT.GUI.allGuis)for(var d=DAT.GUI.allGuis[c].appearanceVars(),e=0;e<d.length;e++)b.push(d[e]);for(c in DAT.GUI.allControllers)DAT.GUI.allControllers[c].type!="function"&&(d=DAT.GUI.allControllers[c].getValue(),DAT.GUI.allControllers[c].type=="number"&&(d=DAT.GUI.roundToDecimal(d,4)),b.push(d));return b.join(",")};
DAT.GUI.getVarFromURL=function(b){for(var c,d=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)if(c=d[e].split("="),c!=void 0&&c[0]==b)return c[1];return null};
DAT.GUI.replaceGetVar=function(b,c){for(var d,e=window.location.href,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++)if(d=f[g].split("="),d!=void 0&&d[0]==b)return e.replace(d[1],c);if(window.location.href.indexOf("?")!=-1)return e+"&"+b+"="+c;return e+"?"+b+"="+c};DAT.GUI.saveIndex=0;DAT.GUI.guiIndex=0;DAT.GUI.showSaveString=function(){alert(DAT.GUI.getSaveString())};
DAT.GUI.makeUnselectable=function(b){if(!(b==void 0||b.style==void 0)){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on";for(var b=b.childNodes,c=0;c<b.length;c++)DAT.GUI.makeUnselectable(b[c])}};DAT.GUI.makeSelectable=function(b){if(!(b==void 0||b.style==void 0)){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off";for(var b=b.childNodes,c=0;c<b.length;c++)DAT.GUI.makeSelectable(b[c])}};
DAT.GUI.map=function(b,c,d,e,f){return e+(f-e)*((b-c)/(d-c))};DAT.GUI.constrain=function(b,c,d){b<c?b=c:b>d&&(b=d);return b};DAT.GUI.error=function(b){typeof console.error=="function"&&console.error("[DAT.GUI ERROR] "+b)};DAT.GUI.roundToDecimal=function(b,c){var d=Math.pow(10,c);return Math.round(b*d)/d};DAT.GUI.extendController=function(b){b.prototype=new DAT.GUI.Controller;b.prototype.constructor=b};DAT.GUI.addClass=function(b,c){DAT.GUI.hasClass(b,c)||(b.className+=" "+c)};
DAT.GUI.hasClass=function(b,c){return b.className.indexOf(c)!=-1};DAT.GUI.removeClass=function(b,c){b.className=b.className.replace(RegExp(" "+c,"g"),"")};DAT.GUI.getVarFromURL("saveString")!=null&&DAT.GUI.load(DAT.GUI.getVarFromURL("saveString"));
DAT.GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);
DAT.GUI.makeUnselectable(this.domElement)};DAT.GUI.Controller.prototype.changeFunction=null;DAT.GUI.Controller.prototype.finishChangeFunction=null;DAT.GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};DAT.GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};DAT.GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};DAT.GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
DAT.GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};DAT.GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};DAT.GUI.Controller.prototype.updateDisplay=function(){};DAT.GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};DAT.GUI.Controller.prototype.onFinishChange=function(b){this.finishChangeFunction=b;return this};
DAT.GUI.Controller.prototype.options=function(){var b=this,c=document.createElement("select");if(arguments.length==1){var d=arguments[0],e;for(e in d){var f=document.createElement("option");f.innerHTML=e;f.setAttribute("value",d[e]);if(arguments[e]==this.getValue())f.selected=!0;c.appendChild(f)}}else for(e=0;e<arguments.length;e++){f=document.createElement("option");f.innerHTML=arguments[e];f.setAttribute("value",arguments[e]);if(arguments[e]==this.getValue())f.selected=!0;c.appendChild(f)}c.addEventListener("change",
function(){b.setValue(this.value);b.finishChangeFunction!=null&&b.finishChangeFunction.call(this,b.getValue())},!1);b.domElement.appendChild(c);return this};
DAT.GUI.ControllerBoolean=function(){this.type="boolean";DAT.GUI.Controller.apply(this,arguments);var b=this,c=document.createElement("input");c.setAttribute("type","checkbox");c.checked=this.getValue();this.setValue(this.getValue());this.domElement.addEventListener("click",function(d){c.checked=!c.checked;d.preventDefault();b.setValue(c.checked)},!1);c.addEventListener("mouseup",function(){c.checked=!c.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";
this.domElement.appendChild(c);this.updateDisplay=function(){c.checked=b.getValue()};this.setValue=function(b){if(typeof b!="boolean")try{b=eval(b)}catch(c){}return DAT.GUI.Controller.prototype.setValue.call(this,b)}};DAT.GUI.extendController(DAT.GUI.ControllerBoolean);
DAT.GUI.ControllerFunction=function(){this.type="function";var b=this;DAT.GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.fire()},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";var c=null;this.onFire=function(b){c=b;return this};this.fire=function(){c!=null&&c.call(this);b.object[b.propertyName].call(b.object)}};DAT.GUI.extendController(DAT.GUI.ControllerFunction);
DAT.GUI.ControllerNumber=function(){this.type="number";DAT.GUI.Controller.apply(this,arguments);var b=this,c=!1,d=!1,e=0,f=0,g=arguments[3],h=arguments[4],j=arguments[5];this.min=function(){var c=!1;g==void 0&&h!=void 0&&(c=!0);if(arguments.length==0)return g;else g=arguments[0];c&&(t(),j==void 0&&(j=(h-g)*0.01));return b};this.max=function(){var c=!1;g!=void 0&&h==void 0&&(c=!0);if(arguments.length==0)return h;else h=arguments[0];c&&(t(),j==void 0&&(j=(h-g)*0.01));return b};this.step=function(){if(arguments.length==
0)return j;else j=arguments[0];return b};this.getMin=function(){return g};this.getMax=function(){return h};this.getStep=function(){return j==void 0?h!=void 0&&g!=void 0?(h-g)/100:1:j};var m=document.createElement("input");m.setAttribute("id",this.propertyName);m.setAttribute("type","text");m.setAttribute("value",this.getValue());j&&m.setAttribute("step",j);this.domElement.appendChild(m);var n,t=function(){n=new DAT.GUI.ControllerNumberSlider(b,g,h,j,b.getValue());b.domElement.appendChild(n.domElement)};
g!=void 0&&h!=void 0&&t();m.addEventListener("blur",function(){var c=parseFloat(this.value);n&&DAT.GUI.removeClass(b.domElement,"active");isNaN(c)||b.setValue(c)},!1);m.addEventListener("mousewheel",function(c){c.preventDefault();b.setValue(b.getValue()+Math.abs(c.wheelDeltaY)/c.wheelDeltaY*b.getStep());return!1},!1);m.addEventListener("mousedown",function(b){f=e=b.pageY;DAT.GUI.makeSelectable(m);document.addEventListener("mousemove",w,!1);document.addEventListener("mouseup",o,!1)},!1);m.addEventListener("keydown",
function(c){switch(c.keyCode){case 13:c=parseFloat(this.value);b.setValue(c);break;case 38:c=b.getValue()+b.getStep();b.setValue(c);break;case 40:c=b.getValue()-b.getStep(),b.setValue(c)}},!1);var o=function(){document.removeEventListener("mousemove",w,!1);DAT.GUI.makeSelectable(m);b.finishChangeFunction!=null&&b.finishChangeFunction.call(this,b.getValue());d=c=!1;document.removeEventListener("mouseup",o,!1)},w=function(g){f=e;e=g.pageY;var j=f-e;!c&&!d&&(j==0?c=!0:d=!0);if(c)return!0;DAT.GUI.addClass(b.domElement,
"active");DAT.GUI.makeUnselectable(b.parent.domElement);DAT.GUI.makeUnselectable(m);g.preventDefault();g=b.getValue()+j*b.getStep();b.setValue(g);return!1};this.options=function(){b.noSlider();b.domElement.removeChild(m);return DAT.GUI.Controller.prototype.options.apply(this,arguments)};this.noSlider=function(){n&&b.domElement.removeChild(n.domElement);return this};this.setValue=function(b){b=parseFloat(b);if(b===b)return g!=void 0&&b<=g?b=g:h!=void 0&&b>=h&&(b=h),DAT.GUI.Controller.prototype.setValue.call(this,
b)};this.updateDisplay=function(){m.value=DAT.GUI.roundToDecimal(b.getValue(),4);if(n)n.value=b.getValue()}};DAT.GUI.extendController(DAT.GUI.ControllerNumber);
DAT.GUI.ControllerNumberSlider=function(b,c,d,e,f){var g=!1,h=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);var j=function(c){if(g){var d;d=h.domElement;var e=0,f=0;if(d.offsetParent){do e+=d.offsetLeft,f+=d.offsetTop;while(d=d.offsetParent);d=[e,f]}else d=void 0;c=DAT.GUI.map(c.pageX,d[0],d[0]+h.domElement.offsetWidth,
b.getMin(),b.getMax());c=Math.round(c/b.getStep())*b.getStep();c===c&&b.setValue(c)}};this.domElement.addEventListener("mousedown",function(c){g=!0;DAT.GUI.addClass(b.domElement,"active");j(c);document.addEventListener("mouseup",m,!1)},!1);var m=function(){DAT.GUI.removeClass(b.domElement,"active");g=!1;b.finishChangeFunction!=null&&b.finishChangeFunction.call(this,b.getValue());document.removeEventListener("mouseup",m,!1)};this.__defineSetter__("value",function(c){this.fg.style.width=DAT.GUI.map(c,
b.getMin(),b.getMax(),0,100)+"%"});document.addEventListener("mousemove",j,!1);this.value=f};
DAT.GUI.ControllerString=function(){this.type="string";var b=this;DAT.GUI.Controller.apply(this,arguments);var c=document.createElement("input"),d=this.getValue();c.setAttribute("value",d);c.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){c.focus();c.select()},!1);c.addEventListener("keyup",function(d){d.keyCode==13&&b.finishChangeFunction!=null&&(b.finishChangeFunction.call(this,b.getValue()),c.blur());b.setValue(c.value)},!1);c.addEventListener("mousedown",
function(){DAT.GUI.makeSelectable(c)},!1);c.addEventListener("blur",function(){DAT.GUI.supressHotKeys=!1;b.finishChangeFunction!=null&&b.finishChangeFunction.call(this,b.getValue())},!1);c.addEventListener("focus",function(){DAT.GUI.supressHotKeys=!0},!1);this.updateDisplay=function(){c.value=b.getValue()};this.options=function(){b.domElement.removeChild(c);return DAT.GUI.Controller.prototype.options.apply(this,arguments)};this.domElement.appendChild(c)};DAT.GUI.extendController(DAT.GUI.ControllerString);
DAT.GUI.inlineCSS="#guidat { position: fixed; top: 0; right: 0; width: auto; z-index: 1001; text-align: right; } .guidat { color: #fff; opacity: 0.97; text-align: left; float: right; margin-right: 10px; margin-bottom: 20px; background-color: #fff; } .guidat, .guidat input { font: 9.5px Lucida Grande, sans-serif; } .guidat-controllers { height: 300px; overflow-y: auto; overflow-x: hidden; background-color: rgba(0, 0, 0, 0.1); } a.guidat-toggle:link, a.guidat-toggle:visited, a.guidat-toggle:active { text-decoration: none; cursor: pointer; color: #fff; background-color: #222; text-align: center; display: block; padding: 5px; } a.guidat-toggle:hover { background-color: #000; } .guidat-controller { padding: 3px; height: 25px; clear: left; border-bottom: 1px solid #222; background-color: #111; } .guidat-controller, .guidat-controller input, .guidat-slider-bg, .guidat-slider-fg { -moz-transition: background-color 0.15s linear; -webkit-transition: background-color 0.15s linear; transition: background-color 0.15s linear; } .guidat-controller.boolean:hover, .guidat-controller.function:hover { background-color: #000; } .guidat-controller input { float: right; outline: none; border: 0; padding: 4px; margin-top: 2px; background-color: #222; } .guidat-controller select { margin-top: 4px; float: right; } .guidat-controller input:hover { background-color: #444; } .guidat-controller input:focus, .guidat-controller.active input { background-color: #555; color: #fff; } .guidat-controller.number { border-left: 5px solid #00aeff; } .guidat-controller.string { border-left: 5px solid #1ed36f; } .guidat-controller.string input { border: 0; color: #1ed36f; margin-right: 2px; width: 148px; } .guidat-controller.boolean { border-left: 5px solid #54396e; } .guidat-controller.function { border-left: 5px solid #e61d5f; } .guidat-controller.number input[type=text] { width: 35px; margin-left: 5px; margin-right: 2px; color: #00aeff; } .guidat .guidat-controller.boolean input { margin-top: 6px; margin-right: 2px; font-size: 20px; } .guidat-controller:last-child { border-bottom: none; -webkit-box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.5); -moz-box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.5); box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.5); } .guidat-propertyname { padding: 5px; padding-top: 7px; cursor: default; display: inline-block; } .guidat-controller .guidat-slider-bg:hover, .guidat-controller.active .guidat-slider-bg { background-color: #444; } .guidat-controller .guidat-slider-bg .guidat-slider-fg:hover, .guidat-controller.active .guidat-slider-bg .guidat-slider-fg { background-color: #52c8ff; } .guidat-slider-bg { background-color: #222; cursor: ew-resize; width: 40%; margin-top: 2px; float: right; height: 21px; } .guidat-slider-fg { cursor: ew-resize; background-color: #00aeff; height: 21px; } ";var Stats=function(){function b(b,c,d){var e,f,g;for(f=0;f<30;f++)for(e=0;e<73;e++)g=(e+f*74)*4,b[g]=b[g+4],b[g+1]=b[g+5],b[g+2]=b[g+6];for(f=0;f<30;f++)g=(73+f*74)*4,f<c?(b[g]=k[d].bg.r,b[g+1]=k[d].bg.g,b[g+2]=k[d].bg.b):(b[g]=k[d].fg.r,b[g+1]=k[d].fg.g,b[g+2]=k[d].fg.b)}var c=0,d=2,e,f=0,g=(new Date).getTime(),h=g,j=g,m=0,n=1E3,t=0,o,w,u,A,C,p=0,x=1E3,H=0,B,I,D,F,T=0,L=1E3,M=0,N,S,v,J,k={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,
b:26},fg:{r:255,g:0,b:128}}};e=document.createElement("div");e.style.cursor="pointer";e.style.width="80px";e.style.opacity="0.9";e.style.zIndex="10001";e.addEventListener("click",function(){c++;c==d&&(c=0);o.style.display="none";B.style.display="none";N.style.display="none";switch(c){case 0:o.style.display="block";break;case 1:B.style.display="block";break;case 2:N.style.display="block"}},!1);o=document.createElement("div");o.style.backgroundColor="rgb("+Math.floor(k.fps.bg.r/2)+","+Math.floor(k.fps.bg.g/
2)+","+Math.floor(k.fps.bg.b/2)+")";o.style.padding="2px 0px 3px 0px";e.appendChild(o);w=document.createElement("div");w.style.fontFamily="Helvetica, Arial, sans-serif";w.style.textAlign="left";w.style.fontSize="9px";w.style.color="rgb("+k.fps.fg.r+","+k.fps.fg.g+","+k.fps.fg.b+")";w.style.margin="0px 0px 1px 3px";w.innerHTML='<span style="font-weight:bold">FPS</span>';o.appendChild(w);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";o.appendChild(u);
A=u.getContext("2d");A.fillStyle="rgb("+k.fps.bg.r+","+k.fps.bg.g+","+k.fps.bg.b+")";A.fillRect(0,0,u.width,u.height);C=A.getImageData(0,0,u.width,u.height);B=document.createElement("div");B.style.backgroundColor="rgb("+Math.floor(k.ms.bg.r/2)+","+Math.floor(k.ms.bg.g/2)+","+Math.floor(k.ms.bg.b/2)+")";B.style.padding="2px 0px 3px 0px";B.style.display="none";e.appendChild(B);I=document.createElement("div");I.style.fontFamily="Helvetica, Arial, sans-serif";I.style.textAlign="left";I.style.fontSize=
"9px";I.style.color="rgb("+k.ms.fg.r+","+k.ms.fg.g+","+k.ms.fg.b+")";I.style.margin="0px 0px 1px 3px";I.innerHTML='<span style="font-weight:bold">MS</span>';B.appendChild(I);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";B.appendChild(u);D=u.getContext("2d");D.fillStyle="rgb("+k.ms.bg.r+","+k.ms.bg.g+","+k.ms.bg.b+")";D.fillRect(0,0,u.width,u.height);F=D.getImageData(0,0,u.width,u.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&
(d=3)}catch(P){}N=document.createElement("div");N.style.backgroundColor="rgb("+Math.floor(k.mb.bg.r/2)+","+Math.floor(k.mb.bg.g/2)+","+Math.floor(k.mb.bg.b/2)+")";N.style.padding="2px 0px 3px 0px";N.style.display="none";e.appendChild(N);S=document.createElement("div");S.style.fontFamily="Helvetica, Arial, sans-serif";S.style.textAlign="left";S.style.fontSize="9px";S.style.color="rgb("+k.mb.fg.r+","+k.mb.fg.g+","+k.mb.fg.b+")";S.style.margin="0px 0px 1px 3px";S.innerHTML='<span style="font-weight:bold">MB</span>';
N.appendChild(S);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";N.appendChild(u);v=u.getContext("2d");v.fillStyle="#301010";v.fillRect(0,0,u.width,u.height);J=v.getImageData(0,0,u.width,u.height);return{domElement:e,update:function(){f++;g=(new Date).getTime();p=g-h;x=Math.min(x,p);H=Math.max(H,p);b(F.data,Math.min(30,30-p/200*30),"ms");I.innerHTML='<span style="font-weight:bold">'+p+" MS</span> ("+x+"-"+H+")";D.putImageData(F,0,0);h=g;if(g>
j+1E3){m=Math.round(f*1E3/(g-j));n=Math.min(n,m);t=Math.max(t,m);b(C.data,Math.min(30,30-m/100*30),"fps");w.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+n+"-"+t+")";A.putImageData(C,0,0);if(d==3)T=performance.memory.usedJSHeapSize*9.54E-7,L=Math.min(L,T),M=Math.max(M,T),b(J.data,Math.min(30,30-T/2),"mb"),S.innerHTML='<span style="font-weight:bold">'+Math.round(T)+" MB</span> ("+Math.round(L)+"-"+Math.round(M)+")",v.putImageData(J,0,0);j=g;f=0}}}};var THREE=THREE||{};if(!window.Int32Array)window.Int32Array=Array,window.Float32Array=Array;THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,c,d){this.r=b;this.g=c;this.b=d;this.updateHex()},setHSV:function(b,c,d){var e,f,g,h,j,m;if(d==0)e=f=g=0;else switch(h=Math.floor(b*6),j=b*6-h,b=d*(1-c),m=d*(1-c*j),c=d*(1-c*(1-j)),h){case 1:e=m;f=d;g=b;break;case 2:e=b;f=d;g=c;break;case 3:e=b;f=m;g=d;break;case 4:e=c;f=b;g=d;break;case 5:e=d;f=b;g=m;break;case 6:case 0:e=d,f=c,g=b}this.setRGB(e,
f,g)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,c){this.set(b||0,c||0)};
THREE.Vector2.prototype={set:function(b,c){this.x=b;this.y=c;return this},copy:function(b){this.x=b.x;this.y=b.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(b,c){this.x=b.x+c.x;this.y=b.y+c.y;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;return this},sub:function(b,c){this.x=b.x-c.x;this.y=b.y-c.y;return this},subSelf:function(b){this.x-=b.x;this.y-=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;return this},divideScalar:function(b){b?
(this.x/=b,this.y/=b):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var c=this.x-b.x,b=this.y-b.y;return c*c+b*b},setLength:function(b){return this.normalize().multiplyScalar(b)},
unit:function(){return this.normalize()},equals:function(b){return b.x==this.x&&b.y==this.y}};THREE.Vector3=function(b,c,d){this.set(b||0,c||0,d||0)};
THREE.Vector3.prototype={set:function(b,c,d){this.x=b;this.y=c;this.z=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(b,c){this.x=b.x+c.x;this.y=b.y+c.y;this.z=b.z+c.z;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;return this},sub:function(b,c){this.x=b.x-c.x;this.y=b.y-c.y;this.z=b.z-c.z;return this},subSelf:function(b){this.x-=
b.x;this.y-=b.y;this.z-=b.z;return this},multiply:function(b,c){this.x=b.x*c.x;this.y=b.y*c.y;this.z=b.z*c.z;return this},multiplySelf:function(b){this.x*=b.x;this.y*=b.y;this.z*=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;return this},divideSelf:function(b){return this.divide(this,b)},divideScalar:function(b){b?(this.x/=b,this.y/=b,this.z/=b):this.set(0,0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*
b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.normalize().multiplyScalar(b)},cross:function(b,c){this.x=b.y*c.z-b.z*c.y;this.y=b.z*c.x-b.x*c.z;this.z=b.x*c.y-b.y*c.x;return this},crossSelf:function(b){return this.set(this.y*b.z-this.z*b.y,this.z*b.x-this.x*b.z,this.x*
b.y-this.y*b.x)},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){return(new THREE.Vector3).sub(this,b).lengthSq()},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var c=Math.cos(this.y);this.y=Math.asin(b.n13);Math.abs(c)>1.0E-5?(this.x=Math.atan2(-b.n23/c,b.n33/c),this.z=Math.atan2(-b.n12/c,b.n11/c)):(this.x=0,this.z=Math.atan2(b.n21,b.n22))},isZero:function(){return this.lengthSq()<1.0E-4}};
THREE.Vector4=function(b,c,d,e){this.set(b||0,c||0,d||0,e||1)};
THREE.Vector4.prototype={set:function(b,c,d,e){this.x=b;this.y=c;this.z=d;this.w=e;return this},copy:function(b){return this.set(b.x,b.y,b.z,b.w||1)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(b,c){this.x=b.x+c.x;this.y=b.y+c.y;this.z=b.z+c.z;this.w=b.w+c.w;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this},sub:function(b,c){this.x=b.x-c.x;this.y=b.y-c.y;this.z=b.z-c.z;this.w=b.w-c.w;return this},subSelf:function(b){this.x-=
b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this},divideScalar:function(b){b?(this.x/=b,this.y/=b,this.z/=b,this.w/=b):this.set(0,0,0,1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},
setLength:function(b){return this.normalize().multiplyScalar(b)},lerpSelf:function(b,c){this.x+=(b.x-this.x)*c;this.y+=(b.y-this.y)*c;this.z+=(b.z-this.z)*c;this.w+=(b.w-this.w)*c;return this}};THREE.Ray=function(b,c){this.origin=b||new THREE.Vector3;this.direction=c||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){return this.intersectObjects(b.objects)},intersectObjects:function(b){var c,d,e=[];c=0;for(d=b.length;c<d;c++)e=e.concat(this.intersectObject(b[c]));e.sort(function(b,c){return b.distance-c.distance});return e},intersectObject:function(b){function c(b,c,d){var e,d=d.matrixWorld.getPosition();e=d.clone().subSelf(b).dot(c);b=b.clone().addSelf(c.clone().multiplyScalar(e));return d.distanceTo(b)}function d(b,c,d,e){var e=e.clone().subSelf(c),d=d.clone().subSelf(c),
f=b.clone().subSelf(c),b=e.dot(e),c=e.dot(d),e=e.dot(f),g=d.dot(d),d=d.dot(f),f=1/(b*g-c*c),g=(g*e-c*d)*f,b=(b*d-c*e)*f;return g>0&&b>0&&g+b<1}if(b instanceof THREE.Particle){var e=c(this.origin,this.direction,b);if(!e||e>b.scale.x)return[];return[{distance:e,point:b.position,face:null,object:b}]}else if(b instanceof THREE.Mesh){e=c(this.origin,this.direction,b);if(!e||e>b.geometry.boundingSphere.radius*Math.max(b.scale.x,Math.max(b.scale.y,b.scale.z)))return[];var f,g,h,j,m,n,t,o,w,u,A=b.geometry,
C=A.vertices,p=[],e=0;for(f=A.faces.length;e<f;e++)if(g=A.faces[e],w=this.origin.clone(),u=this.direction.clone(),n=b.matrixWorld,h=n.multiplyVector3(C[g.a].position.clone()),j=n.multiplyVector3(C[g.b].position.clone()),m=n.multiplyVector3(C[g.c].position.clone()),n=g instanceof THREE.Face4?n.multiplyVector3(C[g.d].position.clone()):null,t=b.matrixRotationWorld.multiplyVector3(g.normal.clone()),o=u.dot(t),b.doubleSided||(b.flipSided?o>0:o<0))if(t=t.dot((new THREE.Vector3).sub(h,w))/o,w=w.addSelf(u.multiplyScalar(t)),
g instanceof THREE.Face3)d(w,h,j,m)&&(g={distance:this.origin.distanceTo(w),point:w,face:g,object:b},p.push(g));else if(g instanceof THREE.Face4&&(d(w,h,j,n)||d(w,j,m,n)))g={distance:this.origin.distanceTo(w),point:w,face:g,object:b},p.push(g);return p}else return[]}};
THREE.Rectangle=function(){function b(){g=e-c;h=f-d}var c,d,e,f,g,h,j=!0;this.getX=function(){return c};this.getY=function(){return d};this.getWidth=function(){return g};this.getHeight=function(){return h};this.getLeft=function(){return c};this.getTop=function(){return d};this.getRight=function(){return e};this.getBottom=function(){return f};this.set=function(g,h,t,o){j=!1;c=g;d=h;e=t;f=o;b()};this.addPoint=function(g,h){j?(j=!1,c=g,d=h,e=g,f=h):(c=c<g?c:g,d=d<h?d:h,e=e>g?e:g,f=f>h?f:h);b()};this.add3Points=
function(g,h,t,o,w,u){j?(j=!1,c=g<t?g<w?g:w:t<w?t:w,d=h<o?h<u?h:u:o<u?o:u,e=g>t?g>w?g:w:t>w?t:w,f=h>o?h>u?h:u:o>u?o:u):(c=g<t?g<w?g<c?g:c:w<c?w:c:t<w?t<c?t:c:w<c?w:c,d=h<o?h<u?h<d?h:d:u<d?u:d:o<u?o<d?o:d:u<d?u:d,e=g>t?g>w?g>e?g:e:w>e?w:e:t>w?t>e?t:e:w>e?w:e,f=h>o?h>u?h>f?h:f:u>f?u:f:o>u?o>f?o:f:u>f?u:f);b()};this.addRectangle=function(g){j?(j=!1,c=g.getLeft(),d=g.getTop(),e=g.getRight(),f=g.getBottom()):(c=c<g.getLeft()?c:g.getLeft(),d=d<g.getTop()?d:g.getTop(),e=e>g.getRight()?e:g.getRight(),f=f>
g.getBottom()?f:g.getBottom());b()};this.inflate=function(g){c-=g;d-=g;e+=g;f+=g;b()};this.minSelf=function(g){c=c>g.getLeft()?c:g.getLeft();d=d>g.getTop()?d:g.getTop();e=e<g.getRight()?e:g.getRight();f=f<g.getBottom()?f:g.getBottom();b()};this.instersects=function(b){return Math.min(e,b.getRight())-Math.max(c,b.getLeft())>=0&&Math.min(f,b.getBottom())-Math.max(d,b.getTop())>=0};this.empty=function(){j=!0;f=e=d=c=0;b()};this.isEmpty=function(){return j}};THREE.Matrix3=function(){this.m=[]};
THREE.Matrix3.prototype={transpose:function(){var b,c=this.m;b=c[1];c[1]=c[3];c[3]=b;b=c[2];c[2]=c[6];c[6]=b;b=c[5];c[5]=c[7];c[7]=b;return this},transposeIntoArray:function(b){var c=this.m;b[0]=c[0];b[1]=c[3];b[2]=c[6];b[3]=c[1];b[4]=c[4];b[5]=c[7];b[6]=c[2];b[7]=c[5];b[8]=c[8];return this}};THREE.Matrix4=function(b,c,d,e,f,g,h,j,m,n,t,o,w,u,A,C){this.set(b||1,c||0,d||0,e||0,f||0,g||1,h||0,j||0,m||0,n||0,t||1,o||0,w||0,u||0,A||0,C||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,c,d,e,f,g,h,j,m,n,t,o,w,u,A,C){this.n11=b;this.n12=c;this.n13=d;this.n14=e;this.n21=f;this.n22=g;this.n23=h;this.n24=j;this.n31=m;this.n32=n;this.n33=t;this.n34=o;this.n41=w;this.n42=u;this.n43=A;this.n44=C;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,c,d){var e=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,g=THREE.Matrix4.__v3;g.sub(b,c).normalize();if(g.length()===0)g.z=1;e.cross(d,g).normalize();e.length()===0&&(g.x+=1.0E-4,e.cross(d,g).normalize());f.cross(g,e).normalize();this.n11=e.x;this.n12=f.x;this.n13=g.x;this.n21=e.y;this.n22=f.y;this.n23=g.y;this.n31=e.z;this.n32=f.z;this.n33=g.z;return this},multiplyVector3:function(b){var c=b.x,d=b.y,e=b.z,f=1/(this.n41*c+this.n42*d+this.n43*e+this.n44);b.x=(this.n11*c+this.n12*d+this.n13*e+this.n14)*f;b.y=(this.n21*c+this.n22*d+this.n23*
e+this.n24)*f;b.z=(this.n31*c+this.n32*d+this.n33*e+this.n34)*f;return b},multiplyVector4:function(b){var c=b.x,d=b.y,e=b.z,f=b.w;b.x=this.n11*c+this.n12*d+this.n13*e+this.n14*f;b.y=this.n21*c+this.n22*d+this.n23*e+this.n24*f;b.z=this.n31*c+this.n32*d+this.n33*e+this.n34*f;b.w=this.n41*c+this.n42*d+this.n43*e+this.n44*f;return b},rotateAxis:function(b){var c=b.x,d=b.y,e=b.z;b.x=c*this.n11+d*this.n12+e*this.n13;b.y=c*this.n21+d*this.n22+e*this.n23;b.z=c*this.n31+d*this.n32+e*this.n33;b.normalize();
return b},crossVector:function(b){var c=new THREE.Vector4;c.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;c.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;c.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;c.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return c},multiply:function(b,c){var d=b.n11,e=b.n12,f=b.n13,g=b.n14,h=b.n21,j=b.n22,m=b.n23,n=b.n24,t=b.n31,o=b.n32,w=b.n33,u=b.n34,A=b.n41,C=b.n42,p=b.n43,x=b.n44,H=c.n11,B=c.n12,I=c.n13,D=c.n14,F=c.n21,T=c.n22,
L=c.n23,M=c.n24,N=c.n31,S=c.n32,v=c.n33,J=c.n34,k=c.n41,P=c.n42,K=c.n43,U=c.n44;this.n11=d*H+e*F+f*N+g*k;this.n12=d*B+e*T+f*S+g*P;this.n13=d*I+e*L+f*v+g*K;this.n14=d*D+e*M+f*J+g*U;this.n21=h*H+j*F+m*N+n*k;this.n22=h*B+j*T+m*S+n*P;this.n23=h*I+j*L+m*v+n*K;this.n24=h*D+j*M+m*J+n*U;this.n31=t*H+o*F+w*N+u*k;this.n32=t*B+o*T+w*S+u*P;this.n33=t*I+o*L+w*v+u*K;this.n34=t*D+o*M+w*J+u*U;this.n41=A*H+C*F+p*N+x*k;this.n42=A*B+C*T+p*S+x*P;this.n43=A*I+C*L+p*v+x*K;this.n44=A*D+C*M+p*J+x*U;return this},multiplyToArray:function(b,
c,d){this.multiply(b,c);d[0]=this.n11;d[1]=this.n21;d[2]=this.n31;d[3]=this.n41;d[4]=this.n12;d[5]=this.n22;d[6]=this.n32;d[7]=this.n42;d[8]=this.n13;d[9]=this.n23;d[10]=this.n33;d[11]=this.n43;d[12]=this.n14;d[13]=this.n24;d[14]=this.n34;d[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=
b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=this.n11,c=this.n12,d=this.n13,e=this.n14,f=this.n21,g=this.n22,h=this.n23,j=this.n24,m=this.n31,n=this.n32,t=this.n33,o=this.n34,w=this.n41,u=this.n42,A=this.n43,C=this.n44;return e*h*n*w-d*j*n*w-e*g*t*w+c*j*t*w+d*g*o*w-c*h*o*w-e*h*m*u+d*j*m*u+e*f*t*u-b*j*t*u-d*f*o*u+b*h*o*u+e*g*m*A-c*j*m*A-e*f*n*A+b*j*n*A+c*f*o*A-b*g*o*A-d*g*m*C+c*h*m*C+d*f*n*C-b*h*n*C-c*f*t*C+b*g*t*C},transpose:function(){var b;b=this.n21;this.n21=
this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=
this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=
this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,c){b[c]=this.n11;b[c+1]=this.n21;b[c+2]=this.n31;b[c+3]=this.n41;b[c+4]=this.n12;b[c+5]=this.n22;b[c+6]=this.n32;b[c+7]=this.n42;b[c+8]=this.n13;b[c+9]=this.n23;b[c+10]=this.n33;b[c+11]=this.n43;b[c+12]=this.n14;b[c+13]=this.n24;b[c+14]=this.n34;b[c+15]=this.n44;return b},setTranslation:function(b,
c,d){this.set(1,0,0,b,0,1,0,c,0,0,1,d,0,0,0,1);return this},setScale:function(b,c,d){this.set(b,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1);return this},setRotationX:function(b){var c=Math.cos(b),b=Math.sin(b);this.set(1,0,0,0,0,c,-b,0,0,b,c,0,0,0,0,1);return this},setRotationY:function(b){var c=Math.cos(b),b=Math.sin(b);this.set(c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1);return this},setRotationZ:function(b){var c=Math.cos(b),b=Math.sin(b);this.set(c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,
c){var d=Math.cos(c),e=Math.sin(c),f=1-d,g=b.x,h=b.y,j=b.z,m=f*g,n=f*h;this.set(m*g+d,m*h-e*j,m*j+e*h,0,m*h+e*j,n*h+d,n*j-e*g,0,m*j-e*h,n*j+e*g,f*j*j+d,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);
return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b,c){var d=b.x,e=b.y,f=b.z,g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e),j=Math.cos(f),f=Math.sin(f);switch(c){case "YXZ":var m=h*j,n=h*f,t=e*j,o=e*f;this.n11=m+o*d;this.n12=
t*d-n;this.n13=g*e;this.n21=g*f;this.n22=g*j;this.n23=-d;this.n31=n*d-t;this.n32=o+m*d;this.n33=g*h;break;case "ZXY":m=h*j;n=h*f;t=e*j;o=e*f;this.n11=m-o*d;this.n12=-g*f;this.n13=t+n*d;this.n21=n+t*d;this.n22=g*j;this.n23=o-m*d;this.n31=-g*e;this.n32=d;this.n33=g*h;break;case "ZYX":m=g*j;n=g*f;t=d*j;o=d*f;this.n11=h*j;this.n12=t*e-n;this.n13=m*e+o;this.n21=h*f;this.n22=o*e+m;this.n23=n*e-t;this.n31=-e;this.n32=d*h;this.n33=g*h;break;case "YZX":m=g*h;n=g*e;t=d*h;o=d*e;this.n11=h*j;this.n12=o-m*f;this.n13=
t*f+n;this.n21=f;this.n22=g*j;this.n23=-d*j;this.n31=-e*j;this.n32=n*f+t;this.n33=m-o*f;break;case "XZY":m=g*h;n=g*e;t=d*h;o=d*e;this.n11=h*j;this.n12=-f;this.n13=e*j;this.n21=m*f+o;this.n22=g*j;this.n23=n*f-t;this.n31=t*f-n;this.n32=d*j;this.n33=o*f+m;break;default:m=g*j,n=g*f,t=d*j,o=d*f,this.n11=h*j,this.n12=-h*f,this.n13=e,this.n21=n+t*e,this.n22=m-o*e,this.n23=-d*h,this.n31=o-m*e,this.n32=t+n*e,this.n33=g*h}return this},setRotationFromQuaternion:function(b){var c=b.x,d=b.y,e=b.z,f=b.w,g=c+c,
h=d+d,j=e+e,b=c*g,m=c*h;c*=j;var n=d*h;d*=j;e*=j;g*=f;h*=f;f*=j;this.n11=1-(n+e);this.n12=m-f;this.n13=c+h;this.n21=m+f;this.n22=1-(b+e);this.n23=d-g;this.n31=c-h;this.n32=d+g;this.n33=1-(b+n);return this},scale:function(b){var c=b.x,d=b.y,b=b.z;this.n11*=c;this.n12*=d;this.n13*=b;this.n21*=c;this.n22*=d;this.n23*=b;this.n31*=c;this.n32*=d;this.n33*=b;this.n41*=c;this.n42*=d;this.n43*=b;return this},extractPosition:function(b){this.n14=b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,
c){var d=1/c.x,e=1/c.y,f=1/c.z;this.n11=b.n11*d;this.n21=b.n21*d;this.n31=b.n31*d;this.n12=b.n12*e;this.n22=b.n22*e;this.n32=b.n32*e;this.n13=b.n13*f;this.n23=b.n23*f;this.n33=b.n33*f}};
THREE.Matrix4.makeInvert=function(b,c){var d=b.n11,e=b.n12,f=b.n13,g=b.n14,h=b.n21,j=b.n22,m=b.n23,n=b.n24,t=b.n31,o=b.n32,w=b.n33,u=b.n34,A=b.n41,C=b.n42,p=b.n43,x=b.n44;c===void 0&&(c=new THREE.Matrix4);c.n11=m*u*C-n*w*C+n*o*p-j*u*p-m*o*x+j*w*x;c.n12=g*w*C-f*u*C-g*o*p+e*u*p+f*o*x-e*w*x;c.n13=f*n*C-g*m*C+g*j*p-e*n*p-f*j*x+e*m*x;c.n14=g*m*o-f*n*o-g*j*w+e*n*w+f*j*u-e*m*u;c.n21=n*w*A-m*u*A-n*t*p+h*u*p+m*t*x-h*w*x;c.n22=f*u*A-g*w*A+g*t*p-d*u*p-f*t*x+d*w*x;c.n23=g*m*A-f*n*A-g*h*p+d*n*p+f*h*x-d*m*x;c.n24=
f*n*t-g*m*t+g*h*w-d*n*w-f*h*u+d*m*u;c.n31=j*u*A-n*o*A+n*t*C-h*u*C-j*t*x+h*o*x;c.n32=g*o*A-e*u*A-g*t*C+d*u*C+e*t*x-d*o*x;c.n33=f*n*A-g*j*A+g*h*C-d*n*C-e*h*x+d*j*x;c.n34=g*j*t-e*n*t-g*h*o+d*n*o+e*h*u-d*j*u;c.n41=m*o*A-j*w*A-m*t*C+h*w*C+j*t*p-h*o*p;c.n42=e*w*A-f*o*A+f*t*C-d*w*C-e*t*p+d*o*p;c.n43=f*j*A-e*m*A-f*h*C+d*m*C+e*h*p-d*j*p;c.n44=e*m*t-f*j*t+f*h*o-d*m*o-e*h*w+d*j*w;c.multiplyScalar(1/b.determinant());return c};
THREE.Matrix4.makeInvert3x3=function(b){var c=b.m33,d=c.m,e=b.n33*b.n22-b.n32*b.n23,f=-b.n33*b.n21+b.n31*b.n23,g=b.n32*b.n21-b.n31*b.n22,h=-b.n33*b.n12+b.n32*b.n13,j=b.n33*b.n11-b.n31*b.n13,m=-b.n32*b.n11+b.n31*b.n12,n=b.n23*b.n12-b.n22*b.n13,t=-b.n23*b.n11+b.n21*b.n13,o=b.n22*b.n11-b.n21*b.n12,b=b.n11*e+b.n21*h+b.n31*n;b==0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");b=1/b;d[0]=b*e;d[1]=b*f;d[2]=b*g;d[3]=b*h;d[4]=b*j;d[5]=b*m;d[6]=b*n;d[7]=b*t;d[8]=b*o;return c};
THREE.Matrix4.makeFrustum=function(b,c,d,e,f,g){var h;h=new THREE.Matrix4;h.n11=2*f/(c-b);h.n12=0;h.n13=(c+b)/(c-b);h.n14=0;h.n21=0;h.n22=2*f/(e-d);h.n23=(e+d)/(e-d);h.n24=0;h.n31=0;h.n32=0;h.n33=-(g+f)/(g-f);h.n34=-2*g*f/(g-f);h.n41=0;h.n42=0;h.n43=-1;h.n44=0;return h};THREE.Matrix4.makePerspective=function(b,c,d,e){var f,b=d*Math.tan(b*Math.PI/360);f=-b;return THREE.Matrix4.makeFrustum(f*c,b*c,f,b,d,e)};
THREE.Matrix4.makeOrtho=function(b,c,d,e,f,g){var h,j,m,n;h=new THREE.Matrix4;j=c-b;m=d-e;n=g-f;h.n11=2/j;h.n12=0;h.n13=0;h.n14=-((c+b)/j);h.n21=0;h.n22=2/m;h.n23=0;h.n24=-((d+e)/m);h.n31=0;h.n32=0;h.n33=-2/n;h.n34=-((g+f)/n);h.n41=0;h.n42=0;h.n43=0;h.n44=1;return h};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new THREE.Quaternion;
this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,c){this.matrix.rotateAxis(c);this.position.addSelf(c.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==void 0&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var c=this;c.parent!==void 0;)c=c.parent;c!==void 0&&c instanceof THREE.Scene&&c.addChildRecurse(b)}},removeChild:function(b){var c=this.children.indexOf(b);if(c!==-1)b.parent=void 0,this.children.splice(c,1)},getChildByName:function(b,c){var d,e,f;d=0;for(e=this.children.length;d<e;d++){f=this.children[d];if(f.name===b)return f;if(c&&(f=f.getChildByName(b,c),f!==void 0))return f}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},update:function(b,c,d){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c)b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix),
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale),this.matrixWorldNeedsUpdate=!1,c=!0;for(var b=0,e=this.children.length;b<e;b++)this.children[b].update(this.matrixWorld,c,d)}};THREE.Quaternion=function(b,c,d,e){this.set(b||0,c||0,d||0,e!==void 0?e:1)};
THREE.Quaternion.prototype={set:function(b,c,d,e){this.x=b;this.y=c;this.z=d;this.w=e;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var c=0.5*Math.PI/360,d=b.x*c,e=b.y*c,f=b.z*c,b=Math.cos(e),e=Math.sin(e),c=Math.cos(-f),f=Math.sin(-f),g=Math.cos(d),d=Math.sin(d),h=b*c,j=e*f;this.w=h*g-j*d;this.x=h*d+j*g;this.y=e*c*g+b*f*d;this.z=b*f*g-e*c*d;return this},setFromAxisAngle:function(b,c){var d=c/2,e=Math.sin(d);this.x=b.x*e;this.y=b.y*
e;this.z=b.z*e;this.w=Math.cos(d);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);b==0?this.w=this.z=this.y=this.x=0:(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=b);return this},
multiplySelf:function(b){var c=this.x,d=this.y,e=this.z,f=this.w,g=b.x,h=b.y,j=b.z,b=b.w;this.x=c*b+f*g+d*j-e*h;this.y=d*b+f*h+e*g-c*j;this.z=e*b+f*j+c*h-d*g;this.w=f*b-c*g-d*h-e*j;return this},multiply:function(b,c){this.x=b.x*c.w+b.y*c.z-b.z*c.y+b.w*c.x;this.y=-b.x*c.z+b.y*c.w+b.z*c.x+b.w*c.y;this.z=b.x*c.y-b.y*c.x+b.z*c.w+b.w*c.z;this.w=-b.x*c.x-b.y*c.y-b.z*c.z+b.w*c.w;return this},multiplyVector3:function(b,c){c||(c=b);var d=b.x,e=b.y,f=b.z,g=this.x,h=this.y,j=this.z,m=this.w,n=m*d+h*f-j*e,t=
m*e+j*d-g*f,o=m*f+g*e-h*d,d=-g*d-h*e-j*f;c.x=n*m+d*-g+t*-j-o*-h;c.y=t*m+d*-h+o*-g-n*-j;c.z=o*m+d*-j+n*-h-t*-g;return c}};
THREE.Quaternion.slerp=function(b,c,d,e){var f=b.w*c.w+b.x*c.x+b.y*c.y+b.z*c.z;if(Math.abs(f)>=1)return d.w=b.w,d.x=b.x,d.y=b.y,d.z=b.z,d;var g=Math.acos(f),h=Math.sqrt(1-f*f);if(Math.abs(h)<0.0010)return d.w=0.5*(b.w+c.w),d.x=0.5*(b.x+c.x),d.y=0.5*(b.y+c.y),d.z=0.5*(b.z+c.z),d;f=Math.sin((1-e)*g)/h;e=Math.sin(e*g)/h;d.w=b.w*f+c.w*e;d.x=b.x*f+c.x*e;d.y=b.y*f+c.y*e;d.z=b.z*f+c.z*e;return d};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,c,d,e,f,g){this.a=b;this.b=c;this.c=d;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=e instanceof Array?e:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=g instanceof Array?g:[g];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,c,d,e,f,g,h){this.a=b;this.b=c;this.c=d;this.d=e;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=h instanceof Array?h:[h];this.centroid=new THREE.Vector3};THREE.UV=function(b,c){this.set(b||0,c||0)};
THREE.UV.prototype={set:function(b,c){this.u=b;this.v=c;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,c,d;b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d.centroid.set(0,0,0),d instanceof THREE.Face3?(d.centroid.addSelf(this.vertices[d.a].position),d.centroid.addSelf(this.vertices[d.b].position),d.centroid.addSelf(this.vertices[d.c].position),d.centroid.divideScalar(3)):d instanceof THREE.Face4&&(d.centroid.addSelf(this.vertices[d.a].position),d.centroid.addSelf(this.vertices[d.b].position),d.centroid.addSelf(this.vertices[d.c].position),
d.centroid.addSelf(this.vertices[d.d].position),d.centroid.divideScalar(4))},computeFaceNormals:function(b){var c,d,e,f,g,h,j=new THREE.Vector3,m=new THREE.Vector3;e=0;for(f=this.faces.length;e<f;e++){g=this.faces[e];if(b&&g.vertexNormals.length){j.set(0,0,0);c=0;for(d=g.vertexNormals.length;c<d;c++)j.addSelf(g.vertexNormals[c]);j.divideScalar(3)}else c=this.vertices[g.a],d=this.vertices[g.b],h=this.vertices[g.c],j.sub(h.position,d.position),m.sub(c.position,d.position),j.crossSelf(m);j.isZero()||
j.normalize();g.normal.copy(j)}},computeVertexNormals:function(){var b,c,d,e;if(this.__tmpVertices==void 0){e=this.__tmpVertices=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<c;b++)e[b]=new THREE.Vector3;b=0;for(c=this.faces.length;b<c;b++)if(d=this.faces[b],d instanceof THREE.Face3)d.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(d instanceof THREE.Face4)d.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else{e=
this.__tmpVertices;b=0;for(c=this.vertices.length;b<c;b++)e[b].set(0,0,0)}b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d instanceof THREE.Face3?(e[d.a].addSelf(d.normal),e[d.b].addSelf(d.normal),e[d.c].addSelf(d.normal)):d instanceof THREE.Face4&&(e[d.a].addSelf(d.normal),e[d.b].addSelf(d.normal),e[d.c].addSelf(d.normal),e[d.d].addSelf(d.normal));b=0;for(c=this.vertices.length;b<c;b++)e[b].normalize();b=0;for(c=this.faces.length;b<c;b++)d=this.faces[b],d instanceof THREE.Face3?(d.vertexNormals[0].copy(e[d.a]),
d.vertexNormals[1].copy(e[d.b]),d.vertexNormals[2].copy(e[d.c])):d instanceof THREE.Face4&&(d.vertexNormals[0].copy(e[d.a]),d.vertexNormals[1].copy(e[d.b]),d.vertexNormals[2].copy(e[d.c]),d.vertexNormals[3].copy(e[d.d]))},computeTangents:function(){function b(b,c,d,e,f,k,g){j=b.vertices[c].position;m=b.vertices[d].position;n=b.vertices[e].position;t=h[f];o=h[k];w=h[g];u=m.x-j.x;A=n.x-j.x;C=m.y-j.y;p=n.y-j.y;x=m.z-j.z;H=n.z-j.z;B=o.u-t.u;I=w.u-t.u;D=o.v-t.v;F=w.v-t.v;T=1/(B*F-I*D);S.set((F*u-D*A)*
T,(F*C-D*p)*T,(F*x-D*H)*T);v.set((B*A-I*u)*T,(B*p-I*C)*T,(B*H-I*x)*T);M[c].addSelf(S);M[d].addSelf(S);M[e].addSelf(S);N[c].addSelf(v);N[d].addSelf(v);N[e].addSelf(v)}var c,d,e,f,g,h,j,m,n,t,o,w,u,A,C,p,x,H,B,I,D,F,T,L,M=[],N=[],S=new THREE.Vector3,v=new THREE.Vector3,J=new THREE.Vector3,k=new THREE.Vector3,P=new THREE.Vector3;c=0;for(d=this.vertices.length;c<d;c++)M[c]=new THREE.Vector3,N[c]=new THREE.Vector3;c=0;for(d=this.faces.length;c<d;c++)g=this.faces[c],h=this.faceVertexUvs[0][c],g instanceof
THREE.Face3?b(this,g.a,g.b,g.c,0,1,2):g instanceof THREE.Face4&&(b(this,g.a,g.b,g.c,0,1,2),b(this,g.a,g.b,g.d,0,1,3));var K=["a","b","c","d"];c=0;for(d=this.faces.length;c<d;c++){g=this.faces[c];for(e=0;e<g.vertexNormals.length;e++)P.copy(g.vertexNormals[e]),f=g[K[e]],L=M[f],J.copy(L),J.subSelf(P.multiplyScalar(P.dot(L))).normalize(),k.cross(g.vertexNormals[e],L),f=k.dot(N[f]),f=f<0?-1:1,g.vertexTangents[e]=new THREE.Vector4(J.x,J.y,J.z,f)}this.hasTangents=!0},computeBoundingBox:function(){var b;
if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var c=1,d=this.vertices.length;c<d;c++){b=this.vertices[c];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;
else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=0,c=0,d=this.vertices.length;c<d;c++)b=Math.max(b,this.vertices[c].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(b,c){return Math.min(b,c)+"_"+Math.max(b,c)}function c(b,c,d){b[c]===
void 0?(b[c]={set:{},array:[]},b[c].set[d]=1,b[c].array.push(d)):b[c].set[d]===void 0&&(b[c].set[d]=1,b[c].array.push(d))}var d,e,f,g,h,j={};d=0;for(e=this.faces.length;d<e;d++)h=this.faces[d],h instanceof THREE.Face3?(f=b(h.a,h.b),c(j,f,d),f=b(h.b,h.c),c(j,f,d),f=b(h.a,h.c),c(j,f,d)):h instanceof THREE.Face4&&(f=b(h.b,h.d),c(j,f,d),f=b(h.a,h.b),c(j,f,d),f=b(h.a,h.d),c(j,f,d),f=b(h.b,h.c),c(j,f,d),f=b(h.c,h.d),c(j,f,d));d=0;for(e=this.edges.length;d<e;d++){h=this.edges[d];f=h.vertexIndices[0];g=h.vertexIndices[1];
h.faceIndices=j[b(f,g)].array;for(f=0;f<h.faceIndices.length;f++)g=h.faceIndices[f],h.faces.push(this.faces[g])}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function c(b,c,d,e,f,g,j){b=(d-b)*0.5;e=(e-c)*0.5;return(2*(c-d)+b+e)*j+(-3*(c-d)-2*b-e)*g+b*f+c}this.points=b;var d=[],e={x:0,y:0,z:0},f,g,h,j,m,n,t,o,w;this.initFromArray=function(b){this.points=[];for(var c=0;c<b.length;c++)this.points[c]={x:b[c][0],y:b[c][1],z:b[c][2]}};this.getPoint=function(b){f=(this.points.length-1)*b;g=Math.floor(f);h=f-g;d[0]=g==0?g:g-1;d[1]=g;d[2]=g>this.points.length-2?g:g+1;d[3]=g>this.points.length-3?g:g+2;n=this.points[d[0]];t=this.points[d[1]];
o=this.points[d[2]];w=this.points[d[3]];j=h*h;m=h*j;e.x=c(n.x,t.x,o.x,w.x,h,j,m);e.y=c(n.y,t.y,o.y,w.y,h,j,m);e.z=c(n.z,t.z,o.z,w.z,h,j,m);return e};this.getControlPointsArray=function(){var b,c,d=this.points.length,e=[];for(b=0;b<d;b++)c=this.points[b],e[b]=[c.x,c.y,c.z];return e};this.getLength=function(b){var c,d,e=c=c=0,f=new THREE.Vector3,g=new THREE.Vector3,j=[],h=0;j[0]=0;b||(b=100);d=this.points.length*b;f.copy(this.points[0]);for(b=1;b<d;b++)c=b/d,position=this.getPoint(c),g.copy(position),
h+=g.distanceTo(f),f.copy(position),c*=this.points.length-1,c=Math.floor(c),c!=e&&(j[c]=h,e=c);j[j.length]=h;return{chunks:j,total:h}};this.reparametrizeByArcLength=function(b){var c,d,e,f,g,j,h=[],m=new THREE.Vector3,o=this.getLength();h.push(m.copy(this.points[0]).clone());for(c=1;c<this.points.length;c++){d=o.chunks[c]-o.chunks[c-1];j=Math.ceil(b*d/o.total);f=(c-1)/(this.points.length-1);g=c/(this.points.length-1);for(d=1;d<j-1;d++)e=f+d*(1/j)*(g-f),position=this.getPoint(e),h.push(m.copy(position).clone());
h.push(m.copy(this.points[c]).clone())}this.points=h}};THREE.Edge=function(b,c,d,e){this.vertices=[b,c];this.vertexIndices=[d,e];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,c,d,e,f){THREE.Object3D.call(this);this.fov=b||50;this.aspect=c||1;this.near=d||0.1;this.far=e||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;
THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,c){this.matrix.rotateAxis(c);c.multiplyScalar(b);this.position.addSelf(c);this.target.position.addSelf(c)};
THREE.Camera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var b=this.fullWidth/this.fullHeight,c=Math.tan(this.fov*Math.PI/360)*this.near,d=-c,e=b*d,b=Math.abs(b*c-e),d=Math.abs(c-d);this.projectionMatrix=THREE.Matrix4.makeFrustum(e+this.x*b/this.fullWidth,e+(this.x+this.width)*b/this.fullWidth,c-(this.y+this.height)*d/this.fullHeight,c-this.y*d/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.setViewOffset=function(b,c,d,e,f,g){this.fullWidth=b;this.fullHeight=c;this.x=d;this.y=e;this.width=f;this.height=g;this.updateProjectionMatrix()};
THREE.Camera.prototype.update=function(b,c,d){if(this.useTarget)this.matrix.lookAt(this.position,this.target.position,this.up),this.matrix.setPosition(this.position),b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix),THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse),c=!0;else if(this.matrixAutoUpdate&&this.updateMatrix(),c||this.matrixWorldNeedsUpdate)b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=
!1,c=!0,THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,c,d)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,c,d,e){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=c||1;this.distance=d||0;this.castShadow=e!==void 0?e:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=c||1;this.distance=d||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,c,d,e){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=void 0;b!==void 0&&this.add(b,c,d,e)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,c,d,e){c===void 0&&(c=-1);d===void 0&&(d=0);if(e===void 0)e=THREE.BillboardBlending;d=Math.min(d,Math.max(0,d));this.lensFlares.push({texture:b,size:c,distance:d,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:e})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,c=this.lensFlares.length,d,e=-this.positionScreen.x*2,f=-this.positionScreen.y*2;for(b=0;b<c;b++)d=this.lensFlares[b],d.x=this.positionScreen.x+e*d.distance,d.y=this.positionScreen.y+f*d.distance,d.wantedRotation=d.x*Math.PI*0.25,d.rotation+=(d.wantedRotation-d.rotation)*0.25};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==void 0?b.opacity:1;this.transparent=b.transparent!==void 0?b.transparent:!1;this.blending=b.blending!==void 0?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==void 0?b.depthTest:!0;this.polygonOffset=b.polygonOffset!==void 0?b.polygonOffset:!1;this.polygonOffsetFactor=b.polygonOffsetFactor!==void 0?b.polygonOffsetFactor:0;this.polygonOffsetUnits=b.polygonOffsetUnits!==void 0?b.polygonOffsetUnits:
0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};
THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==void 0?b.linewidth:1;this.linecap=b.linecap!==void 0?b.linecap:"round";this.linejoin=b.linejoin!==void 0?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;
THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==
void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};
THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==
void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};
THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==void 0?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==void 0?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==void 0?b.shininess:30;this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;
this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==
void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==void 0?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==void 0?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==void 0?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.fog=
b.fog!==void 0?b.fog:!1;this.lights=b.lights!==void 0?b.lights:!1;this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==
void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};
THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.size=b.size!==void 0?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==void 0?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==void 0?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(b){THREE.Material.call(this);this.domElement=b};
THREE.Texture=function(b,c,d,e,f,g){this.image=b;this.mapping=c!==void 0?c:new THREE.UVMapping;this.wrapS=d!==void 0?d:THREE.ClampToEdgeWrapping;this.wrapT=e!==void 0?e:THREE.ClampToEdgeWrapping;this.magFilter=f!==void 0?f:THREE.LinearFilter;this.minFilter=g!==void 0?g:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.needsUpdate=!1};
THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;
THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;
THREE.ParticleSystem=function(b,c){THREE.Object3D.call(this);this.geometry=b;this.materials=c instanceof Array?c:[c];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(b,c,d){THREE.Object3D.call(this);this.geometry=b;this.materials=c instanceof Array?c:[c];this.type=d!=void 0?d:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;
THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,c){THREE.Object3D.call(this);this.geometry=b;this.materials=c&&c.length?c:[c];this.overdraw=!1;if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var d=0;d<this.geometry.morphTargets.length;d++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[d].name]=
d}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==void 0)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,c,d){this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate)b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0;var e,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(e=0;e<f;e++)b=this.children[e],b instanceof THREE.Bone?b.update(this.skinMatrix,c,d):b.update(this.matrixWorld,!0,d)}else for(e=0;e<f;e++)this.children[e].update(this.skinMatrix,
c,d)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1&&(b.parent!==void 0&&b.parent.removeChild(b),b.parent=this,this.children.push(b),!(b instanceof THREE.Bone)))this.hasNoneBoneChildren=!0};
THREE.SkinnedMesh=function(b,c){THREE.Mesh.call(this,b,c);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var d,e,f,g,h,j;if(this.geometry.bones!==void 0){for(d=0;d<this.geometry.bones.length;d++)f=this.geometry.bones[d],g=f.pos,h=f.rotq,j=f.scl,e=this.addBone(),e.name=f.name,e.position.set(g[0],g[1],g[2]),e.quaternion.set(h[0],h[1],h[2],h[3]),e.useQuaternion=!0,j!==void 0?e.scale.set(j[0],j[1],j[2]):e.scale.set(1,1,1);for(d=0;d<this.bones.length;d++)f=this.geometry.bones[d],
e=this.bones[d],f.parent===-1?this.addChild(e):this.bones[f.parent].addChild(e);this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,c,d){if(this.visible){this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate)b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0;var e,f=this.children.length;for(e=0;e<f;e++)b=this.children[e],b instanceof THREE.Bone?b.update(this.identityMatrix,!1,d):b.update(this.matrixWorld,c,d);d=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(c=0;c<d;c++)ba[c].skinMatrix.flattenToArrayOffset(bm,
c*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===void 0&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var b,c=[],d=0;d<this.bones.length;d++)b=this.bones[d],c.push(THREE.Matrix4.makeInvert(b.skinMatrix)),b.skinMatrix.flattenToArrayOffset(this.boneMatrices,d*16);if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var e;for(b=0;b<this.geometry.skinIndices.length;b++){var d=this.geometry.vertices[b].position,f=this.geometry.skinIndices[b].x,g=this.geometry.skinIndices[b].y;e=new THREE.Vector3(d.x,
d.y,d.z);this.geometry.skinVerticesA.push(c[f].multiplyVector3(e));e=new THREE.Vector3(d.x,d.y,d.z);this.geometry.skinVerticesB.push(c[g].multiplyVector3(e));this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1&&(d=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5,this.geometry.skinWeights[b].x+=d,this.geometry.skinWeights[b].y+=d)}}};THREE.Ribbon=function(b,c){THREE.Object3D.call(this);this.geometry=b;this.materials=c instanceof Array?c:[c]};
THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,c,d,e){THREE.Object3D.call(this);this.isPlaying=this.isAddedToDOM=this.isLoaded=!1;this.duration=-1;this.radius=c!==void 0?Math.abs(c):100;this.volume=Math.min(1,Math.max(0,d!==void 0?d:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=e!==void 0?e:!0;this.sources=b instanceof Array?b:[b];for(var f,d=this.sources.length,b=0;b<d;b++)if(c=this.sources[b],c.toLowerCase(),c.indexOf(".mp3")!==-1?f="audio/mpeg":
c.indexOf(".ogg")!==-1?f="audio/ogg":c.indexOf(".wav")!==-1&&(f="audio/wav"),this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded)this.removeEventListener("canplay",this.onLoad,!0),b.isLoaded=!0,b.duration=this.duration,b.isPlaying&&b.play()};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded&&(this.domElement.play(),b))this.domElement.currentTime=b%this.duration};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,c,d){this.matrixAutoUpdate&&(this.matrix.setPosition(this.position),c=!0);if(c||this.matrixWorldNeedsUpdate)b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0;for(var e=this.children.length,b=0;b<e;b++)this.children[b].update(this.matrixWorld,c,d)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,c){c===void 0&&(c=0);for(var c=Math.abs(c),d=0;d<this.LODs.length;d++)if(c<this.LODs[d].visibleAtDistance)break;this.LODs.splice(d,0,{visibleAtDistance:c,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,c,d){this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate)b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0;if(this.LODs.length>1){b=d.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var e=1;e<this.LODs.length;e++)if(b>=this.LODs[e].visibleAtDistance)this.LODs[e-1].object3D.visible=!1,
this.LODs[e].object3D.visible=!0;else break;for(;e<this.LODs.length;e++)this.LODs[e].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,c,d)};THREE.ShadowVolume=function(b,c){b instanceof THREE.Mesh?(THREE.Mesh.call(this,b.geometry,c?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]),b.addChild(this)):THREE.Mesh.call(this,b,c?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,c,d,e,f,g,h,j,m,n,t,o,w,u,A=new THREE.Geometry;A.vertices=this.geometry.vertices;e=A.faces=this.geometry.faces;var C=A.egdes=this.geometry.edges,p=A.edgeFaces=[];f=0;var x=[];b=0;for(c=e.length;b<c;b++)if(d=e[b],x.push(f),f+=d instanceof THREE.Face3?3:4,d.vertexNormals[0]=d.normal,d.vertexNormals[1]=d.normal,d.vertexNormals[2]=d.normal,d instanceof THREE.Face4)d.vertexNormals[3]=
d.normal;b=0;for(c=C.length;b<c;b++)j=C[b],d=j.faces[0],e=j.faces[1],f=j.faceIndices[0],g=j.faceIndices[1],h=j.vertexIndices[0],j=j.vertexIndices[1],d.a===h?(m="a",t=x[f]+0):d.b===h?(m="b",t=x[f]+1):d.c===h?(m="c",t=x[f]+2):d.d===h&&(m="d",t=x[f]+3),d.a===j?(m+="a",o=x[f]+0):d.b===j?(m+="b",o=x[f]+1):d.c===j?(m+="c",o=x[f]+2):d.d===j&&(m+="d",o=x[f]+3),e.a===h?(n="a",w=x[g]+0):e.b===h?(n="b",w=x[g]+1):e.c===h?(n="c",w=x[g]+2):e.d===h&&(n="d",w=x[g]+3),e.a===j?(n+="a",u=x[g]+0):e.b===j?(n+="b",u=x[g]+
1):e.c===j?(n+="c",u=x[g]+2):e.d===j&&(n+="d",u=x[g]+3),m==="ac"||m==="ad"||m==="ca"||m==="da"?t>o&&(d=t,t=o,o=d):t<o&&(d=t,t=o,o=d),n==="ac"||n==="ad"||n==="ca"||n==="da"?w>u&&(d=w,w=u,u=d):w<u&&(d=w,w=u,u=d),d=new THREE.Face4(t,o,w,u),d.normal.set(1,0,0),p.push(d);this.geometry=A}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var c=this.geometry.vertices,d=this.geometry.faces,e=this.geometry.edgeFaces,f=b.faces,b=b.vertices,g=f.length,h,j,m,n,t,o=["a","b","c","d"];for(m=0;m<g;m++){j=c.length;h=f[m];h instanceof THREE.Face4?(n=4,j=new THREE.Face4(j,j+1,j+2,j+3)):(n=3,j=new THREE.Face3(j,j+1,j+2));j.normal.copy(h.normal);d.push(j);
for(j=0;j<n;j++)t=b[h[o[j]]],c.push(new THREE.Vertex(t.position.clone()))}for(g=0;g<f.length-1;g++){b=d[g];for(h=g+1;h<f.length;h++)j=d[h],j=this.facesShareEdge(c,b,j),j!==void 0&&(j=new THREE.Face4(j.indices[0],j.indices[3],j.indices[2],j.indices[1]),j.normal.set(1,0,0),e.push(j))}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,c,d){var e,f,g,h,j,m,n,t,o,w,u,A,C,p=0,x=["a","b","c","d"];e=c instanceof THREE.Face4?4:3;f=d instanceof THREE.Face4?4:3;for(A=0;A<e;A++){g=c[x[A]];j=b[g];for(C=0;C<f;C++)if(h=d[x[C]],m=b[h],Math.abs(j.position.x-m.position.x)<1.0E-4&&Math.abs(j.position.y-m.position.y)<1.0E-4&&Math.abs(j.position.z-m.position.z)<1.0E-4&&(p++,p===1&&(n=j,t=m,o=g,w=h,u=x[A]),p===2))return u+=x[A],u==="ad"||u==="ac"?{faces:[c,d],vertices:[n,t,m,j],indices:[o,w,
h,g],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[c,d],vertices:[n,j,m,t],indices:[o,g,h,w],vertexTypes:[1,1,2,2],extrudable:!0}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==void 0)this.material=b.material,this.map=void 0,this.blending=material.blending;else if(b.map!==void 0)this.map=b.map instanceof THREE.Texture?b.map:THREE.ImageUtils.loadTexture(b.map),this.material=void 0,this.blending=b.blending!==void 0?b.blending:THREE.NormalBlending;this.useScreenCoordinates=b.useScreenCoordinates!==void 0?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==void 0?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==void 0?b.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=b.scaleByViewport!==void 0?b.scaleByViewport:!this.affectedByDistance;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;
THREE.Sprite.prototype.supr=THREE.Object3D.prototype;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);
THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1)this.objects.push(b),this.__objectsAdded.push(b);for(var c=0;c<b.children.length;c++)this.addChildRecurse(b.children[c])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var c=this.lights.indexOf(b);c!==-1&&this.lights.splice(c,1)}else b instanceof THREE.Sound?(c=this.sounds.indexOf(b),c!==-1&&this.sounds.splice(c,1)):b instanceof THREE.Camera||(c=this.objects.indexOf(b),c!==-1&&(this.objects.splice(c,1),this.__objectsRemoved.push(b)));for(c=0;c<b.children.length;c++)this.removeChildRecurse(b.children[c])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,c,d){this.color=new THREE.Color(b);this.near=c||1;this.far=d||1E3};THREE.FogExp2=function(b,c){this.color=new THREE.Color(b);this.density=c!==void 0?c:2.5E-4};
THREE.Projector=function(){function b(){var b=m[j]=m[j]||new THREE.RenderableVertex;j++;return b}function c(b,c){return c.z-b.z}function d(b,c){var d=0,e=1,f=b.z+b.w,g=c.z+c.w,j=-b.z+b.w,h=-c.z+c.w;return f>=0&&g>=0&&j>=0&&h>=0?!0:f<0&&g<0||j<0&&h<0?!1:(f<0?d=Math.max(d,f/(f-g)):g<0&&(e=Math.min(e,f/(f-g))),j<0?d=Math.max(d,j/(j-h)):h<0&&(e=Math.min(e,j/(j-h))),e<d?!1:(b.lerpSelf(c,d),c.lerpSelf(b,1-e),!0))}var e,f,g=[],h,j,m=[],n,t,o=[],w,u=[],A,C,p=[],x,H,B=[],I=new THREE.Vector4,D=new THREE.Vector4,
F=new THREE.Matrix4,T=new THREE.Matrix4,L=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],M=new THREE.Vector4,N=new THREE.Vector4;this.projectVector=function(b,c){F.multiply(c.projectionMatrix,c.matrixWorldInverse);F.multiplyVector3(b);return b};this.unprojectVector=function(b,c){F.multiply(c.matrixWorld,THREE.Matrix4.makeInvert(c.projectionMatrix));F.multiplyVector3(b);return b};this.projectObjects=function(b,d,j){var d=[],k,h,m;f=0;h=
b.objects;b=0;for(k=h.length;b<k;b++){m=h[b];var p;if(!(p=!m.visible))if(p=m instanceof THREE.Mesh){a:{p=void 0;for(var o=m.matrixWorld,z=-m.geometry.boundingSphere.radius*Math.max(m.scale.x,Math.max(m.scale.y,m.scale.z)),E=0;E<6;E++)if(p=L[E].x*o.n14+L[E].y*o.n24+L[E].z*o.n34+L[E].w,p<=z){p=!1;break a}p=!0}p=!p}if(!p)p=g[f]=g[f]||new THREE.RenderableObject,f++,e=p,I.copy(m.position),F.multiplyVector3(I),e.object=m,e.z=I.z,d.push(e)}j&&d.sort(c);return d};this.projectScene=function(e,f,g){var k=[],
P=f.near,K=f.far,U,O,z,E,V,G,R,W,$,y,Q,Z,X,ga,la,va,ma;H=C=w=t=0;f.matrixAutoUpdate&&f.update(void 0,!0);e.update(void 0,!1,f);F.multiply(f.projectionMatrix,f.matrixWorldInverse);L[0].set(F.n41-F.n11,F.n42-F.n12,F.n43-F.n13,F.n44-F.n14);L[1].set(F.n41+F.n11,F.n42+F.n12,F.n43+F.n13,F.n44+F.n14);L[2].set(F.n41+F.n21,F.n42+F.n22,F.n43+F.n23,F.n44+F.n24);L[3].set(F.n41-F.n21,F.n42-F.n22,F.n43-F.n23,F.n44-F.n24);L[4].set(F.n41-F.n31,F.n42-F.n32,F.n43-F.n33,F.n44-F.n34);L[5].set(F.n41+F.n31,F.n42+F.n32,
F.n43+F.n33,F.n44+F.n34);for(U=0;U<6;U++)$=L[U],$.divideScalar(Math.sqrt($.x*$.x+$.y*$.y+$.z*$.z));$=this.projectObjects(e,f,!0);e=0;for(U=$.length;e<U;e++)if(y=$[e].object,y.visible)if(Q=y.matrixWorld,Z=y.matrixRotationWorld,X=y.materials,ga=y.overdraw,j=0,y instanceof THREE.Mesh){la=y.geometry;E=la.vertices;va=la.faces;la=la.faceVertexUvs;O=0;for(z=E.length;O<z;O++)h=b(),h.positionWorld.copy(E[O].position),Q.multiplyVector3(h.positionWorld),h.positionScreen.copy(h.positionWorld),F.multiplyVector4(h.positionScreen),
h.positionScreen.x/=h.positionScreen.w,h.positionScreen.y/=h.positionScreen.w,h.visible=h.positionScreen.z>P&&h.positionScreen.z<K;E=0;for(O=va.length;E<O;E++){z=va[E];if(z instanceof THREE.Face3)if(V=m[z.a],G=m[z.b],R=m[z.c],V.visible&&G.visible&&R.visible&&(y.doubleSided||y.flipSided!=(R.positionScreen.x-V.positionScreen.x)*(G.positionScreen.y-V.positionScreen.y)-(R.positionScreen.y-V.positionScreen.y)*(G.positionScreen.x-V.positionScreen.x)<0))W=o[t]=o[t]||new THREE.RenderableFace3,t++,n=W,n.v1.copy(V),
n.v2.copy(G),n.v3.copy(R);else continue;else if(z instanceof THREE.Face4)if(V=m[z.a],G=m[z.b],R=m[z.c],W=m[z.d],V.visible&&G.visible&&R.visible&&W.visible&&(y.doubleSided||y.flipSided!=((W.positionScreen.x-V.positionScreen.x)*(G.positionScreen.y-V.positionScreen.y)-(W.positionScreen.y-V.positionScreen.y)*(G.positionScreen.x-V.positionScreen.x)<0||(G.positionScreen.x-R.positionScreen.x)*(W.positionScreen.y-R.positionScreen.y)-(G.positionScreen.y-R.positionScreen.y)*(W.positionScreen.x-R.positionScreen.x)<
0)))ma=u[w]=u[w]||new THREE.RenderableFace4,w++,n=ma,n.v1.copy(V),n.v2.copy(G),n.v3.copy(R),n.v4.copy(W);else continue;n.normalWorld.copy(z.normal);Z.multiplyVector3(n.normalWorld);n.centroidWorld.copy(z.centroid);Q.multiplyVector3(n.centroidWorld);n.centroidScreen.copy(n.centroidWorld);F.multiplyVector3(n.centroidScreen);R=z.vertexNormals;V=0;for(G=R.length;V<G;V++)W=n.vertexNormalsWorld[V],W.copy(R[V]),Z.multiplyVector3(W);V=0;for(G=la.length;V<G;V++)if(ma=la[V][E]){R=0;for(W=ma.length;R<W;R++)n.uvs[V][R]=
ma[R]}n.meshMaterials=X;n.faceMaterials=z.materials;n.overdraw=ga;n.z=n.centroidScreen.z;k.push(n)}}else if(y instanceof THREE.Line){T.multiply(F,Q);E=y.geometry.vertices;V=b();V.positionScreen.copy(E[0].position);T.multiplyVector4(V.positionScreen);O=1;for(z=E.length;O<z;O++)if(V=b(),V.positionScreen.copy(E[O].position),T.multiplyVector4(V.positionScreen),G=m[j-2],M.copy(V.positionScreen),N.copy(G.positionScreen),d(M,N))M.multiplyScalar(1/M.w),N.multiplyScalar(1/N.w),Q=p[C]=p[C]||new THREE.RenderableLine,
C++,A=Q,A.v1.positionScreen.copy(M),A.v2.positionScreen.copy(N),A.z=Math.max(M.z,N.z),A.materials=y.materials,k.push(A)}else if(y instanceof THREE.Particle&&(D.set(y.matrixWorld.n14,y.matrixWorld.n24,y.matrixWorld.n34,1),F.multiplyVector4(D),D.z/=D.w,D.z>0&&D.z<1))Q=B[H]=B[H]||new THREE.RenderableParticle,H++,x=Q,x.x=D.x/D.w,x.y=D.y/D.w,x.z=D.z,x.rotation=y.rotation.z,x.scale.x=y.scale.x*Math.abs(x.x-(D.x+f.projectionMatrix.n11)/(D.w+f.projectionMatrix.n14)),x.scale.y=y.scale.y*Math.abs(x.y-(D.y+
f.projectionMatrix.n22)/(D.w+f.projectionMatrix.n24)),x.materials=y.materials,k.push(x);g&&k.sort(c);return k}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var b=null,c=new THREE.Projector,d,e,f,g;this.domElement=document.createElement("div");this.setSize=function(b,c){d=b;e=c;f=d/2;g=e/2};this.render=function(d,e){var m,n,t,o,w,u,A,C;b=c.projectScene(d,e);m=0;for(n=b.length;m<n;m++)if(w=b[m],w instanceof THREE.RenderableParticle){A=w.x*f+f;C=w.y*g+g;t=0;for(o=w.material.length;t<o;t++)if(u=w.material[t],u instanceof THREE.ParticleDOMMaterial)u=u.domElement,u.style.left=A+"px",u.style.top=C+"px"}}};
THREE.CanvasRenderer=function(b){function c(b){if(x!=b)A.globalAlpha=x=b}function d(b){if(H!=b){switch(b){case THREE.NormalBlending:A.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:A.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:A.globalCompositeOperation="darker"}H=b}}function e(b){if(B!=b.hex)B=b.hex,A.strokeStyle="#"+g(B.toString(16))}function f(b){if(I!=b.hex)I=b.hex,A.fillStyle="#"+g(I.toString(16))}function g(b){for(;b.length<6;)b="0"+b;return b}
var h=this,j=null,m=new THREE.Projector,b=b||{},n=b.canvas!==void 0?b.canvas:document.createElement("canvas"),t,o,w,u,A=n.getContext("2d"),C=new THREE.Color(0),p=0,x=1,H=0,B=null,I=null,D=null,F=null,T=null,L,M,N,S,v=new THREE.RenderableVertex,J=new THREE.RenderableVertex,k,P,K,U,O,z,E,V,G,R,W,$,y=new THREE.Color(0),Q=new THREE.Color(0),Z=new THREE.Color(0),X=new THREE.Color(0),ga=new THREE.Color(0),la,va,ma,sa,Za,$a,Ua,Va,Wa,ab,xa=new THREE.Rectangle,na=new THREE.Rectangle,ka=new THREE.Rectangle,
La=!1,ta=new THREE.Color,qa=new THREE.Color,Ga=new THREE.Color,Ma=new THREE.Color,ia=new THREE.Vector3,Ea,Ha,Na,wa,Ia,Oa,b=16;Ea=document.createElement("canvas");Ea.width=Ea.height=2;Ha=Ea.getContext("2d");Ha.fillStyle="rgba(0,0,0,1)";Ha.fillRect(0,0,2,2);Na=Ha.getImageData(0,0,2,2);wa=Na.data;Ia=document.createElement("canvas");Ia.width=Ia.height=b;Oa=Ia.getContext("2d");Oa.translate(-b/2,-b/2);Oa.scale(b,b);b--;this.domElement=n;this.sortElements=this.sortObjects=this.autoClear=!0;this.data={vertices:0,
faces:0};this.setSize=function(b,c){t=b;o=c;w=t/2;u=o/2;n.width=t;n.height=o;xa.set(-w,-u,w,u);x=1;H=0;T=F=D=I=B=null};this.setClearColor=function(b,c){C=b;p=c};this.setClearColorHex=function(b,c){C.setHex(b);p=c};this.clear=function(){A.setTransform(1,0,0,-1,w,u);if(!na.isEmpty())na.inflate(1),na.minSelf(xa),C.hex==0&&p==0?A.clearRect(na.getX(),na.getY(),na.getWidth(),na.getHeight()):(d(THREE.NormalBlending),c(1),A.fillStyle="rgba("+Math.floor(C.r*255)+","+Math.floor(C.g*255)+","+Math.floor(C.b*
255)+","+p+")",A.fillRect(na.getX(),na.getY(),na.getWidth(),na.getHeight())),na.empty()};this.render=function(b,g){function p(b){var c,d,e,f=b.lights;qa.setRGB(0,0,0);Ga.setRGB(0,0,0);Ma.setRGB(0,0,0);b=0;for(c=f.length;b<c;b++)d=f[b],e=d.color,d instanceof THREE.AmbientLight?(qa.r+=e.r,qa.g+=e.g,qa.b+=e.b):d instanceof THREE.DirectionalLight?(Ga.r+=e.r,Ga.g+=e.g,Ga.b+=e.b):d instanceof THREE.PointLight&&(Ma.r+=e.r,Ma.g+=e.g,Ma.b+=e.b)}function o(b,c,d,e){var f,k,g,j,z=b.lights,b=0;for(f=z.length;b<
f;b++)k=z[b],g=k.color,k instanceof THREE.DirectionalLight?(j=d.dot(k.position),j<=0||(j*=k.intensity,e.r+=g.r*j,e.g+=g.g*j,e.b+=g.b*j)):k instanceof THREE.PointLight&&(j=d.dot(ia.sub(k.position,c).normalize()),j<=0||(j*=k.distance==0?1:1-Math.min(c.distanceTo(k.position)/k.distance,1),j!=0&&(j*=k.intensity,e.r+=g.r*j,e.g+=g.g*j,e.b+=g.b*j)))}function n(b,k,g){c(g.opacity);d(g.blending);var j,z,h,G,E,m;if(g instanceof THREE.ParticleBasicMaterial){if(g.map){G=g.map.image;E=G.width>>1;m=G.height>>1;
g=k.scale.x*w;h=k.scale.y*u;j=g*E;z=h*m;ka.set(b.x-j,b.y-z,b.x+j,b.y+z);if(!xa.instersects(ka))return;A.save();A.translate(b.x,b.y);A.rotate(-k.rotation);A.scale(g,-h);A.translate(-E,-m);A.drawImage(G,0,0);A.restore()}A.beginPath();A.moveTo(b.x-10,b.y);A.lineTo(b.x+10,b.y);A.moveTo(b.x,b.y-10);A.lineTo(b.x,b.y+10);A.closePath();A.strokeStyle="rgb(255,255,0)";A.stroke()}else g instanceof THREE.ParticleCanvasMaterial&&(j=k.scale.x*w,z=k.scale.y*u,ka.set(b.x-j,b.y-z,b.x+j,b.y+z),xa.instersects(ka)&&
(e(g.color),f(g.color),A.save(),A.translate(b.x,b.y),A.rotate(-k.rotation),A.scale(j,z),g.program(A),A.restore()))}function x(b,f,k,g){c(g.opacity);d(g.blending);A.beginPath();A.moveTo(b.positionScreen.x,b.positionScreen.y);A.lineTo(f.positionScreen.x,f.positionScreen.y);A.closePath();if(g instanceof THREE.LineBasicMaterial){b=g.linewidth;if(D!=b)A.lineWidth=D=b;b=g.linecap;if(F!=b)A.lineCap=F=b;b=g.linejoin;if(T!=b)A.lineJoin=T=b;e(g.color);A.stroke();ka.inflate(g.linewidth*2)}}function t(b,e,f,
j,G,E,m,v,p){h.data.vertices+=3;h.data.faces++;c(v.opacity);d(v.blending);k=b.positionScreen.x;P=b.positionScreen.y;K=e.positionScreen.x;U=e.positionScreen.y;O=f.positionScreen.x;z=f.positionScreen.y;B(k,P,K,U,O,z);if(v instanceof THREE.MeshBasicMaterial)if(v.map)v.map.mapping instanceof THREE.UVMapping&&(sa=m.uvs[0],ya(k,P,K,U,O,z,v.map.image,sa[j].u,sa[j].v,sa[G].u,sa[G].v,sa[E].u,sa[E].v));else if(v.envMap){if(v.envMap.mapping instanceof THREE.SphericalReflectionMapping)b=g.matrixWorldInverse,
ia.copy(m.vertexNormalsWorld[0]),Za=(ia.x*b.n11+ia.y*b.n12+ia.z*b.n13)*0.5+0.5,$a=-(ia.x*b.n21+ia.y*b.n22+ia.z*b.n23)*0.5+0.5,ia.copy(m.vertexNormalsWorld[1]),Ua=(ia.x*b.n11+ia.y*b.n12+ia.z*b.n13)*0.5+0.5,Va=-(ia.x*b.n21+ia.y*b.n22+ia.z*b.n23)*0.5+0.5,ia.copy(m.vertexNormalsWorld[2]),Wa=(ia.x*b.n11+ia.y*b.n12+ia.z*b.n13)*0.5+0.5,ab=-(ia.x*b.n21+ia.y*b.n22+ia.z*b.n23)*0.5+0.5,ya(k,P,K,U,O,z,v.envMap.image,Za,$a,Ua,Va,Wa,ab)}else v.wireframe?C(v.color,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):
za(v.color);else if(v instanceof THREE.MeshLambertMaterial)v.map&&!v.wireframe&&(v.map.mapping instanceof THREE.UVMapping&&(sa=m.uvs[0],ya(k,P,K,U,O,z,v.map.image,sa[j].u,sa[j].v,sa[G].u,sa[G].v,sa[E].u,sa[E].v)),d(THREE.SubtractiveBlending)),La?!v.wireframe&&v.shading==THREE.SmoothShading&&m.vertexNormalsWorld.length==3?(Q.r=Z.r=X.r=qa.r,Q.g=Z.g=X.g=qa.g,Q.b=Z.b=X.b=qa.b,o(p,m.v1.positionWorld,m.vertexNormalsWorld[0],Q),o(p,m.v2.positionWorld,m.vertexNormalsWorld[1],Z),o(p,m.v3.positionWorld,m.vertexNormalsWorld[2],
X),ga.r=(Z.r+X.r)*0.5,ga.g=(Z.g+X.g)*0.5,ga.b=(Z.b+X.b)*0.5,ma=Ja(Q,Z,X,ga),ya(k,P,K,U,O,z,ma,0,0,1,0,0,1)):(ta.r=qa.r,ta.g=qa.g,ta.b=qa.b,o(p,m.centroidWorld,m.normalWorld,ta),y.r=Math.max(0,Math.min(v.color.r*ta.r,1)),y.g=Math.max(0,Math.min(v.color.g*ta.g,1)),y.b=Math.max(0,Math.min(v.color.b*ta.b,1)),y.updateHex(),v.wireframe?C(y,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):za(y)):v.wireframe?C(v.color,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):za(v.color);else if(v instanceof
THREE.MeshDepthMaterial)la=g.near,va=g.far,Q.r=Q.g=Q.b=1-Ba(b.positionScreen.z,la,va),Z.r=Z.g=Z.b=1-Ba(e.positionScreen.z,la,va),X.r=X.g=X.b=1-Ba(f.positionScreen.z,la,va),ga.r=(Z.r+X.r)*0.5,ga.g=(Z.g+X.g)*0.5,ga.b=(Z.b+X.b)*0.5,ma=Ja(Q,Z,X,ga),ya(k,P,K,U,O,z,ma,0,0,1,0,0,1);else if(v instanceof THREE.MeshNormalMaterial)y.r=Ca(m.normalWorld.x),y.g=Ca(m.normalWorld.y),y.b=Ca(m.normalWorld.z),y.updateHex(),v.wireframe?C(y,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):za(y)}function H(b,
e,f,j,v,m,p,n,u){h.data.vertices+=4;h.data.faces++;c(n.opacity);d(n.blending);if(n.map||n.envMap)t(b,e,j,0,1,3,p,n,u),t(v,f,m,1,2,3,p,n,u);else if(k=b.positionScreen.x,P=b.positionScreen.y,K=e.positionScreen.x,U=e.positionScreen.y,O=f.positionScreen.x,z=f.positionScreen.y,E=j.positionScreen.x,V=j.positionScreen.y,G=v.positionScreen.x,R=v.positionScreen.y,W=m.positionScreen.x,$=m.positionScreen.y,n instanceof THREE.MeshBasicMaterial)I(k,P,K,U,O,z,E,V),n.wireframe?C(n.color,n.wireframeLinewidth,n.wireframeLinecap,
n.wireframeLinejoin):za(n.color);else if(n instanceof THREE.MeshLambertMaterial)La?!n.wireframe&&n.shading==THREE.SmoothShading&&p.vertexNormalsWorld.length==4?(Q.r=Z.r=X.r=ga.r=qa.r,Q.g=Z.g=X.g=ga.g=qa.g,Q.b=Z.b=X.b=ga.b=qa.b,o(u,p.v1.positionWorld,p.vertexNormalsWorld[0],Q),o(u,p.v2.positionWorld,p.vertexNormalsWorld[1],Z),o(u,p.v4.positionWorld,p.vertexNormalsWorld[3],X),o(u,p.v3.positionWorld,p.vertexNormalsWorld[2],ga),ma=Ja(Q,Z,X,ga),B(k,P,K,U,E,V),ya(k,P,K,U,E,V,ma,0,0,1,0,0,1),B(G,R,O,z,W,
$),ya(G,R,O,z,W,$,ma,1,0,1,1,0,1)):(ta.r=qa.r,ta.g=qa.g,ta.b=qa.b,o(u,p.centroidWorld,p.normalWorld,ta),y.r=Math.max(0,Math.min(n.color.r*ta.r,1)),y.g=Math.max(0,Math.min(n.color.g*ta.g,1)),y.b=Math.max(0,Math.min(n.color.b*ta.b,1)),y.updateHex(),I(k,P,K,U,O,z,E,V),n.wireframe?C(y,n.wireframeLinewidth,n.wireframeLinecap,n.wireframeLinejoin):za(y)):(I(k,P,K,U,O,z,E,V),n.wireframe?C(n.color,n.wireframeLinewidth,n.wireframeLinecap,n.wireframeLinejoin):za(n.color));else if(n instanceof THREE.MeshNormalMaterial)y.r=
Ca(p.normalWorld.x),y.g=Ca(p.normalWorld.y),y.b=Ca(p.normalWorld.z),y.updateHex(),I(k,P,K,U,O,z,E,V),n.wireframe?C(y,n.wireframeLinewidth,n.wireframeLinecap,n.wireframeLinejoin):za(y);else if(n instanceof THREE.MeshDepthMaterial)la=g.near,va=g.far,Q.r=Q.g=Q.b=1-Ba(b.positionScreen.z,la,va),Z.r=Z.g=Z.b=1-Ba(e.positionScreen.z,la,va),X.r=X.g=X.b=1-Ba(j.positionScreen.z,la,va),ga.r=ga.g=ga.b=1-Ba(f.positionScreen.z,la,va),ma=Ja(Q,Z,X,ga),B(k,P,K,U,E,V),ya(k,P,K,U,E,V,ma,0,0,1,0,0,1),B(G,R,O,z,W,$),ya(G,
R,O,z,W,$,ma,1,0,1,1,0,1)}function B(b,c,d,e,f,k){A.beginPath();A.moveTo(b,c);A.lineTo(d,e);A.lineTo(f,k);A.lineTo(b,c);A.closePath()}function I(b,c,d,e,f,k,g,j){A.beginPath();A.moveTo(b,c);A.lineTo(d,e);A.lineTo(f,k);A.lineTo(g,j);A.lineTo(b,c);A.closePath()}function C(b,c,d,f){if(D!=c)A.lineWidth=D=c;if(F!=d)A.lineCap=F=d;if(T!=f)A.lineJoin=T=f;e(b);A.stroke();ka.inflate(c*2)}function za(b){f(b);A.fill()}function ya(b,c,d,e,f,k,g,j,z,h,G,E,v){var m,p;m=g.width-1;p=g.height-1;j*=m;z*=p;h*=m;G*=p;
E*=m;v*=p;d-=b;e-=c;f-=b;k-=c;h-=j;G-=z;E-=j;v-=z;m=h*v-E*G;m!=0&&(p=1/m,m=(v*d-G*f)*p,G=(v*e-G*k)*p,d=(h*f-E*d)*p,e=(h*k-E*e)*p,b=b-m*j-d*z,c=c-G*j-e*z,A.save(),A.transform(m,G,d,e,b,c),A.clip(),A.drawImage(g,0,0),A.restore())}function Ja(b,c,d,e){var f=~~(b.r*255),k=~~(b.g*255),b=~~(b.b*255),g=~~(c.r*255),j=~~(c.g*255),c=~~(c.b*255),z=~~(d.r*255),h=~~(d.g*255),d=~~(d.b*255),G=~~(e.r*255),E=~~(e.g*255),e=~~(e.b*255);wa[0]=f<0?0:f>255?255:f;wa[1]=k<0?0:k>255?255:k;wa[2]=b<0?0:b>255?255:b;wa[4]=g<
0?0:g>255?255:g;wa[5]=j<0?0:j>255?255:j;wa[6]=c<0?0:c>255?255:c;wa[8]=z<0?0:z>255?255:z;wa[9]=h<0?0:h>255?255:h;wa[10]=d<0?0:d>255?255:d;wa[12]=G<0?0:G>255?255:G;wa[13]=E<0?0:E>255?255:E;wa[14]=e<0?0:e>255?255:e;Ha.putImageData(Na,0,0);Oa.drawImage(Ea,0,0);return Ia}function Ba(b,c,d){b=(b-c)/(d-c);return b*b*(3-2*b)}function Ca(b){b=(b+1)*0.5;return b<0?0:b>1?1:b}function Aa(b,c){var d=c.x-b.x,e=c.y-b.y,f=1/Math.sqrt(d*d+e*e);d*=f;e*=f;c.x+=d;c.y+=e;b.x-=d;b.y-=e}var Qa,fa,Y,aa,ca,da,ea,ha;this.autoClear?
this.clear():A.setTransform(1,0,0,-1,w,u);h.data.vertices=0;h.data.faces=0;j=m.projectScene(b,g,this.sortElements);A.fillStyle="rgba( 0, 255, 255, 0.5 )";A.fillRect(xa.getX(),xa.getY(),xa.getWidth(),xa.getHeight());(La=b.lights.length>0)&&p(b);Qa=0;for(fa=j.length;Qa<fa;Qa++){Y=j[Qa];ka.empty();if(Y instanceof THREE.RenderableParticle){L=Y;L.x*=w;L.y*=u;aa=0;for(ca=Y.materials.length;aa<ca;)ha=Y.materials[aa++],ha.opacity!=0&&n(L,Y,ha,b)}else if(Y instanceof THREE.RenderableLine){if(L=Y.v1,M=Y.v2,
L.positionScreen.x*=w,L.positionScreen.y*=u,M.positionScreen.x*=w,M.positionScreen.y*=u,ka.addPoint(L.positionScreen.x,L.positionScreen.y),ka.addPoint(M.positionScreen.x,M.positionScreen.y),xa.instersects(ka)){aa=0;for(ca=Y.materials.length;aa<ca;)ha=Y.materials[aa++],ha.opacity!=0&&x(L,M,Y,ha,b)}}else if(Y instanceof THREE.RenderableFace3){if(L=Y.v1,M=Y.v2,N=Y.v3,L.positionScreen.x*=w,L.positionScreen.y*=u,M.positionScreen.x*=w,M.positionScreen.y*=u,N.positionScreen.x*=w,N.positionScreen.y*=u,Y.overdraw&&
(Aa(L.positionScreen,M.positionScreen),Aa(M.positionScreen,N.positionScreen),Aa(N.positionScreen,L.positionScreen)),ka.add3Points(L.positionScreen.x,L.positionScreen.y,M.positionScreen.x,M.positionScreen.y,N.positionScreen.x,N.positionScreen.y),xa.instersects(ka)){aa=0;for(ca=Y.meshMaterials.length;aa<ca;)if(ha=Y.meshMaterials[aa++],ha instanceof THREE.MeshFaceMaterial){da=0;for(ea=Y.faceMaterials.length;da<ea;)(ha=Y.faceMaterials[da++])&&ha.opacity!=0&&t(L,M,N,0,1,2,Y,ha,b)}else ha.opacity!=0&&t(L,
M,N,0,1,2,Y,ha,b)}}else if(Y instanceof THREE.RenderableFace4&&(L=Y.v1,M=Y.v2,N=Y.v3,S=Y.v4,L.positionScreen.x*=w,L.positionScreen.y*=u,M.positionScreen.x*=w,M.positionScreen.y*=u,N.positionScreen.x*=w,N.positionScreen.y*=u,S.positionScreen.x*=w,S.positionScreen.y*=u,v.positionScreen.copy(M.positionScreen),J.positionScreen.copy(S.positionScreen),Y.overdraw&&(Aa(L.positionScreen,M.positionScreen),Aa(M.positionScreen,S.positionScreen),Aa(S.positionScreen,L.positionScreen),Aa(N.positionScreen,v.positionScreen),
Aa(N.positionScreen,J.positionScreen)),ka.addPoint(L.positionScreen.x,L.positionScreen.y),ka.addPoint(M.positionScreen.x,M.positionScreen.y),ka.addPoint(N.positionScreen.x,N.positionScreen.y),ka.addPoint(S.positionScreen.x,S.positionScreen.y),xa.instersects(ka))){aa=0;for(ca=Y.meshMaterials.length;aa<ca;)if(ha=Y.meshMaterials[aa++],ha instanceof THREE.MeshFaceMaterial){da=0;for(ea=Y.faceMaterials.length;da<ea;)(ha=Y.faceMaterials[da++])&&ha.opacity!=0&&H(L,M,N,S,v,J,Y,ha,b)}else ha.opacity!=0&&H(L,
M,N,S,v,J,Y,ha,b)}na.addRectangle(ka)}A.lineWidth=1;A.strokeStyle="rgba( 255, 0, 0, 0.5 )";A.strokeRect(na.getX(),na.getY(),na.getWidth(),na.getHeight());A.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function b(b,c,d){var e,f,k,g;e=0;for(f=b.lights.length;e<f;e++)k=b.lights[e],k instanceof THREE.DirectionalLight?(g=c.normalWorld.dot(k.position)*k.intensity,g>0&&(d.r+=k.color.r*g,d.g+=k.color.g*g,d.b+=k.color.b*g)):k instanceof THREE.PointLight&&(S.sub(k.position,c.centroidWorld),S.normalize(),g=c.normalWorld.dot(S)*k.intensity,g>0&&(d.r+=k.color.r*g,d.g+=k.color.g*g,d.b+=k.color.b*g))}function c(c,d,j,v,G,m){h.data.vertices+=3;h.data.faces++;k=e(P++);k.setAttribute("d",
"M "+c.positionScreen.x+" "+c.positionScreen.y+" L "+d.positionScreen.x+" "+d.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+"z");G instanceof THREE.MeshBasicMaterial?D.hex=G.color.hex:G instanceof THREE.MeshLambertMaterial?I?(F.r=T.r,F.g=T.g,F.b=T.b,b(m,v,F),D.r=Math.max(0,Math.min(G.color.r*F.r,1)),D.g=Math.max(0,Math.min(G.color.g*F.g,1)),D.b=Math.max(0,Math.min(G.color.b*F.b,1)),D.updateHex()):D.hex=G.color.hex:G instanceof THREE.MeshDepthMaterial?(N=1-G.__2near/(G.__farPlusNear-
v.z*G.__farMinusNear),D.setRGB(N,N,N)):G instanceof THREE.MeshNormalMaterial&&D.setRGB(f(v.normalWorld.x),f(v.normalWorld.y),f(v.normalWorld.z));G.wireframe?k.setAttribute("style","fill: none; stroke: #"+g(D.hex.toString(16))+"; stroke-width: "+G.wireframeLinewidth+"; stroke-opacity: "+G.opacity+"; stroke-linecap: "+G.wireframeLinecap+"; stroke-linejoin: "+G.wireframeLinejoin):k.setAttribute("style","fill: #"+g(D.hex.toString(16))+"; fill-opacity: "+G.opacity);n.appendChild(k)}function d(c,d,j,v,
G,m,p){h.data.vertices+=4;h.data.faces++;k=e(P++);k.setAttribute("d","M "+c.positionScreen.x+" "+c.positionScreen.y+" L "+d.positionScreen.x+" "+d.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+" L "+v.positionScreen.x+","+v.positionScreen.y+"z");m instanceof THREE.MeshBasicMaterial?D.hex=m.color.hex:m instanceof THREE.MeshLambertMaterial?I?(F.r=T.r,F.g=T.g,F.b=T.b,b(p,G,F),D.r=Math.max(0,Math.min(m.color.r*F.r,1)),D.g=Math.max(0,Math.min(m.color.g*F.g,1)),D.b=Math.max(0,Math.min(m.color.b*
F.b,1)),D.updateHex()):D.hex=m.color.hex:m instanceof THREE.MeshDepthMaterial?(N=1-m.__2near/(m.__farPlusNear-G.z*m.__farMinusNear),D.setRGB(N,N,N)):m instanceof THREE.MeshNormalMaterial&&D.setRGB(f(G.normalWorld.x),f(G.normalWorld.y),f(G.normalWorld.z));m.wireframe?k.setAttribute("style","fill: none; stroke: #"+g(D.hex.toString(16))+"; stroke-width: "+m.wireframeLinewidth+"; stroke-opacity: "+m.opacity+"; stroke-linecap: "+m.wireframeLinecap+"; stroke-linejoin: "+m.wireframeLinejoin):k.setAttribute("style",
"fill: #"+g(D.hex.toString(16))+"; fill-opacity: "+m.opacity);n.appendChild(k)}function e(b){v[b]==null&&(v[b]=document.createElementNS("http://www.w3.org/2000/svg","path"),U==0&&v[b].setAttribute("shape-rendering","crispEdges"));return v[b]}function f(b){b=(b+1)*0.5;return b<0?0:b>1?1:b}function g(b){for(;b.length<6;)b="0"+b;return b}var h=this,j=null,m=new THREE.Projector,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),t,o,w,u,A,C,p,x,H=new THREE.Rectangle,B=new THREE.Rectangle,I=
!1,D=new THREE.Color(16777215),F=new THREE.Color(16777215),T=new THREE.Color(0),L=new THREE.Color(0),M=new THREE.Color(0),N,S=new THREE.Vector3,v=[],J=[],k,P,K,U=1;this.domElement=n;this.sortElements=this.sortObjects=this.autoClear=!0;this.data={vertices:0,faces:0};this.setQuality=function(b){switch(b){case "high":U=1;break;case "low":U=0}};this.setSize=function(b,c){t=b;o=c;w=t/2;u=o/2;n.setAttribute("viewBox",-w+" "+-u+" "+t+" "+o);n.setAttribute("width",t);n.setAttribute("height",o);H.set(-w,-u,
w,u)};this.clear=function(){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])};this.render=function(b,e){var f,v,G,R,o,t,y,Q;this.autoClear&&this.clear();h.data.vertices=0;h.data.faces=0;j=m.projectScene(b,e,this.sortElements);K=P=0;if(I=b.lights.length>0){y=b.lights;T.setRGB(0,0,0);L.setRGB(0,0,0);M.setRGB(0,0,0);f=0;for(v=y.length;f<v;f++)G=y[f],R=G.color,G instanceof THREE.AmbientLight?(T.r+=R.r,T.g+=R.g,T.b+=R.b):G instanceof THREE.DirectionalLight?(L.r+=R.r,L.g+=R.g,L.b+=R.b):G instanceof
THREE.PointLight&&(M.r+=R.r,M.g+=R.g,M.b+=R.b)}f=0;for(v=j.length;f<v;f++)if(y=j[f],B.empty(),y instanceof THREE.RenderableParticle){A=y;A.x*=w;A.y*=-u;G=0;for(R=y.materials.length;G<R;)G++}else if(y instanceof THREE.RenderableLine){if(A=y.v1,C=y.v2,A.positionScreen.x*=w,A.positionScreen.y*=-u,C.positionScreen.x*=w,C.positionScreen.y*=-u,B.addPoint(A.positionScreen.x,A.positionScreen.y),B.addPoint(C.positionScreen.x,C.positionScreen.y),H.instersects(B)){G=0;for(R=y.materials.length;G<R;)if((Q=y.materials[G++])&&
Q.opacity!=0){o=A;t=C;var F=K++;J[F]==null&&(J[F]=document.createElementNS("http://www.w3.org/2000/svg","line"),U==0&&J[F].setAttribute("shape-rendering","crispEdges"));k=J[F];k.setAttribute("x1",o.positionScreen.x);k.setAttribute("y1",o.positionScreen.y);k.setAttribute("x2",t.positionScreen.x);k.setAttribute("y2",t.positionScreen.y);Q instanceof THREE.LineBasicMaterial&&(k.setAttribute("style","fill: none; stroke: ##"+g(Q.color.hex.toString(16))+"; stroke-width: "+Q.linewidth+"; stroke-opacity: "+
Q.opacity+"; stroke-linecap: "+Q.linecap+"; stroke-linejoin: "+Q.linejoin),n.appendChild(k))}}}else if(y instanceof THREE.RenderableFace3){if(A=y.v1,C=y.v2,p=y.v3,A.positionScreen.x*=w,A.positionScreen.y*=-u,C.positionScreen.x*=w,C.positionScreen.y*=-u,p.positionScreen.x*=w,p.positionScreen.y*=-u,B.addPoint(A.positionScreen.x,A.positionScreen.y),B.addPoint(C.positionScreen.x,C.positionScreen.y),B.addPoint(p.positionScreen.x,p.positionScreen.y),H.instersects(B)){G=0;for(R=y.meshMaterials.length;G<
R;)if(Q=y.meshMaterials[G++],Q instanceof THREE.MeshFaceMaterial){o=0;for(t=y.faceMaterials.length;o<t;)(Q=y.faceMaterials[o++])&&Q.opacity!=0&&c(A,C,p,y,Q,b)}else Q&&Q.opacity!=0&&c(A,C,p,y,Q,b)}}else if(y instanceof THREE.RenderableFace4&&(A=y.v1,C=y.v2,p=y.v3,x=y.v4,A.positionScreen.x*=w,A.positionScreen.y*=-u,C.positionScreen.x*=w,C.positionScreen.y*=-u,p.positionScreen.x*=w,p.positionScreen.y*=-u,x.positionScreen.x*=w,x.positionScreen.y*=-u,B.addPoint(A.positionScreen.x,A.positionScreen.y),B.addPoint(C.positionScreen.x,
C.positionScreen.y),B.addPoint(p.positionScreen.x,p.positionScreen.y),B.addPoint(x.positionScreen.x,x.positionScreen.y),H.instersects(B))){G=0;for(R=y.meshMaterials.length;G<R;)if(Q=y.meshMaterials[G++],Q instanceof THREE.MeshFaceMaterial){o=0;for(t=y.faceMaterials.length;o<t;)(Q=y.faceMaterials[o++])&&Q.opacity!=0&&d(A,C,p,x,y,Q,b)}else Q&&Q.opacity!=0&&d(A,C,p,x,y,Q,b)}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var c,d,e,f={};for(c=0;c<b.length;c++)for(d in e=this.clone(b[c]),e)f[d]=e[d];return f},clone:function(b){var c,d,e,f={};for(c in b)for(d in f[c]={},b[c])e=b[c][d],f[c][d]=e instanceof THREE.Color||e instanceof THREE.Vector3||e instanceof THREE.Texture?e.clone():e;return f}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",
value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},
map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function c(b,c,d){var e,f,g,j=b.vertices,z=j.length,h=b.colors,G=h.length,v=b.__vertexArray,m=b.__colorArray,E=b.__sortArray,p=b.__dirtyVertices,R=b.__dirtyColors;if(d.sortParticles){_projScreenMatrix.multiplySelf(d.matrixWorld);for(e=0;e<z;e++)f=j[e].position,_vector3.copy(f),_projScreenMatrix.multiplyVector3(_vector3),E[e]=[_vector3.z,e];E.sort(function(b,c){return c[0]-b[0]});for(e=0;e<z;e++)f=j[E[e][1]].position,g=e*3,v[g]=f.x,v[g+1]=f.y,v[g+2]=f.z;for(e=0;e<G;e++)g=
e*3,color=h[E[e][1]],m[g]=color.r,m[g+1]=color.g,m[g+2]=color.b}else{if(p)for(e=0;e<z;e++)f=j[e].position,g=e*3,v[g]=f.x,v[g+1]=f.y,v[g+2]=f.z;if(R)for(e=0;e<G;e++)color=h[e],g=e*3,m[g]=color.r,m[g+1]=color.g,m[g+2]=color.b}if(p||d.sortParticles)k.bindBuffer(k.ARRAY_BUFFER,b.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,v,c);if(R||d.sortParticles)k.bindBuffer(k.ARRAY_BUFFER,b.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,m,c)}function d(b,c,d,e,f){e.program||J.initMaterial(e,c,d,f);var g=e.program,
j=g.uniforms,z=e.uniforms;g!=K&&(k.useProgram(g),K=g);k.uniformMatrix4fv(j.projectionMatrix,!1,_projectionMatrixArray);if(d&&(e instanceof THREE.MeshBasicMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshPhongMaterial||e instanceof THREE.LineBasicMaterial||e instanceof THREE.ParticleBasicMaterial||e.fog))if(z.fogColor.value=d.color,d instanceof THREE.Fog)z.fogNear.value=d.near,z.fogFar.value=d.far;else if(d instanceof THREE.FogExp2)z.fogDensity.value=d.density;if(e instanceof
THREE.MeshPhongMaterial||e instanceof THREE.MeshLambertMaterial||e.lights){var h,G,v=0,m=0,E=0,p,R,o,n,u=_lights,V=u.directional.colors,P=u.directional.positions,W=u.point.colors,w=u.point.positions,t=u.point.distances,x=0,O=0,d=G=n=0;for(h=c.length;d<h;d++)if(G=c[d],p=G.color,R=G.position,o=G.intensity,n=G.distance,G instanceof THREE.AmbientLight)v+=p.r,m+=p.g,E+=p.b;else if(G instanceof THREE.DirectionalLight)n=x*3,V[n]=p.r*o,V[n+1]=p.g*o,V[n+2]=p.b*o,P[n]=R.x,P[n+1]=R.y,P[n+2]=R.z,x+=1;else if(G instanceof
THREE.PointLight)G=O*3,W[G]=p.r*o,W[G+1]=p.g*o,W[G+2]=p.b*o,w[G]=R.x,w[G+1]=R.y,w[G+2]=R.z,t[O]=n,O+=1;for(d=x*3;d<V.length;d++)V[d]=0;for(d=O*3;d<W.length;d++)W[d]=0;u.point.length=O;u.directional.length=x;u.ambient[0]=v;u.ambient[1]=m;u.ambient[2]=E;d=_lights;z.enableLighting.value=d.directional.length+d.point.length;z.ambientLightColor.value=d.ambient;z.directionalLightColor.value=d.directional.colors;z.directionalLightDirection.value=d.directional.positions;z.pointLightColor.value=d.point.colors;
z.pointLightPosition.value=d.point.positions;z.pointLightDistance.value=d.point.distances}if(e instanceof THREE.MeshBasicMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshPhongMaterial)z.diffuse.value=e.color,z.opacity.value=e.opacity,(z.map.texture=e.map)&&z.offsetRepeat.value.set(e.map.offset.x,e.map.offset.y,e.map.repeat.x,e.map.repeat.y),z.lightMap.texture=e.lightMap,z.envMap.texture=e.envMap,z.reflectivity.value=e.reflectivity,z.refractionRatio.value=e.refractionRatio,
z.combine.value=e.combine,z.useRefract.value=e.envMap&&e.envMap.mapping instanceof THREE.CubeRefractionMapping;if(e instanceof THREE.LineBasicMaterial)z.diffuse.value=e.color,z.opacity.value=e.opacity;else if(e instanceof THREE.ParticleBasicMaterial)z.psColor.value=e.color,z.opacity.value=e.opacity,z.size.value=e.size,z.scale.value=_canvas.height/2,z.map.texture=e.map;else if(e instanceof THREE.MeshPhongMaterial)z.ambient.value=e.ambient,z.specular.value=e.specular,z.shininess.value=e.shininess;else if(e instanceof
THREE.MeshDepthMaterial)z.mNear.value=b.near,z.mFar.value=b.far,z.opacity.value=e.opacity;else if(e instanceof THREE.MeshNormalMaterial)z.opacity.value=e.opacity;for(var y in z)if(m=g.uniforms[y])if(h=z[y],v=h.type,d=h.value,v=="i")k.uniform1i(m,d);else if(v=="f")k.uniform1f(m,d);else if(v=="fv1")k.uniform1fv(m,d);else if(v=="fv")k.uniform3fv(m,d);else if(v=="v2")k.uniform2f(m,d.x,d.y);else if(v=="v3")k.uniform3f(m,d.x,d.y,d.z);else if(v=="v4")k.uniform4f(m,d.x,d.y,d.z,d.w);else if(v=="c")k.uniform3f(m,
d.r,d.g,d.b);else if(v=="t"&&(k.uniform1i(m,d),h=h.texture))if(h.image instanceof Array&&h.image.length==6){if(h.image.length==6){if(h.needsUpdate){if(h.__webglInit){k.bindTexture(k.TEXTURE_CUBE_MAP,h.image.__webglTextureCube);for(v=0;v<6;++v)k.texSubImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,0,0,k.RGBA,k.UNSIGNED_BYTE,h.image[v])}else{h.image.__webglTextureCube=k.createTexture();k.bindTexture(k.TEXTURE_CUBE_MAP,h.image.__webglTextureCube);for(v=0;v<6;++v)k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+
v,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,h.image[v]);h.__webglInit=!0}T(k.TEXTURE_CUBE_MAP,h,h.image[0]);k.bindTexture(k.TEXTURE_CUBE_MAP,null);h.needsUpdate=!1}k.activeTexture(k.TEXTURE0+d);k.bindTexture(k.TEXTURE_CUBE_MAP,h.image.__webglTextureCube)}}else L(h,d);k.uniformMatrix4fv(j.modelViewMatrix,!1,f._modelViewMatrixArray);k.uniformMatrix3fv(j.normalMatrix,!1,f._normalMatrixArray);(e instanceof THREE.MeshShaderMaterial||e instanceof THREE.MeshPhongMaterial||e.envMap)&&j.cameraPosition!==null&&k.uniform3f(j.cameraPosition,
b.position.x,b.position.y,b.position.z);(e instanceof THREE.MeshShaderMaterial||e.envMap||e.skinning)&&j.objectMatrix!==null&&k.uniformMatrix4fv(j.objectMatrix,!1,f._objectMatrixArray);(e instanceof THREE.MeshPhongMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshShaderMaterial||e.skinning)&&j.viewMatrix!==null&&k.uniformMatrix4fv(j.viewMatrix,!1,_viewMatrixArray);if(e instanceof THREE.ShadowVolumeDynamicMaterial)b=z.directionalLightDirection.value,b[0]=-c[1].position.x,b[1]=
-c[1].position.y,b[2]=-c[1].position.z,k.uniform3fv(j.directionalLightDirection,b),k.uniformMatrix4fv(j.objectMatrix,!1,f._objectMatrixArray),k.uniformMatrix4fv(j.viewMatrix,!1,_viewMatrixArray);e.skinning&&(k.uniformMatrix4fv(j.cameraInverseMatrix,!1,_viewMatrixArray),k.uniformMatrix4fv(j.boneGlobalMatrices,!1,f.boneMatrices));return g}function e(b,c,e,f,g,j){if(f.opacity!=0){var z,b=d(b,c,e,f,j).attributes;if(!f.morphTargets&&b.position>=0)k.bindBuffer(k.ARRAY_BUFFER,g.__webglVertexBuffer),k.vertexAttribPointer(b.position,
3,k.FLOAT,!1,0,0);else{c=f.program.attributes;j.morphTargetBase!==-1?(k.bindBuffer(k.ARRAY_BUFFER,g.__webglMorphTargetsBuffers[j.morphTargetBase]),k.vertexAttribPointer(c.position,3,k.FLOAT,!1,0,0)):c.position>=0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglVertexBuffer),k.vertexAttribPointer(c.position,3,k.FLOAT,!1,0,0));if(j.morphTargetForcedOrder.length)for(var e=0,h=j.morphTargetForcedOrder,G=j.morphTargetInfluences;e<f.numSupportedMorphTargets&&e<h.length;)k.bindBuffer(k.ARRAY_BUFFER,g.__webglMorphTargetsBuffers[h[e]]),
k.vertexAttribPointer(c["morphTarget"+e],3,k.FLOAT,!1,0,0),j.__webglMorphTargetInfluences[e]=G[h[e]],e++;else{var h=[],v=-1,m=0,G=j.morphTargetInfluences,E,p=G.length,e=0;for(j.morphTargetBase!==-1&&(h[j.morphTargetBase]=!0);e<f.numSupportedMorphTargets;){for(E=0;E<p;E++)!h[E]&&G[E]>v&&(m=E,v=G[m]);k.bindBuffer(k.ARRAY_BUFFER,g.__webglMorphTargetsBuffers[m]);k.vertexAttribPointer(c["morphTarget"+e],3,k.FLOAT,!1,0,0);j.__webglMorphTargetInfluences[e]=v;h[m]=1;v=-1;e++}}f.program.uniforms.morphTargetInfluences!==
null&&k.uniform1fv(f.program.uniforms.morphTargetInfluences,j.__webglMorphTargetInfluences)}if(g.__webglCustomAttributes)for(z in g.__webglCustomAttributes)b[z]>=0&&(c=g.__webglCustomAttributes[z],k.bindBuffer(k.ARRAY_BUFFER,c.buffer),k.vertexAttribPointer(b[z],c.size,k.FLOAT,!1,0,0));b.color>=0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglColorBuffer),k.vertexAttribPointer(b.color,3,k.FLOAT,!1,0,0));b.normal>=0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglNormalBuffer),k.vertexAttribPointer(b.normal,3,k.FLOAT,
!1,0,0));b.tangent>=0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglTangentBuffer),k.vertexAttribPointer(b.tangent,4,k.FLOAT,!1,0,0));b.uv>=0&&(g.__webglUVBuffer?(k.bindBuffer(k.ARRAY_BUFFER,g.__webglUVBuffer),k.vertexAttribPointer(b.uv,2,k.FLOAT,!1,0,0),k.enableVertexAttribArray(b.uv)):k.disableVertexAttribArray(b.uv));b.uv2>=0&&(g.__webglUV2Buffer?(k.bindBuffer(k.ARRAY_BUFFER,g.__webglUV2Buffer),k.vertexAttribPointer(b.uv2,2,k.FLOAT,!1,0,0),k.enableVertexAttribArray(b.uv2)):k.disableVertexAttribArray(b.uv2));
f.skinning&&b.skinVertexA>=0&&b.skinVertexB>=0&&b.skinIndex>=0&&b.skinWeight>=0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinVertexABuffer),k.vertexAttribPointer(b.skinVertexA,4,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinVertexBBuffer),k.vertexAttribPointer(b.skinVertexB,4,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinIndicesBuffer),k.vertexAttribPointer(b.skinIndex,4,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinWeightsBuffer),k.vertexAttribPointer(b.skinWeight,
4,k.FLOAT,!1,0,0));j instanceof THREE.Mesh?(f.wireframe?(k.lineWidth(f.wireframeLinewidth),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,g.__webglLineBuffer),k.drawElements(k.LINES,g.__webglLineCount,k.UNSIGNED_SHORT,0)):(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,g.__webglFaceBuffer),k.drawElements(k.TRIANGLES,g.__webglFaceCount,k.UNSIGNED_SHORT,0)),J.data.vertices+=g.__webglFaceCount,J.data.faces+=g.__webglFaceCount/3,J.data.drawCalls++):j instanceof THREE.Line?(j=j.type==THREE.LineStrip?k.LINE_STRIP:k.LINES,k.lineWidth(f.linewidth),
k.drawArrays(j,0,g.__webglLineCount),J.data.drawCalls++):j instanceof THREE.ParticleSystem?(k.drawArrays(k.POINTS,0,g.__webglParticleCount),J.data.drawCalls++):j instanceof THREE.Ribbon&&(k.drawArrays(k.TRIANGLE_STRIP,0,g.__webglVertexCount),J.data.drawCalls++)}}function f(b,c,d){if(!b.__webglVertexBuffer)b.__webglVertexBuffer=k.createBuffer();if(!b.__webglNormalBuffer)b.__webglNormalBuffer=k.createBuffer();b.hasPos&&(k.bindBuffer(k.ARRAY_BUFFER,b.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,
b.positionArray,k.DYNAMIC_DRAW),k.enableVertexAttribArray(c.attributes.position),k.vertexAttribPointer(c.attributes.position,3,k.FLOAT,!1,0,0));if(b.hasNormal){k.bindBuffer(k.ARRAY_BUFFER,b.__webglNormalBuffer);if(d==THREE.FlatShading){var e,f,g,j,z,h,G,v,m,E,p=b.count*3;for(E=0;E<p;E+=9)d=b.normalArray,e=d[E],f=d[E+1],g=d[E+2],j=d[E+3],h=d[E+4],v=d[E+5],z=d[E+6],G=d[E+7],m=d[E+8],e=(e+j+z)/3,f=(f+h+G)/3,g=(g+v+m)/3,d[E]=e,d[E+1]=f,d[E+2]=g,d[E+3]=e,d[E+4]=f,d[E+5]=g,d[E+6]=e,d[E+7]=f,d[E+8]=g}k.bufferData(k.ARRAY_BUFFER,
b.normalArray,k.DYNAMIC_DRAW);k.enableVertexAttribArray(c.attributes.normal);k.vertexAttribPointer(c.attributes.normal,3,k.FLOAT,!1,0,0)}k.drawArrays(k.TRIANGLES,0,b.count);b.count=0}function g(b){if(z!=b.doubleSided)b.doubleSided?k.disable(k.CULL_FACE):k.enable(k.CULL_FACE),z=b.doubleSided;if(E!=b.flipSided)b.flipSided?k.frontFace(k.CW):k.frontFace(k.CCW),E=b.flipSided}function h(b){G!=b&&(b?k.enable(k.DEPTH_TEST):k.disable(k.DEPTH_TEST),G=b)}function j(b,c,d){R!=b&&(b?k.enable(k.POLYGON_OFFSET_FILL):
k.disable(k.POLYGON_OFFSET_FILL),R=b);if(b&&(_oldPolygonOffsetFactor!=c||_oldPolygonOffsetUnits!=d))k.polygonOffset(c,d),_oldPolygonOffsetFactor=c,_oldPolygonOffsetUnits=d}function m(b){_frustum[0].set(b.n41-b.n11,b.n42-b.n12,b.n43-b.n13,b.n44-b.n14);_frustum[1].set(b.n41+b.n11,b.n42+b.n12,b.n43+b.n13,b.n44+b.n14);_frustum[2].set(b.n41+b.n21,b.n42+b.n22,b.n43+b.n23,b.n44+b.n24);_frustum[3].set(b.n41-b.n21,b.n42-b.n22,b.n43-b.n23,b.n44-b.n24);_frustum[4].set(b.n41-b.n31,b.n42-b.n32,b.n43-b.n33,b.n44-
b.n34);_frustum[5].set(b.n41+b.n31,b.n42+b.n32,b.n43+b.n33,b.n44+b.n34);for(var c,b=0;b<6;b++)c=_frustum[b],c.divideScalar(Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z))}function n(b){for(var c=b.matrixWorld,d=-b.geometry.boundingSphere.radius*Math.max(b.scale.x,Math.max(b.scale.y,b.scale.z)),e=0;e<6;e++)if(b=_frustum[e].x*c.n14+_frustum[e].y*c.n24+_frustum[e].z*c.n34+_frustum[e].w,b<=d)return!1;return!0}function t(b,c){b.list[b.count]=c;b.count+=1}function o(b){var c,d,e=b.object,f=b.opaque,g=b.transparent;
g.count=0;b=f.count=0;for(c=e.materials.length;b<c;b++)d=e.materials[b],d.transparent?t(g,d):t(f,d)}function w(b){var c,d,e,f,g=b.object,k=b.buffer,j=b.opaque,z=b.transparent;z.count=0;b=j.count=0;for(e=g.materials.length;b<e;b++)if(c=g.materials[b],c instanceof THREE.MeshFaceMaterial){c=0;for(d=k.materials.length;c<d;c++)(f=k.materials[c])&&(f.transparent?t(z,f):t(j,f))}else(f=c)&&(f.transparent?t(z,f):t(j,f))}function u(b,c){return c.z-b.z}function A(b){k.enable(k.POLYGON_OFFSET_FILL);k.polygonOffset(0.1,
1);k.enable(k.STENCIL_TEST);k.enable(k.DEPTH_TEST);k.depthMask(!1);k.colorMask(!1,!1,!1,!1);k.stencilFunc(k.ALWAYS,1,255);k.stencilOpSeparate(k.BACK,k.KEEP,k.INCR,k.KEEP);k.stencilOpSeparate(k.FRONT,k.KEEP,k.DECR,k.KEEP);var c,d=b.lights.length,e,f=b.lights,g=[],j,z,h,G,v,m=b.__webglShadowVolumes.length;for(c=0;c<d;c++)if(e=b.lights[c],e instanceof THREE.DirectionalLight&&e.castShadow){g[0]=-e.position.x;g[1]=-e.position.y;g[2]=-e.position.z;for(v=0;v<m;v++)e=b.__webglShadowVolumes[v].object,j=b.__webglShadowVolumes[v].buffer,
z=e.materials[0],z.program||J.initMaterial(z,f,void 0,e),z=z.program,h=z.uniforms,G=z.attributes,K!==z&&(k.useProgram(z),K=z,k.uniformMatrix4fv(h.projectionMatrix,!1,_projectionMatrixArray),k.uniformMatrix4fv(h.viewMatrix,!1,_viewMatrixArray),k.uniform3fv(h.directionalLightDirection,g)),e.matrixWorld.flattenToArray(e._objectMatrixArray),k.uniformMatrix4fv(h.objectMatrix,!1,e._objectMatrixArray),k.bindBuffer(k.ARRAY_BUFFER,j.__webglVertexBuffer),k.vertexAttribPointer(G.position,3,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,
j.__webglNormalBuffer),k.vertexAttribPointer(G.normal,3,k.FLOAT,!1,0,0),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,j.__webglFaceBuffer),k.cullFace(k.FRONT),k.drawElements(k.TRIANGLES,j.__webglFaceCount,k.UNSIGNED_SHORT,0),k.cullFace(k.BACK),k.drawElements(k.TRIANGLES,j.__webglFaceCount,k.UNSIGNED_SHORT,0)}k.disable(k.POLYGON_OFFSET_FILL);k.colorMask(!0,!0,!0,!0);k.stencilFunc(k.NOTEQUAL,0,255);k.stencilOp(k.KEEP,k.KEEP,k.KEEP);k.disable(k.DEPTH_TEST);V=-1;K=y.program;k.useProgram(y.program);k.uniformMatrix4fv(y.projectionLocation,
!1,_projectionMatrixArray);k.uniform1f(y.darknessLocation,y.darkness);k.bindBuffer(k.ARRAY_BUFFER,y.vertexBuffer);k.vertexAttribPointer(y.vertexLocation,3,k.FLOAT,!1,0,0);k.enableVertexAttribArray(y.vertexLocation);k.blendFunc(k.ONE,k.ONE_MINUS_SRC_ALPHA);k.blendEquation(k.FUNC_ADD);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,y.elementBuffer);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);k.disable(k.STENCIL_TEST);k.enable(k.DEPTH_TEST);k.depthMask(O)}function C(b,c){var d,e,f;d=_sprite.attributes;var g=
_sprite.uniforms,j=_viewportHeight/_viewportWidth,z,h=[],G=_viewportWidth*0.5,v=_viewportHeight*0.5,m=!0;k.useProgram(_sprite.program);K=_sprite.program;V=-1;X||(k.enableVertexAttribArray(_sprite.attributes.position),k.enableVertexAttribArray(_sprite.attributes.uv),X=!0);k.disable(k.CULL_FACE);k.enable(k.BLEND);k.depthMask(!0);k.bindBuffer(k.ARRAY_BUFFER,_sprite.vertexBuffer);k.vertexAttribPointer(d.position,2,k.FLOAT,!1,16,0);k.vertexAttribPointer(d.uv,2,k.FLOAT,!1,16,8);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);k.uniformMatrix4fv(g.projectionMatrix,!1,_projectionMatrixArray);k.activeTexture(k.TEXTURE0);k.uniform1i(g.map,0);d=0;for(e=b.__webglSprites.length;d<e;d++)f=b.__webglSprites[d],f.useScreenCoordinates?f.z=-f.position.z:(f._modelViewMatrix.multiplyToArray(c.matrixWorldInverse,f.matrixWorld,f._modelViewMatrixArray),f.z=-f._modelViewMatrix.n34);b.__webglSprites.sort(u);d=0;for(e=b.__webglSprites.length;d<e;d++)f=b.__webglSprites[d],f.material===void 0&&f.map&&f.map.image&&f.map.image.width&&
(f.useScreenCoordinates?(k.uniform1i(g.useScreenCoordinates,1),k.uniform3f(g.screenPosition,(f.position.x-G)/G,(v-f.position.y)/v,Math.max(0,Math.min(1,f.position.z)))):(k.uniform1i(g.useScreenCoordinates,0),k.uniform1i(g.affectedByDistance,f.affectedByDistance?1:0),k.uniformMatrix4fv(g.modelViewMatrix,!1,f._modelViewMatrixArray)),z=f.map.image.width/(f.scaleByViewport?_viewportHeight:1),h[0]=z*j*f.scale.x,h[1]=z*f.scale.y,k.uniform2f(g.uvScale,f.uvScale.x,f.uvScale.y),k.uniform2f(g.uvOffset,f.uvOffset.x,
f.uvOffset.y),k.uniform2f(g.alignment,f.alignment.x,f.alignment.y),k.uniform1f(g.opacity,f.opacity),k.uniform1f(g.rotation,f.rotation),k.uniform2fv(g.scale,h),f.mergeWith3D&&!m?(k.enable(k.DEPTH_TEST),m=!0):!f.mergeWith3D&&m&&(k.disable(k.DEPTH_TEST),m=!1),F(f.blending),L(f.map,0),k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0));k.enable(k.CULL_FACE);k.enable(k.DEPTH_TEST);k.depthMask(O)}function p(b,c){var d,e,f=b.__webglLensFlares.length,g,j,z,h=new THREE.Vector3,G=_viewportHeight/_viewportWidth,
v=_viewportWidth*0.5,m=_viewportHeight*0.5,E=16/_viewportHeight,p=[E*G,E],R=[1,1,0],o=[1,1],n=Q.uniforms;d=Q.attributes;k.useProgram(Q.program);K=Q.program;V=-1;Z||(k.enableVertexAttribArray(Q.attributes.vertex),k.enableVertexAttribArray(Q.attributes.uv),Z=!0);k.uniform1i(n.occlusionMap,0);k.uniform1i(n.map,1);k.bindBuffer(k.ARRAY_BUFFER,Q.vertexBuffer);k.vertexAttribPointer(d.vertex,2,k.FLOAT,!1,16,0);k.vertexAttribPointer(d.uv,2,k.FLOAT,!1,16,8);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Q.elementBuffer);
k.disable(k.CULL_FACE);k.depthMask(!1);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,Q.occlusionTexture);k.activeTexture(k.TEXTURE1);for(e=0;e<f;e++)if(d=b.__webglLensFlares[e].object,h.set(d.matrixWorld.n14,d.matrixWorld.n24,d.matrixWorld.n34),c.matrixWorldInverse.multiplyVector3(h),c.projectionMatrix.multiplyVector3(h),R[0]=h.x,R[1]=h.y,R[2]=h.z,o[0]=R[0]*v+v,o[1]=R[1]*m+m,Q.hasVertexTexture||o[0]>0&&o[0]<_viewportWidth&&o[1]>0&&o[1]<_viewportHeight){k.bindTexture(k.TEXTURE_2D,Q.tempTexture);
k.copyTexImage2D(k.TEXTURE_2D,0,k.RGB,o[0]-8,o[1]-8,16,16,0);k.uniform1i(n.renderType,0);k.uniform2fv(n.scale,p);k.uniform3fv(n.screenPosition,R);k.disable(k.BLEND);k.enable(k.DEPTH_TEST);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);k.bindTexture(k.TEXTURE_2D,Q.occlusionTexture);k.copyTexImage2D(k.TEXTURE_2D,0,k.RGBA,o[0]-8,o[1]-8,16,16,0);k.uniform1i(n.renderType,1);k.disable(k.DEPTH_TEST);k.bindTexture(k.TEXTURE_2D,Q.tempTexture);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);d.positionScreen.x=
R[0];d.positionScreen.y=R[1];d.positionScreen.z=R[2];d.customUpdateCallback?d.customUpdateCallback(d):d.updateLensFlares();k.uniform1i(n.renderType,2);k.enable(k.BLEND);g=0;for(j=d.lensFlares.length;g<j;g++)if(z=d.lensFlares[g],z.opacity>0.0010&&z.scale>0.0010)R[0]=z.x,R[1]=z.y,R[2]=z.z,E=z.size*z.scale/_viewportHeight,p[0]=E*G,p[1]=E,k.uniform3fv(n.screenPosition,R),k.uniform2fv(n.scale,p),k.uniform1f(n.rotation,z.rotation),k.uniform1f(n.opacity,z.opacity),F(z.blending),L(z.texture,1),k.drawElements(k.TRIANGLES,
6,k.UNSIGNED_SHORT,0)}k.enable(k.CULL_FACE);k.enable(k.DEPTH_TEST);k.depthMask(O)}function x(b,c){b._modelViewMatrix.multiplyToArray(c.matrixWorldInverse,b.matrixWorld,b._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(b._modelViewMatrix).transposeIntoArray(b._normalMatrixArray)}function H(b){var d,e,f,g;if(b instanceof THREE.Mesh){e=b.geometry;for(d in e.geometryGroups){f=e.geometryGroups[d];a:{for(var j=g=void 0,z=void 0,h=void 0,G=void 0,G=f.__materials,j=0,z=G.length;j<z;j++)if(h=G[j],h.attributes)for(g in h.attributes)if(h.attributes[g].needsUpdate){g=
!0;break a}g=!1}if(e.__dirtyVertices||e.__dirtyMorphTargets||e.__dirtyElements||e.__dirtyUvs||e.__dirtyNormals||e.__dirtyColors||e.__dirtyTangents||g)if(g=f,j=b,z=k.DYNAMIC_DRAW,g.__inittedArrays){var v=G=h=void 0,m=void 0,E=v=void 0,p=void 0,R=void 0,o=void 0,n=void 0,u=void 0,V=void 0,P=void 0,J=void 0,W=void 0,w=void 0,K=void 0,t=void 0,x=m=o=m=R=p=void 0,O=void 0,y=O=x=p=void 0,$=void 0,H=y=O=x=v=v=E=o=m=y=O=x=$=y=O=x=$=y=O=x=void 0,B=0,U=0,Q=0,A=0,F=0,I=0,X=0,Z=0,C=0,D=0,L=0,O=x=0,M=g.__vertexArray,
T=g.__uvArray,N=g.__uv2Array,S=g.__normalArray,fa=g.__tangentArray,Y=g.__colorArray,aa=g.__skinVertexAArray,ca=g.__skinVertexBArray,da=g.__skinIndexArray,ea=g.__skinWeightArray,ha=g.__morphTargetsArrays,ua=g.__webglCustomAttributes,y=void 0,oa=g.__faceArray,ra=g.__lineArray,Xa=g.__needsSmoothNormals,u=g.__vertexColorType,n=g.__uvType,V=g.__normalType,ja=j.geometry,cb=ja.__dirtyVertices,db=ja.__dirtyElements,Ya=ja.__dirtyUvs,eb=ja.__dirtyNormals,ib=ja.__dirtyTangents,jb=ja.__dirtyColors,kb=ja.__dirtyMorphTargets,
Pa=ja.vertices,sb=g.faces,vb=ja.faces,tb=ja.faceVertexUvs[0],ub=ja.faceVertexUvs[1],Ra=ja.skinVerticesA,Sa=ja.skinVerticesB,Ta=ja.skinIndices,Fa=ja.skinWeights,Ka=j instanceof THREE.ShadowVolume?ja.edgeFaces:void 0,Da=ja.morphTargets;if(ua)for(H in ua)ua[H].offset=0,ua[H].offsetSrc=0;h=0;for(G=sb.length;h<G;h++)if(v=sb[h],m=vb[v],tb&&(P=tb[v]),ub&&(J=ub[v]),v=m.vertexNormals,E=m.normal,p=m.vertexColors,R=m.color,o=m.vertexTangents,m instanceof THREE.Face3){if(cb)W=Pa[m.a].position,w=Pa[m.b].position,
K=Pa[m.c].position,M[U]=W.x,M[U+1]=W.y,M[U+2]=W.z,M[U+3]=w.x,M[U+4]=w.y,M[U+5]=w.z,M[U+6]=K.x,M[U+7]=K.y,M[U+8]=K.z,U+=9;if(ua)for(H in ua)if(y=ua[H],y.__original.needsUpdate)x=y.offset,O=y.offsetSrc,y.size===1?(y.boundTo===void 0||y.boundTo==="vertices"?(y.array[x+0]=y.value[m.a],y.array[x+1]=y.value[m.b],y.array[x+2]=y.value[m.c]):y.boundTo==="faces"?(y.array[x+0]=y.value[O],y.array[x+1]=y.value[O],y.array[x+2]=y.value[O],y.offsetSrc++):y.boundTo==="faceVertices"&&(y.array[x+0]=y.value[O+0],y.array[x+
1]=y.value[O+1],y.array[x+2]=y.value[O+2],y.offsetSrc+=3),y.offset+=3):(y.boundTo===void 0||y.boundTo==="vertices"?(W=y.value[m.a],w=y.value[m.b],K=y.value[m.c]):y.boundTo==="faces"?(W=y.value[O],w=y.value[O],K=y.value[O],y.offsetSrc++):y.boundTo==="faceVertices"&&(W=y.value[O+0],w=y.value[O+1],K=y.value[O+2],y.offsetSrc+=3),y.size===2?(y.array[x+0]=W.x,y.array[x+1]=W.y,y.array[x+2]=w.x,y.array[x+3]=w.y,y.array[x+4]=K.x,y.array[x+5]=K.y,y.offset+=6):y.size===3?(y.type==="c"?(y.array[x+0]=W.r,y.array[x+
1]=W.g,y.array[x+2]=W.b,y.array[x+3]=w.r,y.array[x+4]=w.g,y.array[x+5]=w.b,y.array[x+6]=K.r,y.array[x+7]=K.g,y.array[x+8]=K.b):(y.array[x+0]=W.x,y.array[x+1]=W.y,y.array[x+2]=W.z,y.array[x+3]=w.x,y.array[x+4]=w.y,y.array[x+5]=w.z,y.array[x+6]=K.x,y.array[x+7]=K.y,y.array[x+8]=K.z),y.offset+=9):(y.array[x+0]=W.x,y.array[x+1]=W.y,y.array[x+2]=W.z,y.array[x+3]=W.w,y.array[x+4]=w.x,y.array[x+5]=w.y,y.array[x+6]=w.z,y.array[x+7]=w.w,y.array[x+8]=K.x,y.array[x+9]=K.y,y.array[x+10]=K.z,y.array[x+11]=K.w,
y.offset+=12));if(kb){x=0;for(O=Da.length;x<O;x++)W=Da[x].vertices[m.a].position,w=Da[x].vertices[m.b].position,K=Da[x].vertices[m.c].position,y=ha[x],y[L+0]=W.x,y[L+1]=W.y,y[L+2]=W.z,y[L+3]=w.x,y[L+4]=w.y,y[L+5]=w.z,y[L+6]=K.x,y[L+7]=K.y,y[L+8]=K.z;L+=9}if(Fa.length)x=Fa[m.a],O=Fa[m.b],y=Fa[m.c],ea[D]=x.x,ea[D+1]=x.y,ea[D+2]=x.z,ea[D+3]=x.w,ea[D+4]=O.x,ea[D+5]=O.y,ea[D+6]=O.z,ea[D+7]=O.w,ea[D+8]=y.x,ea[D+9]=y.y,ea[D+10]=y.z,ea[D+11]=y.w,x=Ta[m.a],O=Ta[m.b],y=Ta[m.c],da[D]=x.x,da[D+1]=x.y,da[D+2]=
x.z,da[D+3]=x.w,da[D+4]=O.x,da[D+5]=O.y,da[D+6]=O.z,da[D+7]=O.w,da[D+8]=y.x,da[D+9]=y.y,da[D+10]=y.z,da[D+11]=y.w,x=Ra[m.a],O=Ra[m.b],y=Ra[m.c],aa[D]=x.x,aa[D+1]=x.y,aa[D+2]=x.z,aa[D+3]=1,aa[D+4]=O.x,aa[D+5]=O.y,aa[D+6]=O.z,aa[D+7]=1,aa[D+8]=y.x,aa[D+9]=y.y,aa[D+10]=y.z,aa[D+11]=1,x=Sa[m.a],O=Sa[m.b],y=Sa[m.c],ca[D]=x.x,ca[D+1]=x.y,ca[D+2]=x.z,ca[D+3]=1,ca[D+4]=O.x,ca[D+5]=O.y,ca[D+6]=O.z,ca[D+7]=1,ca[D+8]=y.x,ca[D+9]=y.y,ca[D+10]=y.z,ca[D+11]=1,D+=12;if(jb&&u)p.length==3&&u==THREE.VertexColors?(m=
p[0],x=p[1],O=p[2]):O=x=m=R,Y[C]=m.r,Y[C+1]=m.g,Y[C+2]=m.b,Y[C+3]=x.r,Y[C+4]=x.g,Y[C+5]=x.b,Y[C+6]=O.r,Y[C+7]=O.g,Y[C+8]=O.b,C+=9;if(ib&&ja.hasTangents)p=o[0],R=o[1],m=o[2],fa[X]=p.x,fa[X+1]=p.y,fa[X+2]=p.z,fa[X+3]=p.w,fa[X+4]=R.x,fa[X+5]=R.y,fa[X+6]=R.z,fa[X+7]=R.w,fa[X+8]=m.x,fa[X+9]=m.y,fa[X+10]=m.z,fa[X+11]=m.w,X+=12;if(eb&&V)if(v.length==3&&Xa)for(o=0;o<3;o++)E=v[o],S[I]=E.x,S[I+1]=E.y,S[I+2]=E.z,I+=3;else for(o=0;o<3;o++)S[I]=E.x,S[I+1]=E.y,S[I+2]=E.z,I+=3;if(Ya&&P!==void 0&&n)for(o=0;o<3;o++)v=
P[o],T[Q]=v.u,T[Q+1]=v.v,Q+=2;if(Ya&&J!==void 0&&n)for(o=0;o<3;o++)v=J[o],N[A]=v.u,N[A+1]=v.v,A+=2;db&&(oa[F]=B,oa[F+1]=B+1,oa[F+2]=B+2,F+=3,ra[Z]=B,ra[Z+1]=B+1,ra[Z+2]=B,ra[Z+3]=B+2,ra[Z+4]=B+1,ra[Z+5]=B+2,Z+=6,B+=3)}else if(m instanceof THREE.Face4){if(cb)W=Pa[m.a].position,w=Pa[m.b].position,K=Pa[m.c].position,t=Pa[m.d].position,M[U]=W.x,M[U+1]=W.y,M[U+2]=W.z,M[U+3]=w.x,M[U+4]=w.y,M[U+5]=w.z,M[U+6]=K.x,M[U+7]=K.y,M[U+8]=K.z,M[U+9]=t.x,M[U+10]=t.y,M[U+11]=t.z,U+=12;if(ua)for(H in ua)if(y=ua[H],
y.__original.needsUpdate)x=y.offset,O=y.offsetSrc,y.size===1?(y.boundTo===void 0||y.boundTo==="vertices"?(y.array[x+0]=y.value[m.a],y.array[x+1]=y.value[m.b],y.array[x+2]=y.value[m.c],y.array[x+3]=y.value[m.d]):y.boundTo==="faces"?(y.array[x+0]=y.value[O],y.array[x+1]=y.value[O],y.array[x+2]=y.value[O],y.array[x+3]=y.value[O],y.offsetSrc++):y.boundTo==="faceVertices"&&(y.array[x+0]=y.value[O+0],y.array[x+1]=y.value[O+1],y.array[x+2]=y.value[O+2],y.array[x+3]=y.value[O+3],y.offsetSrc+=4),y.offset+=
4):(y.boundTo===void 0||y.boundTo==="vertices"?(W=y.value[m.a],w=y.value[m.b],K=y.value[m.c],t=y.value[m.d]):y.boundTo==="faces"?(W=y.value[O],w=y.value[O],K=y.value[O],t=y.value[O],y.offsetSrc++):y.boundTo==="faceVertices"&&(W=y.value[O+0],w=y.value[O+1],K=y.value[O+2],t=y.value[O+3],y.offsetSrc+=4),y.size===2?(y.array[x+0]=W.x,y.array[x+1]=W.y,y.array[x+2]=w.x,y.array[x+3]=w.y,y.array[x+4]=K.x,y.array[x+5]=K.y,y.array[x+6]=t.x,y.array[x+7]=t.y,y.offset+=8):y.size===3?(y.type==="c"?(y.array[x+0]=
W.r,y.array[x+1]=W.g,y.array[x+2]=W.b,y.array[x+3]=w.r,y.array[x+4]=w.g,y.array[x+5]=w.b,y.array[x+6]=K.r,y.array[x+7]=K.g,y.array[x+8]=K.b,y.array[x+9]=t.r,y.array[x+10]=t.g,y.array[x+11]=t.b):(y.array[x+0]=W.x,y.array[x+1]=W.y,y.array[x+2]=W.z,y.array[x+3]=w.x,y.array[x+4]=w.y,y.array[x+5]=w.z,y.array[x+6]=K.x,y.array[x+7]=K.y,y.array[x+8]=K.z,y.array[x+9]=t.x,y.array[x+10]=t.y,y.array[x+11]=t.z),y.offset+=12):(y.array[x+0]=W.x,y.array[x+1]=W.y,y.array[x+2]=W.z,y.array[x+3]=W.w,y.array[x+4]=w.x,
y.array[x+5]=w.y,y.array[x+6]=w.z,y.array[x+7]=w.w,y.array[x+8]=K.x,y.array[x+9]=K.y,y.array[x+10]=K.z,y.array[x+11]=K.w,y.array[x+12]=t.x,y.array[x+13]=t.y,y.array[x+14]=t.z,y.array[x+15]=t.w,y.offset+=16));if(kb){x=0;for(O=Da.length;x<O;x++)W=Da[x].vertices[m.a].position,w=Da[x].vertices[m.b].position,K=Da[x].vertices[m.c].position,t=Da[x].vertices[m.d].position,y=ha[x],y[L+0]=W.x,y[L+1]=W.y,y[L+2]=W.z,y[L+3]=w.x,y[L+4]=w.y,y[L+5]=w.z,y[L+6]=K.x,y[L+7]=K.y,y[L+8]=K.z,y[L+9]=t.x,y[L+10]=t.y,y[L+
11]=t.z;L+=12}if(Fa.length)x=Fa[m.a],O=Fa[m.b],y=Fa[m.c],$=Fa[m.d],ea[D]=x.x,ea[D+1]=x.y,ea[D+2]=x.z,ea[D+3]=x.w,ea[D+4]=O.x,ea[D+5]=O.y,ea[D+6]=O.z,ea[D+7]=O.w,ea[D+8]=y.x,ea[D+9]=y.y,ea[D+10]=y.z,ea[D+11]=y.w,ea[D+12]=$.x,ea[D+13]=$.y,ea[D+14]=$.z,ea[D+15]=$.w,x=Ta[m.a],O=Ta[m.b],y=Ta[m.c],$=Ta[m.d],da[D]=x.x,da[D+1]=x.y,da[D+2]=x.z,da[D+3]=x.w,da[D+4]=O.x,da[D+5]=O.y,da[D+6]=O.z,da[D+7]=O.w,da[D+8]=y.x,da[D+9]=y.y,da[D+10]=y.z,da[D+11]=y.w,da[D+12]=$.x,da[D+13]=$.y,da[D+14]=$.z,da[D+15]=$.w,x=
Ra[m.a],O=Ra[m.b],y=Ra[m.c],$=Ra[m.d],aa[D]=x.x,aa[D+1]=x.y,aa[D+2]=x.z,aa[D+3]=1,aa[D+4]=O.x,aa[D+5]=O.y,aa[D+6]=O.z,aa[D+7]=1,aa[D+8]=y.x,aa[D+9]=y.y,aa[D+10]=y.z,aa[D+11]=1,aa[D+12]=$.x,aa[D+13]=$.y,aa[D+14]=$.z,aa[D+15]=1,x=Sa[m.a],O=Sa[m.b],y=Sa[m.c],m=Sa[m.d],ca[D]=x.x,ca[D+1]=x.y,ca[D+2]=x.z,ca[D+3]=1,ca[D+4]=O.x,ca[D+5]=O.y,ca[D+6]=O.z,ca[D+7]=1,ca[D+8]=y.x,ca[D+9]=y.y,ca[D+10]=y.z,ca[D+11]=1,ca[D+12]=m.x,ca[D+13]=m.y,ca[D+14]=m.z,ca[D+15]=1,D+=16;if(jb&&u)p.length==4&&u==THREE.VertexColors?
(m=p[0],x=p[1],O=p[2],p=p[3]):p=O=x=m=R,Y[C]=m.r,Y[C+1]=m.g,Y[C+2]=m.b,Y[C+3]=x.r,Y[C+4]=x.g,Y[C+5]=x.b,Y[C+6]=O.r,Y[C+7]=O.g,Y[C+8]=O.b,Y[C+9]=p.r,Y[C+10]=p.g,Y[C+11]=p.b,C+=12;if(ib&&ja.hasTangents)p=o[0],R=o[1],m=o[2],o=o[3],fa[X]=p.x,fa[X+1]=p.y,fa[X+2]=p.z,fa[X+3]=p.w,fa[X+4]=R.x,fa[X+5]=R.y,fa[X+6]=R.z,fa[X+7]=R.w,fa[X+8]=m.x,fa[X+9]=m.y,fa[X+10]=m.z,fa[X+11]=m.w,fa[X+12]=o.x,fa[X+13]=o.y,fa[X+14]=o.z,fa[X+15]=o.w,X+=16;if(eb&&V)if(v.length==4&&Xa)for(o=0;o<4;o++)E=v[o],S[I]=E.x,S[I+1]=E.y,
S[I+2]=E.z,I+=3;else for(o=0;o<4;o++)S[I]=E.x,S[I+1]=E.y,S[I+2]=E.z,I+=3;if(Ya&&P!==void 0&&n)for(o=0;o<4;o++)v=P[o],T[Q]=v.u,T[Q+1]=v.v,Q+=2;if(Ya&&J!==void 0&&n)for(o=0;o<4;o++)v=J[o],N[A]=v.u,N[A+1]=v.v,A+=2;db&&(oa[F]=B,oa[F+1]=B+1,oa[F+2]=B+3,oa[F+3]=B+1,oa[F+4]=B+2,oa[F+5]=B+3,F+=6,ra[Z]=B,ra[Z+1]=B+1,ra[Z+2]=B,ra[Z+3]=B+3,ra[Z+4]=B+1,ra[Z+5]=B+2,ra[Z+6]=B+2,ra[Z+7]=B+3,Z+=8,B+=4)}if(Ka){h=0;for(G=Ka.length;h<G;h++)oa[F]=Ka[h].a,oa[F+1]=Ka[h].b,oa[F+2]=Ka[h].c,oa[F+3]=Ka[h].a,oa[F+4]=Ka[h].c,
oa[F+5]=Ka[h].d,F+=6}cb&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,M,z));if(ua)for(H in ua)y=ua[H],y.__original.needsUpdate&&(k.bindBuffer(k.ARRAY_BUFFER,y.buffer),k.bufferData(k.ARRAY_BUFFER,y.array,z));if(kb){x=0;for(O=Da.length;x<O;x++)k.bindBuffer(k.ARRAY_BUFFER,g.__webglMorphTargetsBuffers[x]),k.bufferData(k.ARRAY_BUFFER,ha[x],z)}jb&&C>0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,Y,z));eb&&(k.bindBuffer(k.ARRAY_BUFFER,
g.__webglNormalBuffer),k.bufferData(k.ARRAY_BUFFER,S,z));ib&&ja.hasTangents&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglTangentBuffer),k.bufferData(k.ARRAY_BUFFER,fa,z));Ya&&Q>0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglUVBuffer),k.bufferData(k.ARRAY_BUFFER,T,z));Ya&&A>0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglUV2Buffer),k.bufferData(k.ARRAY_BUFFER,N,z));db&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,g.__webglFaceBuffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,oa,z),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,g.__webglLineBuffer),
k.bufferData(k.ELEMENT_ARRAY_BUFFER,ra,z));D>0&&(k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinVertexABuffer),k.bufferData(k.ARRAY_BUFFER,aa,z),k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinVertexBBuffer),k.bufferData(k.ARRAY_BUFFER,ca,z),k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinIndicesBuffer),k.bufferData(k.ARRAY_BUFFER,da,z),k.bindBuffer(k.ARRAY_BUFFER,g.__webglSkinWeightsBuffer),k.bufferData(k.ARRAY_BUFFER,ea,z));j.dynamic||(delete g.__inittedArrays,delete g.__colorArray,delete g.__normalArray,delete g.__tangentArray,
delete g.__uvArray,delete g.__uv2Array,delete g.__faceArray,delete g.__vertexArray,delete g.__lineArray,delete g.__skinVertexAArray,delete g.__skinVertexBArray,delete g.__skinIndexArray,delete g.__skinWeightArray)}}e.__dirtyVertices=!1;e.__dirtyMorphTargets=!1;e.__dirtyElements=!1;e.__dirtyUvs=!1;e.__dirtyNormals=!1;e.__dirtyTangents=!1;e.__dirtyColors=!1;var pa;f=f.__materials;e=0;for(b=f.length;e<b;e++)if(d=f[e],d.attributes)for(pa in d.attributes)d.attributes[pa].needsUpdate=!1}else if(b instanceof
THREE.Ribbon){e=b.geometry;if(e.__dirtyVertices||e.__dirtyColors){pa=e;b=k.DYNAMIC_DRAW;G=pa.vertices;f=pa.colors;n=G.length;g=f.length;u=pa.__vertexArray;j=pa.__colorArray;V=pa.__dirtyColors;if(pa.__dirtyVertices){for(z=0;z<n;z++)h=G[z].position,d=z*3,u[d]=h.x,u[d+1]=h.y,u[d+2]=h.z;k.bindBuffer(k.ARRAY_BUFFER,pa.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,u,b)}if(V){for(z=0;z<g;z++)color=f[z],d=z*3,j[d]=color.r,j[d+1]=color.g,j[d+2]=color.b;k.bindBuffer(k.ARRAY_BUFFER,pa.__webglColorBuffer);
k.bufferData(k.ARRAY_BUFFER,j,b)}}e.__dirtyVertices=!1;e.__dirtyColors=!1}else if(b instanceof THREE.Line){e=b.geometry;if(e.__dirtyVertices||e.__dirtyColors){pa=e;b=k.DYNAMIC_DRAW;G=pa.vertices;f=pa.colors;n=G.length;g=f.length;u=pa.__vertexArray;j=pa.__colorArray;V=pa.__dirtyColors;if(pa.__dirtyVertices){for(z=0;z<n;z++)h=G[z].position,d=z*3,u[d]=h.x,u[d+1]=h.y,u[d+2]=h.z;k.bindBuffer(k.ARRAY_BUFFER,pa.__webglVertexBuffer);k.bufferData(k.ARRAY_BUFFER,u,b)}if(V){for(z=0;z<g;z++)color=f[z],d=z*3,
j[d]=color.r,j[d+1]=color.g,j[d+2]=color.b;k.bindBuffer(k.ARRAY_BUFFER,pa.__webglColorBuffer);k.bufferData(k.ARRAY_BUFFER,j,b)}}e.__dirtyVertices=!1;e.__dirtyColors=!1}else if(b instanceof THREE.ParticleSystem)e=b.geometry,(e.__dirtyVertices||e.__dirtyColors||b.sortParticles)&&c(e,k.DYNAMIC_DRAW,b),e.__dirtyVertices=!1,e.__dirtyColors=!1}function B(b,c){var d;for(d=b.length-1;d>=0;d--)b[d].object==c&&b.splice(d,1)}function I(b){function c(b){var f=[];d=0;for(e=b.length;d<e;d++)b[d]==void 0?f.push("undefined"):
f.push(b[d].id);return f.join("_")}var d,e,f,g,k,j,z,h,G={},m=b.morphTargets!==void 0?b.morphTargets.length:0;b.geometryGroups={};f=0;for(g=b.faces.length;f<g;f++)k=b.faces[f],j=k.materials,z=c(j),G[z]==void 0&&(G[z]={hash:z,counter:0}),h=G[z].hash+"_"+G[z].counter,b.geometryGroups[h]==void 0&&(b.geometryGroups[h]={faces:[],materials:j,vertices:0,numMorphTargets:m}),k=k instanceof THREE.Face3?3:4,b.geometryGroups[h].vertices+k>65535&&(G[z].counter+=1,h=G[z].hash+"_"+G[z].counter,b.geometryGroups[h]==
void 0&&(b.geometryGroups[h]={faces:[],materials:j,vertices:0,numMorphTargets:m})),b.geometryGroups[h].faces.push(f),b.geometryGroups[h].vertices+=k}function D(b,c,d){b.push({buffer:c,object:d,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function F(b){if(b!=V){switch(b){case THREE.AdditiveBlending:k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE);break;case THREE.SubtractiveBlending:k.blendEquation(k.FUNC_ADD);k.blendFunc(k.ZERO,k.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:k.blendEquation(k.FUNC_ADD);
k.blendFunc(k.ZERO,k.SRC_COLOR);break;default:k.blendEquationSeparate(k.FUNC_ADD,k.FUNC_ADD),k.blendFuncSeparate(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA,k.ONE,k.ONE_MINUS_SRC_ALPHA)}V=b}}function T(b,c,d){(d.width&d.width-1)==0&&(d.height&d.height-1)==0?(k.texParameteri(b,k.TEXTURE_WRAP_S,v(c.wrapS)),k.texParameteri(b,k.TEXTURE_WRAP_T,v(c.wrapT)),k.texParameteri(b,k.TEXTURE_MAG_FILTER,v(c.magFilter)),k.texParameteri(b,k.TEXTURE_MIN_FILTER,v(c.minFilter)),k.generateMipmap(b)):(k.texParameteri(b,k.TEXTURE_WRAP_S,
k.CLAMP_TO_EDGE),k.texParameteri(b,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(b,k.TEXTURE_MAG_FILTER,S(c.magFilter)),k.texParameteri(b,k.TEXTURE_MIN_FILTER,S(c.minFilter)))}function L(b,c){if(b.needsUpdate)b.__webglInit?(k.bindTexture(k.TEXTURE_2D,b.__webglTexture),k.texSubImage2D(k.TEXTURE_2D,0,0,0,k.RGBA,k.UNSIGNED_BYTE,b.image)):(b.__webglTexture=k.createTexture(),k.bindTexture(k.TEXTURE_2D,b.__webglTexture),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,b.image),b.__webglInit=
!0),T(k.TEXTURE_2D,b,b.image),k.bindTexture(k.TEXTURE_2D,null),b.needsUpdate=!1;k.activeTexture(k.TEXTURE0+c);k.bindTexture(k.TEXTURE_2D,b.__webglTexture)}function M(b){if(b&&!b.__webglFramebuffer){if(b.depthBuffer===void 0)b.depthBuffer=!0;if(b.stencilBuffer===void 0)b.stencilBuffer=!0;b.__webglFramebuffer=k.createFramebuffer();b.__webglRenderbuffer=k.createRenderbuffer();b.__webglTexture=k.createTexture();k.bindTexture(k.TEXTURE_2D,b.__webglTexture);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,
v(b.wrapS));k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,v(b.wrapT));k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,v(b.magFilter));k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,v(b.minFilter));k.texImage2D(k.TEXTURE_2D,0,v(b.format),b.width,b.height,0,v(b.format),v(b.type),null);k.bindRenderbuffer(k.RENDERBUFFER,b.__webglRenderbuffer);k.bindFramebuffer(k.FRAMEBUFFER,b.__webglFramebuffer);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,b.__webglTexture,0);b.depthBuffer&&
!b.stencilBuffer?(k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,b.width,b.height),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,b.__webglRenderbuffer)):b.depthBuffer&&b.stencilBuffer?(k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_STENCIL,b.width,b.height),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,b.__webglRenderbuffer)):k.renderbufferStorage(k.RENDERBUFFER,k.RGBA4,b.width,b.height);k.bindTexture(k.TEXTURE_2D,null);k.bindRenderbuffer(k.RENDERBUFFER,
null);k.bindFramebuffer(k.FRAMEBUFFER,null)}var c,d;b?(c=b.__webglFramebuffer,d=b.width,b=b.height):(c=null,d=_viewportWidth,b=_viewportHeight);c!=U&&(k.bindFramebuffer(k.FRAMEBUFFER,c),k.viewport(_viewportX,_viewportY,d,b),U=c)}function N(b,c){var d;b=="fragment"?d=k.createShader(k.FRAGMENT_SHADER):b=="vertex"&&(d=k.createShader(k.VERTEX_SHADER));k.shaderSource(d,c);k.compileShader(d);if(!k.getShaderParameter(d,k.COMPILE_STATUS))return console.error(k.getShaderInfoLog(d)),console.error(c),null;return d}
function S(b){switch(b){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return k.NEAREST;default:return k.LINEAR}}function v(b){switch(b){case THREE.RepeatWrapping:return k.REPEAT;case THREE.ClampToEdgeWrapping:return k.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return k.MIRRORED_REPEAT;case THREE.NearestFilter:return k.NEAREST;case THREE.NearestMipMapNearestFilter:return k.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return k.NEAREST_MIPMAP_LINEAR;
case THREE.LinearFilter:return k.LINEAR;case THREE.LinearMipMapNearestFilter:return k.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return k.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return k.BYTE;case THREE.UnsignedByteType:return k.UNSIGNED_BYTE;case THREE.ShortType:return k.SHORT;case THREE.UnsignedShortType:return k.UNSIGNED_SHORT;case THREE.IntType:return k.INT;case THREE.UnsignedShortType:return k.UNSIGNED_INT;case THREE.FloatType:return k.FLOAT;case THREE.AlphaFormat:return k.ALPHA;
case THREE.RGBFormat:return k.RGB;case THREE.RGBAFormat:return k.RGBA;case THREE.LuminanceFormat:return k.LUMINANCE;case THREE.LuminanceAlphaFormat:return k.LUMINANCE_ALPHA}return 0}var J=this,k,P=[],K=null,U=null,O=!0,z=null,E=null,V=null,G=null,R=null;_oldPolygonOffsetUnits=_oldPolygonOffsetFactor=null;_cullEnabled=!0;_viewportHeight=_viewportWidth=_viewportY=_viewportX=0;_frustum=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4];_projScreenMatrix=
new THREE.Matrix4;_projectionMatrixArray=new Float32Array(16);_viewMatrixArray=new Float32Array(16);_vector3=new THREE.Vector4;_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};_canvas=b.canvas!==void 0?b.canvas:document.createElement("canvas");_stencil=b.stencil!==void 0?b.stencil:!0;_antialias=b.antialias!==void 0?b.antialias:!1;_clearColor=b.clearColor!==void 0?new THREE.Color(b.clearColor):new THREE.Color(0);_clearAlpha=
b.clearAlpha!==void 0?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=_canvas;this.sortObjects=this.autoClear=!0;try{if(!(k=_canvas.getContext("experimental-webgl",{antialias:_antialias,stencil:_stencil})))throw"Error creating WebGL context.";}catch(W){console.error(W)}console.log(navigator.userAgent+" | "+k.getParameter(k.VERSION)+" | "+k.getParameter(k.VENDOR)+" | "+k.getParameter(k.RENDERER)+" | "+k.getParameter(k.SHADING_LANGUAGE_VERSION));k.clearColor(0,
0,0,1);k.clearDepth(1);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);k.frontFace(k.CCW);k.cullFace(k.BACK);k.enable(k.CULL_FACE);k.enable(k.BLEND);k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA);k.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha);_cullEnabled=!0;this.context=k;var $=k.getParameter(k.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(_stencil){var y={};y.vertices=new Float32Array(12);y.faces=new Uint16Array(6);y.darkness=0.5;y.vertices[0]=-20;y.vertices[1]=
-20;y.vertices[2]=-1;y.vertices[3]=20;y.vertices[4]=-20;y.vertices[5]=-1;y.vertices[6]=20;y.vertices[7]=20;y.vertices[8]=-1;y.vertices[9]=-20;y.vertices[10]=20;y.vertices[11]=-1;y.faces[0]=0;y.faces[1]=1;y.faces[2]=2;y.faces[3]=0;y.faces[4]=2;y.faces[5]=3;y.vertexBuffer=k.createBuffer();y.elementBuffer=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,y.vertexBuffer);k.bufferData(k.ARRAY_BUFFER,y.vertices,k.STATIC_DRAW);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,y.elementBuffer);k.bufferData(k.ELEMENT_ARRAY_BUFFER,
y.faces,k.STATIC_DRAW);y.program=k.createProgram();k.attachShader(y.program,N("fragment",THREE.ShaderLib.shadowPost.fragmentShader));k.attachShader(y.program,N("vertex",THREE.ShaderLib.shadowPost.vertexShader));k.linkProgram(y.program);y.vertexLocation=k.getAttribLocation(y.program,"position");y.projectionLocation=k.getUniformLocation(y.program,"projectionMatrix");y.darknessLocation=k.getUniformLocation(y.program,"darkness")}var Q={};Q.vertices=new Float32Array(16);Q.faces=new Uint16Array(6);b=0;
Q.vertices[b++]=-1;Q.vertices[b++]=-1;Q.vertices[b++]=0;Q.vertices[b++]=0;Q.vertices[b++]=1;Q.vertices[b++]=-1;Q.vertices[b++]=1;Q.vertices[b++]=0;Q.vertices[b++]=1;Q.vertices[b++]=1;Q.vertices[b++]=1;Q.vertices[b++]=1;Q.vertices[b++]=-1;Q.vertices[b++]=1;Q.vertices[b++]=0;Q.vertices[b++]=1;b=0;Q.faces[b++]=0;Q.faces[b++]=1;Q.faces[b++]=2;Q.faces[b++]=0;Q.faces[b++]=2;Q.faces[b++]=3;Q.vertexBuffer=k.createBuffer();Q.elementBuffer=k.createBuffer();Q.tempTexture=k.createTexture();Q.occlusionTexture=
k.createTexture();k.bindBuffer(k.ARRAY_BUFFER,Q.vertexBuffer);k.bufferData(k.ARRAY_BUFFER,Q.vertices,k.STATIC_DRAW);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Q.elementBuffer);k.bufferData(k.ELEMENT_ARRAY_BUFFER,Q.faces,k.STATIC_DRAW);k.bindTexture(k.TEXTURE_2D,Q.tempTexture);k.texImage2D(k.TEXTURE_2D,0,k.RGB,16,16,0,k.RGB,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,
k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.bindTexture(k.TEXTURE_2D,Q.occlusionTexture);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,16,16,0,k.RGBA,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.getParameter(k.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(Q.hasVertexTexture=
!1,Q.program=k.createProgram(),k.attachShader(Q.program,N("fragment",THREE.ShaderLib.lensFlare.fragmentShader)),k.attachShader(Q.program,N("vertex",THREE.ShaderLib.lensFlare.vertexShader))):(Q.hasVertexTexture=!0,Q.program=k.createProgram(),k.attachShader(Q.program,N("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader)),k.attachShader(Q.program,N("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader)));k.linkProgram(Q.program);Q.attributes={};Q.uniforms={};Q.attributes.vertex=
k.getAttribLocation(Q.program,"position");Q.attributes.uv=k.getAttribLocation(Q.program,"UV");Q.uniforms.renderType=k.getUniformLocation(Q.program,"renderType");Q.uniforms.map=k.getUniformLocation(Q.program,"map");Q.uniforms.occlusionMap=k.getUniformLocation(Q.program,"occlusionMap");Q.uniforms.opacity=k.getUniformLocation(Q.program,"opacity");Q.uniforms.scale=k.getUniformLocation(Q.program,"scale");Q.uniforms.rotation=k.getUniformLocation(Q.program,"rotation");Q.uniforms.screenPosition=k.getUniformLocation(Q.program,
"screenPosition");var Z=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;
b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=k.createBuffer();_sprite.elementBuffer=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,_sprite.vertexBuffer);k.bufferData(k.ARRAY_BUFFER,_sprite.vertices,k.STATIC_DRAW);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);k.bufferData(k.ELEMENT_ARRAY_BUFFER,_sprite.faces,k.STATIC_DRAW);_sprite.program=k.createProgram();k.attachShader(_sprite.program,
N("fragment",THREE.ShaderLib.sprite.fragmentShader));k.attachShader(_sprite.program,N("vertex",THREE.ShaderLib.sprite.vertexShader));k.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=k.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=k.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=k.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=k.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=
k.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=k.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=k.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=k.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=k.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=k.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=k.getUniformLocation(_sprite.program,
"affectedByDistance");_sprite.uniforms.screenPosition=k.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=k.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=k.getUniformLocation(_sprite.program,"projectionMatrix");var X=!1;this.setSize=function(b,c){_canvas.width=b;_canvas.height=c;this.setViewport(0,0,_canvas.width,_canvas.height)};this.setViewport=function(b,c,d,e){_viewportX=b;_viewportY=c;_viewportWidth=d;_viewportHeight=
e;k.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight)};this.setScissor=function(b,c,d,e){k.scissor(b,c,d,e)};this.enableScissorTest=function(b){b?k.enable(k.SCISSOR_TEST):k.disable(k.SCISSOR_TEST)};this.enableDepthBufferWrite=function(b){O=b;k.depthMask(b)};this.setClearColorHex=function(b,c){_clearColor.setHex(b);_clearAlpha=c;k.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.setClearColor=function(b,c){_clearColor.copy(b);_clearAlpha=c;k.clearColor(_clearColor.r,
_clearColor.g,_clearColor.b,_clearAlpha)};this.clear=function(){k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT|k.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(b){y.darkness=b};this.getContext=function(){return k};this.initMaterial=function(b,c,d,e){var f,g,j;b instanceof THREE.MeshDepthMaterial?j="depth":b instanceof THREE.ShadowVolumeDynamicMaterial?j="shadowVolumeDynamic":b instanceof THREE.MeshNormalMaterial?j="normal":b instanceof THREE.MeshBasicMaterial?j="basic":b instanceof THREE.MeshLambertMaterial?
j="lambert":b instanceof THREE.MeshPhongMaterial?j="phong":b instanceof THREE.LineBasicMaterial?j="basic":b instanceof THREE.ParticleBasicMaterial&&(j="particle_basic");if(j){var z=THREE.ShaderLib[j];b.uniforms=THREE.UniformsUtils.clone(z.uniforms);b.vertexShader=z.vertexShader;b.fragmentShader=z.fragmentShader}var h,G,m;h=m=z=0;for(G=c.length;h<G;h++)g=c[h],g instanceof THREE.DirectionalLight&&m++,g instanceof THREE.PointLight&&z++;z+m<=4?c=m:(c=Math.ceil(4*m/(z+m)),z=4-c);g={directional:c,point:z};
m=50;if(e!==void 0&&e instanceof THREE.SkinnedMesh)m=e.bones.length;var v;a:{h=b.fragmentShader;G=b.vertexShader;var z=b.uniforms,c=b.attributes,d={map:!!b.map,envMap:!!b.envMap,lightMap:!!b.lightMap,vertexColors:b.vertexColors,fog:d,sizeAttenuation:b.sizeAttenuation,skinning:b.skinning,morphTargets:b.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:g.directional,maxPointLights:g.point,maxBones:m},E;g=[];j?g.push(j):(g.push(h),g.push(G));for(E in d)g.push(E),g.push(d[E]);j=g.join();
E=0;for(g=P.length;E<g;E++)if(P[E].code==j){v=P[E].program;break a}E=k.createProgram();g=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,d.fog?"#define USE_FOG":"",d.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.lightMap?"#define USE_LIGHTMAP":"",d.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
m=[$?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,"#define MAX_BONES "+d.maxBones,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.lightMap?"#define USE_LIGHTMAP":"",d.vertexColors?"#define USE_COLOR":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
k.attachShader(E,N("fragment",g+h));k.attachShader(E,N("vertex",m+G));k.linkProgram(E);k.getProgramParameter(E,k.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+k.getProgramParameter(E,k.VALIDATE_STATUS)+", gl error ["+k.getError()+"]");E.uniforms={};E.attributes={};var p;h=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(p in z)h.push(p);p=h;z=0;for(h=
p.length;z<h;z++)G=p[z],E.uniforms[G]=k.getUniformLocation(E,G);h=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(p=0;p<d.maxMorphTargets;p++)h.push("morphTarget"+p);for(v in c)h.push(v);v=h;p=0;for(c=v.length;p<c;p++)d=v[p],E.attributes[d]=k.getAttribLocation(E,d);P.push({program:E,code:j});v=E}b.program=v;v=b.program.attributes;v.position>=0&&k.enableVertexAttribArray(v.position);v.color>=0&&k.enableVertexAttribArray(v.color);v.normal>=
0&&k.enableVertexAttribArray(v.normal);v.tangent>=0&&k.enableVertexAttribArray(v.tangent);b.skinning&&v.skinVertexA>=0&&v.skinVertexB>=0&&v.skinIndex>=0&&v.skinWeight>=0&&(k.enableVertexAttribArray(v.skinVertexA),k.enableVertexAttribArray(v.skinVertexB),k.enableVertexAttribArray(v.skinIndex),k.enableVertexAttribArray(v.skinWeight));if(b.attributes)for(f in b.attributes)v[f]!==void 0&&v[f]>=0&&k.enableVertexAttribArray(v[f]);if(b.morphTargets){b.numSupportedMorphTargets=0;v.morphTarget0>=0&&(k.enableVertexAttribArray(v.morphTarget0),
b.numSupportedMorphTargets++);v.morphTarget1>=0&&(k.enableVertexAttribArray(v.morphTarget1),b.numSupportedMorphTargets++);v.morphTarget2>=0&&(k.enableVertexAttribArray(v.morphTarget2),b.numSupportedMorphTargets++);v.morphTarget3>=0&&(k.enableVertexAttribArray(v.morphTarget3),b.numSupportedMorphTargets++);v.morphTarget4>=0&&(k.enableVertexAttribArray(v.morphTarget4),b.numSupportedMorphTargets++);v.morphTarget5>=0&&(k.enableVertexAttribArray(v.morphTarget5),b.numSupportedMorphTargets++);v.morphTarget6>=
0&&(k.enableVertexAttribArray(v.morphTarget6),b.numSupportedMorphTargets++);v.morphTarget7>=0&&(k.enableVertexAttribArray(v.morphTarget7),b.numSupportedMorphTargets++);e.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);b=0;for(f=this.maxMorphTargets;b<f;b++)e.__webglMorphTargetInfluences[b]=0}};this.render=function(b,c,z,G){var v,E,y,R,W,V,P,O,K=b.lights,t=b.fog;J.data.vertices=0;J.data.faces=0;J.data.drawCalls=0;c.matrixAutoUpdate&&c.update(void 0,!0);b.update(void 0,!1,c);c.matrixWorldInverse.flattenToArray(_viewMatrixArray);
c.projectionMatrix.flattenToArray(_projectionMatrixArray);_projScreenMatrix.multiply(c.projectionMatrix,c.matrixWorldInverse);m(_projScreenMatrix);this.initWebGLObjects(b);M(z);(this.autoClear||G)&&this.clear();W=b.__webglObjects.length;for(G=0;G<W;G++)if(v=b.__webglObjects[G],P=v.object,P.visible)if(!(P instanceof THREE.Mesh)||n(P)){if(P.matrixWorld.flattenToArray(P._objectMatrixArray),x(P,c),w(v),v.render=!0,this.sortObjects)v.object.renderDepth?v.z=v.object.renderDepth:(_vector3.copy(P.position),
_projScreenMatrix.multiplyVector3(_vector3),v.z=_vector3.z)}else v.render=!1;else v.render=!1;this.sortObjects&&b.__webglObjects.sort(u);V=b.__webglObjectsImmediate.length;for(G=0;G<V;G++)v=b.__webglObjectsImmediate[G],P=v.object,P.visible&&(P.matrixAutoUpdate&&P.matrixWorld.flattenToArray(P._objectMatrixArray),x(P,c),o(v));F(THREE.NormalBlending);for(G=0;G<W;G++)if(v=b.__webglObjects[G],v.render){P=v.object;O=v.buffer;y=v.opaque;g(P);for(v=0;v<y.count;v++)R=y.list[v],h(R.depthTest),j(R.polygonOffset,
R.polygonOffsetFactor,R.polygonOffsetUnits),e(c,K,t,R,O,P)}for(G=0;G<V;G++)if(v=b.__webglObjectsImmediate[G],P=v.object,P.visible){y=v.opaque;g(P);for(v=0;v<y.count;v++)R=y.list[v],h(R.depthTest),j(R.polygonOffset,R.polygonOffsetFactor,R.polygonOffsetUnits),E=d(c,K,t,R,P),P.render(function(b){f(b,E,R.shading)})}for(G=0;G<W;G++)if(v=b.__webglObjects[G],v.render){P=v.object;O=v.buffer;y=v.transparent;g(P);for(v=0;v<y.count;v++)R=y.list[v],F(R.blending),h(R.depthTest),j(R.polygonOffset,R.polygonOffsetFactor,
R.polygonOffsetUnits),e(c,K,t,R,O,P)}for(G=0;G<V;G++)if(v=b.__webglObjectsImmediate[G],P=v.object,P.visible){y=v.transparent;g(P);for(v=0;v<y.count;v++)R=y.list[v],F(R.blending),h(R.depthTest),j(R.polygonOffset,R.polygonOffsetFactor,R.polygonOffsetUnits),E=d(c,K,t,R,P),P.render(function(b){f(b,E,R.shading)})}b.__webglSprites.length&&C(b,c);_stencil&&b.__webglShadowVolumes.length&&b.lights.length&&A(b);b.__webglLensFlares.length&&p(b,c);z&&z.minFilter!==THREE.NearestFilter&&z.minFilter!==THREE.LinearFilter&&
(k.bindTexture(k.TEXTURE_2D,z.__webglTexture),k.generateMipmap(k.TEXTURE_2D),k.bindTexture(k.TEXTURE_2D,null))};this.initWebGLObjects=function(b){if(!b.__webglObjects)b.__webglObjects=[],b.__webglObjectsImmediate=[],b.__webglShadowVolumes=[],b.__webglLensFlares=[],b.__webglSprites=[];for(;b.__objectsAdded.length;){var c=b.__objectsAdded[0],d=b,e=void 0,f=void 0,g=void 0;if(c._modelViewMatrix==void 0)c._modelViewMatrix=new THREE.Matrix4,c._normalMatrixArray=new Float32Array(9),c._modelViewMatrixArray=
new Float32Array(16),c._objectMatrixArray=new Float32Array(16),c.matrixWorld.flattenToArray(c._objectMatrixArray);if(c instanceof THREE.Mesh)for(e in f=c.geometry,f.geometryGroups==void 0&&I(f),f.geometryGroups){g=f.geometryGroups[e];if(!g.__webglVertexBuffer){var j=g;j.__webglVertexBuffer=k.createBuffer();j.__webglNormalBuffer=k.createBuffer();j.__webglTangentBuffer=k.createBuffer();j.__webglColorBuffer=k.createBuffer();j.__webglUVBuffer=k.createBuffer();j.__webglUV2Buffer=k.createBuffer();j.__webglSkinVertexABuffer=
k.createBuffer();j.__webglSkinVertexBBuffer=k.createBuffer();j.__webglSkinIndicesBuffer=k.createBuffer();j.__webglSkinWeightsBuffer=k.createBuffer();j.__webglFaceBuffer=k.createBuffer();j.__webglLineBuffer=k.createBuffer();if(j.numMorphTargets){var z=void 0,h=void 0;j.__webglMorphTargetsBuffers=[];z=0;for(h=j.numMorphTargets;z<h;z++)j.__webglMorphTargetsBuffers.push(k.createBuffer())}for(var j=g,z=c,G=void 0,v=void 0,m=void 0,E=m=void 0,p=void 0,y=void 0,R=y=h=0,o=m=v=void 0,x=o=v=G=void 0,m=void 0,
E=z.geometry,p=E.faces,o=j.faces,G=0,v=o.length;G<v;G++)m=o[G],m=p[m],m instanceof THREE.Face3?(h+=3,y+=1,R+=3):m instanceof THREE.Face4&&(h+=4,y+=2,R+=4);for(var G=j,v=z,n=o=p=void 0,u=void 0,n=void 0,m=[],p=0,o=v.materials.length;p<o;p++)if(n=v.materials[p],n instanceof THREE.MeshFaceMaterial){n=0;for(l=G.materials.length;n<l;n++)(u=G.materials[n])&&m.push(u)}else(u=n)&&m.push(u);G=m;j.__materials=G;a:{p=v=void 0;o=G.length;for(v=0;v<o;v++)if(p=G[v],p.map||p.lightMap||p instanceof THREE.MeshShaderMaterial){v=
!0;break a}v=!1}a:{o=p=void 0;m=G.length;for(p=0;p<m;p++)if(o=G[p],!(o instanceof THREE.MeshBasicMaterial&&!o.envMap||o instanceof THREE.MeshDepthMaterial)){o=o&&o.shading!=void 0&&o.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}o=!1}a:{m=p=void 0;n=G.length;for(p=0;p<n;p++)if(m=G[p],m.vertexColors){m=m.vertexColors;break a}m=!1}j.__vertexArray=new Float32Array(h*3);if(o)j.__normalArray=new Float32Array(h*3);if(E.hasTangents)j.__tangentArray=new Float32Array(h*4);if(m)j.__colorArray=
new Float32Array(h*3);if(v){if(E.faceUvs.length>0||E.faceVertexUvs.length>0)j.__uvArray=new Float32Array(h*2);if(E.faceUvs.length>1||E.faceVertexUvs.length>1)j.__uv2Array=new Float32Array(h*2)}if(z.geometry.skinWeights.length&&z.geometry.skinIndices.length)j.__skinVertexAArray=new Float32Array(h*4),j.__skinVertexBArray=new Float32Array(h*4),j.__skinIndexArray=new Float32Array(h*4),j.__skinWeightArray=new Float32Array(h*4);j.__faceArray=new Uint16Array(y*3+(z.geometry.edgeFaces?z.geometry.edgeFaces.length*
6:0));j.__lineArray=new Uint16Array(R*2);if(j.numMorphTargets){j.__morphTargetsArrays=[];E=0;for(p=j.numMorphTargets;E<p;E++)j.__morphTargetsArrays.push(new Float32Array(h*3))}j.__needsSmoothNormals=o==THREE.SmoothShading;j.__uvType=v;j.__vertexColorType=m;j.__normalType=o;j.__webglFaceCount=y*3+(z.geometry.edgeFaces?z.geometry.edgeFaces.length*6:0);j.__webglLineCount=R*2;E=0;for(p=G.length;E<p;E++)if(v=G[E],v.attributes)for(a in j.__webglCustomAttributes={},v.attributes){m=v.attributes[a];o={};for(x in m)o[x]=
m[x];if(!o.__webglInitialized||o.createUniqueBuffers)o.__webglInitialized=!0,y=1,o.type==="v2"?y=2:o.type==="v3"?y=3:o.type==="v4"?y=4:o.type==="c"&&(y=3),o.size=y,o.array=new Float32Array(h*y),o.buffer=k.createBuffer(),o.buffer.belongsToAttribute=a,m.needsUpdate=!0,o.__original=m;j.__webglCustomAttributes[a]=o}j.__inittedArrays=!0;f.__dirtyVertices=!0;f.__dirtyMorphTargets=!0;f.__dirtyElements=!0;f.__dirtyUvs=!0;f.__dirtyNormals=!0;f.__dirtyTangents=!0;f.__dirtyColors=!0}c instanceof THREE.ShadowVolume?
D(d.__webglShadowVolumes,g,c):D(d.__webglObjects,g,c)}else if(c instanceof THREE.LensFlare)D(d.__webglLensFlares,void 0,c);else if(c instanceof THREE.Ribbon){f=c.geometry;if(!f.__webglVertexBuffer)e=f,e.__webglVertexBuffer=k.createBuffer(),e.__webglColorBuffer=k.createBuffer(),e=f,g=e.vertices.length,e.__vertexArray=new Float32Array(g*3),e.__colorArray=new Float32Array(g*3),e.__webglVertexCount=g,f.__dirtyVertices=!0,f.__dirtyColors=!0;D(d.__webglObjects,f,c)}else if(c instanceof THREE.Line){f=c.geometry;
if(!f.__webglVertexBuffer)e=f,e.__webglVertexBuffer=k.createBuffer(),e.__webglColorBuffer=k.createBuffer(),e=f,g=e.vertices.length,e.__vertexArray=new Float32Array(g*3),e.__colorArray=new Float32Array(g*3),e.__webglLineCount=g,f.__dirtyVertices=!0,f.__dirtyColors=!0;D(d.__webglObjects,f,c)}else if(c instanceof THREE.ParticleSystem){f=c.geometry;if(!f.__webglVertexBuffer)e=f,e.__webglVertexBuffer=k.createBuffer(),e.__webglColorBuffer=k.createBuffer(),e=f,g=e.vertices.length,e.__vertexArray=new Float32Array(g*
3),e.__colorArray=new Float32Array(g*3),e.__sortArray=[],e.__webglParticleCount=g,f.__dirtyVertices=!0,f.__dirtyColors=!0;D(d.__webglObjects,f,c)}else THREE.MarchingCubes!==void 0&&c instanceof THREE.MarchingCubes?d.__webglObjectsImmediate.push({object:c,opaque:{list:[],count:0},transparent:{list:[],count:0}}):c instanceof THREE.Sprite&&d.__webglSprites.push(c);b.__objectsAdded.splice(0,1)}for(;b.__objectsRemoved.length;)c=b.__objectsRemoved[0],d=b,c instanceof THREE.ShadowVolume?B(d.__webglShadowVolumes,
c):c instanceof THREE.Mesh||c instanceof THREE.ParticleSystem||c instanceof THREE.Ribbon||c instanceof THREE.Line?B(d.__webglObjects,c):c instanceof THREE.Sprite?B(d.__webglSprites,c):c instanceof THREE.LensFlare?B(d.__webglLensFlares,c):c instanceof THREE.MarchingCubes&&B(d.__webglObjectsImmediate,c),b.__objectsRemoved.splice(0,1);c=0;for(d=b.__webglObjects.length;c<d;c++)H(b.__webglObjects[c].object,b);c=0;for(d=b.__webglShadowVolumes.length;c<d;c++)H(b.__webglShadowVolumes[c].object,b);c=0;for(d=
b.__webglLensFlares.length;c<d;c++)H(b.__webglLensFlares[c].object,b)};this.setFaceCulling=function(b,c){b?(!c||c=="ccw"?k.frontFace(k.CCW):k.frontFace(k.CW),b=="back"?k.cullFace(k.BACK):b=="front"?k.cullFace(k.FRONT):k.cullFace(k.FRONT_AND_BACK),k.enable(k.CULL_FACE)):k.disable(k.CULL_FACE)};this.supportsVertexTextures=function(){return $}};
THREE.WebGLRenderTarget=function(b,c,d){this.width=b;this.height=c;d=d||{};this.wrapS=d.wrapS!==void 0?d.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=d.wrapT!==void 0?d.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=d.magFilter!==void 0?d.magFilter:THREE.LinearFilter;this.minFilter=d.minFilter!==void 0?d.minFilter:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=d.format!==void 0?d.format:THREE.RGBAFormat;this.type=d.type!==void 0?d.type:
THREE.UnsignedByteType;this.depthBuffer=d.depthBuffer!==void 0?d.depthBuffer:!0;this.stencilBuffer=d.stencilBuffer!==void 0?d.stencilBuffer:!0};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,c,d){d&&b.update(void 0,!1,c);var d=b.sounds,e,f=d.length;for(e=0;e<f;e++)b=d[e],this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34),this.soundPosition.subSelf(c.position),b.isPlaying&&b.isLoaded&&(b.isAddedToDOM||b.addToDOM(this.domElement),b.calculateVolumeAndPan(this.soundPosition))}};
THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};
THREE.ColorUtils={adjustHSV:function(b,c,d,e){var f=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,f);f.h=THREE.ColorUtils.clamp(f.h+c,0,1);f.s=THREE.ColorUtils.clamp(f.s+d,0,1);f.v=THREE.ColorUtils.clamp(f.v+e,0,1);b.setHSV(f.h,f.s,f.v)},rgbToHsv:function(b,c){var d=b.r,e=b.g,f=b.b,g=Math.max(Math.max(d,e),f),h=Math.min(Math.min(d,e),f);if(h==g)h=d=0;else{var j=g-h,h=j/g,d=d==g?(e-f)/j:e==g?2+(f-d)/j:4+(d-e)/j;d/=6;d<0&&(d+=1);d>1&&(d-=1)}c===void 0&&(c={h:0,s:0,v:0});c.h=d;c.s=h;c.v=g;return c},
clamp:function(b,c,d){return b<c?c:b>d?d:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,c){var d=c instanceof THREE.Mesh,e=b.vertices.length,f=d?c.geometry:c,g=b.vertices,h=f.vertices,j=b.faces,m=f.faces,n=b.faceVertexUvs[0],f=f.faceVertexUvs[0];d&&c.matrixAutoUpdate&&c.updateMatrix();for(var t=0,o=h.length;t<o;t++){var w=new THREE.Vertex(h[t].position.clone());d&&c.matrix.multiplyVector3(w.position);g.push(w)}t=0;for(o=m.length;t<o;t++){var h=m[t],u,A,C=h.vertexNormals,w=h.vertexColors;h instanceof THREE.Face3?u=new THREE.Face3(h.a+e,h.b+e,h.c+e):
h instanceof THREE.Face4&&(u=new THREE.Face4(h.a+e,h.b+e,h.c+e,h.d+e));u.normal.copy(h.normal);d=0;for(g=C.length;d<g;d++)A=C[d],u.vertexNormals.push(A.clone());u.color.copy(h.color);d=0;for(g=w.length;d<g;d++)A=w[d],u.vertexColors.push(A.clone());u.materials=h.materials.slice();u.centroid.copy(h.centroid);j.push(u)}t=0;for(o=f.length;t<o;t++){e=f[t];j=[];d=0;for(g=e.length;d<g;d++)j.push(new THREE.UV(e[d].u,e[d].v));n.push(j)}}};
THREE.ImageUtils={loadTexture:function(b,c,d){var e=new Image,f=new THREE.Texture(e,c);e.onload=function(){f.needsUpdate=!0;d&&d(this)};e.src=b;return f},loadTextureCube:function(b,c,d){var e,f=[],g=new THREE.Texture(f,c),c=f.loadCount=0;for(e=b.length;c<e;++c)f[c]=new Image,f[c].onload=function(){f.loadCount+=1;if(f.loadCount==6)g.needsUpdate=!0;d&&d(this)},f[c].src=b[c];return g}};
THREE.SceneUtils={addMesh:function(b,c,d,e,f,g,h,j,m,n){c=new THREE.Mesh(c,n);c.scale.x=c.scale.y=c.scale.z=d;c.position.x=e;c.position.y=f;c.position.z=g;c.rotation.x=h;c.rotation.y=j;c.rotation.z=m;b.addObject(c);return c},addPanoramaCubeWebGL:function(b,c,d){var e=THREE.ShaderUtils.lib.cube;e.uniforms.tCube.texture=d;d=new THREE.MeshShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms});c=new THREE.Mesh(new THREE.CubeGeometry(c,c,c,1,1,1,null,!0),d);b.addObject(c);
return c},addPanoramaCube:function(b,c,d){var e=[];e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d[0])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d[1])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d[2])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d[3])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d[4])}));e.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d[5])}));c=new THREE.Mesh(new THREE.Cube(c,c,c,1,1,e,!0),
new THREE.MeshFaceMaterial);b.addObject(c);return c},addPanoramaCubePlanes:function(b,c,d){var e=c/2,c=new THREE.Plane(c,c),f=Math.PI,g=Math.PI/2;THREE.SceneUtils.addMesh(b,c,1,0,0,-e,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(d[5])}));THREE.SceneUtils.addMesh(b,c,1,-e,0,0,0,g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(d[0])}));THREE.SceneUtils.addMesh(b,c,1,e,0,0,0,-g,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(d[1])}));THREE.SceneUtils.addMesh(b,c,1,0,e,0,g,0,f,
new THREE.MeshBasicMaterial({map:new THREE.Texture(d[2])}));THREE.SceneUtils.addMesh(b,c,1,0,-e,0,-g,0,f,new THREE.MeshBasicMaterial({map:new THREE.Texture(d[3])}))},showHierarchy:function(b,c){THREE.SceneUtils.traverseHierarchy(b,function(b){b.visible=c})},traverseHierarchy:function(b,c){var d,e,f=b.children.length;for(e=0;e<f;e++)d=b.children[e],c(d),THREE.SceneUtils.traverseHierarchy(d,c)}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var c,d,e,f,g=2*Math.ceil(b*3)+1;g>25&&(g=25);f=(g-1)*0.5;d=Array(g);for(c=e=0;c<g;++c)d[c]=Math.exp(-((c-f)*(c-f))/(2*b*b)),e+=d[c];for(c=0;c<g;++c)d[c]/=e;return d}};
THREE.AnimationHandler=function(){var b=[],c={},d={update:function(c){for(var d=0;d<b.length;d++)b[d].update(c)},addToUpdate:function(c){b.indexOf(c)===-1&&b.push(c)},removeFromUpdate:function(c){c=b.indexOf(c);c!==-1&&b.splice(c,1)},add:function(b){c[b.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+b.name+" already exists in library. Overwriting.");c[b.name]=b;if(b.initialized!==!0){for(var d=0;d<b.hierarchy.length;d++){for(var e=0;e<b.hierarchy[d].keys.length;e++){if(b.hierarchy[d].keys[e].time<
0)b.hierarchy[d].keys[e].time=0;if(b.hierarchy[d].keys[e].rot!==void 0&&!(b.hierarchy[d].keys[e].rot instanceof THREE.Quaternion)){var j=b.hierarchy[d].keys[e].rot;b.hierarchy[d].keys[e].rot=new THREE.Quaternion(j[0],j[1],j[2],j[3])}}if(b.hierarchy[d].keys[0].morphTargets!==void 0){j={};for(e=0;e<b.hierarchy[d].keys.length;e++)for(var m=0;m<b.hierarchy[d].keys[e].morphTargets.length;m++){var n=b.hierarchy[d].keys[e].morphTargets[m];j[n]=-1}b.hierarchy[d].usedMorphTargets=j;for(e=0;e<b.hierarchy[d].keys.length;e++){var t=
{};for(n in j){for(m=0;m<b.hierarchy[d].keys[e].morphTargets.length;m++)if(b.hierarchy[d].keys[e].morphTargets[m]===n){t[n]=b.hierarchy[d].keys[e].morphTargetsInfluences[m];break}m===b.hierarchy[d].keys[e].morphTargets.length&&(t[n]=0)}b.hierarchy[d].keys[e].morphTargetsInfluences=t}}for(e=1;e<b.hierarchy[d].keys.length;e++)b.hierarchy[d].keys[e].time===b.hierarchy[d].keys[e-1].time&&(b.hierarchy[d].keys.splice(e,1),e--);for(e=1;e<b.hierarchy[d].keys.length;e++)b.hierarchy[d].keys[e].index=e}e=parseInt(b.length*
b.fps,10);b.JIT={};b.JIT.hierarchy=[];for(d=0;d<b.hierarchy.length;d++)b.JIT.hierarchy.push(Array(e));b.initialized=!0}},get:function(b){if(typeof b==="string")return c[b]?c[b]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+b),null)},parse:function(b){var c=[];if(b instanceof THREE.SkinnedMesh)for(var d=0;d<b.bones.length;d++)c.push(b.bones[d]);else e(b,c);return c}},e=function(b,c){c.push(b);for(var d=0;d<b.children.length;d++)e(b.children[d],c)};d.LINEAR=0;d.CATMULLROM=1;d.CATMULLROM_FORWARD=
2;return d}();THREE.Animation=function(b,c,d,e){this.root=b;this.data=THREE.AnimationHandler.get(c);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=d!==void 0?d:THREE.AnimationHandler.LINEAR;this.JITCompile=e!==void 0?e:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,c){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==void 0?b:!0;this.currentTime=c!==void 0?c:0;var d,e=this.hierarchy.length,f;for(d=0;d<e;d++){f=this.hierarchy[d];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===void 0)f.animationCache={},f.animationCache.prevKey={pos:0,rot:0,scl:0},f.animationCache.nextKey={pos:0,rot:0,scl:0},f.animationCache.originalMatrix=f instanceof
THREE.Bone?f.skinMatrix:f.matrix;var g=f.animationCache.prevKey;f=f.animationCache.nextKey;g.pos=this.data.hierarchy[d].keys[0];g.rot=this.data.hierarchy[d].keys[0];g.scl=this.data.hierarchy[d].keys[0];f.pos=this.getNextKeyWith("pos",d,1);f.rot=this.getNextKeyWith("rot",d,1);f.scl=this.getNextKeyWith("scl",d,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==void 0)this.hierarchy[b]instanceof THREE.Bone?this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix:this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix,delete this.hierarchy[b].animationCache};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var c=["pos","rot","scl"],d,e,f,g,h,j,m,n,t=this.data.JIT.hierarchy,o,w;this.currentTime+=b*this.timeScale;w=this.currentTime;o=this.currentTime%=this.data.length;n=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,A=this.hierarchy.length;u<A;u++)if(b=this.hierarchy[u],m=b.animationCache,this.JITCompile&&t[u][n]!==void 0)b instanceof THREE.Bone?(b.skinMatrix=t[u][n],b.matrixAutoUpdate=!1,b.matrixWorldNeedsUpdate=
!1):(b.matrix=t[u][n],b.matrixAutoUpdate=!1,b.matrixWorldNeedsUpdate=!0);else{if(this.JITCompile)b instanceof THREE.Bone?b.skinMatrix=b.animationCache.originalMatrix:b.matrix=b.animationCache.originalMatrix;for(var C=0;C<3;C++){d=c[C];h=m.prevKey[d];j=m.nextKey[d];if(j.time<=w){if(o<w)if(this.loop){h=this.data.hierarchy[u].keys[0];for(j=this.getNextKeyWith(d,u,1);j.time<o;)h=j,j=this.getNextKeyWith(d,u,j.index+1)}else{this.stop();return}else{do h=j,j=this.getNextKeyWith(d,u,j.index+1);while(j.time<
o)}m.prevKey[d]=h;m.nextKey[d]=j}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;e=(o-h.time)/(j.time-h.time);f=h[d];g=j[d];if(e<0||e>1)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+e+" on bone "+u),e=e<0?0:1;if(d==="pos")if(d=b.position,this.interpolationType===THREE.AnimationHandler.LINEAR)d.x=f[0]+(g[0]-f[0])*e,d.y=f[1]+(g[1]-f[1])*e,d.z=f[2]+(g[2]-f[2])*e;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)if(this.points[0]=
this.getPrevKeyWith("pos",u,h.index-1).pos,this.points[1]=f,this.points[2]=g,this.points[3]=this.getNextKeyWith("pos",u,j.index+1).pos,e=e*0.33+0.33,f=this.interpolateCatmullRom(this.points,e),d.x=f[0],d.y=f[1],d.z=f[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)e=this.interpolateCatmullRom(this.points,e*1.01),this.target.set(e[0],e[1],e[2]),this.target.subSelf(d),this.target.y=0,this.target.normalize(),e=Math.atan2(this.target.x,this.target.z),b.rotation.set(0,e,0)}else if(d===
"rot")THREE.Quaternion.slerp(f,g,b.quaternion,e);else if(d==="scl")d=b.scale,d.x=f[0]+(g[0]-f[0])*e,d.y=f[1]+(g[1]-f[1])*e,d.z=f[2]+(g[2]-f[2])*e}}if(this.JITCompile&&t[0][n]===void 0){this.hierarchy[0].update(void 0,!0);for(u=0;u<this.hierarchy.length;u++)t[u][n]=this.hierarchy[u]instanceof THREE.Bone?this.hierarchy[u].skinMatrix.clone():this.hierarchy[u].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,c){var d=[],e=[],f,g,h,j,m,n;f=(b.length-1)*c;g=Math.floor(f);f-=g;d[0]=g==0?g:g-1;d[1]=g;d[2]=g>b.length-2?g:g+1;d[3]=g>b.length-3?g:g+2;g=b[d[0]];j=b[d[1]];m=b[d[2]];n=b[d[3]];d=f*f;h=f*d;e[0]=this.interpolate(g[0],j[0],m[0],n[0],f,d,h);e[1]=this.interpolate(g[1],j[1],m[1],n[1],f,d,h);e[2]=this.interpolate(g[2],j[2],m[2],n[2],f,d,h);return e};
THREE.Animation.prototype.interpolate=function(b,c,d,e,f,g,h){b=(d-b)*0.5;e=(e-c)*0.5;return(2*(c-d)+b+e)*h+(-3*(c-d)-2*b-e)*g+b*f+c};THREE.Animation.prototype.getNextKeyWith=function(b,c,d){var e=this.data.hierarchy[c].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?d=d<e.length-1?d:e.length-1:d%=e.length;d<e.length;d++)if(e[d][b]!==void 0)return e[d];return this.data.hierarchy[c].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,c,d){for(var e=this.data.hierarchy[c].keys,d=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?d>0?d:0:d>=0?d:d+e.length;d>=0;d--)if(e[d][b]!==void 0)return e[d];return this.data.hierarchy[c].keys[e.length-1]};
THREE.FPCamera=function(b){function c(b,c){return function(){c.apply(b,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==void 0)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==void 0)this.lookSpeed=b.lookSpeed;if(b.noFly!==void 0)this.noFly=b.noFly;if(b.lookVertical!==void 0)this.lookVertical=b.lookVertical;if(b.autoForward!==void 0)this.autoForward=b.autoForward;if(b.activeLook!==void 0)this.activeLook=b.activeLook;if(b.heightSpeed!==void 0)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==void 0)this.heightCoef=b.heightCoef;if(b.heightMin!==void 0)this.heightMin=b.heightMin;if(b.heightMax!==void 0)this.heightMax=b.heightMax;if(b.constrainVertical!==
void 0)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==void 0)this.verticalMin=b.verticalMin;if(b.verticalMax!==void 0)this.verticalMax=b.verticalMax;if(b.domElement!==void 0)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;this.onMouseDown=function(b){b.preventDefault();
b.stopPropagation();if(this.activeLook)switch(b.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(b){b.preventDefault();b.stopPropagation();if(this.activeLook)switch(b.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(b){this.mouseX=b.clientX-this.windowHalfX;this.mouseY=b.clientY-this.windowHalfY};this.onKeyDown=function(b){switch(b.keyCode){case 38:case 87:this.moveForward=
!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(b){switch(b.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var b=(new Date).getTime();this.tdiff=(b-this.lastUpdate)/1E3;this.lastUpdate=b;if(!this.freeze){this.autoSpeedFactor=
this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var c=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(c+this.autoSpeedFactor));this.moveBackward&&this.translateZ(c);this.moveLeft&&this.translateX(-c);this.moveRight&&this.translateX(c);c=this.tdiff*this.lookSpeed;this.activeLook||(c=0);this.lon+=this.mouseX*c;this.lookVertical&&
(this.lat-=this.mouseY*c);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var b=this.target.position,f=this.position;b.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);b.y=f.y+100*Math.cos(this.phi);b.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*c;this.lookVertical&&(this.lat-=this.mouseY*c);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=
(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;b=this.target.position;f=this.position;b.x=f.x+100*Math.sin(this.phi)*Math.cos(this.theta);b.y=f.y+100*Math.cos(this.phi);b.z=f.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousemove",c(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),
!1);this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",c(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",c(this,this.onKeyUp),!1)};THREE.FPCamera.prototype=new THREE.Camera;THREE.FPCamera.prototype.constructor=THREE.FPCamera;THREE.FPCamera.prototype.supr=THREE.Camera.prototype;THREE.FPCamera.prototype.translate=function(b,c){this.matrix.rotateAxis(c);if(this.noFly)c.y=0;this.position.addSelf(c.multiplyScalar(b));this.target.position.addSelf(c.multiplyScalar(b))};
THREE.PathCamera=function(b){function c(b,c,d,e){var f={name:d,fps:0.6,length:e,hierarchy:[]},g,j=c.getControlPointsArray(),h=c.getLength(),m=j.length,H=0;g=m-1;c={parent:-1,keys:[]};c.keys[0]={time:0,pos:j[0],rot:[0,0,0,1],scl:[1,1,1]};c.keys[g]={time:e,pos:j[g],rot:[0,0,0,1],scl:[1,1,1]};for(g=1;g<m-1;g++)H=e*h.chunks[g]/h.total,c.keys[g]={time:H,pos:j[g]};f.hierarchy[0]=c;THREE.AnimationHandler.add(f);return new THREE.Animation(b,d,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function d(b,c){var d,
e,f=new THREE.Geometry;for(d=0;d<b.points.length*c;d++)e=d/(b.points.length*c),e=b.getPoint(e),f.vertices[d]=new THREE.Vertex(new THREE.Vector3(e.x,e.y,e.z));return f}function e(b,c){var e=d(c,10),f=d(c,10),g=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(e,g);particleObj=new THREE.ParticleSystem(f,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);b.addChild(lineObj);particleObj.scale.set(1,1,1);b.addChild(particleObj);f=new THREE.SphereGeometry(1,
16,8);g=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<c.points.length;i++)e=new THREE.Mesh(f,g),e.position.copy(c.points[i]),e.updateMatrix(),b.addChild(e)}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookHorizontal=
this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==void 0)this.duration=b.duration*1E3;if(b.waypoints!==void 0)this.waypoints=b.waypoints;if(b.useConstantSpeed!==void 0)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==void 0)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==void 0)this.createDebugPath=b.createDebugPath;if(b.createDebugDummy!==
void 0)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==void 0)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==void 0)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==void 0)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==void 0)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==void 0)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==void 0)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=
window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var f=Math.PI*2,g=Math.PI/180;this.update=function(b,c,d){var e,j;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*g;this.theta=this.lon*g;e=this.phi%f;this.phi=e>=0?e:e+f;e=this.verticalAngleMap.srcRange;j=this.verticalAngleMap.dstRange;var h=j[1]-j[0];this.phi=
TWEEN.Easing.Quadratic.EaseInOut(((this.phi-e[0])*(j[1]-j[0])/(e[1]-e[0])+j[0]-j[0])/h)*h+j[0];e=this.horizontalAngleMap.srcRange;j=this.horizontalAngleMap.dstRange;h=j[1]-j[0];this.theta=TWEEN.Easing.Quadratic.EaseInOut(((this.theta-e[0])*(j[1]-j[0])/(e[1]-e[0])+j[0]-j[0])/h)*h+j[0];e=this.target.position;e.x=100*Math.sin(this.phi)*Math.cos(this.theta);e.y=100*Math.cos(this.phi);e.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,b,c,d)};this.onMouseMove=function(b){this.mouseX=
b.clientX-this.windowHalfX;this.mouseY=b.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var b=new THREE.MeshLambertMaterial({color:30719}),h=new THREE.MeshLambertMaterial({color:65280}),j=new THREE.CubeGeometry(10,10,20),m=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(j,b);b=new THREE.Mesh(m,h);b.position.set(0,10,0);this.animation=
c(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else this.animation=c(this.animationParent,this.spline,this.id,this.duration),this.animationParent.addChild(this.target),this.animationParent.addChild(this);this.createDebugPath&&e(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(b,c){return function(){c.apply(b,arguments)}}(this,this.onMouseMove),
!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function c(b,c){return function(){c.apply(b,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.autoForward=this.dragToLook=!1;this.domElement=document;if(b){if(b.movementSpeed!==void 0)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==void 0)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==void 0)this.dragToLook=b.dragToLook;if(b.autoForward!==void 0)this.autoForward=
b.autoForward;if(b.domElement!==void 0)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(b){if(typeof this[b.type]=="function")this[b.type](b)};this.keydown=function(b){if(!b.altKey){switch(b.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(b){switch(b.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(b){b.preventDefault();b.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(b.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(b){if(!this.dragToLook||this.mouseStatus>0){var c=this.getContainerDimensions(),f=c.size[0]/2,g=c.size[1]/2;this.moveState.yawLeft=-(b.clientX-c.offset[0]-f)/f;this.moveState.pitchDown=(b.clientY-
c.offset[1]-g)/g;this.updateRotationVector()}};this.mouseup=function(b){b.preventDefault();b.stopPropagation();if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(b.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var b=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=b;this.tdiff=(b-this.lastUpdate)/1E3;this.lastUpdate=b;var b=this.tdiff*this.movementSpeed,c=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*b);this.translateY(this.moveVector.y*b);this.translateZ(this.moveVector.z*b);this.tmpQuaternion.set(this.rotationVector.x*c,this.rotationVector.y*c,this.rotationVector.z*c,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var b=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-b+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",c(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",c(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",c(this,this.mouseup),!1);window.addEventListener("keydown",c(this,this.keydown),!1);window.addEventListener("keyup",c(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,c,d,e){THREE.Camera.call(this,b,c,d,e);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.matrixAutoUpdate=this.useTarget=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,j=new THREE.Matrix4,m=!1,n=1,t=0,o=0,w=0,u=0,A=0,C=window.innerWidth/2,p=window.innerHeight/2;this.update=
function(){var b=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=b;this.delta=(b-this.lastUpdate)/1E3;this.lastUpdate=b;this.mouseLook&&(b=this.delta*this.lookSpeed,this.rotateHorizontally(b*u),this.rotateVertically(b*A));b=this.delta*this.movementSpeed;this.translateZ(b*(t>0||this.autoForward&&!(t<0)?1:t));this.translateX(b*o);this.translateY(b*w);m&&(this.roll+=this.rollSpeed*this.delta*n);if(this.forward.y>this.constrainVertical[1])this.forward.y=this.constrainVertical[1],this.forward.normalize();
else if(this.forward.y<this.constrainVertical[0])this.forward.y=this.constrainVertical[0],this.forward.normalize();h.copy(this.forward);g.set(0,1,0);f.cross(g,h).normalize();g.cross(h,f).normalize();this.matrix.n11=f.x;this.matrix.n12=g.x;this.matrix.n13=h.x;this.matrix.n21=f.y;this.matrix.n22=g.y;this.matrix.n23=h.y;this.matrix.n31=f.z;this.matrix.n32=g.z;this.matrix.n33=h.z;j.identity();j.n11=Math.cos(this.roll);j.n12=-Math.sin(this.roll);j.n21=Math.sin(this.roll);j.n22=Math.cos(this.roll);this.matrix.multiplySelf(j);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(b){this.position.x+=this.matrix.n11*b;this.position.y+=this.matrix.n21*b;this.position.z+=this.matrix.n31*b};this.translateY=function(b){this.position.x+=this.matrix.n12*b;this.position.y+=this.matrix.n22*b;this.position.z+=this.matrix.n32*b};this.translateZ=function(b){this.position.x-=this.matrix.n13*b;this.position.y-=
this.matrix.n23*b;this.position.z-=this.matrix.n33*b};this.rotateHorizontally=function(b){f.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);f.multiplyScalar(b);this.forward.subSelf(f);this.forward.normalize()};this.rotateVertically=function(b){g.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);g.multiplyScalar(b);this.forward.addSelf(g);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(b){u=(b.clientX-C)/window.innerWidth;A=(b.clientY-p)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();switch(b.button){case 0:t=1;break;case 2:t=-1}},!1);this.domElement.addEventListener("mouseup",function(b){b.preventDefault();b.stopPropagation();switch(b.button){case 0:t=0;break;case 2:t=0}},!1);this.domElement.addEventListener("keydown",function(b){switch(b.keyCode){case 38:case 87:t=1;break;case 37:case 65:o=-1;break;
case 40:case 83:t=-1;break;case 39:case 68:o=1;break;case 81:m=!0;n=1;break;case 69:m=!0;n=-1;break;case 82:w=1;break;case 70:w=-1}},!1);this.domElement.addEventListener("keyup",function(b){switch(b.keyCode){case 38:case 87:t=0;break;case 37:case 65:o=0;break;case 40:case 83:t=0;break;case 39:case 68:o=0;break;case 81:m=!1;break;case 69:m=!1;break;case 82:w=0;break;case 70:w=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.TrackballCamera=function(b){function c(b,c){return function(){c.apply(b,arguments)}}b=b||{};THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.domElement=b.domElement||document;this.screen=b.screen||{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=b.radius||(this.screen.width+this.screen.height)/4;this.rotateSpeed=b.rotateSpeed||1;this.zoomSpeed=b.zoomSpeed||1.2;this.panSpeed=b.panSpeed||0.3;this.noZoom=b.noZoom||!1;this.noPan=b.noPan||
!1;this.staticMoving=b.staticMoving||!1;this.dynamicDampingFactor=b.dynamicDampingFactor||0.2;this.minDistance=b.minDistance||0;this.maxDistance=b.maxDistance||Infinity;this.keys=b.keys||[65,83,68];this.useTarget=!0;var d=!1,e=this.STATE.NONE,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,j=new THREE.Vector2,m=new THREE.Vector2,n=new THREE.Vector2,t=new THREE.Vector2;this.handleEvent=function(b){if(typeof this[b.type]=="function")this[b.type](b)};this.getMouseOnScreen=function(b,c){return new THREE.Vector2((b-
this.screen.offsetLeft)/this.radius*0.5,(c-this.screen.offsetTop)/this.radius*0.5)};this.getMouseProjectionOnBall=function(b,c){var d=new THREE.Vector3((b-this.screen.width*0.5-this.screen.offsetLeft)/this.radius,(this.screen.height*0.5+this.screen.offsetTop-c)/this.radius,0),e=d.length();e>1?d.normalize():d.z=Math.sqrt(1-e*e);f=this.position.clone().subSelf(this.target.position);e=this.up.clone().setLength(d.y);e.addSelf(this.up.clone().crossSelf(f).setLength(d.x));e.addSelf(f.setLength(d.z));return e};
this.rotateCamera=function(){var b=Math.acos(g.dot(h)/g.length()/h.length());if(b){var c=(new THREE.Vector3).cross(g,h).normalize(),d=new THREE.Quaternion;b*=this.rotateSpeed;d.setFromAxisAngle(c,-b);d.multiplyVector3(f);d.multiplyVector3(this.up);d.multiplyVector3(h);this.staticMoving?g=h:(d.setFromAxisAngle(c,b*(this.dynamicDampingFactor-1)),d.multiplyVector3(g))}};this.zoomCamera=function(){var b=1+(m.y-j.y)*this.zoomSpeed;b!==1&&b>0&&(f.multiplyScalar(b),this.staticMoving?j=m:j.y+=(m.y-j.y)*this.dynamicDampingFactor)};
this.panCamera=function(){var b=t.clone().subSelf(n);if(b.lengthSq()){b.multiplyScalar(f.length()*this.panSpeed);var c=f.clone().crossSelf(this.up).setLength(b.x);c.addSelf(this.up.clone().setLength(b.y));this.position.addSelf(c);this.target.position.addSelf(c);this.staticMoving?n=t:n.addSelf(b.sub(t,n).multiplyScalar(this.dynamicDampingFactor))}};this.checkDistances=function(){if(!this.noZoom||!this.noPan)this.position.lengthSq()>this.maxDistance*this.maxDistance&&this.position.setLength(this.maxDistance),
f.lengthSq()<this.minDistance*this.minDistance&&this.position.add(this.target.position,f.setLength(this.minDistance))};this.update=function(b,c,d){f=this.position.clone().subSelf(this.target.position);this.rotateCamera();this.noZoom||this.zoomCamera();this.noPan||this.panCamera();this.position.add(this.target.position,f);this.checkDistances();this.supr.update.call(this,b,c,d)};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousemove",
c(this,function(b){d&&(g=h=this.getMouseProjectionOnBall(b.clientX,b.clientY),j=m=this.getMouseOnScreen(b.clientX,b.clientY),n=t=this.getMouseOnScreen(b.clientX,b.clientY),d=!1);e!==this.STATE.NONE&&(e===this.STATE.ROTATE?h=this.getMouseProjectionOnBall(b.clientX,b.clientY):e===this.STATE.ZOOM&&!this.noZoom?m=this.getMouseOnScreen(b.clientX,b.clientY):e===this.STATE.PAN&&!this.noPan&&(t=this.getMouseOnScreen(b.clientX,b.clientY)))}),!1);this.domElement.addEventListener("mousedown",c(this,function(b){b.preventDefault();
b.stopPropagation();if(e===this.STATE.NONE)e=b.button,e===this.STATE.ROTATE?g=h=this.getMouseProjectionOnBall(b.clientX,b.clientY):e===this.STATE.ZOOM&&!this.noZoom?j=m=this.getMouseOnScreen(b.clientX,b.clientY):this.noPan||(n=t=this.getMouseOnScreen(b.clientX,b.clientY))}),!1);this.domElement.addEventListener("mouseup",c(this,function(b){b.preventDefault();b.stopPropagation();e=this.STATE.NONE}),!1);window.addEventListener("keydown",c(this,function(b){if(e===this.STATE.NONE){if(b.keyCode===this.keys[this.STATE.ROTATE])e=
this.STATE.ROTATE;else if(b.keyCode===this.keys[this.STATE.ZOOM]&&!this.noZoom)e=this.STATE.ZOOM;else if(b.keyCode===this.keys[this.STATE.PAN]&&!this.noPan)e=this.STATE.PAN;e!==this.STATE.NONE&&(d=!0)}}),!1);window.addEventListener("keyup",c(this,function(){if(e!==this.STATE.NONE)e=this.STATE.NONE}),!1)};THREE.TrackballCamera.prototype=new THREE.Camera;THREE.TrackballCamera.prototype.constructor=THREE.TrackballCamera;THREE.TrackballCamera.prototype.supr=THREE.Camera.prototype;
THREE.TrackballCamera.prototype.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};THREE.QuakeCamera=THREE.FPCamera;
THREE.CubeGeometry=function(b,c,d,e,f,g,h,j,m){function n(b,c,d,j,h,m,o,n){var u,w,A=e||1,C=f||1,v=h/2,J=m/2,k=t.vertices.length;if(b=="x"&&c=="y"||b=="y"&&c=="x")u="z";else if(b=="x"&&c=="z"||b=="z"&&c=="x")u="y",C=g||1;else if(b=="z"&&c=="y"||b=="y"&&c=="z")u="x",A=g||1;var P=A+1,K=C+1;h/=A;var U=m/C;for(w=0;w<K;w++)for(m=0;m<P;m++){var O=new THREE.Vector3;O[b]=(m*h-v)*d;O[c]=(w*U-J)*j;O[u]=o;t.vertices.push(new THREE.Vertex(O))}for(w=0;w<C;w++)for(m=0;m<A;m++)t.faces.push(new THREE.Face4(m+P*w+
k,m+P*(w+1)+k,m+1+P*(w+1)+k,m+1+P*w+k,null,null,n)),t.faceVertexUvs[0].push([new THREE.UV(m/A,w/C),new THREE.UV(m/A,(w+1)/C),new THREE.UV((m+1)/A,(w+1)/C),new THREE.UV((m+1)/A,w/C)])}THREE.Geometry.call(this);var t=this,o=b/2,w=c/2,u=d/2,j=j?-1:1;if(h!==void 0)if(h instanceof Array)this.materials=h;else{this.materials=[];for(var A=0;A<6;A++)this.materials.push([h])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(m!=void 0)for(var C in m)this.sides[C]!=void 0&&(this.sides[C]=
m[C]);this.sides.px&&n("z","y",1*j,-1,d,c,-o,this.materials[0]);this.sides.nx&&n("z","y",-1*j,-1,d,c,o,this.materials[1]);this.sides.py&&n("x","z",1*j,1,b,d,w,this.materials[2]);this.sides.ny&&n("x","z",1*j,-1,b,d,-w,this.materials[3]);this.sides.pz&&n("x","y",1*j,-1,b,c,u,this.materials[4]);this.sides.nz&&n("x","y",-1*j,-1,b,c,-u,this.materials[5]);(function(){for(var b=[],c=[],d=0,e=t.vertices.length;d<e;d++){for(var f=t.vertices[d],g=!1,j=0,h=b.length;j<h;j++){var m=b[j];if(f.position.x==m.position.x&&
f.position.y==m.position.y&&f.position.z==m.position.z){c[d]=j;g=!0;break}}if(!g)c[d]=b.length,b.push(new THREE.Vertex(f.position.clone()))}d=0;for(e=t.faces.length;d<e;d++)f=t.faces[d],f.a=c[f.a],f.b=c[f.b],f.c=c[f.c],f.d=c[f.d];t.vertices=b})();this.computeCentroids();this.computeFaceNormals()};THREE.CubeGeometry.prototype=new THREE.Geometry;THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry;
THREE.CylinderGeometry=function(b,c,d,e,f,g){function h(b,c,d){j.vertices.push(new THREE.Vertex(new THREE.Vector3(b,c,d)))}THREE.Geometry.call(this);var j=this,m,n=Math.PI*2,t=e/2;for(m=0;m<b;m++)h(Math.sin(n*m/b)*c,Math.cos(n*m/b)*c,-t);for(m=0;m<b;m++)h(Math.sin(n*m/b)*d,Math.cos(n*m/b)*d,t);for(m=0;m<b;m++)j.faces.push(new THREE.Face4(m,m+b,b+(m+1)%b,(m+1)%b));if(d>0){h(0,0,-t-(g||0));for(m=b;m<b+b/2;m++)j.faces.push(new THREE.Face4(2*b,(2*m-2*b)%b,(2*m-2*b+1)%b,(2*m-2*b+2)%b))}if(c>0){h(0,0,t+
(f||0));for(m=b+b/2;m<2*b;m++)j.faces.push(new THREE.Face4(2*b+1,(2*m-2*b+2)%b+b,(2*m-2*b+1)%b+b,(2*m-2*b)%b+b))}m=0;for(b=this.faces.length;m<b;m++){var c=[],d=this.faces[m],f=this.vertices[d.a],g=this.vertices[d.b],t=this.vertices[d.c],o=this.vertices[d.d];c.push(new THREE.UV(0.5+Math.atan2(f.position.x,f.position.y)/n,0.5+f.position.z/e));c.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/n,0.5+g.position.z/e));c.push(new THREE.UV(0.5+Math.atan2(t.position.x,t.position.y)/n,0.5+t.position.z/
e));d instanceof THREE.Face4&&c.push(new THREE.UV(0.5+Math.atan2(o.position.x,o.position.y)/n,0.5+o.position.z/e));this.faceVertexUvs[0].push(c)}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=new THREE.Geometry;THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;
THREE.IcosahedronGeometry=function(b){function c(b,c,d){var e=Math.sqrt(b*b+c*c+d*d);return f.vertices.push(new THREE.Vertex(new THREE.Vector3(b/e,c/e,d/e)))-1}function d(b,c,d,e){e.faces.push(new THREE.Face3(b,c,d))}function e(b,d){var e=f.vertices[b].position,g=f.vertices[d].position;return c((e.x+g.x)/2,(e.y+g.y)/2,(e.z+g.z)/2)}var f=this,g=new THREE.Geometry,h;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;c(-1,b,0);c(1,b,0);c(-1,-b,0);c(1,-b,0);c(0,-1,b);c(0,1,b);c(0,-1,
-b);c(0,1,-b);c(b,0,-1);c(b,0,1);c(-b,0,-1);c(-b,0,1);d(0,11,5,g);d(0,5,1,g);d(0,1,7,g);d(0,7,10,g);d(0,10,11,g);d(1,5,9,g);d(5,11,4,g);d(11,10,2,g);d(10,7,6,g);d(7,1,8,g);d(3,9,4,g);d(3,4,2,g);d(3,2,6,g);d(3,6,8,g);d(3,8,9,g);d(4,9,5,g);d(2,4,11,g);d(6,2,10,g);d(8,6,7,g);d(9,8,1,g);for(b=0;b<this.subdivisions;b++){h=new THREE.Geometry;for(var j in g.faces){var m=e(g.faces[j].a,g.faces[j].b),n=e(g.faces[j].b,g.faces[j].c),t=e(g.faces[j].c,g.faces[j].a);d(g.faces[j].a,m,t,h);d(g.faces[j].b,n,m,h);
d(g.faces[j].c,t,n,h);d(m,n,t,h)}g.faces=h.faces}f.faces=g.faces;delete g;delete h;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.IcosahedronGeometry.prototype=new THREE.Geometry;THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;
THREE.LatheGeometry=function(b,c,d){THREE.Geometry.call(this);this.steps=c||12;this.angle=d||2*Math.PI;for(var c=this.angle/this.steps,d=[],e=[],f=[],g=[],h=(new THREE.Matrix4).setRotationZ(c),j=0;j<b.length;j++)this.vertices.push(new THREE.Vertex(b[j])),d[j]=b[j].clone(),e[j]=this.vertices.length-1;for(var m=0;m<=this.angle+0.0010;m+=c){for(j=0;j<d.length;j++)m<this.angle?(d[j]=h.multiplyVector3(d[j].clone()),this.vertices.push(new THREE.Vertex(d[j])),f[j]=this.vertices.length-1):f=g;m==0&&(g=e);
for(j=0;j<e.length-1;j++)this.faces.push(new THREE.Face4(f[j],f[j+1],e[j+1],e[j])),this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,j/b.length),new THREE.UV(1-m/this.angle,(j+1)/b.length),new THREE.UV(1-(m-c)/this.angle,(j+1)/b.length),new THREE.UV(1-(m-c)/this.angle,j/b.length)]);e=f;f=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=new THREE.Geometry;THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;
THREE.PlaneGeometry=function(b,c,d,e){THREE.Geometry.call(this);var f,g=b/2,h=c/2,d=d||1,e=e||1,j=d+1,m=e+1;b/=d;var n=c/e;for(f=0;f<m;f++)for(c=0;c<j;c++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(c*b-g,-(f*n-h),0)));for(f=0;f<e;f++)for(c=0;c<d;c++)this.faces.push(new THREE.Face4(c+j*f,c+j*(f+1),c+1+j*(f+1),c+1+j*f)),this.faceVertexUvs[0].push([new THREE.UV(c/d,f/e),new THREE.UV(c/d,(f+1)/e),new THREE.UV((c+1)/d,(f+1)/e),new THREE.UV((c+1)/d,f/e)]);this.computeCentroids();this.computeFaceNormals()};
THREE.PlaneGeometry.prototype=new THREE.Geometry;THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;
THREE.SphereGeometry=function(b,c,d){THREE.Geometry.call(this);for(var b=b||50,e,f=Math.PI,g=Math.max(3,c||8),h=Math.max(2,d||6),c=[],d=0;d<h+1;d++){e=d/h;var j=b*Math.cos(e*f),m=b*Math.sin(e*f),n=[],t=0;for(e=0;e<g;e++){var o=2*e/g,w=m*Math.sin(o*f),o=m*Math.cos(o*f);(d==0||d==h)&&e>0||(t=this.vertices.push(new THREE.Vertex(new THREE.Vector3(o,j,w)))-1);n.push(t)}c.push(n)}for(var u,A,C,f=c.length,d=0;d<f;d++)if(g=c[d].length,d>0)for(e=0;e<g;e++){n=e==g-1;h=c[d][n?0:e+1];j=c[d][n?g-1:e];m=c[d-1][n?
g-1:e];n=c[d-1][n?0:e+1];w=d/(f-1);u=(d-1)/(f-1);A=(e+1)/g;var o=e/g,t=new THREE.UV(1-A,w),w=new THREE.UV(1-o,w),o=new THREE.UV(1-o,u),p=new THREE.UV(1-A,u);d<c.length-1&&(u=this.vertices[h].position.clone(),A=this.vertices[j].position.clone(),C=this.vertices[m].position.clone(),u.normalize(),A.normalize(),C.normalize(),this.faces.push(new THREE.Face3(h,j,m,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(A.x,A.y,A.z),new THREE.Vector3(C.x,C.y,C.z)])),this.faceVertexUvs[0].push([t,w,o]));d>1&&(u=
this.vertices[h].position.clone(),A=this.vertices[m].position.clone(),C=this.vertices[n].position.clone(),u.normalize(),A.normalize(),C.normalize(),this.faces.push(new THREE.Face3(h,m,n,[new THREE.Vector3(u.x,u.y,u.z),new THREE.Vector3(A.x,A.y,A.z),new THREE.Vector3(C.x,C.y,C.z)])),this.faceVertexUvs[0].push([t,o,p]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.SphereGeometry.prototype=new THREE.Geometry;
THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(b,c){THREE.Geometry.call(this);this.parameters=c||{};this.set(b)};THREE.TextGeometry.prototype=new THREE.Geometry;THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;
THREE.TextGeometry.prototype.set=function(b,c){function d(b,c,d){A.vertices.push(new THREE.Vertex(new THREE.Vector3(b,c,d)))}function e(b,c,d,e){A.faces.push(new THREE.Face4(b,c,d,e))}this.text=b;var c=c||this.parameters,f=c.height!==void 0?c.height:50,g=c.curveSegments!==void 0?c.curveSegments:4,h=c.font!==void 0?c.font:"helvetiker",j=c.weight!==void 0?c.weight:"normal",m=c.style!==void 0?c.style:"normal",n=c.bezelThickness!==void 0?c.bezelThickness:10,t=c.bezelSize!==void 0?c.bezelSize:8,o=c.bezelEnabled!==
void 0?c.bezelEnabled:!1;THREE.FontUtils.size=c.size!==void 0?c.size:100;THREE.FontUtils.divisions=g;THREE.FontUtils.face=h;THREE.FontUtils.weight=j;THREE.FontUtils.style=m;THREE.FontUtils.bezelSize=t;var j=THREE.FontUtils.drawText(b),g=j.points,w=j.faces,h=j.contour,u=j.bezel,A=this;A.vertices=[];A.faces=[];for(var C,m=g.length,p=w.length,t=u.length,j=0;j<m;j++)C=g[j],d(C.x,C.y,0);for(j=0;j<m;j++)C=g[j],d(C.x,C.y,f);if(o){for(j=0;j<t;j++)C=u[j],d(C.x,C.y,n);for(j=0;j<t;j++)C=u[j],d(C.x,C.y,f-n)}for(j=
0;j<p;j++)f=w[j],A.faces.push(new THREE.Face3(f[2],f[1],f[0]));for(j=0;j<p;j++)f=w[j],A.faces.push(new THREE.Face3(f[0]+m,f[1]+m,f[2]+m));var x;if(o)for(j=u.length;--j>0;){if(x){if(x.equals(h[j])){x=null;continue}}else x=h[j];n=m*2+j;w=n-1;e(n,w,w+t,n+t);for(o=0;o<m;o++)if(g[o].equals(h[j]))break;for(f=0;f<m;f++)if(g[f].equals(h[j-1]))break;e(o,f,w,n);e(n+t,w+t,f+m,o+m)}else for(j=h.length;--j>0;){if(x){if(x.equals(h[j])){x=null;continue}}else x=h[j];for(o=0;o<m;o++)if(g[o].equals(h[j]))break;for(f=
0;f<m;f++)if(g[f].equals(h[j-1]))break;e(o,f,f+m,o+m)}this.computeCentroids();this.computeFaceNormals()};
THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var c=b.familyName.toLowerCase();this.faces[c]=this.faces[c]||{};this.faces[c][b.cssFontWeight]=this.faces[c][b.cssFontWeight]||{};this.faces[c][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[c][b.cssFontWeight][b.cssFontStyle]=b},extractPoints:function(b,c){if(b.length<3)return console.log("not valid polygon"),
{points:b,faces:[]};var d,e,f,g,h=[],j;for(j in c){b=c[j];g=[];for(d in b)e=b[d],g.push(e.x+","+e.y);var m,n;n=g.slice(1).indexOf(g[0]);var t=this.Triangulate.area(b.slice(0,n+1))<0;e=[];for(n=-1;n<g.length;){m=n+1;n=g[m];n=g.slice(m+1).indexOf(n)+m;if(n<=m)break;var o=b.slice(m,n+1);t?this.Triangulate.area(o)<0?(m>0&&h.push({shape:f,holes:e}),f=o,e=[]):e.push(o):this.Triangulate.area(o)<0?(h.push({shape:o,holes:e}),e=[]):e.push(o);n++}t&&h.push({shape:f,holes:e})}var w,u,A,C,p,x;g=[];for(j=0;j<h.length;j++){m=
h[j];f=m.shape;e=m.holes;for(t=0;t<e.length;t++){n=e[t];A=Number.POSITIVE_INFINITY;for(o=0;o<n.length;o++){p=n[o];for(d=0;d<f.length;d++)C=f[d],C=p.distanceTo(C),C<A&&(A=C,w=o,u=d)}d=u-1>=0?u-1:f.length-1;var o=w-1>=0?w-1:n.length-1,H=[];H.push(n[w]);H.push(f[u]);H.push(f[d]);A=this.Triangulate.area(H);var B=[];B.push(n[w]);B.push(n[o]);B.push(f[u]);p=this.Triangulate.area(B);C=u;x=w;u+=1;w+=-1;u<0&&(u+=f.length);u%=f.length;w<0&&(w+=n.length);w%=f.length;d=u-1>=0?u-1:f.length-1;o=w-1>=0?w-1:n.length-
1;H=[];H.push(n[w]);H.push(f[u]);H.push(f[d]);H=this.Triangulate.area(H);B=[];B.push(n[w]);B.push(n[o]);B.push(f[u]);B=this.Triangulate.area(B);A+p>H+B&&(u=C,w=x,u<0&&(u+=f.length),u%=f.length,w<0&&(w+=n.length),w%=f.length,d=u-1>=0?u-1:f.length-1,o=w-1>=0?w-1:n.length-1);A=f.slice(0,u);p=f.slice(u);C=n.slice(w);x=n.slice(0,w);g.push(n[w]);g.push(f[u]);g.push(f[d]);g.push(n[w]);g.push(n[o]);g.push(f[u]);f=A.concat(C).concat(x).concat(p)}m.shape=f}b=[];w=[];for(j=t=0;j<h.length;j++){m=h[j];f=m.shape;
b=b.concat(f);m=THREE.FontUtils.Triangulate(f,!0);for(u=0;u<m.length;u++)e=m[u],e[0]+=t,e[1]+=t,e[2]+=t;w=w.concat(m);t+=f.length}var I;for(u=0;u<g.length/3;u++){e=[];for(h=0;h<3;h++){j=!1;for(f=0;f<b.length&&!j;f++)I=u*3+h,b[f].equals(g[I])&&(e.push(f),j=!0);j||(b.push(g[I]),e.push(b.length-1),console.log("not found"))}w.push(e)}return{points:b,faces:w}},drawText:function(b){var c=[],d=[],e,f=this.getFace(),g=this.size/f.resolution,h=0;e=String(b).split("");for(var j=e.length,b=0;b<j;b++){var m=
this.extractGlyphPoints(e[b],f,g,h);h+=m.offset;c.push(m.points);d=d.concat(m.points)}b=h/2;for(e=0;e<d.length;e++)d[e].x-=b;c=this.extractPoints(d,c);c.contour=d;f=[];g=[];e=[];for(var h=[],j=new THREE.Vector2,n,b=d.length;--b>=0;){if(n){if(n.equals(d[b])){n=null;m=this.Triangulate.area(e)>0;h.push(m);g.push(j.divideScalar(e.length));e=[];j=new THREE.Vector2;continue}}else n=d[b];j.addSelf(d[b]);e.push(d[b])}b=d.length;e=0;for(var t;--b>=0;)m=d[b],j=g[e],m=m.clone().subSelf(j),t=this.bezelSize/m.length(),
h[e]?t+=1:t=1-t,t=m.multiplyScalar(t).addSelf(j),f.unshift(t),n?n.equals(d[b])&&(n=null,e++):n=d[b];c.bezel=f;return c},b2p0:function(b,c){var d=1-b;return d*d*c},b2p1:function(b,c){return 2*(1-b)*b*c},b2p2:function(b,c){return b*b*c},b2:function(b,c,d,e){return this.b2p0(b,c)+this.b2p1(b,d)+this.b2p2(b,e)},b3p0:function(b,c){var d=1-b;return d*d*d*c},b3p1:function(b,c){var d=1-b;return 3*d*d*b*c},b3p2:function(b,c){return 3*(1-b)*b*b*c},b3p3:function(b,c){return b*b*b*c},b3:function(b,c,d,e,f){return this.b3p0(b,
c)+this.b3p1(b,d)+this.b3p2(b,e)+this.b3p3(b,f)},extractGlyphPoints:function(b,c,d,e){var f=[],g,h,j,m,n,t,o,w,u,A,C=c.glyphs[b]||c.glyphs[ctxt.options.fallbackCharacter];if(C){if(C.o){c=C._cachedOutline||(C._cachedOutline=C.o.split(" "));j=c.length;for(b=0;b<j;)switch(h=c[b++],h){case "m":h=c[b++]*d+e;m=c[b++]*d;f.push(new THREE.Vector2(h,m));break;case "l":h=c[b++]*d+e;m=c[b++]*d;f.push(new THREE.Vector2(h,m));break;case "q":h=c[b++]*d+e;m=c[b++]*d;o=c[b++]*d+e;w=c[b++]*d;if(g=f[f.length-1]){n=
g.x;t=g.y;g=1;for(divisions=this.divisions;g<=divisions;g++){var p=g/divisions,x=THREE.FontUtils.b2(p,n,o,h),p=THREE.FontUtils.b2(p,t,w,m);f.push(new THREE.Vector2(x,p))}}break;case "b":if(h=c[b++]*d+e,m=c[b++]*d,o=c[b++]*d+e,w=c[b++]*-d,u=c[b++]*d+e,A=c[b++]*-d,g=f[f.length-1]){n=g.x;t=g.y;g=1;for(divisions=this.divisions;g<=divisions;g++)p=g/divisions,x=THREE.FontUtils.b3(p,n,o,u,h),p=THREE.FontUtils.b3(p,t,w,A,m),f.push(new THREE.Vector2(x,p))}}}return{offset:C.ha*d,points:f}}}};
(function(b){var c=function(b){for(var c=b.length,f=0,g=c-1,h=0;h<c;g=h++)f+=b[g].x*b[h].y-b[h].x*b[g].y;return f*0.5};b.Triangulate=function(b,e){var f=b.length;if(f<3)return null;var g=[],h=[],j=[],m,n,t;if(c(b)>0)for(n=0;n<f;n++)h[n]=n;else for(n=0;n<f;n++)h[n]=f-1-n;var o=2*f;for(n=f-1;f>2;){if(o--<=0){console.log("Warning, unable to triangulate polygon!");if(e)return j;return g}m=n;f<=m&&(m=0);n=m+1;f<=n&&(n=0);t=n+1;f<=t&&(t=0);var w;a:{w=b;var u=m,A=n,C=t,p=f,x=h,H=void 0,B=void 0,I=void 0,
D=void 0,F=void 0,T=void 0,L=void 0,M=void 0,N=void 0,B=w[x[u]].x,I=w[x[u]].y,D=w[x[A]].x,F=w[x[A]].y,T=w[x[C]].x,L=w[x[C]].y;if(1.0E-10>(D-B)*(L-I)-(F-I)*(T-B))w=!1;else{for(H=0;H<p;H++)if(!(H==u||H==A||H==C)){var M=w[x[H]].x,N=w[x[H]].y,S=void 0,v=void 0,J=void 0,k=void 0,P=void 0,K=void 0,U=void 0,O=void 0,z=void 0,E=void 0,V=void 0,G=void 0,S=J=P=void 0,S=T-D,v=L-F,J=B-T,k=I-L,P=D-B,K=F-I,U=M-B,O=N-I,z=M-D,E=N-F,V=M-T,G=N-L,S=S*E-v*z,P=P*O-K*U,J=J*G-k*V;if(S>=0&&J>=0&&P>=0){w=!1;break a}}w=!0}}if(w){o=
h[m];w=h[n];u=h[t];g.push(b[o]);g.push(b[w]);g.push(b[u]);j.push([h[m],h[n],h[t]]);m=n;for(t=n+1;t<f;m++,t++)h[m]=h[t];f--;o=2*f}}if(e)return j;return g};b.Triangulate.area=c;return b})(THREE.FontUtils);window._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};
THREE.TorusGeometry=function(b,c,d,e){THREE.Geometry.call(this);this.radius=b||100;this.tube=c||40;this.segmentsR=d||8;this.segmentsT=e||6;b=[];for(c=0;c<=this.segmentsR;++c)for(d=0;d<=this.segmentsT;++d){var e=d/this.segmentsT*2*Math.PI,f=c/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(f))*Math.cos(e),(this.radius+this.tube*Math.cos(f))*Math.sin(e),this.tube*Math.sin(f))));b.push([d/this.segmentsT,1-c/this.segmentsR])}for(c=1;c<=this.segmentsR;++c)for(d=
1;d<=this.segmentsT;++d){var e=(this.segmentsT+1)*c+d,f=(this.segmentsT+1)*c+d-1,g=(this.segmentsT+1)*(c-1)+d-1,h=(this.segmentsT+1)*(c-1)+d;this.faces.push(new THREE.Face4(e,f,g,h));this.faceVertexUvs[0].push([new THREE.UV(b[e][0],b[e][1]),new THREE.UV(b[f][0],b[f][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[h][0],b[h][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusGeometry.prototype=new THREE.Geometry;
THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;
THREE.TorusKnotGeometry=function(b,c,d,e,f,g,h){function j(b,c,d,e,f,g){c=d/e*b;d=Math.cos(c);return new THREE.Vector3(f*(2+d)*0.5*Math.cos(b),f*(2+d)*Math.sin(b)*0.5,g*f*Math.sin(c)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=c||40;this.segmentsR=d||64;this.segmentsT=e||8;this.p=f||2;this.q=g||3;this.heightScale=h||1;this.grid=Array(this.segmentsR);d=new THREE.Vector3;e=new THREE.Vector3;g=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(c=0;c<
this.segmentsT;++c){var m=b/this.segmentsR*2*this.p*Math.PI,h=c/this.segmentsT*2*Math.PI,f=j(m,h,this.q,this.p,this.radius,this.heightScale),m=j(m+0.01,h,this.q,this.p,this.radius,this.heightScale);d.x=m.x-f.x;d.y=m.y-f.y;d.z=m.z-f.z;e.x=m.x+f.x;e.y=m.y+f.y;e.z=m.z+f.z;g.cross(d,e);e.cross(g,d);g.normalize();e.normalize();m=-this.tube*Math.cos(h);h=this.tube*Math.sin(h);f.x+=m*e.x+h*g.x;f.y+=m*e.y+h*g.y;f.z+=m*e.z+h*g.z;this.grid[b][c]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(f.x,f.y,
f.z)))-1}}for(b=0;b<this.segmentsR;++b)for(c=0;c<this.segmentsT;++c){var e=(b+1)%this.segmentsR,g=(c+1)%this.segmentsT,f=this.grid[b][c],d=this.grid[e][c],e=this.grid[e][g],g=this.grid[b][g],h=new THREE.UV(b/this.segmentsR,c/this.segmentsT),m=new THREE.UV((b+1)/this.segmentsR,c/this.segmentsT),n=new THREE.UV((b+1)/this.segmentsR,(c+1)/this.segmentsT),t=new THREE.UV(b/this.segmentsR,(c+1)/this.segmentsT);this.faces.push(new THREE.Face4(f,d,e,g));this.faceVertexUvs[0].push([h,m,n,t])}this.computeCentroids();
this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=new THREE.Geometry;THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var c="Loaded ";c+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=c},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,c,d){b.materials=[];for(var e=0;e<c.length;++e)b.materials[e]=[THREE.Loader.prototype.createMaterial(c[e],d)]},createMaterial:function(b,c){function d(b){b=Math.log(b)/Math.LN2;return Math.floor(b)==b}function e(b,c){var e=new Image;e.onload=function(){if(!d(this.width)||!d(this.height)){var c=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),e=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));b.image.width=c;b.image.height=e;b.image.getContext("2d").drawImage(this,0,0,c,e)}else b.image=this;b.needsUpdate=!0};e.src=c}var f,g,h;f="MeshLambertMaterial";g={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};b.shading&&(b.shading=="Phong"?f="MeshPhongMaterial":b.shading=="Basic"&&(f="MeshBasicMaterial"));if(b.blending)if(b.blending=="Additive")g.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")g.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")g.blending=THREE.MultiplyBlending;if(b.transparent!==void 0||b.opacity<1)g.transparent=b.transparent;if(b.depthTest!==void 0)g.depthTest=b.depthTest;if(b.vertexColors!==void 0)if(b.vertexColors=="face")g.vertexColors=THREE.FaceColors;else if(b.vertexColors)g.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&c){h=document.createElement("canvas");g.map=new THREE.Texture(h);g.map.sourceFile=b.mapDiffuse;if(b.mapDiffuseRepeat)g.map.repeat.set(b.mapDiffuseRepeat[0],b.mapDiffuseRepeat[1]),g.map.wrapS=
g.map.wrapT=THREE.RepeatWrapping;b.mapDiffuseOffset&&g.map.offset.set(b.mapDiffuseOffset[0],b.mapDiffuseOffset[1]);e(g.map,c+"/"+b.mapDiffuse)}else if(b.colorDiffuse)h=(b.colorDiffuse[0]*255<<16)+(b.colorDiffuse[1]*255<<8)+b.colorDiffuse[2]*255,g.color=h,g.opacity=b.transparency;else if(b.DbgColor)g.color=b.DbgColor;if(b.mapLight&&c){h=document.createElement("canvas");g.lightMap=new THREE.Texture(h);g.lightMap.sourceFile=b.mapLight;if(b.mapLightmapRepeat)g.lightMap.repeat.set(b.mapLightRepeat[0],
b.mapLightRepeat[1]),g.lightMap.wrapS=g.lightMap.wrapT=THREE.RepeatWrapping;b.mapLightmapOffset&&g.lightMap.offset.set(b.mapLightmapOffset[0],b.mapLightmapOffset[1]);e(g.lightMap,c+"/"+b.mapLightmap)}return new THREE[f](g)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var c=this,d=b.model,e=b.callback,f=b.texture_path?b.texture_path:this.extractUrlbase(d),b=new Worker(d);b.onmessage=function(b){c.createModel(b.data,e,f);c.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,c,d){var e=new THREE.Geometry,f=b.scale!==void 0?1/b.scale:1;this.init_materials(e,b.materials,d);(function(c){if(b.version===void 0||b.version!=2)console.error("Deprecated file format.");else{var d,f,m,n,t,o,w,u,A,C,p,x,H,B,I=b.faces;o=b.vertices;var D=b.normals,F=b.colors,T=0;for(d=0;d<b.uvs.length;d++)b.uvs[d].length&&T++;for(d=0;d<T;d++)e.faceUvs[d]=[],e.faceVertexUvs[d]=[];n=0;for(t=o.length;n<t;)w=new THREE.Vertex,w.position.x=o[n++]*c,w.position.y=
o[n++]*c,w.position.z=o[n++]*c,e.vertices.push(w);n=0;for(t=I.length;n<t;){c=I[n++];o=c&1;m=c&2;d=c&4;f=c&8;u=c&16;w=c&32;C=c&64;c&=128;o?(p=new THREE.Face4,p.a=I[n++],p.b=I[n++],p.c=I[n++],p.d=I[n++],o=4):(p=new THREE.Face3,p.a=I[n++],p.b=I[n++],p.c=I[n++],o=3);if(m)m=I[n++],p.materials=e.materials[m];m=e.faces.length;if(d)for(d=0;d<T;d++)x=b.uvs[d],A=I[n++],B=x[A*2],A=x[A*2+1],e.faceUvs[d][m]=new THREE.UV(B,A);if(f)for(d=0;d<T;d++){x=b.uvs[d];H=[];for(f=0;f<o;f++)A=I[n++],B=x[A*2],A=x[A*2+1],H[f]=
new THREE.UV(B,A);e.faceVertexUvs[d][m]=H}if(u)u=I[n++]*3,f=new THREE.Vector3,f.x=D[u++],f.y=D[u++],f.z=D[u],p.normal=f;if(w)for(d=0;d<o;d++)u=I[n++]*3,f=new THREE.Vector3,f.x=D[u++],f.y=D[u++],f.z=D[u],p.vertexNormals.push(f);if(C)w=I[n++],w=new THREE.Color(F[w]),p.color=w;if(c)for(d=0;d<o;d++)w=I[n++],w=new THREE.Color(F[w]),p.vertexColors.push(w);e.faces.push(p)}}})(f);(function(){var c,d,f,m;if(b.skinWeights){c=0;for(d=b.skinWeights.length;c<d;c+=2)f=b.skinWeights[c],m=b.skinWeights[c+1],e.skinWeights.push(new THREE.Vector4(f,
m,0,0))}if(b.skinIndices){c=0;for(d=b.skinIndices.length;c<d;c+=2)f=b.skinIndices[c],m=b.skinIndices[c+1],e.skinIndices.push(new THREE.Vector4(f,m,0,0))}e.bones=b.bones;e.animation=b.animation})();(function(c){if(b.morphTargets!==void 0){var d,f,m,n,t,o,w,u,A;d=0;for(f=b.morphTargets.length;d<f;d++){e.morphTargets[d]={};e.morphTargets[d].name=b.morphTargets[d].name;e.morphTargets[d].vertices=[];u=e.morphTargets[d].vertices;A=b.morphTargets[d].vertices;m=0;for(n=A.length;m<n;m+=3)t=A[m]*c,o=A[m+1]*
c,w=A[m+2]*c,u.push(new THREE.Vertex(new THREE.Vector3(t,o,w)))}}if(b.morphColors!==void 0){d=0;for(f=b.morphColors.length;d<f;d++){e.morphColors[d]={};e.morphColors[d].name=b.morphColors[d].name;e.morphColors[d].colors=[];n=e.morphColors[d].colors;t=b.morphColors[d].colors;c=0;for(m=t.length;c<m;c+=3)o=new THREE.Color(16755200),o.setRGB(t[c],t[c+1],t[c+2]),n.push(o)}}})(f);(function(){if(b.edges!==void 0){var c,d,f;for(c=0;c<b.edges.length;c+=2)d=b.edges[c],f=b.edges[c+1],e.edges.push(new THREE.Edge(e.vertices[d],
e.vertices[f],d,f))}})();e.computeCentroids();e.computeFaceNormals();c(e)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var c=b.model,d=b.callback,e=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(c),f=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(c),b=(new Date).getTime(),c=new Worker(c),g=this.showProgress?THREE.Loader.prototype.updateProgress:null;c.onmessage=function(b){THREE.BinaryLoader.prototype.loadAjaxBuffers(b.data.buffers,b.data.materials,d,f,e,g)};c.onerror=function(b){alert("worker.onerror: "+b.message+"\n"+b.data);b.preventDefault()};
c.postMessage(b)},loadAjaxBuffers:function(b,c,d,e,f,g){var h=new XMLHttpRequest,j=e+"/"+b,m=0;h.onreadystatechange=function(){h.readyState==4?h.status==200||h.status==0?THREE.BinaryLoader.prototype.createBinModel(h.responseText,d,f,c):alert("Couldn't load ["+j+"] ["+h.status+"]"):h.readyState==3?g&&(m==0&&(m=h.getResponseHeader("Content-Length")),g({total:m,loaded:h.responseText.length})):h.readyState==2&&(m=h.getResponseHeader("Content-Length"))};h.open("GET",j,!0);h.overrideMimeType("text/plain; charset=x-user-defined");
h.setRequestHeader("Content-Type","text/plain");h.send(null)},createBinModel:function(b,c,d,e){var f=function(c){function d(b,c){var e=t(b,c),f=t(b,c+1),g=t(b,c+2),k=t(b,c+3),j=(k<<1&255|g>>7)-127;e|=(g&127)<<16|f<<8;if(e==0&&j==-127)return 0;return(1-2*(k>>7))*(1+e*Math.pow(2,-23))*Math.pow(2,j)}function f(b,c){var d=t(b,c),e=t(b,c+1),g=t(b,c+2);return(t(b,c+3)<<24)+(g<<16)+(e<<8)+d}function m(b,c){var d=t(b,c);return(t(b,c+1)<<8)+d}function n(b,c){var d=t(b,c);return d>127?d-256:d}function t(b,
c){return b.charCodeAt(c)&255}function o(c){var d,e,g;d=f(b,c);e=f(b,c+F);g=f(b,c+T);c=m(b,c+L);THREE.BinaryLoader.prototype.f3(x,d,e,g,c)}function w(c){var d,e,g,k,z,G;d=f(b,c);e=f(b,c+F);g=f(b,c+T);k=m(b,c+L);z=f(b,c+M);G=f(b,c+N);c=f(b,c+S);THREE.BinaryLoader.prototype.f3n(x,I,d,e,g,k,z,G,c)}function u(c){var d,e,g,z;d=f(b,c);e=f(b,c+v);g=f(b,c+J);z=f(b,c+k);c=m(b,c+P);THREE.BinaryLoader.prototype.f4(x,d,e,g,z,c)}function A(c){var d,e,g,G,h,E,p,y;d=f(b,c);e=f(b,c+v);g=f(b,c+J);G=f(b,c+k);h=m(b,
c+P);E=f(b,c+K);p=f(b,c+U);y=f(b,c+O);c=f(b,c+z);THREE.BinaryLoader.prototype.f4n(x,I,d,e,g,G,h,E,p,y,c)}function C(c){var d,e;d=f(b,c);e=f(b,c+E);c=f(b,c+V);THREE.BinaryLoader.prototype.uv3(x.faceVertexUvs[0],D[d*2],D[d*2+1],D[e*2],D[e*2+1],D[c*2],D[c*2+1])}function p(c){var d,e,g;d=f(b,c);e=f(b,c+G);g=f(b,c+R);c=f(b,c+W);THREE.BinaryLoader.prototype.uv4(x.faceVertexUvs[0],D[d*2],D[d*2+1],D[e*2],D[e*2+1],D[g*2],D[g*2+1],D[c*2],D[c*2+1])}var x=this,H=0,B,I=[],D=[],F,T,L,M,N,S,v,J,k,P,K,U,O,z,E,V,
G,R,W,$,y,Q,Z,X,ga;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(x,e,c);B={signature:b.substr(H,8),header_bytes:t(b,H+8),vertex_coordinate_bytes:t(b,H+9),normal_coordinate_bytes:t(b,H+10),uv_coordinate_bytes:t(b,H+11),vertex_index_bytes:t(b,H+12),normal_index_bytes:t(b,H+13),uv_index_bytes:t(b,H+14),material_index_bytes:t(b,H+15),nvertices:f(b,H+16),nnormals:f(b,H+16+4),nuvs:f(b,H+16+8),ntri_flat:f(b,H+16+12),ntri_smooth:f(b,H+16+16),ntri_flat_uv:f(b,H+16+20),ntri_smooth_uv:f(b,
H+16+24),nquad_flat:f(b,H+16+28),nquad_smooth:f(b,H+16+32),nquad_flat_uv:f(b,H+16+36),nquad_smooth_uv:f(b,H+16+40)};H+=B.header_bytes;F=B.vertex_index_bytes;T=B.vertex_index_bytes*2;L=B.vertex_index_bytes*3;M=B.vertex_index_bytes*3+B.material_index_bytes;N=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes;S=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*2;v=B.vertex_index_bytes;J=B.vertex_index_bytes*2;k=B.vertex_index_bytes*3;P=B.vertex_index_bytes*4;K=B.vertex_index_bytes*
4+B.material_index_bytes;U=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes;O=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*2;z=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*3;E=B.uv_index_bytes;V=B.uv_index_bytes*2;G=B.uv_index_bytes;R=B.uv_index_bytes*2;W=B.uv_index_bytes*3;c=B.vertex_index_bytes*3+B.material_index_bytes;ga=B.vertex_index_bytes*4+B.material_index_bytes;$=B.ntri_flat*c;y=B.ntri_smooth*(c+B.normal_index_bytes*3);Q=B.ntri_flat_uv*
(c+B.uv_index_bytes*3);Z=B.ntri_smooth_uv*(c+B.normal_index_bytes*3+B.uv_index_bytes*3);X=B.nquad_flat*ga;c=B.nquad_smooth*(ga+B.normal_index_bytes*4);ga=B.nquad_flat_uv*(ga+B.uv_index_bytes*4);H+=function(c){for(var e,f,g,k=B.vertex_coordinate_bytes*3,j=c+B.nvertices*k;c<j;c+=k)e=d(b,c),f=d(b,c+B.vertex_coordinate_bytes),g=d(b,c+B.vertex_coordinate_bytes*2),THREE.BinaryLoader.prototype.v(x,e,f,g);return B.nvertices*k}(H);H+=function(c){for(var d,e,f,g=B.normal_coordinate_bytes*3,k=c+B.nnormals*g;c<
k;c+=g)d=n(b,c),e=n(b,c+B.normal_coordinate_bytes),f=n(b,c+B.normal_coordinate_bytes*2),I.push(d/127,e/127,f/127);return B.nnormals*g}(H);H+=function(c){for(var e,f,g=B.uv_coordinate_bytes*2,k=c+B.nuvs*g;c<k;c+=g)e=d(b,c),f=d(b,c+B.uv_coordinate_bytes),D.push(e,f);return B.nuvs*g}(H);$=H+$;y=$+y;Q=y+Q;Z=Q+Z;X=Z+X;c=X+c;ga=c+ga;(function(b){var c,d=B.vertex_index_bytes*3+B.material_index_bytes,e=d+B.uv_index_bytes*3,f=b+B.ntri_flat_uv*e;for(c=b;c<f;c+=e)o(c),C(c+d);return f-b})(y);(function(b){var c,
d=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*3,e=d+B.uv_index_bytes*3,f=b+B.ntri_smooth_uv*e;for(c=b;c<f;c+=e)w(c),C(c+d);return f-b})(Q);(function(b){var c,d=B.vertex_index_bytes*4+B.material_index_bytes,e=d+B.uv_index_bytes*4,f=b+B.nquad_flat_uv*e;for(c=b;c<f;c+=e)u(c),p(c+d);return f-b})(c);(function(b){var c,d=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*4,e=d+B.uv_index_bytes*4,f=b+B.nquad_smooth_uv*e;for(c=b;c<f;c+=e)A(c),p(c+d);return f-b})(ga);
(function(b){var c,d=B.vertex_index_bytes*3+B.material_index_bytes,e=b+B.ntri_flat*d;for(c=b;c<e;c+=d)o(c);return e-b})(H);(function(b){var c,d=B.vertex_index_bytes*3+B.material_index_bytes+B.normal_index_bytes*3,e=b+B.ntri_smooth*d;for(c=b;c<e;c+=d)w(c);return e-b})($);(function(b){var c,d=B.vertex_index_bytes*4+B.material_index_bytes,e=b+B.nquad_flat*d;for(c=b;c<e;c+=d)u(c);return e-b})(Z);(function(b){var c,d=B.vertex_index_bytes*4+B.material_index_bytes+B.normal_index_bytes*4,e=b+B.nquad_smooth*
d;for(c=b;c<e;c+=d)A(c);return e-b})(X);this.computeCentroids();this.computeFaceNormals()};f.prototype=new THREE.Geometry;f.prototype.constructor=f;c(new f(d))},v:function(b,c,d,e){b.vertices.push(new THREE.Vertex(new THREE.Vector3(c,d,e)))},f3:function(b,c,d,e,f){b.faces.push(new THREE.Face3(c,d,e,null,null,b.materials[f]))},f4:function(b,c,d,e,f,g){b.faces.push(new THREE.Face4(c,d,e,f,null,null,b.materials[g]))},f3n:function(b,c,d,e,f,g,h,j,m){var g=b.materials[g],n=c[j*3],t=c[j*3+1],j=c[j*3+2],
o=c[m*3],w=c[m*3+1],m=c[m*3+2];b.faces.push(new THREE.Face3(d,e,f,[new THREE.Vector3(c[h*3],c[h*3+1],c[h*3+2]),new THREE.Vector3(n,t,j),new THREE.Vector3(o,w,m)],null,g))},f4n:function(b,c,d,e,f,g,h,j,m,n,t){var h=b.materials[h],o=c[m*3],w=c[m*3+1],m=c[m*3+2],u=c[n*3],A=c[n*3+1],n=c[n*3+2],C=c[t*3],p=c[t*3+1],t=c[t*3+2];b.faces.push(new THREE.Face4(d,e,f,g,[new THREE.Vector3(c[j*3],c[j*3+1],c[j*3+2]),new THREE.Vector3(o,w,m),new THREE.Vector3(u,A,n),new THREE.Vector3(C,p,t)],null,h))},uv3:function(b,
c,d,e,f,g,h){var j=[];j.push(new THREE.UV(c,d));j.push(new THREE.UV(e,f));j.push(new THREE.UV(g,h));b.push(j)},uv4:function(b,c,d,e,f,g,h,j,m){var n=[];n.push(new THREE.UV(c,d));n.push(new THREE.UV(e,f));n.push(new THREE.UV(g,h));n.push(new THREE.UV(j,m));b.push(n)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,c){var d=this,e=new Worker(b);e.postMessage(0);var f=THREE.Loader.prototype.extractUrlbase(b);e.onmessage=function(b){function e(b,c){return c=="relativeToHTML"?b:f+"/"+b}function j(){for(u in N.objects)if(!K.objects[u])if(H=N.objects[u],H.geometry!==void 0){if(F=K.geometries[H.geometry]){M=[];for(z=0;z<H.materials.length;z++)M[z]=K.materials[H.materials[z]];B=H.position;r=H.rotation;q=H.quaternion;s=H.scale;q=0;M.length==0&&(M[0]=new THREE.MeshFaceMaterial);
M.length>1&&(M=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(F,M);object.name=u;object.position.set(B[0],B[1],B[2]);q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=H.visible;K.scene.addObject(object);K.objects[u]=object;if(H.meshCollider){var b=THREE.CollisionUtils.MeshColliderWBox(object);K.scene.collisions.colliders.push(b)}if(H.castsShadow)b=new THREE.ShadowVolume(F),K.scene.addChild(b),
b.position=object.position,b.rotation=object.rotation,b.scale=object.scale;H.trigger&&H.trigger.toLowerCase()!="none"&&(b={type:H.trigger,object:H},K.triggers[object.name]=b)}}else B=H.position,r=H.rotation,q=H.quaternion,s=H.scale,q=0,object=new THREE.Object3D,object.name=u,object.position.set(B[0],B[1],B[2]),q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]),object.scale.set(s[0],s[1],s[2]),object.visible=H.visible!==void 0?H.visible:!1,K.scene.addObject(object),
K.objects[u]=object,K.empties[u]=object,H.trigger&&H.trigger.toLowerCase()!="none"&&(b={type:H.trigger,object:H},K.triggers[object.name]=b)}function m(b){return function(c){K.geometries[b]=c;j();v-=1;d.onLoadComplete();t()}}function n(b){return function(c){K.geometries[b]=c}}function t(){d.callbackProgress({totalModels:k,totalTextures:P,loadedModels:k-v,loadedTextures:P-J},K);d.onLoadProgress();v==0&&J==0&&c(K)}var o,w,u,A,C,p,x,H,B,I,D,F,T,L,M,N,S,v,J,k,P,K;N=b.data;b=new THREE.BinaryLoader;S=new THREE.JSONLoader;
J=v=0;K={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var U=!1;for(u in N.objects)if(H=N.objects[u],H.meshCollider){U=!0;break}if(U)K.scene.collisions=new THREE.CollisionSystem;if(N.transform){U=N.transform.position;I=N.transform.rotation;var O=N.transform.scale;U&&K.scene.position.set(U[0],U[1],U[2]);I&&K.scene.rotation.set(I[0],I[1],I[2]);O&&K.scene.scale.set(O[0],O[1],O[2]);(U||I||O)&&K.scene.updateMatrix()}U=function(){J-=
1;t();d.onLoadComplete()};for(C in N.cameras){I=N.cameras[C];if(I.type=="perspective")T=new THREE.Camera(I.fov,I.aspect,I.near,I.far);else if(I.type=="ortho")T=new THREE.Camera,T.projectionMatrix=THREE.Matrix4.makeOrtho(I.left,I.right,I.top,I.bottom,I.near,I.far);B=I.position;I=I.target;T.position.set(B[0],B[1],B[2]);T.target.position.set(I[0],I[1],I[2]);K.cameras[C]=T}for(A in N.lights){C=N.lights[A];T=C.color!==void 0?C.color:16777215;I=C.intensity!==void 0?C.intensity:1;if(C.type=="directional")B=
C.direction,light=new THREE.DirectionalLight(T,I),light.position.set(B[0],B[1],B[2]),light.position.normalize();else if(C.type=="point")B=C.position,light=new THREE.PointLight(T,I),light.position.set(B[0],B[1],B[2]);K.scene.addLight(light);K.lights[A]=light}for(p in N.fogs)A=N.fogs[p],A.type=="linear"?L=new THREE.Fog(0,A.near,A.far):A.type=="exp2"&&(L=new THREE.FogExp2(0,A.density)),I=A.color,L.color.setRGB(I[0],I[1],I[2]),K.fogs[p]=L;if(K.cameras&&N.defaults.camera)K.currentCamera=K.cameras[N.defaults.camera];
if(K.fogs&&N.defaults.fog)K.scene.fog=K.fogs[N.defaults.fog];I=N.defaults.bgcolor;K.bgColor=new THREE.Color;K.bgColor.setRGB(I[0],I[1],I[2]);K.bgColorAlpha=N.defaults.bgalpha;for(o in N.geometries)if(p=N.geometries[o],p.type=="bin_mesh"||p.type=="ascii_mesh")v+=1,d.onLoadStart();k=v;for(o in N.geometries)p=N.geometries[o],p.type=="cube"?(F=new THREE.CubeGeometry(p.width,p.height,p.depth,p.segmentsWidth,p.segmentsHeight,p.segmentsDepth,null,p.flipped,p.sides),K.geometries[o]=F):p.type=="plane"?(F=
new THREE.PlaneGeometry(p.width,p.height,p.segmentsWidth,p.segmentsHeight),K.geometries[o]=F):p.type=="sphere"?(F=new THREE.SphereGeometry(p.radius,p.segmentsWidth,p.segmentsHeight),K.geometries[o]=F):p.type=="cylinder"?(F=new THREE.CylinderGeometry(p.numSegs,p.topRad,p.botRad,p.height,p.topOffset,p.botOffset),K.geometries[o]=F):p.type=="torus"?(F=new THREE.TorusGeometry(p.radius,p.tube,p.segmentsR,p.segmentsT),K.geometries[o]=F):p.type=="icosahedron"?(F=new THREE.IcosahedronGeometry(p.subdivisions),
K.geometries[o]=F):p.type=="bin_mesh"?b.load({model:e(p.url,N.urlBaseType),callback:m(o)}):p.type=="ascii_mesh"?S.load({model:e(p.url,N.urlBaseType),callback:m(o)}):p.type=="embedded_mesh"&&(p=N.embeds[p.id])&&S.createModel(p,n(o),"");for(x in N.textures)if(o=N.textures[x],o.url instanceof Array){J+=o.url.length;for(b=0;b<o.url.length;b++)d.onLoadStart()}else J+=1,d.onLoadStart();P=J;for(x in N.textures){o=N.textures[x];if(o.mapping!=void 0&&THREE[o.mapping]!=void 0)o.mapping=new THREE[o.mapping];
if(o.url instanceof Array){for(var b=[],z=0;z<o.url.length;z++)b[z]=e(o.url[z],N.urlBaseType);b=THREE.ImageUtils.loadTextureCube(b,o.mapping,U)}else{b=THREE.ImageUtils.loadTexture(e(o.url,N.urlBaseType),o.mapping,U);if(THREE[o.minFilter]!=void 0)b.minFilter=THREE[o.minFilter];if(THREE[o.magFilter]!=void 0)b.magFilter=THREE[o.magFilter];if(o.repeat)b.repeat.set(o.repeat[0],o.repeat[1]),b.wrapS=b.wrapT=THREE.RepeatWrapping}K.textures[x]=b}for(w in N.materials){x=N.materials[w];for(D in x.parameters)if(D==
"envMap"||D=="map"||D=="lightMap")x.parameters[D]=K.textures[x.parameters[D]];else if(D=="shading")x.parameters[D]=x.parameters[D]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(D=="blending")x.parameters[D]=THREE[x.parameters[D]]?THREE[x.parameters[D]]:THREE.NormalBlending;else if(D=="combine")x.parameters[D]=x.parameters[D]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(D=="vertexColors")if(x.parameters[D]=="face")x.parameters[D]=THREE.FaceColors;else if(x.parameters[D])x.parameters[D]=
THREE.VertexColors;if(x.parameters.opacity!==void 0&&x.parameters.opacity<1)x.parameters.transparent=!0;x=new THREE[x.type](x.parameters);K.materials[w]=x}j();d.callbackSync(K)}}};
THREE.MarchingCubes=function(b,c){THREE.Object3D.call(this);this.materials=c instanceof Array?c:[c];this.init=function(b){this.isolation=80;this.size=b;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(b,c,f){return b+(c-b)*f};this.VIntX=function(b,c,f,g,h,j,m,n,t,o){h=(h-t)/(o-t);t=this.normal_cache;c[g]=j+h*this.delta;c[g+1]=m;c[g+2]=n;f[g]=this.lerp(t[b],t[b+3],h);f[g+1]=this.lerp(t[b+1],t[b+4],h);f[g+2]=this.lerp(t[b+2],t[b+5],h)};this.VIntY=function(b,c,f,g,h,j,m,n,t,o){h=(h-t)/(o-t);t=this.normal_cache;c[g]=j;c[g+1]=m+h*this.delta;c[g+
2]=n;c=b+this.yd*3;f[g]=this.lerp(t[b],t[c],h);f[g+1]=this.lerp(t[b+1],t[c+1],h);f[g+2]=this.lerp(t[b+2],t[c+2],h)};this.VIntZ=function(b,c,f,g,h,j,m,n,t,o){h=(h-t)/(o-t);t=this.normal_cache;c[g]=j;c[g+1]=m;c[g+2]=n+h*this.delta;c=b+this.zd*3;f[g]=this.lerp(t[b],t[c],h);f[g+1]=this.lerp(t[b+1],t[c+1],h);f[g+2]=this.lerp(t[b+2],t[c+2],h)};this.compNorm=function(b){var c=b*3;this.normal_cache[c]==0&&(this.normal_cache[c]=this.field[b-1]-this.field[b+1],this.normal_cache[c+1]=this.field[b-this.yd]-this.field[b+
this.yd],this.normal_cache[c+2]=this.field[b-this.zd]-this.field[b+this.zd])};this.polygonize=function(b,c,f,g,h,j){var m=g+1,n=g+this.yd,t=g+this.zd,o=m+this.yd,w=m+this.zd,u=g+this.yd+this.zd,A=m+this.yd+this.zd,C=0,p=this.field[g],x=this.field[m],H=this.field[n],B=this.field[o],I=this.field[t],D=this.field[w],F=this.field[u],T=this.field[A];p<h&&(C|=1);x<h&&(C|=2);H<h&&(C|=8);B<h&&(C|=4);I<h&&(C|=16);D<h&&(C|=32);F<h&&(C|=128);T<h&&(C|=64);var L=THREE.edgeTable[C];if(L==0)return 0;var M=this.delta,
N=b+M,S=c+M,M=f+M;L&1&&(this.compNorm(g),this.compNorm(m),this.VIntX(g*3,this.vlist,this.nlist,0,h,b,c,f,p,x));L&2&&(this.compNorm(m),this.compNorm(o),this.VIntY(m*3,this.vlist,this.nlist,3,h,N,c,f,x,B));L&4&&(this.compNorm(n),this.compNorm(o),this.VIntX(n*3,this.vlist,this.nlist,6,h,b,S,f,H,B));L&8&&(this.compNorm(g),this.compNorm(n),this.VIntY(g*3,this.vlist,this.nlist,9,h,b,c,f,p,H));L&16&&(this.compNorm(t),this.compNorm(w),this.VIntX(t*3,this.vlist,this.nlist,12,h,b,c,M,I,D));L&32&&(this.compNorm(w),
this.compNorm(A),this.VIntY(w*3,this.vlist,this.nlist,15,h,N,c,M,D,T));L&64&&(this.compNorm(u),this.compNorm(A),this.VIntX(u*3,this.vlist,this.nlist,18,h,b,S,M,F,T));L&128&&(this.compNorm(t),this.compNorm(u),this.VIntY(t*3,this.vlist,this.nlist,21,h,b,c,M,I,F));L&256&&(this.compNorm(g),this.compNorm(t),this.VIntZ(g*3,this.vlist,this.nlist,24,h,b,c,f,p,I));L&512&&(this.compNorm(m),this.compNorm(w),this.VIntZ(m*3,this.vlist,this.nlist,27,h,N,c,f,x,D));L&1024&&(this.compNorm(o),this.compNorm(A),this.VIntZ(o*
3,this.vlist,this.nlist,30,h,N,S,f,B,T));L&2048&&(this.compNorm(n),this.compNorm(u),this.VIntZ(n*3,this.vlist,this.nlist,33,h,b,S,f,H,F));C<<=4;for(h=g=0;THREE.triTable[C+h]!=-1;)b=C+h,c=b+1,f=b+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[b],3*THREE.triTable[c],3*THREE.triTable[f],j),h+=3,g++;return g};this.posnormtriv=function(b,c,f,g,h,j){var m=this.count*3;this.positionArray[m]=b[f];this.positionArray[m+1]=b[f+1];this.positionArray[m+2]=b[f+2];this.positionArray[m+3]=b[g];this.positionArray[m+
4]=b[g+1];this.positionArray[m+5]=b[g+2];this.positionArray[m+6]=b[h];this.positionArray[m+7]=b[h+1];this.positionArray[m+8]=b[h+2];this.normalArray[m]=c[f];this.normalArray[m+1]=c[f+1];this.normalArray[m+2]=c[f+2];this.normalArray[m+3]=c[g];this.normalArray[m+4]=c[g+1];this.normalArray[m+5]=c[g+2];this.normalArray[m+6]=c[h];this.normalArray[m+7]=c[h+1];this.normalArray[m+8]=c[h+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&j(this)};this.begin=function(){this.count=0;
this.hasNormal=this.hasPos=!1};this.end=function(b){if(this.count!=0){for(var c=this.count*3;c<this.positionArray.length;c++)this.positionArray[c]=0;b(this)}};this.addBall=function(b,c,f,g,h){var j=this.size*Math.sqrt(g/h),m=f*this.size,n=c*this.size,t=b*this.size,o=Math.floor(m-j);o<1&&(o=1);m=Math.floor(m+j);m>this.size-1&&(m=this.size-1);var w=Math.floor(n-j);w<1&&(w=1);n=Math.floor(n+j);n>this.size-1&&(n=this.size-1);var u=Math.floor(t-j);u<1&&(u=1);j=Math.floor(t+j);j>this.size-1&&(j=this.size-
1);for(var A,C,p,x,H,B;o<m;o++){t=this.size2*o;C=o/this.size-f;H=C*C;for(C=w;C<n;C++){p=t+this.size*C;A=C/this.size-c;B=A*A;for(A=u;A<j;A++)x=A/this.size-b,x=g/(1.0E-6+x*x+B+H)-h,x>0&&(this.field[p+A]+=x)}}};this.addPlaneX=function(b,c){var f,g,h,j,m,n=this.size,t=this.yd,o=this.zd,w=this.field,u=n*Math.sqrt(b/c);u>n&&(u=n);for(f=0;f<u;f++)if(g=f/n,g*=g,j=b/(1.0E-4+g)-c,j>0)for(g=0;g<n;g++){m=f+g*t;for(h=0;h<n;h++)w[o*h+m]+=j}};this.addPlaneY=function(b,c){var f,g,h,j,m,n,t=this.size,o=this.yd,w=
this.zd,u=this.field,A=t*Math.sqrt(b/c);A>t&&(A=t);for(g=0;g<A;g++)if(f=g/t,f*=f,j=b/(1.0E-4+f)-c,j>0){m=g*o;for(f=0;f<t;f++){n=m+f;for(h=0;h<t;h++)u[w*h+n]+=j}}};this.addPlaneZ=function(b,c){var f,g,h,j,m,n;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(b/c);dist>size&&(dist=size);for(h=0;h<dist;h++)if(f=h/size,f*=f,j=b/(1.0E-4+f)-c,j>0){m=zd*h;for(g=0;g<size;g++){n=m+g*yd;for(f=0;f<size;f++)field[n+f]+=j}}};this.reset=function(){var b;for(b=0;b<this.size3;b++)this.normal_cache[b*
3]=0,this.field[b]=0};this.render=function(b){this.begin();var c,f,g,h,j,m,n,t,o,w=this.size-2;for(h=1;h<w;h++){o=this.size2*h;n=(h-this.halfsize)/this.halfsize;for(g=1;g<w;g++){t=o+this.size*g;m=(g-this.halfsize)/this.halfsize;for(f=1;f<w;f++)j=(f-this.halfsize)/this.halfsize,c=t+f,this.polygonize(j,m,n,c,this.isolation,b)}}this.end(b)};this.generateGeometry=function(){var b=0,c=new THREE.Geometry,f=[];this.render(function(g){var h,j,m,n,t,o,w,u;for(h=0;h<g.count;h++)w=h*3,t=w+1,u=w+2,j=g.positionArray[w],
m=g.positionArray[t],n=g.positionArray[u],o=new THREE.Vector3(j,m,n),j=g.normalArray[w],m=g.normalArray[t],n=g.normalArray[u],w=new THREE.Vector3(j,m,n),w.normalize(),t=new THREE.Vertex(o),c.vertices.push(t),f.push(w);nfaces=g.count/3;for(h=0;h<nfaces;h++)w=(b+h)*3,t=w+1,u=w+2,o=f[w],j=f[t],m=f[u],w=new THREE.Face3(w,t,u,[o,j,m]),c.faces.push(w);b+=nfaces;g.count=0});return c};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function c(c){return new THREE.Mesh(new THREE.CylinderGeometry(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:c}))}function d(b,c){var d=new THREE.Geometry;d.vertices=[new THREE.Vertex,new THREE.Vertex(b)];return new THREE.Line(d,new THREE.LineBasicMaterial({color:c}))}THREE.Object3D.call(this);var e=Math.PI/2,f,b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(f in THREE.Trident.defaultParams)b.hasOwnProperty(f)||(b[f]=THREE.Trident.defaultParams[f]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(d(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(d(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(d(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows)f=c(b.xAxisColor),f.rotation.y=-e,f.position.x=b.length,this.addChild(f),f=c(b.yAxisColor),f.rotation.x=e,f.position.y=b.length,this.addChild(f),f=c(b.zAxisColor),f.rotation.y=Math.PI,f.position.z=b.length,this.addChild(f)};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,c){this.point=b;this.normal=c};THREE.SphereCollider=function(b,c){this.center=b;this.radius=c;this.radiusSq=c*c};THREE.BoxCollider=function(b,c){this.min=b;this.max=c;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,c){this.mesh=b;this.box=c;this.numFaces=this.mesh.geometry.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var c,d,e,f,g=0;c=0;for(d=this.colliders.length;c<d;c++)if(f=this.colliders[c],e=this.rayCast(b,f),e<Number.MAX_VALUE)f.distance=e,e>g?this.hits.push(f):this.hits.unshift(f),g=e;return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var c=this.rayCastAll(b);if(c.length==0)return null;for(var d=0;c[d]instanceof THREE.MeshCollider;){var e=this.rayMesh(b,c[d]);if(e.dist<Number.MAX_VALUE){c[d].distance=e.dist;c[d].faceIndex=e.faceIndex;break}d++}if(d>c.length)return null;return c[d]};
THREE.CollisionSystem.prototype.rayCast=function(b,c){if(c instanceof THREE.PlaneCollider)return this.rayPlane(b,c);else if(c instanceof THREE.SphereCollider)return this.raySphere(b,c);else if(c instanceof THREE.BoxCollider)return this.rayBox(b,c);else if(c instanceof THREE.MeshCollider&&c.box)return this.rayBox(b,c.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,c){for(var d=this.makeRayLocal(b,c.mesh),e=Number.MAX_VALUE,f,g=0;g<c.numFaces;g++){var h=c.mesh.geometry.faces[g],j=c.mesh.geometry.vertices[h.a].position,m=c.mesh.geometry.vertices[h.b].position,n=c.mesh.geometry.vertices[h.c].position,t=h instanceof THREE.Face4?c.mesh.geometry.vertices[h.d].position:null;h instanceof THREE.Face3?(h=this.rayTriangle(d,j,m,n,e,this.collisionNormal),h<e&&(e=h,f=g,c.normal.copy(this.collisionNormal),c.normal.normalize())):
h instanceof THREE.Face4&&(h=this.rayTriangle(d,j,m,t,e,this.collisionNormal),h<e&&(e=h,f=g,c.normal.copy(this.collisionNormal),c.normal.normalize()),h=this.rayTriangle(d,m,n,t,e,this.collisionNormal),h<e&&(e=h,f=g,c.normal.copy(this.collisionNormal),c.normal.normalize()))}return{dist:e,faceIndex:f}};
THREE.CollisionSystem.prototype.rayTriangle=function(b,c,d,e,f,g){var h=THREE.CollisionSystem.__v1,j=THREE.CollisionSystem.__v2;g.set(0,0,0);h.sub(d,c);j.sub(e,d);g.cross(h,j);j=g.dot(b.direction);if(!(j<0))return Number.MAX_VALUE;h=g.dot(c)-g.dot(b.origin);if(!(h<=0))return Number.MAX_VALUE;if(!(h>=j*f))return Number.MAX_VALUE;h/=j;j=THREE.CollisionSystem.__v3;j.copy(b.direction);j.multiplyScalar(h);j.addSelf(b.origin);Math.abs(g.x)>Math.abs(g.y)?Math.abs(g.x)>Math.abs(g.z)?(b=j.y-c.y,g=d.y-c.y,
f=e.y-c.y,j=j.z-c.z,d=d.z-c.z,e=e.z-c.z):(b=j.x-c.x,g=d.x-c.x,f=e.x-c.x,j=j.y-c.y,d=d.y-c.y,e=e.y-c.y):Math.abs(g.y)>Math.abs(g.z)?(b=j.x-c.x,g=d.x-c.x,f=e.x-c.x,j=j.z-c.z,d=d.z-c.z,e=e.z-c.z):(b=j.x-c.x,g=d.x-c.x,f=e.x-c.x,j=j.y-c.y,d=d.y-c.y,e=e.y-c.y);c=g*e-d*f;if(c==0)return Number.MAX_VALUE;c=1/c;e=(b*e-j*f)*c;if(!(e>=0))return Number.MAX_VALUE;c*=g*j-d*b;if(!(c>=0))return Number.MAX_VALUE;if(!(1-e-c>=0))return Number.MAX_VALUE;return h};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,c){var d=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(c.matrixWorld,d);var e=THREE.CollisionSystem.__r;e.origin.copy(b.origin);e.direction.copy(b.direction);d.multiplyVector3(e.origin);d.rotateAxis(e.direction);e.direction.normalize();return e};
THREE.CollisionSystem.prototype.rayBox=function(b,c){var d;c.dynamic&&c.mesh&&c.mesh.matrixWorld?d=this.makeRayLocal(b,c.mesh):(d=THREE.CollisionSystem.__r,d.origin.copy(b.origin),d.direction.copy(b.direction));var e=0,f=0,g=0,h=0,j=0,m=0,n=!0;d.origin.x<c.min.x?(e=c.min.x-d.origin.x,e/=d.direction.x,n=!1,h=-1):d.origin.x>c.max.x&&(e=c.max.x-d.origin.x,e/=d.direction.x,n=!1,h=1);d.origin.y<c.min.y?(f=c.min.y-d.origin.y,f/=d.direction.y,n=!1,j=-1):d.origin.y>c.max.y&&(f=c.max.y-d.origin.y,f/=d.direction.y,
n=!1,j=1);d.origin.z<c.min.z?(g=c.min.z-d.origin.z,g/=d.direction.z,n=!1,m=-1):d.origin.z>c.max.z&&(g=c.max.z-d.origin.z,g/=d.direction.z,n=!1,m=1);if(n)return-1;n=0;f>e&&(n=1,e=f);g>e&&(n=2,e=g);switch(n){case 0:j=d.origin.y+d.direction.y*e;if(j<c.min.y||j>c.max.y)return Number.MAX_VALUE;d=d.origin.z+d.direction.z*e;if(d<c.min.z||d>c.max.z)return Number.MAX_VALUE;c.normal.set(h,0,0);break;case 1:h=d.origin.x+d.direction.x*e;if(h<c.min.x||h>c.max.x)return Number.MAX_VALUE;d=d.origin.z+d.direction.z*
e;if(d<c.min.z||d>c.max.z)return Number.MAX_VALUE;c.normal.set(0,j,0);break;case 2:h=d.origin.x+d.direction.x*e;if(h<c.min.x||h>c.max.x)return Number.MAX_VALUE;j=d.origin.y+d.direction.y*e;if(j<c.min.y||j>c.max.y)return Number.MAX_VALUE;c.normal.set(0,0,m)}return e};THREE.CollisionSystem.prototype.rayPlane=function(b,c){var d=b.direction.dot(c.normal),e=c.point.dot(c.normal);if(d<0)d=(e-b.origin.dot(c.normal))/d;else return Number.MAX_VALUE;return d>0?d:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,c){var d=c.center.clone().subSelf(b.origin);if(d.lengthSq<c.radiusSq)return-1;var e=d.dot(b.direction.clone());if(e<=0)return Number.MAX_VALUE;d=c.radiusSq-(d.lengthSq()-e*e);if(d>=0)return Math.abs(e)-Math.sqrt(d);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var c=b.geometry.boundingBox,d=new THREE.Vector3(c.x[0],c.y[0],c.z[0]),c=new THREE.Vector3(c.x[1],c.y[1],c.z[1]),d=new THREE.BoxCollider(d,c);d.mesh=b;return d};THREE.CollisionUtils.MeshAABB=function(b){var c=THREE.CollisionUtils.MeshOBB(b);c.min.addSelf(b.position);c.max.addSelf(b.position);c.dynamic=!1;return c};
THREE.CollisionUtils.MeshColliderWBox=function(b){return new THREE.MeshCollider(b,THREE.CollisionUtils.MeshOBB(b))};
if(THREE.WebGLRenderer)THREE.AnaglyphWebGLRenderer=function(b){THREE.WebGLRenderer.call(this,b);var c=this,d=this.setSize,e=this.render,f=new THREE.Camera,g=new THREE.Camera,h=new THREE.Matrix4,j=new THREE.Matrix4,m,n,t;f.useTarget=g.useTarget=!1;f.matrixAutoUpdate=g.matrixAutoUpdate=!1;var b={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},o=new THREE.WebGLRenderTarget(512,512,b),w=new THREE.WebGLRenderTarget(512,512,b),u=new THREE.Camera(53,1,1,1E4);u.position.z=
2;_material=new THREE.MeshShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:o},mapRight:{type:"t",value:1,texture:w}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"});
var A=new THREE.Scene;A.addObject(new THREE.Mesh(new THREE.PlaneGeometry(2,2),_material));this.setSize=function(b,e){d.call(c,b,e);o.width=b;o.height=e;w.width=b;w.height=e};this.render=function(b,d){d.update(null,!0);if(m!==d.aspect||n!==d.near||t!==d.fov){m=d.aspect;n=d.near;t=d.fov;var x=d.projectionMatrix.clone(),H=125/30*0.5,B=H*n/125,I=n*Math.tan(t*Math.PI/360),D;h.n14=H;j.n14=-H;H=-I*m+B;D=I*m+B;x.n11=2*n/(D-H);x.n13=(D+H)/(D-H);f.projectionMatrix=x.clone();H=-I*m-B;D=I*m-B;x.n11=2*n/(D-H);
x.n13=(D+H)/(D-H);g.projectionMatrix=x.clone()}f.matrix=d.matrixWorld.clone().multiplySelf(j);f.update(null,!0);f.position.copy(d.position);f.near=n;f.far=d.far;e.call(c,b,f,o,!0);g.matrix=d.matrixWorld.clone().multiplySelf(h);g.update(null,!0);g.position.copy(d.position);g.near=n;g.far=d.far;e.call(c,b,g,w,!0);e.call(c,A,u)}};
if(THREE.WebGLRenderer)THREE.CrosseyedWebGLRenderer=function(b){THREE.WebGLRenderer.call(this,b);this.autoClear=!1;var c=this,d=this.setSize,e=this.render,f,g,h=new THREE.Camera,j=new THREE.Camera;c.separation=10;if(b&&b.separation!==void 0)c.separation=b.separation;(new THREE.Camera(53,window.innerWidth/2/window.innerHeight,1,1E4)).position.z=-10;this.setSize=function(b,e){d.call(c,b,e);f=b/2;g=e};this.render=function(b,d){this.clear();h.fov=d.fov;h.aspect=0.5*d.aspect;h.near=d.near;h.far=d.far;
h.updateProjectionMatrix();h.position.copy(d.position);h.target.position.copy(d.target.position);h.translateX(c.separation);j.projectionMatrix=h.projectionMatrix;j.position.copy(d.position);j.target.position.copy(d.target.position);j.translateX(-c.separation);this.setViewport(0,0,f,g);e.call(c,b,h);this.setViewport(f,0,f,g);e.call(c,b,j,!1)}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();Stats=function(){function b(b,c,d){var e,f,g;for(f=0;f<30;f++)for(e=0;e<73;e++)g=(e+f*74)*4,b[g]=b[g+4],b[g+1]=b[g+5],b[g+2]=b[g+6];for(f=0;f<30;f++)g=(73+f*74)*4,f<c?(b[g]=k[d].bg.r,b[g+1]=k[d].bg.g,b[g+2]=k[d].bg.b):(b[g]=k[d].fg.r,b[g+1]=k[d].fg.g,b[g+2]=k[d].fg.b)}var c=0,d=2,e,f=0,g=(new Date).getTime(),h=g,j=g,m=0,n=1E3,t=0,o,w,u,A,C,p=0,x=1E3,H=0,B,I,D,F,T=0,L=1E3,M=0,N,S,v,J,k={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},
fg:{r:255,g:0,b:128}}};e=document.createElement("div");e.style.cursor="pointer";e.style.width="80px";e.style.opacity="0.9";e.style.zIndex="10001";e.addEventListener("click",function(){c++;c==d&&(c=0);o.style.display="none";B.style.display="none";N.style.display="none";switch(c){case 0:o.style.display="block";break;case 1:B.style.display="block";break;case 2:N.style.display="block"}},!1);o=document.createElement("div");o.style.backgroundColor="rgb("+Math.floor(k.fps.bg.r/2)+","+Math.floor(k.fps.bg.g/
2)+","+Math.floor(k.fps.bg.b/2)+")";o.style.padding="2px 0px 3px 0px";e.appendChild(o);w=document.createElement("div");w.style.fontFamily="Helvetica, Arial, sans-serif";w.style.textAlign="left";w.style.fontSize="9px";w.style.color="rgb("+k.fps.fg.r+","+k.fps.fg.g+","+k.fps.fg.b+")";w.style.margin="0px 0px 1px 3px";w.innerHTML='<span style="font-weight:bold">FPS</span>';o.appendChild(w);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";o.appendChild(u);
A=u.getContext("2d");A.fillStyle="rgb("+k.fps.bg.r+","+k.fps.bg.g+","+k.fps.bg.b+")";A.fillRect(0,0,u.width,u.height);C=A.getImageData(0,0,u.width,u.height);B=document.createElement("div");B.style.backgroundColor="rgb("+Math.floor(k.ms.bg.r/2)+","+Math.floor(k.ms.bg.g/2)+","+Math.floor(k.ms.bg.b/2)+")";B.style.padding="2px 0px 3px 0px";B.style.display="none";e.appendChild(B);I=document.createElement("div");I.style.fontFamily="Helvetica, Arial, sans-serif";I.style.textAlign="left";I.style.fontSize=
"9px";I.style.color="rgb("+k.ms.fg.r+","+k.ms.fg.g+","+k.ms.fg.b+")";I.style.margin="0px 0px 1px 3px";I.innerHTML='<span style="font-weight:bold">MS</span>';B.appendChild(I);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";B.appendChild(u);D=u.getContext("2d");D.fillStyle="rgb("+k.ms.bg.r+","+k.ms.bg.g+","+k.ms.bg.b+")";D.fillRect(0,0,u.width,u.height);F=D.getImageData(0,0,u.width,u.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&
(d=3)}catch(P){}N=document.createElement("div");N.style.backgroundColor="rgb("+Math.floor(k.mb.bg.r/2)+","+Math.floor(k.mb.bg.g/2)+","+Math.floor(k.mb.bg.b/2)+")";N.style.padding="2px 0px 3px 0px";N.style.display="none";e.appendChild(N);S=document.createElement("div");S.style.fontFamily="Helvetica, Arial, sans-serif";S.style.textAlign="left";S.style.fontSize="9px";S.style.color="rgb("+k.mb.fg.r+","+k.mb.fg.g+","+k.mb.fg.b+")";S.style.margin="0px 0px 1px 3px";S.innerHTML='<span style="font-weight:bold">MB</span>';
N.appendChild(S);u=document.createElement("canvas");u.width=74;u.height=30;u.style.display="block";u.style.marginLeft="3px";N.appendChild(u);v=u.getContext("2d");v.fillStyle="#301010";v.fillRect(0,0,u.width,u.height);J=v.getImageData(0,0,u.width,u.height);return{domElement:e,update:function(){f++;g=(new Date).getTime();p=g-h;x=Math.min(x,p);H=Math.max(H,p);b(F.data,Math.min(30,30-p/200*30),"ms");I.innerHTML='<span style="font-weight:bold">'+p+" MS</span> ("+x+"-"+H+")";D.putImageData(F,0,0);h=g;if(g>
j+1E3){m=Math.round(f*1E3/(g-j));n=Math.min(n,m);t=Math.max(t,m);b(C.data,Math.min(30,30-m/100*30),"fps");w.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+n+"-"+t+")";A.putImageData(C,0,0);if(d==3)T=performance.memory.usedJSHeapSize*9.54E-7,L=Math.min(L,T),M=Math.max(M,T),b(J.data,Math.min(30,30-T/2),"mb"),S.innerHTML='<span style="font-weight:bold">'+Math.round(T)+" MB</span> ("+Math.round(L)+"-"+Math.round(M)+")",v.putImageData(J,0,0);j=g;f=0}}}};var TWEEN=TWEEN||function(){var b,c,d,e,f=[];return{start:function(b){d=setInterval(this.update,1E3/(b||60))},stop:function(){clearInterval(d)},add:function(b){f.push(b)},getAll:function(){return f},removeAll:function(){f=[]},remove:function(c){b=f.indexOf(c);b!==-1&&f.splice(b,1)},update:function(){b=0;c=f.length;for(e=(new Date).getTime();b<c;)f[b].update(e)?b++:(f.splice(b,1),c--)}}}();
TWEEN.Tween=function(b){var c={},d={},e={},f=1E3,g=0,h=null,j=TWEEN.Easing.Linear.EaseNone,m=null,n=null,t=null;this.to=function(c,d){d!==null&&(f=d);for(var g in c)b[g]!==null&&(e[g]=c[g]);return this};this.start=function(){TWEEN.add(this);h=(new Date).getTime()+g;for(var f in e)b[f]!==null&&(c[f]=b[f],d[f]=e[f]-b[f]);return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(b){g=b;return this};this.easing=function(b){j=b;return this};this.chain=function(b){m=b};this.onUpdate=
function(b){n=b;return this};this.onComplete=function(b){t=b;return this};this.update=function(e){var g,u;if(e<h)return!0;e=(e-h)/f;e=e>1?1:e;u=j(e);for(g in d)b[g]=c[g]+d[g]*u;n!==null&&n.call(b,u);if(e==1)return t!==null&&t.call(b),m!==null&&m.start(),!1;return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var c,d=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);!d||d<1?(d=1,c=e/4):c=e/(2*Math.PI)*Math.asin(1/d);return-(d*Math.pow(2,10*(b-=1))*Math.sin((b-c)*2*Math.PI/e))};
TWEEN.Easing.Elastic.EaseOut=function(b){var c,d=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);!d||d<1?(d=1,c=e/4):c=e/(2*Math.PI)*Math.asin(1/d);return d*Math.pow(2,-10*b)*Math.sin((b-c)*2*Math.PI/e)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var c,d=0.1,e=0.4;if(b==0)return 0;if(b==1)return 1;e||(e=0.3);!d||d<1?(d=1,c=e/4):c=e/(2*Math.PI)*Math.asin(1/d);if((b*=2)<1)return-0.5*d*Math.pow(2,10*(b-=1))*Math.sin((b-c)*2*Math.PI/e);return d*Math.pow(2,-10*(b-=1))*Math.sin((b-c)*2*Math.PI/e)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var Bird=function(){function b(b,e,f){c.vertices.push(new THREE.Vertex(new THREE.Vector3(b,e,f)))}var c=this;THREE.Geometry.call(this);b(5,0,0);b(-5,-2,1);b(-5,0,0);b(-5,-2,-1);b(0,2,-6);b(0,2,6);b(2,0,0);b(-3,0,0);c.faces.push(new THREE.Face3(0,2,1));c.faces.push(new THREE.Face3(4,7,6));c.faces.push(new THREE.Face3(5,6,7));this.computeCentroids();this.computeFaceNormals()};Bird.prototype=new THREE.Geometry;Bird.prototype.constructor=Bird;var Box2D={};
(function(b,c){function d(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function)Object.defineProperty=function(b,c,d){d.get instanceof Function&&b.__defineGetter__(c,d.get);d.set instanceof Function&&b.__defineSetter__(c,d.set)};b.inherit=function(b,c){d.prototype=c.prototype;b.prototype=new d;b.prototype.constructor=b};b.generateCallback=function(b,c){return function(){c.apply(b,arguments)}};
b.NVector=function(b){b===c&&(b=0);for(var d=Array(b||0),g=0;g<b;++g)d[g]=0;return d};b.is=function(b,d){if(b===null)return!1;if(d instanceof Function&&b instanceof d)return!0;if(b.constructor.__implements!=c&&b.constructor.__implements[d])return!0;return!1};b.parseUInt=function(b){return Math.abs(parseInt(b))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;typeof Box2D==="undefined"&&(Box2D={});if(typeof Box2D.Collision==="undefined")Box2D.Collision={};
if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};
(function(){function b(){b.b2AABB.apply(this,arguments)}function c(){c.b2Bound.apply(this,arguments)}function d(){d.b2BoundValues.apply(this,arguments);this.constructor===d&&this.b2BoundValues.apply(this,arguments)}function e(){e.b2Collision.apply(this,arguments)}function f(){f.b2ContactID.apply(this,arguments);this.constructor===f&&this.b2ContactID.apply(this,arguments)}function g(){g.b2ContactPoint.apply(this,arguments)}function h(){h.b2Distance.apply(this,arguments)}function j(){j.b2DistanceInput.apply(this,
arguments)}function m(){m.b2DistanceOutput.apply(this,arguments)}function n(){n.b2DistanceProxy.apply(this,arguments)}function t(){t.b2DynamicTree.apply(this,arguments);this.constructor===t&&this.b2DynamicTree.apply(this,arguments)}function o(){o.b2DynamicTreeBroadPhase.apply(this,arguments)}function w(){w.b2DynamicTreeNode.apply(this,arguments)}function u(){u.b2DynamicTreePair.apply(this,arguments)}function A(){A.b2Manifold.apply(this,arguments);this.constructor===A&&this.b2Manifold.apply(this,arguments)}
function C(){C.b2ManifoldPoint.apply(this,arguments);this.constructor===C&&this.b2ManifoldPoint.apply(this,arguments)}function p(){p.b2Point.apply(this,arguments)}function x(){x.b2RayCastInput.apply(this,arguments);this.constructor===x&&this.b2RayCastInput.apply(this,arguments)}function H(){H.b2RayCastOutput.apply(this,arguments)}function B(){B.b2Segment.apply(this,arguments)}function I(){I.b2SeparationFunction.apply(this,arguments)}function D(){D.b2Simplex.apply(this,arguments);this.constructor===
D&&this.b2Simplex.apply(this,arguments)}function F(){F.b2SimplexCache.apply(this,arguments)}function T(){T.b2SimplexVertex.apply(this,arguments)}function L(){L.b2TimeOfImpact.apply(this,arguments)}function M(){M.b2TOIInput.apply(this,arguments)}function N(){N.b2WorldManifold.apply(this,arguments);this.constructor===N&&this.b2WorldManifold.apply(this,arguments)}function S(){S.ClipVertex.apply(this,arguments)}function v(){v.Features.apply(this,arguments)}function J(){J.b2CircleShape.apply(this,arguments);
this.constructor===J&&this.b2CircleShape.apply(this,arguments)}function k(){k.b2EdgeChainDef.apply(this,arguments);this.constructor===k&&this.b2EdgeChainDef.apply(this,arguments)}function P(){P.b2EdgeShape.apply(this,arguments);this.constructor===P&&this.b2EdgeShape.apply(this,arguments)}function K(){K.b2MassData.apply(this,arguments)}function U(){U.b2PolygonShape.apply(this,arguments);this.constructor===U&&this.b2PolygonShape.apply(this,arguments)}function O(){O.b2Shape.apply(this,arguments);this.constructor===
O&&this.b2Shape.apply(this,arguments)}function z(){z.b2Color.apply(this,arguments);this.constructor===z&&this.b2Color.apply(this,arguments)}function E(){E.b2Settings.apply(this,arguments)}function V(){V.b2Mat22.apply(this,arguments);this.constructor===V&&this.b2Mat22.apply(this,arguments)}function G(){G.b2Mat33.apply(this,arguments);this.constructor===G&&this.b2Mat33.apply(this,arguments)}function R(){R.b2Math.apply(this,arguments)}function W(){W.b2Sweep.apply(this,arguments)}function $(){$.b2Transform.apply(this,
arguments);this.constructor===$&&this.b2Transform.apply(this,arguments)}function y(){y.b2Vec2.apply(this,arguments);this.constructor===y&&this.b2Vec2.apply(this,arguments)}function Q(){Q.b2Vec3.apply(this,arguments);this.constructor===Q&&this.b2Vec3.apply(this,arguments)}function Z(){Z.b2Body.apply(this,arguments);this.constructor===Z&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments);this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function ga(){ga.b2ContactFilter.apply(this,
arguments)}function la(){la.b2ContactImpulse.apply(this,arguments)}function va(){va.b2ContactListener.apply(this,arguments)}function ma(){ma.b2ContactManager.apply(this,arguments);this.constructor===ma&&this.b2ContactManager.apply(this,arguments)}function sa(){sa.b2DebugDraw.apply(this,arguments);this.constructor===sa&&this.b2DebugDraw.apply(this,arguments)}function Za(){Za.b2DestructionListener.apply(this,arguments)}function $a(){$a.b2FilterData.apply(this,arguments)}function Ua(){Ua.b2Fixture.apply(this,
arguments);this.constructor===Ua&&this.b2Fixture.apply(this,arguments)}function Va(){Va.b2FixtureDef.apply(this,arguments);this.constructor===Va&&this.b2FixtureDef.apply(this,arguments)}function Wa(){Wa.b2Island.apply(this,arguments);this.constructor===Wa&&this.b2Island.apply(this,arguments)}function ab(){ab.b2TimeStep.apply(this,arguments)}function xa(){xa.b2World.apply(this,arguments);this.constructor===xa&&this.b2World.apply(this,arguments)}function na(){na.b2CircleContact.apply(this,arguments)}
function ka(){ka.b2Contact.apply(this,arguments);this.constructor===ka&&this.b2Contact.apply(this,arguments)}function La(){La.b2ContactConstraint.apply(this,arguments);this.constructor===La&&this.b2ContactConstraint.apply(this,arguments)}function ta(){ta.b2ContactConstraintPoint.apply(this,arguments)}function qa(){qa.b2ContactEdge.apply(this,arguments)}function Ga(){Ga.b2ContactFactory.apply(this,arguments);this.constructor===Ga&&this.b2ContactFactory.apply(this,arguments)}function Ma(){Ma.b2ContactRegister.apply(this,
arguments)}function ia(){ia.b2ContactResult.apply(this,arguments)}function Ea(){Ea.b2ContactSolver.apply(this,arguments);this.constructor===Ea&&this.b2ContactSolver.apply(this,arguments)}function Ha(){Ha.b2EdgeAndCircleContact.apply(this,arguments)}function Na(){Na.b2NullContact.apply(this,arguments);this.constructor===Na&&this.b2NullContact.apply(this,arguments)}function wa(){wa.b2PolyAndCircleContact.apply(this,arguments)}function Ia(){Ia.b2PolyAndEdgeContact.apply(this,arguments)}function Oa(){Oa.b2PolygonContact.apply(this,
arguments)}function bb(){bb.b2PositionSolverManifold.apply(this,arguments);this.constructor===bb&&this.b2PositionSolverManifold.apply(this,arguments)}function lb(){lb.b2BuoyancyController.apply(this,arguments)}function mb(){mb.b2ConstantAccelController.apply(this,arguments)}function nb(){nb.b2ConstantForceController.apply(this,arguments)}function ob(){ob.b2Controller.apply(this,arguments)}function pb(){pb.b2ControllerEdge.apply(this,arguments)}function qb(){qb.b2GravityController.apply(this,arguments)}
function rb(){rb.b2TensorDampingController.apply(this,arguments)}function fb(){fb.b2DistanceJoint.apply(this,arguments);this.constructor===fb&&this.b2DistanceJoint.apply(this,arguments)}function hb(){hb.b2DistanceJointDef.apply(this,arguments);this.constructor===hb&&this.b2DistanceJointDef.apply(this,arguments)}function gb(){gb.b2FrictionJoint.apply(this,arguments);this.constructor===gb&&this.b2FrictionJoint.apply(this,arguments)}function za(){za.b2FrictionJointDef.apply(this,arguments);this.constructor===
za&&this.b2FrictionJointDef.apply(this,arguments)}function ya(){ya.b2GearJoint.apply(this,arguments);this.constructor===ya&&this.b2GearJoint.apply(this,arguments)}function Ja(){Ja.b2GearJointDef.apply(this,arguments);this.constructor===Ja&&this.b2GearJointDef.apply(this,arguments)}function Ba(){Ba.b2Jacobian.apply(this,arguments)}function Ca(){Ca.b2Joint.apply(this,arguments);this.constructor===Ca&&this.b2Joint.apply(this,arguments)}function Aa(){Aa.b2JointDef.apply(this,arguments);this.constructor===
Aa&&this.b2JointDef.apply(this,arguments)}function Qa(){Qa.b2JointEdge.apply(this,arguments)}function fa(){fa.b2LineJoint.apply(this,arguments);this.constructor===fa&&this.b2LineJoint.apply(this,arguments)}function Y(){Y.b2LineJointDef.apply(this,arguments);this.constructor===Y&&this.b2LineJointDef.apply(this,arguments)}function aa(){aa.b2MouseJoint.apply(this,arguments);this.constructor===aa&&this.b2MouseJoint.apply(this,arguments)}function ca(){ca.b2MouseJointDef.apply(this,arguments);this.constructor===
ca&&this.b2MouseJointDef.apply(this,arguments)}function da(){da.b2PrismaticJoint.apply(this,arguments);this.constructor===da&&this.b2PrismaticJoint.apply(this,arguments)}function ea(){ea.b2PrismaticJointDef.apply(this,arguments);this.constructor===ea&&this.b2PrismaticJointDef.apply(this,arguments)}function ha(){ha.b2PulleyJoint.apply(this,arguments);this.constructor===ha&&this.b2PulleyJoint.apply(this,arguments)}function ua(){ua.b2PulleyJointDef.apply(this,arguments);this.constructor===ua&&this.b2PulleyJointDef.apply(this,
arguments)}function oa(){oa.b2RevoluteJoint.apply(this,arguments);this.constructor===oa&&this.b2RevoluteJoint.apply(this,arguments)}function ra(){ra.b2RevoluteJointDef.apply(this,arguments);this.constructor===ra&&this.b2RevoluteJointDef.apply(this,arguments)}function Xa(){Xa.b2WeldJoint.apply(this,arguments);this.constructor===Xa&&this.b2WeldJoint.apply(this,arguments)}function ja(){ja.b2WeldJointDef.apply(this,arguments);this.constructor===ja&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase=
"Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=b;Box2D.Collision.b2Bound=c;Box2D.Collision.b2BoundValues=d;Box2D.Collision.b2Collision=e;Box2D.Collision.b2ContactID=f;Box2D.Collision.b2ContactPoint=g;Box2D.Collision.b2Distance=h;Box2D.Collision.b2DistanceInput=j;Box2D.Collision.b2DistanceOutput=m;Box2D.Collision.b2DistanceProxy=n;Box2D.Collision.b2DynamicTree=t;Box2D.Collision.b2DynamicTreeBroadPhase=o;Box2D.Collision.b2DynamicTreeNode=w;Box2D.Collision.b2DynamicTreePair=u;Box2D.Collision.b2Manifold=
A;Box2D.Collision.b2ManifoldPoint=C;Box2D.Collision.b2Point=p;Box2D.Collision.b2RayCastInput=x;Box2D.Collision.b2RayCastOutput=H;Box2D.Collision.b2Segment=B;Box2D.Collision.b2SeparationFunction=I;Box2D.Collision.b2Simplex=D;Box2D.Collision.b2SimplexCache=F;Box2D.Collision.b2SimplexVertex=T;Box2D.Collision.b2TimeOfImpact=L;Box2D.Collision.b2TOIInput=M;Box2D.Collision.b2WorldManifold=N;Box2D.Collision.ClipVertex=S;Box2D.Collision.Features=v;Box2D.Collision.Shapes.b2CircleShape=J;Box2D.Collision.Shapes.b2EdgeChainDef=
k;Box2D.Collision.Shapes.b2EdgeShape=P;Box2D.Collision.Shapes.b2MassData=K;Box2D.Collision.Shapes.b2PolygonShape=U;Box2D.Collision.Shapes.b2Shape=O;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=z;Box2D.Common.b2Settings=E;Box2D.Common.Math.b2Mat22=V;Box2D.Common.Math.b2Mat33=G;Box2D.Common.Math.b2Math=R;Box2D.Common.Math.b2Sweep=W;Box2D.Common.Math.b2Transform=$;Box2D.Common.Math.b2Vec2=y;Box2D.Common.Math.b2Vec3=Q;Box2D.Dynamics.b2Body=Z;Box2D.Dynamics.b2BodyDef=X;Box2D.Dynamics.b2ContactFilter=
ga;Box2D.Dynamics.b2ContactImpulse=la;Box2D.Dynamics.b2ContactListener=va;Box2D.Dynamics.b2ContactManager=ma;Box2D.Dynamics.b2DebugDraw=sa;Box2D.Dynamics.b2DestructionListener=Za;Box2D.Dynamics.b2FilterData=$a;Box2D.Dynamics.b2Fixture=Ua;Box2D.Dynamics.b2FixtureDef=Va;Box2D.Dynamics.b2Island=Wa;Box2D.Dynamics.b2TimeStep=ab;Box2D.Dynamics.b2World=xa;Box2D.Dynamics.Contacts.b2CircleContact=na;Box2D.Dynamics.Contacts.b2Contact=ka;Box2D.Dynamics.Contacts.b2ContactConstraint=La;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=
ta;Box2D.Dynamics.Contacts.b2ContactEdge=qa;Box2D.Dynamics.Contacts.b2ContactFactory=Ga;Box2D.Dynamics.Contacts.b2ContactRegister=Ma;Box2D.Dynamics.Contacts.b2ContactResult=ia;Box2D.Dynamics.Contacts.b2ContactSolver=Ea;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=Ha;Box2D.Dynamics.Contacts.b2NullContact=Na;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=wa;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=Ia;Box2D.Dynamics.Contacts.b2PolygonContact=Oa;Box2D.Dynamics.Contacts.b2PositionSolverManifold=
bb;Box2D.Dynamics.Controllers.b2BuoyancyController=lb;Box2D.Dynamics.Controllers.b2ConstantAccelController=mb;Box2D.Dynamics.Controllers.b2ConstantForceController=nb;Box2D.Dynamics.Controllers.b2Controller=ob;Box2D.Dynamics.Controllers.b2ControllerEdge=pb;Box2D.Dynamics.Controllers.b2GravityController=qb;Box2D.Dynamics.Controllers.b2TensorDampingController=rb;Box2D.Dynamics.Joints.b2DistanceJoint=fb;Box2D.Dynamics.Joints.b2DistanceJointDef=hb;Box2D.Dynamics.Joints.b2FrictionJoint=gb;Box2D.Dynamics.Joints.b2FrictionJointDef=
za;Box2D.Dynamics.Joints.b2GearJoint=ya;Box2D.Dynamics.Joints.b2GearJointDef=Ja;Box2D.Dynamics.Joints.b2Jacobian=Ba;Box2D.Dynamics.Joints.b2Joint=Ca;Box2D.Dynamics.Joints.b2JointDef=Aa;Box2D.Dynamics.Joints.b2JointEdge=Qa;Box2D.Dynamics.Joints.b2LineJoint=fa;Box2D.Dynamics.Joints.b2LineJointDef=Y;Box2D.Dynamics.Joints.b2MouseJoint=aa;Box2D.Dynamics.Joints.b2MouseJointDef=ca;Box2D.Dynamics.Joints.b2PrismaticJoint=da;Box2D.Dynamics.Joints.b2PrismaticJointDef=ea;Box2D.Dynamics.Joints.b2PulleyJoint=ha;
Box2D.Dynamics.Joints.b2PulleyJointDef=ua;Box2D.Dynamics.Joints.b2RevoluteJoint=oa;Box2D.Dynamics.Joints.b2RevoluteJointDef=ra;Box2D.Dynamics.Joints.b2WeldJoint=Xa;Box2D.Dynamics.Joints.b2WeldJointDef=ja})();Box2D.postDefs=[];
(function(){var b=Box2D.Collision.Shapes.b2CircleShape,c=Box2D.Collision.Shapes.b2PolygonShape,d=Box2D.Collision.Shapes.b2Shape,e=Box2D.Common.b2Settings,f=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Sweep,h=Box2D.Common.Math.b2Transform,j=Box2D.Common.Math.b2Vec2,m=Box2D.Collision.b2AABB,n=Box2D.Collision.b2Bound,t=Box2D.Collision.b2BoundValues,o=Box2D.Collision.b2Collision,w=Box2D.Collision.b2ContactID,u=Box2D.Collision.b2ContactPoint,A=Box2D.Collision.b2Distance,C=Box2D.Collision.b2DistanceInput,
p=Box2D.Collision.b2DistanceOutput,x=Box2D.Collision.b2DistanceProxy,H=Box2D.Collision.b2DynamicTree,B=Box2D.Collision.b2DynamicTreeBroadPhase,I=Box2D.Collision.b2DynamicTreeNode,D=Box2D.Collision.b2DynamicTreePair,F=Box2D.Collision.b2Manifold,T=Box2D.Collision.b2ManifoldPoint,L=Box2D.Collision.b2Point,M=Box2D.Collision.b2RayCastInput,N=Box2D.Collision.b2RayCastOutput,S=Box2D.Collision.b2Segment,v=Box2D.Collision.b2SeparationFunction,J=Box2D.Collision.b2Simplex,k=Box2D.Collision.b2SimplexCache,P=
Box2D.Collision.b2SimplexVertex,K=Box2D.Collision.b2TimeOfImpact,U=Box2D.Collision.b2TOIInput,O=Box2D.Collision.b2WorldManifold,z=Box2D.Collision.ClipVertex,E=Box2D.Collision.Features,V=Box2D.Collision.IBroadPhase;m.b2AABB=function(){this.lowerBound=new j;this.upperBound=new j};m.prototype.IsValid=function(){var b=this.upperBound.y-this.lowerBound.y;return b=(b=this.upperBound.x-this.lowerBound.x>=0&&b>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};m.prototype.GetCenter=function(){return new j((this.lowerBound.x+
this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};m.prototype.GetExtents=function(){return new j((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};m.prototype.Contains=function(b){var c;return c=(c=(c=(c=this.lowerBound.x<=b.lowerBound.x)&&this.lowerBound.y<=b.lowerBound.y)&&b.upperBound.x<=this.upperBound.x)&&b.upperBound.y<=this.upperBound.y};m.prototype.RayCast=function(b,c){var d=-Number.MAX_VALUE,e=Number.MAX_VALUE,f=c.p1.x,g=c.p1.y,k=c.p2.x-c.p1.x,
j=c.p2.y-c.p1.y,z=Math.abs(j),m=b.normal,v=0,h=0,E=v=0,E=0;if(Math.abs(k)<Number.MIN_VALUE){if(f<this.lowerBound.x||this.upperBound.x<f)return!1}else{v=1/k;h=(this.lowerBound.x-f)*v;v*=this.upperBound.x-f;E=-1;h>v&&(E=h,h=v,v=E,E=1);if(h>d)m.x=E,m.y=0,d=h;e=Math.min(e,v);if(d>e)return!1}if(z<Number.MIN_VALUE){if(g<this.lowerBound.y||this.upperBound.y<g)return!1}else{v=1/j;h=(this.lowerBound.y-g)*v;v*=this.upperBound.y-g;E=-1;h>v&&(E=h,h=v,v=E,E=1);if(h>d)m.y=E,m.x=0,d=h;e=Math.min(e,v);if(d>e)return!1}b.fraction=
d;return!0};m.prototype.TestOverlap=function(b){var c=b.lowerBound.y-this.upperBound.y,d=this.lowerBound.y-b.upperBound.y;if(b.lowerBound.x-this.upperBound.x>0||c>0)return!1;if(this.lowerBound.x-b.upperBound.x>0||d>0)return!1;return!0};m.Combine=function(b,c){var d=new m;d.Combine(b,c);return d};m.prototype.Combine=function(b,c){this.lowerBound.x=Math.min(b.lowerBound.x,c.lowerBound.x);this.lowerBound.y=Math.min(b.lowerBound.y,c.lowerBound.y);this.upperBound.x=Math.max(b.upperBound.x,c.upperBound.x);
this.upperBound.y=Math.max(b.upperBound.y,c.upperBound.y)};n.b2Bound=function(){};n.prototype.IsLower=function(){return(this.value&1)==0};n.prototype.IsUpper=function(){return(this.value&1)==1};n.prototype.Swap=function(b){var c=this.value,d=this.proxy,e=this.stabbingCount;this.value=b.value;this.proxy=b.proxy;this.stabbingCount=b.stabbingCount;b.value=c;b.proxy=d;b.stabbingCount=e};t.b2BoundValues=function(){};t.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=
0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};o.b2Collision=function(){};o.ClipSegmentToLine=function(b,c,d,e){e===void 0&&(e=0);var f,g=0;f=c[0];var k=f.v;f=c[1];var j=f.v,z=d.x*k.x+d.y*k.y-e;f=d.x*j.x+d.y*j.y-e;z<=0&&b[g++].Set(c[0]);f<=0&&b[g++].Set(c[1]);if(z*f<0)d=z/(z-f),f=b[g],f=f.v,f.x=k.x+d*(j.x-k.x),f.y=k.y+d*(j.y-k.y),f=b[g],f.id=(z>0?c[0]:c[1]).id,++g;return g};o.EdgeSeparation=function(b,c,d,e,f){d===void 0&&(d=0);parseInt(b.m_vertexCount);
var g=b.m_vertices,b=b.m_normals,k=parseInt(e.m_vertexCount),j=e.m_vertices,z,v;z=c.R;v=b[d];b=z.col1.x*v.x+z.col2.x*v.y;e=z.col1.y*v.x+z.col2.y*v.y;z=f.R;var m=z.col1.x*b+z.col1.y*e;z=z.col2.x*b+z.col2.y*e;for(var h=0,E=Number.MAX_VALUE,p=0;p<k;++p)v=j[p],v=v.x*m+v.y*z,v<E&&(E=v,h=p);v=g[d];z=c.R;d=c.position.x+(z.col1.x*v.x+z.col2.x*v.y);c=c.position.y+(z.col1.y*v.x+z.col2.y*v.y);v=j[h];z=f.R;g=f.position.x+(z.col1.x*v.x+z.col2.x*v.y);f=f.position.y+(z.col1.y*v.x+z.col2.y*v.y);g-=d;f-=c;return g*
b+f*e};o.FindMaxSeparation=function(b,c,d,e,f){var g=parseInt(c.m_vertexCount),k=c.m_normals,j,z;z=f.R;j=e.m_centroid;var v=f.position.x+(z.col1.x*j.x+z.col2.x*j.y),m=f.position.y+(z.col1.y*j.x+z.col2.y*j.y);z=d.R;j=c.m_centroid;v-=d.position.x+(z.col1.x*j.x+z.col2.x*j.y);m-=d.position.y+(z.col1.y*j.x+z.col2.y*j.y);z=v*d.R.col1.x+m*d.R.col1.y;for(var m=v*d.R.col2.x+m*d.R.col2.y,v=0,h=-Number.MAX_VALUE,E=0;E<g;++E)j=k[E],j=j.x*z+j.y*m,j>h&&(h=j,v=E);k=o.EdgeSeparation(c,d,v,e,f);j=parseInt(v-1>=0?
v-1:g-1);z=o.EdgeSeparation(c,d,j,e,f);var m=parseInt(v+1<g?v+1:0),h=o.EdgeSeparation(c,d,m,e,f),p=E=0,n=0;if(z>k&&z>h)n=-1,E=j,p=z;else if(h>k)n=1,E=m,p=h;else return b[0]=v,k;for(;;)if(v=n==-1?E-1>=0?E-1:g-1:E+1<g?E+1:0,k=o.EdgeSeparation(c,d,v,e,f),k>p)E=v,p=k;else break;b[0]=E;return p};o.FindIncidentEdge=function(b,c,d,e,f,g){e===void 0&&(e=0);parseInt(c.m_vertexCount);var k=c.m_normals,j=parseInt(f.m_vertexCount),c=f.m_vertices,f=f.m_normals,z;z=d.R;var d=k[e],k=z.col1.x*d.x+z.col2.x*d.y,v=
z.col1.y*d.x+z.col2.y*d.y;z=g.R;d=z.col1.x*k+z.col1.y*v;v=z.col2.x*k+z.col2.y*v;k=d;z=0;for(var m=Number.MAX_VALUE,h=0;h<j;++h)d=f[h],d=k*d.x+v*d.y,d<m&&(m=d,z=h);f=parseInt(z);k=parseInt(f+1<j?f+1:0);j=b[0];d=c[f];z=g.R;j.v.x=g.position.x+(z.col1.x*d.x+z.col2.x*d.y);j.v.y=g.position.y+(z.col1.y*d.x+z.col2.y*d.y);j.id.features.referenceEdge=e;j.id.features.incidentEdge=f;j.id.features.incidentVertex=0;j=b[1];d=c[k];z=g.R;j.v.x=g.position.x+(z.col1.x*d.x+z.col2.x*d.y);j.v.y=g.position.y+(z.col1.y*
d.x+z.col2.y*d.y);j.id.features.referenceEdge=e;j.id.features.incidentEdge=k;j.id.features.incidentVertex=1};o.MakeClipPointVector=function(){var b=new Vector(2);b[0]=new z;b[1]=new z;return b};o.CollidePolygons=function(b,c,d,f,g){var k;b.m_pointCount=0;var j=c.m_radius+f.m_radius;o.s_edgeAO[0]=0;var z=o.FindMaxSeparation(o.s_edgeAO,c,d,f,g);k=o.s_edgeAO[0];if(!(z>j)){var v;o.s_edgeBO[0]=0;var m=o.FindMaxSeparation(o.s_edgeBO,f,g,c,d);v=o.s_edgeBO[0];if(!(m>j)){var h=0,E=0;m>0.98*z+0.0010?(z=f,f=
c,c=g,h=v,b.m_type=F.e_faceB,E=1):(z=c,c=d,d=g,h=k,b.m_type=F.e_faceA,E=0);k=o.s_incidentEdge;o.FindIncidentEdge(k,z,c,h,f,d);v=parseInt(z.m_vertexCount);var g=z.m_vertices,z=g[h],p;p=h+1<v?g[parseInt(h+1)]:g[0];h=o.s_localTangent;h.Set(p.x-z.x,p.y-z.y);h.Normalize();g=o.s_localNormal;g.x=h.y;g.y=-h.x;f=o.s_planePoint;f.Set(0.5*(z.x+p.x),0.5*(z.y+p.y));m=o.s_tangent;v=c.R;m.x=v.col1.x*h.x+v.col2.x*h.y;m.y=v.col1.y*h.x+v.col2.y*h.y;var n=o.s_tangent2;n.x=-m.x;n.y=-m.y;h=o.s_normal;h.x=m.y;h.y=-m.x;
var x=o.s_v11,P=o.s_v12;x.x=c.position.x+(v.col1.x*z.x+v.col2.x*z.y);x.y=c.position.y+(v.col1.y*z.x+v.col2.y*z.y);P.x=c.position.x+(v.col1.x*p.x+v.col2.x*p.y);P.y=c.position.y+(v.col1.y*p.x+v.col2.y*p.y);c=h.x*x.x+h.y*x.y;v=m.x*P.x+m.y*P.y+j;p=o.s_clipPoints1;z=o.s_clipPoints2;P=0;P=o.ClipSegmentToLine(p,k,n,-m.x*x.x-m.y*x.y+j);if(!(P<2)&&(P=o.ClipSegmentToLine(z,p,m,v),!(P<2))){b.m_localPlaneNormal.SetV(g);b.m_localPoint.SetV(f);for(f=g=0;f<e.b2_maxManifoldPoints;++f)if(k=z[f],h.x*k.v.x+h.y*k.v.y-
c<=j)m=b.m_points[g],v=d.R,n=k.v.x-d.position.x,x=k.v.y-d.position.y,m.m_localPoint.x=n*v.col1.x+x*v.col1.y,m.m_localPoint.y=n*v.col2.x+x*v.col2.y,m.m_id.Set(k.id),m.m_id.features.flip=E,++g;b.m_pointCount=g}}}};o.CollideCircles=function(b,c,d,e,f){b.m_pointCount=0;var g,k;g=d.R;k=c.m_p;var j=d.position.x+(g.col1.x*k.x+g.col2.x*k.y),d=d.position.y+(g.col1.y*k.x+g.col2.y*k.y);g=f.R;k=e.m_p;j=f.position.x+(g.col1.x*k.x+g.col2.x*k.y)-j;f=f.position.y+(g.col1.y*k.x+g.col2.y*k.y)-d;g=c.m_radius+e.m_radius;
if(!(j*j+f*f>g*g))b.m_type=F.e_circles,b.m_localPoint.SetV(c.m_p),b.m_localPlaneNormal.SetZero(),b.m_pointCount=1,b.m_points[0].m_localPoint.SetV(e.m_p),b.m_points[0].m_id.key=0};o.CollidePolygonAndCircle=function(b,c,d,e,f){var g=b.m_pointCount=0,k=0,j,z;z=f.R;j=e.m_p;var v=f.position.y+(z.col1.y*j.x+z.col2.y*j.y),g=f.position.x+(z.col1.x*j.x+z.col2.x*j.y)-d.position.x,k=v-d.position.y;z=d.R;d=g*z.col1.x+k*z.col1.y;z=g*z.col2.x+k*z.col2.y;for(var h=0,v=-Number.MAX_VALUE,f=c.m_radius+e.m_radius,m=
parseInt(c.m_vertexCount),E=c.m_vertices,c=c.m_normals,p=0;p<m;++p){j=E[p];g=d-j.x;k=z-j.y;j=c[p];g=j.x*g+j.y*k;if(g>f)return;g>v&&(v=g,h=p)}g=parseInt(h);k=parseInt(g+1<m?g+1:0);j=E[g];E=E[k];if(v<Number.MIN_VALUE)b.m_pointCount=1,b.m_type=F.e_faceA,b.m_localPlaneNormal.SetV(c[h]),b.m_localPoint.x=0.5*(j.x+E.x),b.m_localPoint.y=0.5*(j.y+E.y);else if(v=(d-E.x)*(j.x-E.x)+(z-E.y)*(j.y-E.y),(d-j.x)*(E.x-j.x)+(z-j.y)*(E.y-j.y)<=0){if((d-j.x)*(d-j.x)+(z-j.y)*(z-j.y)>f*f)return;b.m_pointCount=1;b.m_type=
F.e_faceA;b.m_localPlaneNormal.x=d-j.x;b.m_localPlaneNormal.y=z-j.y;b.m_localPlaneNormal.Normalize();b.m_localPoint.SetV(j)}else if(v<=0){if((d-E.x)*(d-E.x)+(z-E.y)*(z-E.y)>f*f)return;b.m_pointCount=1;b.m_type=F.e_faceA;b.m_localPlaneNormal.x=d-E.x;b.m_localPlaneNormal.y=z-E.y;b.m_localPlaneNormal.Normalize();b.m_localPoint.SetV(E)}else{h=0.5*(j.x+E.x);j=0.5*(j.y+E.y);v=(d-h)*c[g].x+(z-j)*c[g].y;if(v>f)return;b.m_pointCount=1;b.m_type=F.e_faceA;b.m_localPlaneNormal.x=c[g].x;b.m_localPlaneNormal.y=
c[g].y;b.m_localPlaneNormal.Normalize();b.m_localPoint.Set(h,j)}b.m_points[0].m_localPoint.SetV(e.m_p);b.m_points[0].m_id.key=0};o.TestOverlap=function(b,c){var d=c.lowerBound,e=b.upperBound,f=d.x-e.x,g=d.y-e.y,d=b.lowerBound,e=c.upperBound,k=d.y-e.y;if(f>0||g>0)return!1;if(d.x-e.x>0||k>0)return!1;return!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=o.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=o.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=
o.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new j;Box2D.Collision.b2Collision.s_localNormal=new j;Box2D.Collision.b2Collision.s_planePoint=new j;Box2D.Collision.b2Collision.s_normal=new j;Box2D.Collision.b2Collision.s_tangent=new j;Box2D.Collision.b2Collision.s_tangent2=new j;Box2D.Collision.b2Collision.s_v11=new j;Box2D.Collision.b2Collision.s_v12=new j;
Box2D.Collision.b2Collision.b2CollidePolyTempVec=new j;Box2D.Collision.b2Collision.b2_nullFeature=255});w.b2ContactID=function(){this.features=new E};w.prototype.b2ContactID=function(){this.features._m_id=this};w.prototype.Set=function(b){this.key=b._key};w.prototype.Copy=function(){var b=new w;b.key=this.key;return b};Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,set:function(b){b===
void 0&&(b=0);this._key=b;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});u.b2ContactPoint=function(){this.position=new j;this.velocity=new j;this.normal=new j;this.id=new w};A.b2Distance=function(){};A.Distance=function(b,c,d){++A.b2_gjkCalls;var g=d.proxyA,k=d.proxyB,z=d.transformA,v=d.transformB,h=A.s_simplex;h.ReadCache(c,g,z,k,v);var m=
h.m_vertices,E=A.s_saveA,p=A.s_saveB,n=0;h.GetClosestPoint().LengthSquared();for(var x=0,o,P=0;P<20;){n=h.m_count;for(x=0;x<n;x++)E[x]=m[x].indexA,p[x]=m[x].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:e.b2Assert(!1)}if(h.m_count==3)break;o=h.GetClosestPoint();o.LengthSquared();x=h.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;o=m[h.m_count];o.indexA=g.GetSupport(f.MulTMV(z.R,x.GetNegative()));o.wA=f.MulX(z,g.GetVertex(o.indexA));
o.indexB=k.GetSupport(f.MulTMV(v.R,x));o.wB=f.MulX(v,k.GetVertex(o.indexB));o.w=f.SubtractVV(o.wB,o.wA);++P;++A.b2_gjkIters;for(var V=!1,x=0;x<n;x++)if(o.indexA==E[x]&&o.indexB==p[x]){V=!0;break}if(V)break;++h.m_count}A.b2_gjkMaxIters=f.Max(A.b2_gjkMaxIters,P);h.GetWitnessPoints(b.pointA,b.pointB);b.distance=f.SubtractVV(b.pointA,b.pointB).Length();b.iterations=P;h.WriteCache(c);if(d.useRadii)c=g.m_radius,k=k.m_radius,b.distance>c+k&&b.distance>Number.MIN_VALUE?(b.distance-=c+k,d=f.SubtractVV(b.pointB,
b.pointA),d.Normalize(),b.pointA.x+=c*d.x,b.pointA.y+=c*d.y,b.pointB.x-=k*d.x,b.pointB.y-=k*d.y):(o=new j,o.x=0.5*(b.pointA.x+b.pointB.x),o.y=0.5*(b.pointA.y+b.pointB.y),b.pointA.x=b.pointB.x=o.x,b.pointA.y=b.pointB.y=o.y,b.distance=0)};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new J;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});C.b2DistanceInput=function(){};p.b2DistanceOutput=function(){this.pointA=
new j;this.pointB=new j};x.b2DistanceProxy=function(){};x.prototype.Set=function(f){switch(f.GetType()){case d.e_circleShape:f=f instanceof b?f:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=f.m_p;this.m_count=1;this.m_radius=f.m_radius;break;case d.e_polygonShape:f=f instanceof c?f:null;this.m_vertices=f.m_vertices;this.m_count=f.m_vertexCount;this.m_radius=f.m_radius;break;default:e.b2Assert(!1)}};x.prototype.GetSupport=function(b){for(var c=0,d=this.m_vertices[0].x*b.x+this.m_vertices[0].y*
b.y,e=1;e<this.m_count;++e){var f=this.m_vertices[e].x*b.x+this.m_vertices[e].y*b.y;f>d&&(c=e,d=f)}return c};x.prototype.GetSupportVertex=function(b){for(var c=0,d=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,e=1;e<this.m_count;++e){var f=this.m_vertices[e].x*b.x+this.m_vertices[e].y*b.y;f>d&&(c=e,d=f)}return this.m_vertices[c]};x.prototype.GetVertexCount=function(){return this.m_count};x.prototype.GetVertex=function(b){b===void 0&&(b=0);e.b2Assert(0<=b&&b<this.m_count);return this.m_vertices[b]};
H.b2DynamicTree=function(){};H.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};H.prototype.CreateProxy=function(b,c){var d=this.AllocateNode(),f=e.b2_aabbExtension,g=e.b2_aabbExtension;d.aabb.lowerBound.x=b.lowerBound.x-f;d.aabb.lowerBound.y=b.lowerBound.y-g;d.aabb.upperBound.x=b.upperBound.x+f;d.aabb.upperBound.y=b.upperBound.y+g;d.userData=c;this.InsertLeaf(d);return d};H.prototype.DestroyProxy=function(b){this.RemoveLeaf(b);this.FreeNode(b)};
H.prototype.MoveProxy=function(b,c,d){e.b2Assert(b.IsLeaf());if(b.aabb.Contains(c))return!1;this.RemoveLeaf(b);var f=e.b2_aabbExtension+e.b2_aabbMultiplier*(d.x>0?d.x:-d.x),d=e.b2_aabbExtension+e.b2_aabbMultiplier*(d.y>0?d.y:-d.y);b.aabb.lowerBound.x=c.lowerBound.x-f;b.aabb.lowerBound.y=c.lowerBound.y-d;b.aabb.upperBound.x=c.upperBound.x+f;b.aabb.upperBound.y=c.upperBound.y+d;this.InsertLeaf(b);return!0};H.prototype.Rebalance=function(b){b===void 0&&(b=0);if(this.m_root!=null)for(var c=0;c<b;c++){for(var d=
this.m_root,e=0;d.IsLeaf()==!1;)d=this.m_path>>e&1?d.child2:d.child1,e=e+1&31;++this.m_path;this.RemoveLeaf(d);this.InsertLeaf(d)}};H.prototype.GetFatAABB=function(b){return b.aabb};H.prototype.GetUserData=function(b){return b.userData};H.prototype.Query=function(b,c){if(this.m_root!=null){var d=new Vector,e=0;for(d[e++]=this.m_root;e>0;){var f=d[--e];if(f.aabb.TestOverlap(c))if(f.IsLeaf()){if(!b(f))break}else d[e++]=f.child1,d[e++]=f.child2}}};H.prototype.RayCast=function(b,c){if(this.m_root!=null){var d=
c.p1,e=c.p2,g=f.SubtractVV(d,e);g.Normalize();var g=f.CrossFV(1,g),k=f.AbsV(g),j=c.maxFraction,z=new m,v=0,h=0,v=d.x+j*(e.x-d.x),h=d.y+j*(e.y-d.y);z.lowerBound.x=Math.min(d.x,v);z.lowerBound.y=Math.min(d.y,h);z.upperBound.x=Math.max(d.x,v);z.upperBound.y=Math.max(d.y,h);var E=new Vector,p=0;for(E[p++]=this.m_root;p>0;)if(j=E[--p],j.aabb.TestOverlap(z)!=!1&&(v=j.aabb.GetCenter(),h=j.aabb.GetExtents(),!(Math.abs(g.x*(d.x-v.x)+g.y*(d.y-v.y))-k.x*h.x-k.y*h.y>0)))if(j.IsLeaf()){v=new M;v.p1=c.p1;v.p2=
c.p2;v.maxFraction=c.maxFraction;j=b(v,j);if(j==0)break;if(j>0)v=d.x+j*(e.x-d.x),h=d.y+j*(e.y-d.y),z.lowerBound.x=Math.min(d.x,v),z.lowerBound.y=Math.min(d.y,h),z.upperBound.x=Math.max(d.x,v),z.upperBound.y=Math.max(d.y,h)}else E[p++]=j.child1,E[p++]=j.child2}};H.prototype.AllocateNode=function(){if(this.m_freeList){var b=this.m_freeList;this.m_freeList=b.parent;b.parent=null;b.child1=null;b.child2=null;return b}return new I};H.prototype.FreeNode=function(b){b.parent=this.m_freeList;this.m_freeList=
b};H.prototype.InsertLeaf=function(b){++this.m_insertionCount;if(this.m_root==null)this.m_root=b,this.m_root.parent=null;else{var c=b.aabb.GetCenter(),d=this.m_root;if(d.IsLeaf()==!1){do var e=d.child1,d=d.child2,d=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-c.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-c.y)<Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-c.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-c.y)?e:d;while(d.IsLeaf()==!1)}c=d.parent;e=this.AllocateNode();
e.parent=c;e.userData=null;e.aabb.Combine(b.aabb,d.aabb);if(c){d.parent.child1==d?c.child1=e:c.child2=e;e.child1=d;e.child2=b;d.parent=e;b.parent=e;do{if(c.aabb.Contains(e.aabb))break;c.aabb.Combine(c.child1.aabb,c.child2.aabb);e=c;c=c.parent}while(c)}else e.child1=d,e.child2=b,d.parent=e,this.m_root=b.parent=e}};H.prototype.RemoveLeaf=function(b){if(b==this.m_root)this.m_root=null;else{var c=b.parent,d=c.parent,b=c.child1==b?c.child2:c.child1;if(d){d.child1==c?d.child1=b:d.child2=b;b.parent=d;for(this.FreeNode(c);d;){c=
d.aabb;d.aabb=m.Combine(d.child1.aabb,d.child2.aabb);if(c.Contains(d.aabb))break;d=d.parent}}else this.m_root=b,b.parent=null,this.FreeNode(c)}};B.b2DynamicTreeBroadPhase=function(){this.m_tree=new H;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};B.prototype.CreateProxy=function(b,c){var d=this.m_tree.CreateProxy(b,c);++this.m_proxyCount;this.BufferMove(d);return d};B.prototype.DestroyProxy=function(b){this.UnBufferMove(b);--this.m_proxyCount;this.m_tree.DestroyProxy(b)};
B.prototype.MoveProxy=function(b,c,d){this.m_tree.MoveProxy(b,c,d)&&this.BufferMove(b)};B.prototype.TestOverlap=function(b,c){var d=this.m_tree.GetFatAABB(b),e=this.m_tree.GetFatAABB(c);return d.TestOverlap(e)};B.prototype.GetUserData=function(b){return this.m_tree.GetUserData(b)};B.prototype.GetFatAABB=function(b){return this.m_tree.GetFatAABB(b)};B.prototype.GetProxyCount=function(){return this.m_proxyCount};B.prototype.UpdatePairs=function(b){for(var c=this,d=c.m_pairCount=0,e,d=0;d<c.m_moveBuffer.length;++d){e=
c.m_moveBuffer[d];var f=c.m_tree.GetFatAABB(e);c.m_tree.Query(function(b){if(b==e)return!0;c.m_pairCount==c.m_pairBuffer.length&&(c.m_pairBuffer[c.m_pairCount]=new D);var d=c.m_pairBuffer[c.m_pairCount];d.proxyA=b<e?b:e;d.proxyB=b>=e?b:e;++c.m_pairCount;return!0},f)}for(d=c.m_moveBuffer.length=0;d<c.m_pairCount;){var f=c.m_pairBuffer[d],g=c.m_tree.GetUserData(f.proxyA),k=c.m_tree.GetUserData(f.proxyB);b(g,k);for(++d;d<c.m_pairCount;){g=c.m_pairBuffer[d];if(g.proxyA!=f.proxyA||g.proxyB!=f.proxyB)break;
++d}}};B.prototype.Query=function(b,c){this.m_tree.Query(b,c)};B.prototype.RayCast=function(b,c){this.m_tree.RayCast(b,c)};B.prototype.Validate=function(){};B.prototype.Rebalance=function(b){b===void 0&&(b=0);this.m_tree.Rebalance(b)};B.prototype.BufferMove=function(b){this.m_moveBuffer[this.m_moveBuffer.length]=b};B.prototype.UnBufferMove=function(b){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(b)),1)};B.prototype.ComparePairs=function(){return 0};B.__implements={};B.__implements[V]=
!0;I.b2DynamicTreeNode=function(){this.aabb=new m};I.prototype.IsLeaf=function(){return this.child1==null};D.b2DynamicTreePair=function(){};F.b2Manifold=function(){this.m_pointCount=0};F.prototype.b2Manifold=function(){this.m_points=new Vector(e.b2_maxManifoldPoints);for(var b=0;b<e.b2_maxManifoldPoints;b++)this.m_points[b]=new T;this.m_localPlaneNormal=new j;this.m_localPoint=new j};F.prototype.Reset=function(){for(var b=0;b<e.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof T?this.m_points[b]:
null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};F.prototype.Set=function(b){this.m_pointCount=b.m_pointCount;for(var c=0;c<e.b2_maxManifoldPoints;c++)(this.m_points[c]instanceof T?this.m_points[c]:null).Set(b.m_points[c]);this.m_localPlaneNormal.SetV(b.m_localPlaneNormal);this.m_localPoint.SetV(b.m_localPoint);this.m_type=b.m_type};F.prototype.Copy=function(){var b=new F;b.Set(this);return b};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=
1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});T.b2ManifoldPoint=function(){this.m_localPoint=new j;this.m_id=new w};T.prototype.b2ManifoldPoint=function(){this.Reset()};T.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};T.prototype.Set=function(b){this.m_localPoint.SetV(b.m_localPoint);this.m_normalImpulse=b.m_normalImpulse;this.m_tangentImpulse=b.m_tangentImpulse;this.m_id.Set(b.m_id)};L.b2Point=function(){this.p=
new j};L.prototype.Support=function(){return this.p};L.prototype.GetFirstVertex=function(){return this.p};M.b2RayCastInput=function(){this.p1=new j;this.p2=new j};M.prototype.b2RayCastInput=function(b,c,d){b===void 0&&(b=null);c===void 0&&(c=null);d===void 0&&(d=1);b&&this.p1.SetV(b);c&&this.p2.SetV(c);this.maxFraction=d};N.b2RayCastOutput=function(){this.normal=new j};S.b2Segment=function(){this.p1=new j;this.p2=new j};S.prototype.TestSegment=function(b,c,d,e){e===void 0&&(e=0);var f=d.p1,g=d.p2.x-
f.x,k=d.p2.y-f.y,d=this.p2.y-this.p1.y,j=-(this.p2.x-this.p1.x),z=100*Number.MIN_VALUE,v=-(g*d+k*j);if(v>z){var h=f.x-this.p1.x,m=f.y-this.p1.y,f=h*d+m*j;if(0<=f&&f<=e*v&&(e=-g*m+k*h,-z*v<=e&&e<=v*(1+z)))return f/=v,e=Math.sqrt(d*d+j*j),d/=e,j/=e,b[0]=f,c.Set(d,j),!0}return!1};S.prototype.Extend=function(b){this.ExtendForward(b);this.ExtendBackward(b)};S.prototype.ExtendForward=function(b){var c=this.p2.x-this.p1.x,d=this.p2.y-this.p1.y,b=Math.min(c>0?(b.upperBound.x-this.p1.x)/c:c<0?(b.lowerBound.x-
this.p1.x)/c:Number.POSITIVE_INFINITY,d>0?(b.upperBound.y-this.p1.y)/d:d<0?(b.lowerBound.y-this.p1.y)/d:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+c*b;this.p2.y=this.p1.y+d*b};S.prototype.ExtendBackward=function(b){var c=-this.p2.x+this.p1.x,d=-this.p2.y+this.p1.y,b=Math.min(c>0?(b.upperBound.x-this.p2.x)/c:c<0?(b.lowerBound.x-this.p2.x)/c:Number.POSITIVE_INFINITY,d>0?(b.upperBound.y-this.p2.y)/d:d<0?(b.lowerBound.y-this.p2.y)/d:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+c*b;this.p1.y=this.p2.y+
d*b};v.b2SeparationFunction=function(){this.m_localPoint=new j;this.m_axis=new j};v.prototype.Initialize=function(b,c,d,g,k){this.m_proxyA=c;this.m_proxyB=g;var z=parseInt(b.count);e.b2Assert(0<z&&z<3);var h,m,E,p,n=p=E=g=c=0,o=0,n=0;z==1?(this.m_type=v.e_points,h=this.m_proxyA.GetVertex(b.indexA[0]),m=this.m_proxyB.GetVertex(b.indexB[0]),z=h,b=d.R,c=d.position.x+(b.col1.x*z.x+b.col2.x*z.y),g=d.position.y+(b.col1.y*z.x+b.col2.y*z.y),z=m,b=k.R,E=k.position.x+(b.col1.x*z.x+b.col2.x*z.y),p=k.position.y+
(b.col1.y*z.x+b.col2.y*z.y),this.m_axis.x=E-c,this.m_axis.y=p-g,this.m_axis.Normalize()):(b.indexB[0]==b.indexB[1]?(this.m_type=v.e_faceA,c=this.m_proxyA.GetVertex(b.indexA[0]),g=this.m_proxyA.GetVertex(b.indexA[1]),m=this.m_proxyB.GetVertex(b.indexB[0]),this.m_localPoint.x=0.5*(c.x+g.x),this.m_localPoint.y=0.5*(c.y+g.y),this.m_axis=f.CrossVF(f.SubtractVV(g,c),1),this.m_axis.Normalize(),z=this.m_axis,b=d.R,n=b.col1.x*z.x+b.col2.x*z.y,o=b.col1.y*z.x+b.col2.y*z.y,z=this.m_localPoint,b=d.R,c=d.position.x+
(b.col1.x*z.x+b.col2.x*z.y),g=d.position.y+(b.col1.y*z.x+b.col2.y*z.y),z=m,b=k.R,E=k.position.x+(b.col1.x*z.x+b.col2.x*z.y),p=k.position.y+(b.col1.y*z.x+b.col2.y*z.y),n=(E-c)*n+(p-g)*o):b.indexA[0]==b.indexA[0]?(this.m_type=v.e_faceB,E=this.m_proxyB.GetVertex(b.indexB[0]),p=this.m_proxyB.GetVertex(b.indexB[1]),h=this.m_proxyA.GetVertex(b.indexA[0]),this.m_localPoint.x=0.5*(E.x+p.x),this.m_localPoint.y=0.5*(E.y+p.y),this.m_axis=f.CrossVF(f.SubtractVV(p,E),1),this.m_axis.Normalize(),z=this.m_axis,b=
k.R,n=b.col1.x*z.x+b.col2.x*z.y,o=b.col1.y*z.x+b.col2.y*z.y,z=this.m_localPoint,b=k.R,E=k.position.x+(b.col1.x*z.x+b.col2.x*z.y),p=k.position.y+(b.col1.y*z.x+b.col2.y*z.y),z=h,b=d.R,c=d.position.x+(b.col1.x*z.x+b.col2.x*z.y),g=d.position.y+(b.col1.y*z.x+b.col2.y*z.y),n=(c-E)*n+(g-p)*o):(c=this.m_proxyA.GetVertex(b.indexA[0]),g=this.m_proxyA.GetVertex(b.indexA[1]),E=this.m_proxyB.GetVertex(b.indexB[0]),p=this.m_proxyB.GetVertex(b.indexB[1]),f.MulX(d,h),h=f.MulMV(d.R,f.SubtractVV(g,c)),f.MulX(k,m),
n=f.MulMV(k.R,f.SubtractVV(p,E)),k=h.x*h.x+h.y*h.y,m=n.x*n.x+n.y*n.y,b=f.SubtractVV(n,h),d=h.x*b.x+h.y*b.y,b=n.x*b.x+n.y*b.y,h=h.x*n.x+h.y*n.y,o=k*m-h*h,n=0,o!=0&&(n=f.Clamp((h*b-d*m)/o,0,1)),(h*n+b)/m<0&&(n=f.Clamp((h-d)/k,0,1)),h=new j,h.x=c.x+n*(g.x-c.x),h.y=c.y+n*(g.y-c.y),m=new j,m.x=E.x+n*(p.x-E.x),m.y=E.y+n*(p.y-E.y),n==0||n==1?(this.m_type=v.e_faceB,this.m_axis=f.CrossVF(f.SubtractVV(p,E),1),this.m_axis.Normalize(),this.m_localPoint=m):(this.m_type=v.e_faceA,this.m_axis=f.CrossVF(f.SubtractVV(g,
c),1),this.m_localPoint=h)),n<0&&this.m_axis.NegativeSelf())};v.prototype.Evaluate=function(b,c){var d,g,k=0;switch(this.m_type){case v.e_points:return d=f.MulTMV(b.R,this.m_axis),g=f.MulTMV(c.R,this.m_axis.GetNegative()),d=this.m_proxyA.GetSupportVertex(d),g=this.m_proxyB.GetSupportVertex(g),d=f.MulX(b,d),g=f.MulX(c,g),k=(g.x-d.x)*this.m_axis.x+(g.y-d.y)*this.m_axis.y;case v.e_faceA:return k=f.MulMV(b.R,this.m_axis),d=f.MulX(b,this.m_localPoint),g=f.MulTMV(c.R,k.GetNegative()),g=this.m_proxyB.GetSupportVertex(g),
g=f.MulX(c,g),k=(g.x-d.x)*k.x+(g.y-d.y)*k.y;case v.e_faceB:return k=f.MulMV(c.R,this.m_axis),g=f.MulX(c,this.m_localPoint),d=f.MulTMV(b.R,k.GetNegative()),d=this.m_proxyA.GetSupportVertex(d),d=f.MulX(b,d),k=(d.x-g.x)*k.x+(d.y-g.y)*k.y;default:return e.b2Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});J.b2Simplex=function(){this.m_v1=new P;this.m_v2=new P;this.m_v3=
new P;this.m_vertices=new Vector(3)};J.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};J.prototype.ReadCache=function(b,c,d,g,k){e.b2Assert(0<=b.count&&b.count<=3);var j,z;this.m_count=b.count;for(var v=this.m_vertices,h=0;h<this.m_count;h++){var m=v[h];m.indexA=b.indexA[h];m.indexB=b.indexB[h];j=c.GetVertex(m.indexA);z=g.GetVertex(m.indexB);m.wA=f.MulX(d,j);m.wB=f.MulX(k,z);m.w=f.SubtractVV(m.wB,m.wA);m.a=0}if(this.m_count>1&&
(b=b.metric,j=this.GetMetric(),j<0.5*b||2*b<j||j<Number.MIN_VALUE))this.m_count=0;if(this.m_count==0)m=v[0],m.indexA=0,m.indexB=0,j=c.GetVertex(0),z=g.GetVertex(0),m.wA=f.MulX(d,j),m.wB=f.MulX(k,z),m.w=f.SubtractVV(m.wB,m.wA),this.m_count=1};J.prototype.WriteCache=function(b){b.metric=this.GetMetric();b.count=Box2D.parseUInt(this.m_count);for(var c=this.m_vertices,d=0;d<this.m_count;d++)b.indexA[d]=Box2D.parseUInt(c[d].indexA),b.indexB[d]=Box2D.parseUInt(c[d].indexB)};J.prototype.GetSearchDirection=
function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var b=f.SubtractVV(this.m_v2.w,this.m_v1.w);return f.CrossVV(b,this.m_v1.w.GetNegative())>0?f.CrossFV(1,b):f.CrossVF(b,1);default:return e.b2Assert(!1),new j}};J.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return e.b2Assert(!1),new j;case 1:return this.m_v1.w;case 2:return new j(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return e.b2Assert(!1),
new j}};J.prototype.GetWitnessPoints=function(b,c){switch(this.m_count){case 0:e.b2Assert(!1);break;case 1:b.SetV(this.m_v1.wA);c.SetV(this.m_v1.wB);break;case 2:b.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;b.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;c.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;c.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:c.x=b.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;c.y=b.y=
this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:e.b2Assert(!1)}};J.prototype.GetMetric=function(){switch(this.m_count){case 0:return e.b2Assert(!1),0;case 1:return 0;case 2:return f.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return f.CrossVV(f.SubtractVV(this.m_v2.w,this.m_v1.w),f.SubtractVV(this.m_v3.w,this.m_v1.w));default:return e.b2Assert(!1),0}};J.prototype.Solve2=function(){var b=this.m_v1.w,c=this.m_v2.w,d=f.SubtractVV(c,b),b=-(b.x*d.x+
b.y*d.y);b<=0?this.m_count=this.m_v1.a=1:(c=c.x*d.x+c.y*d.y,c<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(d=1/(c+b),this.m_v1.a=c*d,this.m_v2.a=b*d,this.m_count=2))};J.prototype.Solve3=function(){var b=this.m_v1.w,c=this.m_v2.w,d=this.m_v3.w,e=f.SubtractVV(c,b),g=f.Dot(b,e),k=f.Dot(c,e),g=-g,j=f.SubtractVV(d,b),z=f.Dot(b,j),v=f.Dot(d,j),z=-z,h=f.SubtractVV(d,c),m=f.Dot(c,h),h=f.Dot(d,h),m=-m,j=f.CrossVV(e,j),e=j*f.CrossVV(c,d),d=j*f.CrossVV(d,b),b=j*f.CrossVV(b,c);g<=0&&z<=0?this.m_count=
this.m_v1.a=1:k>0&&g>0&&b<=0?(v=1/(k+g),this.m_v1.a=k*v,this.m_v2.a=g*v,this.m_count=2):v>0&&z>0&&d<=0?(k=1/(v+z),this.m_v1.a=v*k,this.m_v3.a=z*k,this.m_count=2,this.m_v2.Set(this.m_v3)):k<=0&&m<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):v<=0&&h<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):h>0&&m>0&&e<=0?(k=1/(h+m),this.m_v2.a=h*k,this.m_v3.a=m*k,this.m_count=2,this.m_v1.Set(this.m_v3)):(k=1/(e+d+b),this.m_v1.a=e*k,this.m_v2.a=d*k,this.m_v3.a=b*k,this.m_count=3)};k.b2SimplexCache=
function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};P.b2SimplexVertex=function(){};P.prototype.Set=function(b){this.wA.SetV(b.wA);this.wB.SetV(b.wB);this.w.SetV(b.w);this.a=b.a;this.indexA=b.indexA;this.indexB=b.indexB};K.b2TimeOfImpact=function(){};K.TimeOfImpact=function(b){++K.b2_toiCalls;var c=b.proxyA,d=b.proxyB,g=b.sweepA,k=b.sweepB;e.b2Assert(g.t0==k.t0);e.b2Assert(1-g.t0>Number.MIN_VALUE);var j=c.m_radius+d.m_radius,b=b.tolerance,z=0,v=0,h=0;K.s_cache.count=
0;for(K.s_distanceInput.useRadii=!1;;){g.GetTransform(K.s_xfA,z);k.GetTransform(K.s_xfB,z);K.s_distanceInput.proxyA=c;K.s_distanceInput.proxyB=d;K.s_distanceInput.transformA=K.s_xfA;K.s_distanceInput.transformB=K.s_xfB;A.Distance(K.s_distanceOutput,K.s_cache,K.s_distanceInput);if(K.s_distanceOutput.distance<=0){z=1;break}K.s_fcn.Initialize(K.s_cache,c,K.s_xfA,d,K.s_xfB);var m=K.s_fcn.Evaluate(K.s_xfA,K.s_xfB);if(m<=0){z=1;break}v==0&&(h=m>j?f.Max(j-b,0.75*j):f.Max(m-b,0.02*j));if(m-h<0.5*b){if(v==
0){z=1;break}break}var E=z,p=z,n=1;g.GetTransform(K.s_xfA,n);k.GetTransform(K.s_xfB,n);var o=K.s_fcn.Evaluate(K.s_xfA,K.s_xfB);if(o>=h){z=1;break}for(var x=0;;){var P=0,P=x&1?p+(h-m)*(n-p)/(o-m):0.5*(p+n);g.GetTransform(K.s_xfA,P);k.GetTransform(K.s_xfB,P);var V=K.s_fcn.Evaluate(K.s_xfA,K.s_xfB);if(f.Abs(V-h)<0.025*b){E=P;break}V>h?(p=P,m=V):(n=P,o=V);++x;++K.b2_toiRootIters;if(x==50)break}K.b2_toiMaxRootIters=f.Max(K.b2_toiMaxRootIters,x);if(E<(1+100*Number.MIN_VALUE)*z)break;z=E;v++;++K.b2_toiIters;
if(v==1E3)break}K.b2_toiMaxIters=f.Max(K.b2_toiMaxIters,v);return z};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new k;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new C;Box2D.Collision.b2TimeOfImpact.s_xfA=new h;Box2D.Collision.b2TimeOfImpact.s_xfB=
new h;Box2D.Collision.b2TimeOfImpact.s_fcn=new v;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new p});U.b2TOIInput=function(){this.proxyA=new x;this.proxyB=new x;this.sweepA=new g;this.sweepB=new g};O.b2WorldManifold=function(){this.m_normal=new j};O.prototype.b2WorldManifold=function(){this.m_points=new Vector(e.b2_maxManifoldPoints);for(var b=0;b<e.b2_maxManifoldPoints;b++)this.m_points[b]=new j};O.prototype.Initialize=function(b,c,d,e,f){d===void 0&&(d=0);f===void 0&&(f=0);if(b.m_pointCount!=
0){var g=0,k,j,z=0,v=0,h=0,m=0,E=0;k=0;switch(b.m_type){case F.e_circles:j=c.R;k=b.m_localPoint;g=c.position.x+j.col1.x*k.x+j.col2.x*k.y;c=c.position.y+j.col1.y*k.x+j.col2.y*k.y;j=e.R;k=b.m_points[0].m_localPoint;b=e.position.x+j.col1.x*k.x+j.col2.x*k.y;e=e.position.y+j.col1.y*k.x+j.col2.y*k.y;k=b-g;j=e-c;z=k*k+j*j;z>Number.MIN_VALUE*Number.MIN_VALUE?(z=Math.sqrt(z),this.m_normal.x=k/z,this.m_normal.y=j/z):(this.m_normal.x=1,this.m_normal.y=0);k=c+d*this.m_normal.y;e-=f*this.m_normal.y;this.m_points[0].x=
0.5*(g+d*this.m_normal.x+(b-f*this.m_normal.x));this.m_points[0].y=0.5*(k+e);break;case F.e_faceA:j=c.R;k=b.m_localPlaneNormal;z=j.col1.x*k.x+j.col2.x*k.y;v=j.col1.y*k.x+j.col2.y*k.y;j=c.R;k=b.m_localPoint;h=c.position.x+j.col1.x*k.x+j.col2.x*k.y;m=c.position.y+j.col1.y*k.x+j.col2.y*k.y;this.m_normal.x=z;this.m_normal.y=v;for(g=0;g<b.m_pointCount;g++)j=e.R,k=b.m_points[g].m_localPoint,E=e.position.x+j.col1.x*k.x+j.col2.x*k.y,k=e.position.y+j.col1.y*k.x+j.col2.y*k.y,this.m_points[g].x=E+0.5*(d-(E-
h)*z-(k-m)*v-f)*z,this.m_points[g].y=k+0.5*(d-(E-h)*z-(k-m)*v-f)*v;break;case F.e_faceB:j=e.R;k=b.m_localPlaneNormal;z=j.col1.x*k.x+j.col2.x*k.y;v=j.col1.y*k.x+j.col2.y*k.y;j=e.R;k=b.m_localPoint;h=e.position.x+j.col1.x*k.x+j.col2.x*k.y;m=e.position.y+j.col1.y*k.x+j.col2.y*k.y;this.m_normal.x=-z;this.m_normal.y=-v;for(g=0;g<b.m_pointCount;g++)j=c.R,k=b.m_points[g].m_localPoint,E=c.position.x+j.col1.x*k.x+j.col2.x*k.y,k=c.position.y+j.col1.y*k.x+j.col2.y*k.y,this.m_points[g].x=E+0.5*(f-(E-h)*z-(k-
m)*v-d)*z,this.m_points[g].y=k+0.5*(f-(E-h)*z-(k-m)*v-d)*v}}};z.ClipVertex=function(){this.v=new j;this.id=new w};z.prototype.Set=function(b){this.v.SetV(b.v);this.id.Set(b.id)};E.Features=function(){};Object.defineProperty(E.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(E.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._referenceEdge=b;this._m_id._key=this._m_id._key&4294967040|
this._referenceEdge&255}});Object.defineProperty(E.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(E.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._incidentEdge=b;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(E.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(E.prototype,
"incidentVertex",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._incidentVertex=b;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(E.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(E.prototype,"flip",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._flip=b;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();
(function(){var b=Box2D.Common.b2Settings,c=Box2D.Collision.Shapes.b2CircleShape,d=Box2D.Collision.Shapes.b2EdgeChainDef,e=Box2D.Collision.Shapes.b2EdgeShape,f=Box2D.Collision.Shapes.b2MassData,g=Box2D.Collision.Shapes.b2PolygonShape,h=Box2D.Collision.Shapes.b2Shape,j=Box2D.Common.Math.b2Mat22,m=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Transform,t=Box2D.Common.Math.b2Vec2,o=Box2D.Collision.b2Distance,w=Box2D.Collision.b2DistanceInput,u=Box2D.Collision.b2DistanceOutput,A=Box2D.Collision.b2DistanceProxy,
C=Box2D.Collision.b2SimplexCache;Box2D.inherit(c,Box2D.Collision.Shapes.b2Shape);c.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;c.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new t};c.prototype.Copy=function(){var b=new c;b.Set(this);return b};c.prototype.Set=function(b){this.__super.Set.call(this,b);Box2D.is(b,c)&&this.m_p.SetV((b instanceof c?b:null).m_p)};c.prototype.TestPoint=function(b,c){var d=b.R,e=b.position.x+(d.col1.x*this.m_p.x+
d.col2.x*this.m_p.y),d=b.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y),e=c.x-e,d=c.y-d;return e*e+d*d<=this.m_radius*this.m_radius};c.prototype.RayCast=function(b,c,d){var e=d.R,f=c.p1.x-(d.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y)),d=c.p1.y-(d.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y)),e=c.p2.x-c.p1.x,g=c.p2.y-c.p1.y,j=f*e+d*g,h=e*e+g*g,m=j*j-h*(f*f+d*d-this.m_radius*this.m_radius);if(m<0||h<Number.MIN_VALUE)return!1;j=-(j+Math.sqrt(m));if(0<=j&&j<=c.maxFraction*h)return j/=
h,b.fraction=j,b.normal.x=f+j*e,b.normal.y=d+j*g,b.normal.Normalize(),!0;return!1};c.prototype.ComputeAABB=function(b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),d=c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y);b.lowerBound.Set(e-this.m_radius,d-this.m_radius);b.upperBound.Set(e+this.m_radius,d+this.m_radius)};c.prototype.ComputeMass=function(c,d){d===void 0&&(d=0);c.mass=d*b.b2_pi*this.m_radius*this.m_radius;c.center.SetV(this.m_p);c.I=c.mass*(0.5*this.m_radius*
this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};c.prototype.ComputeSubmergedArea=function(b,c,d,e){c===void 0&&(c=0);var d=m.MulX(d,this.m_p),f=-(m.Dot(b,d)-c);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return e.SetV(d),Math.PI*this.m_radius*this.m_radius;var c=this.m_radius*this.m_radius,g=f*f,f=c*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(c-g),c=-2/3*Math.pow(c-g,1.5)/f;e.x=d.x+b.x*c;e.y=d.y+b.y*c;return f};c.prototype.GetLocalPosition=function(){return this.m_p};
c.prototype.SetLocalPosition=function(b){this.m_p.SetV(b)};c.prototype.GetRadius=function(){return this.m_radius};c.prototype.SetRadius=function(b){b===void 0&&(b=0);this.m_radius=b};c.prototype.b2CircleShape=function(b){b===void 0&&(b=0);this.__super.b2Shape.call(this);this.m_type=h.e_circleShape;this.m_radius=b};d.b2EdgeChainDef=function(){};d.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape);e.prototype.__super=
Box2D.Collision.Shapes.b2Shape.prototype;e.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new t;this.m_v1=new t;this.m_v2=new t;this.m_coreV1=new t;this.m_coreV2=new t;this.m_normal=new t;this.m_direction=new t;this.m_cornerDir1=new t;this.m_cornerDir2=new t};e.prototype.TestPoint=function(){return!1};e.prototype.RayCast=function(b,c,d){var e,f=c.p2.x-c.p1.x,g=c.p2.y-c.p1.y;e=d.R;var j=d.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),
h=d.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),m=d.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y)-h,d=-(d.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y)-j);e=100*Number.MIN_VALUE;var n=-(f*m+g*d);if(n>e){var j=c.p1.x-j,o=c.p1.y-h,h=j*m+o*d;if(0<=h&&h<=c.maxFraction*n&&(c=-f*o+g*j,-e*n<=c&&c<=n*(1+e)))return h/=n,b.fraction=h,c=Math.sqrt(m*m+d*d),b.normal.x=m/c,b.normal.y=d/c,!0}return!1};e.prototype.ComputeAABB=function(b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_v1.x+
d.col2.x*this.m_v1.y),f=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),g=c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y),d=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y);e<g?(b.lowerBound.x=e,b.upperBound.x=g):(b.lowerBound.x=g,b.upperBound.x=e);f<d?(b.lowerBound.y=f,b.upperBound.y=d):(b.lowerBound.y=d,b.upperBound.y=f)};e.prototype.ComputeMass=function(b){b.mass=0;b.center.SetV(this.m_v1);b.I=0};e.prototype.ComputeSubmergedArea=function(b,c,d,e){c===void 0&&(c=0);var f=
new t(b.x*c,b.y*c),g=m.MulX(d,this.m_v1),d=m.MulX(d,this.m_v2),j=m.Dot(b,g)-c,b=m.Dot(b,d)-c;if(j>0)if(b>0)return 0;else g.x=-b/(j-b)*g.x+j/(j-b)*d.x,g.y=-b/(j-b)*g.y+j/(j-b)*d.y;else if(b>0)d.x=-b/(j-b)*g.x+j/(j-b)*d.x,d.y=-b/(j-b)*g.y+j/(j-b)*d.y;e.x=(f.x+g.x+d.x)/3;e.y=(f.y+g.y+d.y)/3;return 0.5*((g.x-f.x)*(d.y-f.y)-(g.y-f.y)*(d.x-f.x))};e.prototype.GetLength=function(){return this.m_length};e.prototype.GetVertex1=function(){return this.m_v1};e.prototype.GetVertex2=function(){return this.m_v2};
e.prototype.GetCoreVertex1=function(){return this.m_coreV1};e.prototype.GetCoreVertex2=function(){return this.m_coreV2};e.prototype.GetNormalVector=function(){return this.m_normal};e.prototype.GetDirectionVector=function(){return this.m_direction};e.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};e.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};e.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};e.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};
e.prototype.GetFirstVertex=function(b){var c=b.R;return new t(b.position.x+(c.col1.x*this.m_coreV1.x+c.col2.x*this.m_coreV1.y),b.position.y+(c.col1.y*this.m_coreV1.x+c.col2.y*this.m_coreV1.y))};e.prototype.GetNextEdge=function(){return this.m_nextEdge};e.prototype.GetPrevEdge=function(){return this.m_prevEdge};e.prototype.Support=function(b,c,d){c===void 0&&(c=0);d===void 0&&(d=0);var e=b.R,f=b.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),g=b.position.y+(e.col1.y*this.m_coreV1.x+
e.col2.y*this.m_coreV1.y),j=b.position.x+(e.col1.x*this.m_coreV2.x+e.col2.x*this.m_coreV2.y),b=b.position.y+(e.col1.y*this.m_coreV2.x+e.col2.y*this.m_coreV2.y);f*c+g*d>j*c+b*d?(this.s_supportVec.x=f,this.s_supportVec.y=g):(this.s_supportVec.x=j,this.s_supportVec.y=b);return this.s_supportVec};e.prototype.b2EdgeShape=function(c,d){this.__super.b2Shape.call(this);this.m_type=h.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=c;this.m_v2=d;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-
this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-b.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-b.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};e.prototype.SetPrevEdge=
function(b,c,d,e){this.m_prevEdge=b;this.m_coreV1=c;this.m_cornerDir1=d;this.m_cornerConvex1=e};e.prototype.SetNextEdge=function(b,c,d,e){this.m_nextEdge=b;this.m_coreV2=c;this.m_cornerDir2=d;this.m_cornerConvex2=e};f.b2MassData=function(){this.mass=0;this.center=new t(0,0);this.I=0};Box2D.inherit(g,Box2D.Collision.Shapes.b2Shape);g.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;g.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};g.prototype.Copy=
function(){var b=new g;b.Set(this);return b};g.prototype.Set=function(b){this.__super.Set.call(this,b);if(Box2D.is(b,g)){b=b instanceof g?b:null;this.m_centroid.SetV(b.m_centroid);this.m_vertexCount=b.m_vertexCount;this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),this.m_normals[c].SetV(b.m_normals[c])}};g.prototype.SetAsArray=function(b,c){c===void 0&&(c=0);for(var d=new Vector,e=0,f,e=0;e<b.length;++e)f=b[e],d.push(f);this.SetAsVector(d,
c)};g.AsArray=function(b,c){c===void 0&&(c=0);var d=new g;d.SetAsArray(b,c);return d};g.prototype.SetAsVector=function(c,d){d===void 0&&(d=0);if(d==0)d=c.length;b.b2Assert(2<=d);this.m_vertexCount=d;this.Reserve(d);for(var e=0,e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(c[e]);for(e=0;e<this.m_vertexCount;++e){var f=parseInt(e),j=parseInt(e+1<this.m_vertexCount?e+1:0),f=m.SubtractVV(this.m_vertices[j],this.m_vertices[f]);b.b2Assert(f.LengthSquared()>Number.MIN_VALUE);this.m_normals[e].SetV(m.CrossVF(f,
1));this.m_normals[e].Normalize()}this.m_centroid=g.ComputeCentroid(this.m_vertices,this.m_vertexCount)};g.AsVector=function(b,c){c===void 0&&(c=0);var d=new g;d.SetAsVector(b,c);return d};g.prototype.SetAsBox=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-b,-c);this.m_vertices[1].Set(b,-c);this.m_vertices[2].Set(b,c);this.m_vertices[3].Set(-b,c);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,
0);this.m_centroid.SetZero()};g.AsBox=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);var d=new g;d.SetAsBox(b,c);return d};g.prototype.SetAsOrientedBox=function(b,c,d,e){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=null);e===void 0&&(e=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-b,-c);this.m_vertices[1].Set(b,-c);this.m_vertices[2].Set(b,c);this.m_vertices[3].Set(-b,c);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,
0);this.m_centroid=d;b=new n;b.position=d;b.R.Set(e);for(d=0;d<this.m_vertexCount;++d)this.m_vertices[d]=m.MulX(b,this.m_vertices[d]),this.m_normals[d]=m.MulMV(b.R,this.m_normals[d])};g.AsOrientedBox=function(b,c,d,e){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=null);e===void 0&&(e=0);var f=new g;f.SetAsOrientedBox(b,c,d,e);return f};g.prototype.SetAsEdge=function(b,c){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(b);this.m_vertices[1].SetV(c);this.m_centroid.x=0.5*(b.x+c.x);
this.m_centroid.y=0.5*(b.y+c.y);this.m_normals[0]=m.CrossVF(m.SubtractVV(c,b),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};g.AsEdge=function(b,c){var d=new g;d.SetAsEdge(b,c);return d};g.prototype.TestPoint=function(b,c){var d;d=b.R;for(var e=c.x-b.position.x,f=c.y-b.position.y,g=e*d.col1.x+f*d.col1.y,j=e*d.col2.x+f*d.col2.y,h=0;h<this.m_vertexCount;++h)if(d=this.m_vertices[h],e=g-d.x,f=j-d.y,d=this.m_normals[h],d.x*e+d.y*f>0)return!1;
return!0};g.prototype.RayCast=function(b,c,d){var e=0,f=c.maxFraction,g=0,j=0,h,m,g=c.p1.x-d.position.x,j=c.p1.y-d.position.y;h=d.R;var n=g*h.col1.x+j*h.col1.y,o=g*h.col2.x+j*h.col2.y,g=c.p2.x-d.position.x,j=c.p2.y-d.position.y;h=d.R;c=g*h.col1.x+j*h.col1.y-n;h=g*h.col2.x+j*h.col2.y-o;for(var u=parseInt(-1),v=0;v<this.m_vertexCount;++v){m=this.m_vertices[v];g=m.x-n;j=m.y-o;m=this.m_normals[v];g=m.x*g+m.y*j;j=m.x*c+m.y*h;if(j==0){if(g<0)return!1}else j<0&&g<e*j?(e=g/j,u=v):j>0&&g<f*j&&(f=g/j);if(f<
e-Number.MIN_VALUE)return!1}if(u>=0)return b.fraction=e,h=d.R,m=this.m_normals[u],b.normal.x=h.col1.x*m.x+h.col2.x*m.y,b.normal.y=h.col1.y*m.x+h.col2.y*m.y,!0;return!1};g.prototype.ComputeAABB=function(b,c){for(var d=c.R,e=this.m_vertices[0],f=c.position.x+(d.col1.x*e.x+d.col2.x*e.y),g=c.position.y+(d.col1.y*e.x+d.col2.y*e.y),j=f,h=g,m=1;m<this.m_vertexCount;++m)var e=this.m_vertices[m],n=c.position.x+(d.col1.x*e.x+d.col2.x*e.y),e=c.position.y+(d.col1.y*e.x+d.col2.y*e.y),f=f<n?f:n,g=g<e?g:e,j=j>n?
j:n,h=h>e?h:e;b.lowerBound.x=f-this.m_radius;b.lowerBound.y=g-this.m_radius;b.upperBound.x=j+this.m_radius;b.upperBound.y=h+this.m_radius};g.prototype.ComputeMass=function(b,c){c===void 0&&(c=0);if(this.m_vertexCount==2)b.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),b.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y),b.mass=0,b.I=0;else{for(var d=0,e=0,f=0,g=0,j=1/3,h=0;h<this.m_vertexCount;++h){var m=this.m_vertices[h],n=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0],
o=m.x-0,u=m.y-0,v=n.x-0,J=n.y-0,k=o*J-u*v,P=0.5*k;f+=P;d+=P*j*(0+m.x+n.x);e+=P*j*(0+m.y+n.y);m=o;g+=k*(j*(0.25*(m*m+v*m+v*v)+(0*m+0*v))+0+(j*(0.25*(u*u+J*u+J*J)+(0*u+0*J))+0))}b.mass=c*f;d*=1/f;e*=1/f;b.center.Set(d,e);b.I=c*g}};g.prototype.ComputeSubmergedArea=function(b,c,d,e){c===void 0&&(c=0);for(var g=m.MulTMV(d.R,b),j=c-m.Dot(b,d.position),h=new Vector_a2j_Number,n=0,o=parseInt(-1),c=parseInt(-1),u=!1,b=b=0;b<this.m_vertexCount;++b){h[b]=m.Dot(g,this.m_vertices[b])-j;var w=h[b]<-Number.MIN_VALUE;
b>0&&(w?u||(o=b-1,n++):u&&(c=b-1,n++));u=w}switch(n){case 0:return u?(b=new f,this.ComputeMass(b,1),e.SetV(m.MulX(d,b.center)),b.mass):0;case 1:o==-1?o=this.m_vertexCount-1:c=this.m_vertexCount-1}b=parseInt((o+1)%this.m_vertexCount);g=parseInt((c+1)%this.m_vertexCount);j=(0-h[o])/(h[b]-h[o]);h=(0-h[c])/(h[g]-h[c]);o=new t(this.m_vertices[o].x*(1-j)+this.m_vertices[b].x*j,this.m_vertices[o].y*(1-j)+this.m_vertices[b].y*j);c=new t(this.m_vertices[c].x*(1-h)+this.m_vertices[g].x*h,this.m_vertices[c].y*
(1-h)+this.m_vertices[g].y*h);h=0;j=new t;for(n=this.m_vertices[b];b!=g;)b=(b+1)%this.m_vertexCount,u=b==g?c:this.m_vertices[b],w=0.5*((n.x-o.x)*(u.y-o.y)-(n.y-o.y)*(u.x-o.x)),h+=w,j.x+=w*(o.x+n.x+u.x)/3,j.y+=w*(o.y+n.y+u.y)/3,n=u;j.Multiply(1/h);e.SetV(m.MulX(d,j));return h};g.prototype.GetVertexCount=function(){return this.m_vertexCount};g.prototype.GetVertices=function(){return this.m_vertices};g.prototype.GetNormals=function(){return this.m_normals};g.prototype.GetSupport=function(b){for(var c=
0,d=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,e=1;e<this.m_vertexCount;++e){var f=this.m_vertices[e].x*b.x+this.m_vertices[e].y*b.y;f>d&&(c=e,d=f)}return c};g.prototype.GetSupportVertex=function(b){for(var c=0,d=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,e=1;e<this.m_vertexCount;++e){var f=this.m_vertices[e].x*b.x+this.m_vertices[e].y*b.y;f>d&&(c=e,d=f)}return this.m_vertices[c]};g.prototype.Validate=function(){return!1};g.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);
this.m_type=h.e_polygonShape;this.m_centroid=new t;this.m_vertices=new Vector;this.m_normals=new Vector};g.prototype.Reserve=function(b){b===void 0&&(b=0);for(var c=parseInt(this.m_vertices.length);c<b;c++)this.m_vertices[c]=new t,this.m_normals[c]=new t};g.ComputeCentroid=function(b,c){c===void 0&&(c=0);for(var d=new t,e=0,f=1/3,g=0;g<c;++g){var j=b[g],h=g+1<c?b[parseInt(g+1)]:b[0],m=0.5*((j.x-0)*(h.y-0)-(j.y-0)*(h.x-0));e+=m;d.x+=m*f*(0+j.x+h.x);d.y+=m*f*(0+j.y+h.y)}d.x*=1/e;d.y*=1/e;return d};
g.ComputeOBB=function(b,c,d){d===void 0&&(d=0);for(var e=0,f=new Vector(d+1),e=0;e<d;++e)f[e]=c[e];f[d]=f[0];c=Number.MAX_VALUE;for(e=1;e<=d;++e){var g=f[parseInt(e-1)],j=f[e].x-g.x,h=f[e].y-g.y,m=Math.sqrt(j*j+h*h);j/=m;h/=m;for(var n=-h,o=j,u=m=Number.MAX_VALUE,v=-Number.MAX_VALUE,J=-Number.MAX_VALUE,k=0;k<d;++k){var P=f[k].x-g.x,K=f[k].y-g.y,w=j*P+h*K,P=n*P+o*K;w<m&&(m=w);P<u&&(u=P);w>v&&(v=w);P>J&&(J=P)}k=(v-m)*(J-u);if(k<0.95*c)c=k,b.R.col1.x=j,b.R.col1.y=h,b.R.col2.x=n,b.R.col2.y=o,j=0.5*(m+
v),h=0.5*(u+J),n=b.R,b.center.x=g.x+(n.col1.x*j+n.col2.x*h),b.center.y=g.y+(n.col1.y*j+n.col2.y*h),b.extents.x=0.5*(v-m),b.extents.y=0.5*(J-u)}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new j});h.b2Shape=function(){};h.prototype.Copy=function(){return null};h.prototype.Set=function(b){this.m_radius=b.m_radius};h.prototype.GetType=function(){return this.m_type};h.prototype.TestPoint=function(){return!1};h.prototype.RayCast=function(){return!1};h.prototype.ComputeAABB=
function(){};h.prototype.ComputeMass=function(){};h.prototype.ComputeSubmergedArea=function(){return 0};h.TestOverlap=function(b,c,d,e){var f=new w;f.proxyA=new A;f.proxyA.Set(b);f.proxyB=new A;f.proxyB.Set(d);f.transformA=c;f.transformB=e;f.useRadii=!0;b=new C;b.count=0;c=new u;o.Distance(c,b,f);return c.distance<10*Number.MIN_VALUE};h.prototype.b2Shape=function(){this.m_type=h.e_unknownShape;this.m_radius=b.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=
parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();
(function(){var b=Box2D.Common.b2Color,c=Box2D.Common.b2Settings,d=Box2D.Common.Math.b2Math;b.b2Color=function(){this._b=this._g=this._r=0};b.prototype.b2Color=function(b,c,g){b===void 0&&(b=0);c===void 0&&(c=0);g===void 0&&(g=0);this._r=Box2D.parseUInt(255*d.Clamp(b,0,1));this._g=Box2D.parseUInt(255*d.Clamp(c,0,1));this._b=Box2D.parseUInt(255*d.Clamp(g,0,1))};b.prototype.Set=function(b,c,g){b===void 0&&(b=0);c===void 0&&(c=0);g===void 0&&(g=0);this._r=Box2D.parseUInt(255*d.Clamp(b,0,1));this._g=
Box2D.parseUInt(255*d.Clamp(c,0,1));this._b=Box2D.parseUInt(255*d.Clamp(g,0,1))};Object.defineProperty(b.prototype,"r",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._r=Box2D.parseUInt(255*d.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"g",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._g=Box2D.parseUInt(255*d.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"b",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._b=Box2D.parseUInt(255*
d.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});c.b2Settings=function(){};c.b2MixFriction=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);return Math.sqrt(b*c)};c.b2MixRestitution=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);return b>c?b:c};c.b2Assert=function(b){if(!b)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=
65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=0.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*c.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=0.0050;Box2D.Common.b2Settings.b2_angularSlop=2/180*c.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*c.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=
1;Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=1/180*c.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=c.b2_maxTranslation*c.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=c.b2_pi*0.115;Box2D.Common.b2Settings.b2_maxRotationSquared=c.b2_maxRotation*c.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=0.2;Box2D.Common.b2Settings.b2_timeToSleep=0.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=
0.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*c.b2_pi})})();
(function(){var b=Box2D.Common.Math.b2Mat22,c=Box2D.Common.Math.b2Mat33,d=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,g=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3;b.b2Mat22=function(){this.col1=new g;this.col2=new g};b.prototype.b2Mat22=function(){this.SetIdentity()};b.FromAngle=function(c){c===void 0&&(c=0);var d=new b;d.Set(c);return d};b.FromVV=function(c,d){var e=new b;e.SetVV(c,d);return e};b.prototype.Set=function(b){b===void 0&&(b=0);var c=
Math.cos(b),b=Math.sin(b);this.col1.x=c;this.col2.x=-b;this.col1.y=b;this.col2.y=c};b.prototype.SetVV=function(b,c){this.col1.SetV(b);this.col2.SetV(c)};b.prototype.Copy=function(){var c=new b;c.SetM(this);return c};b.prototype.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2)};b.prototype.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y};b.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};
b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};b.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};b.prototype.GetInverse=function(b){var c=this.col1.x,d=this.col2.x,e=this.col1.y,f=this.col2.y,g=c*f-d*e;g!=0&&(g=1/g);b.col1.x=g*f;b.col2.x=-g*d;b.col1.y=-g*e;b.col2.y=g*c;return b};b.prototype.Solve=function(b,c,d){c===void 0&&(c=0);d===void 0&&(d=0);var e=this.col1.x,f=this.col2.x,g=this.col1.y,h=this.col2.y,A=e*h-f*g;A!=0&&(A=1/A);
b.x=A*(h*c-f*d);b.y=A*(e*d-g*c);return b};b.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};c.b2Mat33=function(){this.col1=new h;this.col2=new h;this.col3=new h};c.prototype.b2Mat33=function(b,c,d){b===void 0&&(b=null);c===void 0&&(c=null);d===void 0&&(d=null);!b&&!c&&!d?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(b),this.col2.SetV(c),this.col3.SetV(d))};c.prototype.SetVVV=function(b,c,d){this.col1.SetV(b);this.col2.SetV(c);this.col3.SetV(d)};c.prototype.Copy=
function(){return new c(this.col1,this.col2,this.col3)};c.prototype.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2);this.col3.SetV(b.col3)};c.prototype.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col1.z+=b.col1.z;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y;this.col2.z+=b.col2.z;this.col3.x+=b.col3.x;this.col3.y+=b.col3.y;this.col3.z+=b.col3.z};c.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;
this.col1.z=0;this.col2.z=0;this.col3.z=1};c.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};c.prototype.Solve22=function(b,c,d){c===void 0&&(c=0);d===void 0&&(d=0);var e=this.col1.x,f=this.col2.x,g=this.col1.y,h=this.col2.y,A=e*h-f*g;A!=0&&(A=1/A);b.x=A*(h*c-f*d);b.y=A*(e*d-g*c);return b};c.prototype.Solve33=function(b,c,d,e){c===void 0&&(c=0);d===void 0&&(d=0);e===void 0&&(e=0);var f=this.col1.x,
g=this.col1.y,h=this.col1.z,A=this.col2.x,C=this.col2.y,p=this.col2.z,x=this.col3.x,H=this.col3.y,B=this.col3.z,I=f*(C*B-p*H)+g*(p*x-A*B)+h*(A*H-C*x);I!=0&&(I=1/I);b.x=I*(c*(C*B-p*H)+d*(p*x-A*B)+e*(A*H-C*x));b.y=I*(f*(d*B-e*H)+g*(e*x-c*B)+h*(c*H-d*x));b.z=I*(f*(C*e-p*d)+g*(p*c-A*e)+h*(A*d-C*c));return b};d.b2Math=function(){};d.IsValid=function(b){b===void 0&&(b=0);return isFinite(b)};d.Dot=function(b,c){return b.x*c.x+b.y*c.y};d.CrossVV=function(b,c){return b.x*c.y-b.y*c.x};d.CrossVF=function(b,
c){c===void 0&&(c=0);return new g(c*b.y,-c*b.x)};d.CrossFV=function(b,c){b===void 0&&(b=0);return new g(-b*c.y,b*c.x)};d.MulMV=function(b,c){return new g(b.col1.x*c.x+b.col2.x*c.y,b.col1.y*c.x+b.col2.y*c.y)};d.MulTMV=function(b,c){return new g(d.Dot(c,b.col1),d.Dot(c,b.col2))};d.MulX=function(b,c){var e=d.MulMV(b.R,c);e.x+=b.position.x;e.y+=b.position.y;return e};d.MulXT=function(b,c){var e=d.SubtractVV(c,b.position),f=e.x*b.R.col1.x+e.y*b.R.col1.y;e.y=e.x*b.R.col2.x+e.y*b.R.col2.y;e.x=f;return e};
d.AddVV=function(b,c){return new g(b.x+c.x,b.y+c.y)};d.SubtractVV=function(b,c){return new g(b.x-c.x,b.y-c.y)};d.Distance=function(b,c){var d=b.x-c.x,e=b.y-c.y;return Math.sqrt(d*d+e*e)};d.DistanceSquared=function(b,c){var d=b.x-c.x,e=b.y-c.y;return d*d+e*e};d.MulFV=function(b,c){b===void 0&&(b=0);return new g(b*c.x,b*c.y)};d.AddMM=function(c,e){return b.FromVV(d.AddVV(c.col1,e.col1),d.AddVV(c.col2,e.col2))};d.MulMM=function(c,e){return b.FromVV(d.MulMV(c,e.col1),d.MulMV(c,e.col2))};d.MulTMM=function(c,
e){var f=new g(d.Dot(c.col1,e.col1),d.Dot(c.col2,e.col1)),h=new g(d.Dot(c.col1,e.col2),d.Dot(c.col2,e.col2));return b.FromVV(f,h)};d.Abs=function(b){b===void 0&&(b=0);return b>0?b:-b};d.AbsV=function(b){return new g(d.Abs(b.x),d.Abs(b.y))};d.AbsM=function(c){return b.FromVV(d.AbsV(c.col1),d.AbsV(c.col2))};d.Min=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);return b<c?b:c};d.MinV=function(b,c){return new g(d.Min(b.x,c.x),d.Min(b.y,c.y))};d.Max=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);
return b>c?b:c};d.MaxV=function(b,c){return new g(d.Max(b.x,c.x),d.Max(b.y,c.y))};d.Clamp=function(b,c,d){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=0);return b<c?c:b>d?d:b};d.ClampV=function(b,c,e){return d.MaxV(c,d.MinV(b,e))};d.Swap=function(b,c){var d=b[0];b[0]=c[0];c[0]=d};d.Random=function(){return Math.random()*2-1};d.RandomRange=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);var d=Math.random();return(c-b)*d+b};d.NextPowerOfTwo=function(b){b===void 0&&(b=0);b|=b>>1&2147483647;b|=
b>>2&1073741823;b|=b>>4&268435455;b|=b>>8&16777215;b|=b>>16&65535;return b+1};d.IsPowerOfTwo=function(b){b===void 0&&(b=0);return b>0&&(b&b-1)==0};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new g(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=b.FromVV(new g(1,0),new g(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new f(d.b2Vec2_zero,d.b2Mat22_identity)});e.b2Sweep=function(){this.localCenter=new g;this.c0=new g;this.c=new g};e.prototype.Set=function(b){this.localCenter.SetV(b.localCenter);
this.c0.SetV(b.c0);this.c.SetV(b.c);this.a0=b.a0;this.a=b.a;this.t0=b.t0};e.prototype.Copy=function(){var b=new e;b.localCenter.SetV(this.localCenter);b.c0.SetV(this.c0);b.c.SetV(this.c);b.a0=this.a0;b.a=this.a;b.t0=this.t0;return b};e.prototype.GetTransform=function(b,c){c===void 0&&(c=0);b.position.x=(1-c)*this.c0.x+c*this.c.x;b.position.y=(1-c)*this.c0.y+c*this.c.y;b.R.Set((1-c)*this.a0+c*this.a);var d=b.R;b.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y;b.position.y-=d.col1.y*
this.localCenter.x+d.col2.y*this.localCenter.y};e.prototype.Advance=function(b){b===void 0&&(b=0);if(this.t0<b&&1-this.t0>Number.MIN_VALUE){var c=(b-this.t0)/(1-this.t0);this.c0.x=(1-c)*this.c0.x+c*this.c.x;this.c0.y=(1-c)*this.c0.y+c*this.c.y;this.a0=(1-c)*this.a0+c*this.a;this.t0=b}};f.b2Transform=function(){this.position=new g;this.R=new b};f.prototype.b2Transform=function(b,c){b===void 0&&(b=null);c===void 0&&(c=null);b&&(this.position.SetV(b),this.R.SetM(c))};f.prototype.Initialize=function(b,
c){this.position.SetV(b);this.R.SetM(c)};f.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};f.prototype.Set=function(b){this.position.SetV(b.position);this.R.SetM(b.R)};f.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};g.b2Vec2=function(){};g.prototype.b2Vec2=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);this.x=b;this.y=c};g.prototype.SetZero=function(){this.y=this.x=0};g.prototype.Set=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);
this.x=b;this.y=c};g.prototype.SetV=function(b){this.x=b.x;this.y=b.y};g.prototype.GetNegative=function(){return new g(-this.x,-this.y)};g.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};g.Make=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);return new g(b,c)};g.prototype.Copy=function(){return new g(this.x,this.y)};g.prototype.Add=function(b){this.x+=b.x;this.y+=b.y};g.prototype.Subtract=function(b){this.x-=b.x;this.y-=b.y};g.prototype.Multiply=function(b){b===void 0&&(b=0);this.x*=
b;this.y*=b};g.prototype.MulM=function(b){var c=this.x;this.x=b.col1.x*c+b.col2.x*this.y;this.y=b.col1.y*c+b.col2.y*this.y};g.prototype.MulTM=function(b){var c=d.Dot(this,b.col1);this.y=d.Dot(this,b.col2);this.x=c};g.prototype.CrossVF=function(b){b===void 0&&(b=0);var c=this.x;this.x=b*this.y;this.y=-b*c};g.prototype.CrossFV=function(b){b===void 0&&(b=0);var c=this.x;this.x=-b*this.y;this.y=b*c};g.prototype.MinV=function(b){this.x=this.x<b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y};g.prototype.MaxV=
function(b){this.x=this.x>b.x?this.x:b.x;this.y=this.y>b.y?this.y:b.y};g.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};g.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};g.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};g.prototype.Normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y);if(b<Number.MIN_VALUE)return 0;var c=1/b;this.x*=c;this.y*=c;return b};g.prototype.IsValid=function(){return d.IsValid(this.x)&&
d.IsValid(this.y)};h.b2Vec3=function(){};h.prototype.b2Vec3=function(b,c,d){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=0);this.x=b;this.y=c;this.z=d};h.prototype.SetZero=function(){this.x=this.y=this.z=0};h.prototype.Set=function(b,c,d){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=0);this.x=b;this.y=c;this.z=d};h.prototype.SetV=function(b){this.x=b.x;this.y=b.y;this.z=b.z};h.prototype.GetNegative=function(){return new h(-this.x,-this.y,-this.z)};h.prototype.NegativeSelf=function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z};h.prototype.Copy=function(){return new h(this.x,this.y,this.z)};h.prototype.Add=function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z};h.prototype.Subtract=function(b){this.x-=b.x;this.y-=b.y;this.z-=b.z};h.prototype.Multiply=function(b){b===void 0&&(b=0);this.x*=b;this.y*=b;this.z*=b}})();
(function(){var b=Box2D.Common.Math.b2Math,c=Box2D.Common.Math.b2Sweep,d=Box2D.Common.Math.b2Transform,e=Box2D.Common.Math.b2Vec2,f=Box2D.Common.b2Color,g=Box2D.Common.b2Settings,h=Box2D.Collision.b2AABB,j=Box2D.Collision.b2ContactPoint,m=Box2D.Collision.b2DynamicTreeBroadPhase,n=Box2D.Collision.b2RayCastInput,t=Box2D.Collision.b2RayCastOutput,o=Box2D.Collision.Shapes.b2CircleShape,w=Box2D.Collision.Shapes.b2EdgeShape,u=Box2D.Collision.Shapes.b2MassData,A=Box2D.Collision.Shapes.b2PolygonShape,C=Box2D.Collision.Shapes.b2Shape,
p=Box2D.Dynamics.b2Body,x=Box2D.Dynamics.b2BodyDef,H=Box2D.Dynamics.b2ContactFilter,B=Box2D.Dynamics.b2ContactImpulse,I=Box2D.Dynamics.b2ContactListener,D=Box2D.Dynamics.b2ContactManager,F=Box2D.Dynamics.b2DebugDraw,T=Box2D.Dynamics.b2DestructionListener,L=Box2D.Dynamics.b2FilterData,M=Box2D.Dynamics.b2Fixture,N=Box2D.Dynamics.b2FixtureDef,S=Box2D.Dynamics.b2Island,v=Box2D.Dynamics.b2TimeStep,J=Box2D.Dynamics.b2World,k=Box2D.Dynamics.Contacts.b2Contact,P=Box2D.Dynamics.Contacts.b2ContactFactory,K=
Box2D.Dynamics.Contacts.b2ContactSolver,U=Box2D.Dynamics.Joints.b2Joint,O=Box2D.Dynamics.Joints.b2PulleyJoint;p.b2Body=function(){this.m_xf=new d;this.m_sweep=new c;this.m_linearVelocity=new e;this.m_force=new e};p.prototype.connectEdges=function(c,d,e){e===void 0&&(e=0);var f=Math.atan2(d.GetDirectionVector().y,d.GetDirectionVector().x),e=b.MulFV(Math.tan((f-e)*0.5),d.GetDirectionVector()),e=b.SubtractVV(e,d.GetNormalVector()),e=b.MulFV(g.b2_toiSlop,e),e=b.AddVV(e,d.GetVertex1()),k=b.AddVV(c.GetDirectionVector(),
d.GetDirectionVector());k.Normalize();var h=b.Dot(c.GetDirectionVector(),d.GetNormalVector())>0;c.SetNextEdge(d,e,k,h);d.SetPrevEdge(c,e,k,h);return f};p.prototype.CreateFixture=function(b){if(this.m_world.IsLocked()==!0)return null;var c=new M;c.Create(this,this.m_xf,b);this.m_flags&p.e_activeFlag&&c.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);c.m_next=this.m_fixtureList;this.m_fixtureList=c;++this.m_fixtureCount;c.m_body=this;c.m_density>0&&this.ResetMassData();this.m_world.m_flags|=
J.e_newFixture;return c};p.prototype.CreateFixture2=function(b,c){c===void 0&&(c=0);var d=new N;d.shape=b;d.density=c;return this.CreateFixture(d)};p.prototype.DestroyFixture=function(b){if(this.m_world.IsLocked()!=!0){for(var c=this.m_fixtureList,d=null;c!=null;){if(c==b){d?d.m_next=b.m_next:this.m_fixtureList=b.m_next;break}d=c;c=c.m_next}for(c=this.m_contactList;c;){var d=c.contact,c=c.next,e=d.GetFixtureA(),f=d.GetFixtureB();(b==e||b==f)&&this.m_world.m_contactManager.Destroy(d)}this.m_flags&
p.e_activeFlag&&b.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);b.Destroy();b.m_body=null;b.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};p.prototype.SetPositionAndAngle=function(b,c){c===void 0&&(c=0);var d;if(this.m_world.IsLocked()!=!0){this.m_xf.R.Set(c);this.m_xf.position.SetV(b);d=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y;this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;
this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=c;e=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(e,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};p.prototype.SetTransform=function(b){this.SetPositionAndAngle(b.position,b.GetAngle())};p.prototype.GetTransform=function(){return this.m_xf};p.prototype.GetPosition=function(){return this.m_xf.position};p.prototype.SetPosition=function(b){this.SetPositionAndAngle(b,
this.GetAngle())};p.prototype.GetAngle=function(){return this.m_sweep.a};p.prototype.SetAngle=function(b){b===void 0&&(b=0);this.SetPositionAndAngle(this.GetPosition(),b)};p.prototype.GetWorldCenter=function(){return this.m_sweep.c};p.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};p.prototype.SetLinearVelocity=function(b){this.m_type!=p.b2_staticBody&&this.m_linearVelocity.SetV(b)};p.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};p.prototype.SetAngularVelocity=
function(b){b===void 0&&(b=0);if(this.m_type!=p.b2_staticBody)this.m_angularVelocity=b};p.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};p.prototype.GetDefinition=function(){var b=new x;b.type=this.GetType();b.allowSleep=(this.m_flags&p.e_allowSleepFlag)==p.e_allowSleepFlag;b.angle=this.GetAngle();b.angularDamping=this.m_angularDamping;b.angularVelocity=this.m_angularVelocity;b.fixedRotation=(this.m_flags&p.e_fixedRotationFlag)==p.e_fixedRotationFlag;b.bullet=(this.m_flags&
p.e_bulletFlag)==p.e_bulletFlag;b.awake=(this.m_flags&p.e_awakeFlag)==p.e_awakeFlag;b.linearDamping=this.m_linearDamping;b.linearVelocity.SetV(this.GetLinearVelocity());b.position=this.GetPosition();b.userData=this.GetUserData();return b};p.prototype.ApplyForce=function(b,c){this.m_type==p.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_force.x+=b.x,this.m_force.y+=b.y,this.m_torque+=(c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x)};p.prototype.ApplyTorque=function(b){b===void 0&&
(b=0);this.m_type==p.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_torque+=b)};p.prototype.ApplyImpulse=function(b,c){this.m_type==p.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*b.x,this.m_linearVelocity.y+=this.m_invMass*b.y,this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*b.y-(c.y-this.m_sweep.c.y)*b.x))};p.prototype.Split=function(c){for(var d=this.GetLinearVelocity().Copy(),e=this.GetAngularVelocity(),f=this.GetWorldCenter(),
g=this.m_world.CreateBody(this.GetDefinition()),k,h=this.m_fixtureList;h;)if(c(h)){var j=h.m_next;k?k.m_next=j:this.m_fixtureList=j;this.m_fixtureCount--;h.m_next=g.m_fixtureList;g.m_fixtureList=h;g.m_fixtureCount++;h.m_body=g;h=j}else k=h,h=h.m_next;this.ResetMassData();g.ResetMassData();k=this.GetWorldCenter();c=g.GetWorldCenter();k=b.AddVV(d,b.CrossFV(e,b.SubtractVV(k,f)));d=b.AddVV(d,b.CrossFV(e,b.SubtractVV(c,f)));this.SetLinearVelocity(k);g.SetLinearVelocity(d);this.SetAngularVelocity(e);g.SetAngularVelocity(e);
this.SynchronizeFixtures();g.SynchronizeFixtures();return g};p.prototype.Merge=function(b){var c;for(c=b.m_fixtureList;c;){var d=c.m_next;b.m_fixtureCount--;c.m_next=this.m_fixtureList;this.m_fixtureList=c;this.m_fixtureCount++;c.m_body=f;c=d}e.m_fixtureCount=0;var e=this,f=b;e.GetWorldCenter();f.GetWorldCenter();e.GetLinearVelocity().Copy();f.GetLinearVelocity().Copy();e.GetAngularVelocity();f.GetAngularVelocity();e.ResetMassData();this.SynchronizeFixtures()};p.prototype.GetMass=function(){return this.m_mass};
p.prototype.GetInertia=function(){return this.m_I};p.prototype.GetMassData=function(b){b.mass=this.m_mass;b.I=this.m_I;b.center.SetV(this.m_sweep.localCenter)};p.prototype.SetMassData=function(c){g.b2Assert(this.m_world.IsLocked()==!1);if(this.m_world.IsLocked()!=!0&&this.m_type==p.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=c.mass;if(this.m_mass<=0)this.m_mass=1;this.m_invMass=1/this.m_mass;if(c.I>0&&(this.m_flags&p.e_fixedRotationFlag)==0)this.m_I=c.I-this.m_mass*(c.center.x*
c.center.x+c.center.y*c.center.y),this.m_invI=1/this.m_I;var d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(c.center);this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}};p.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==
p.b2_staticBody||this.m_type==p.b2_kinematicBody)){for(var c=e.Make(0,0),d=this.m_fixtureList;d;d=d.m_next)if(d.m_density!=0){var f=d.GetMassData();this.m_mass+=f.mass;c.x+=f.center.x*f.mass;c.y+=f.center.y*f.mass;this.m_I+=f.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,c.x*=this.m_invMass,c.y*=this.m_invMass):this.m_invMass=this.m_mass=1;this.m_I>0&&(this.m_flags&p.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(c.x*c.x+c.y*c.y),this.m_I*=this.m_inertiaScale,g.b2Assert(this.m_I>0),this.m_invI=1/
this.m_I):this.m_invI=this.m_I=0;d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(c);this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}};p.prototype.GetWorldPoint=function(b){var c=this.m_xf.R,b=new e(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;
return b};p.prototype.GetWorldVector=function(c){return b.MulMV(this.m_xf.R,c)};p.prototype.GetLocalPoint=function(c){return b.MulXT(this.m_xf,c)};p.prototype.GetLocalVector=function(c){return b.MulTMV(this.m_xf.R,c)};p.prototype.GetLinearVelocityFromWorldPoint=function(b){return new e(this.m_linearVelocity.x-this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(b.x-this.m_sweep.c.x))};p.prototype.GetLinearVelocityFromLocalPoint=function(b){var c=this.m_xf.R,
b=new e(c.col1.x*b.x+c.col2.x*b.y,c.col1.y*b.x+c.col2.y*b.y);b.x+=this.m_xf.position.x;b.y+=this.m_xf.position.y;return new e(this.m_linearVelocity.x-this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(b.x-this.m_sweep.c.x))};p.prototype.GetLinearDamping=function(){return this.m_linearDamping};p.prototype.SetLinearDamping=function(b){b===void 0&&(b=0);this.m_linearDamping=b};p.prototype.GetAngularDamping=function(){return this.m_angularDamping};p.prototype.SetAngularDamping=
function(b){b===void 0&&(b=0);this.m_angularDamping=b};p.prototype.SetType=function(b){b===void 0&&(b=0);if(this.m_type!=b){this.m_type=b;this.ResetMassData();if(this.m_type==p.b2_staticBody)this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}};p.prototype.GetType=function(){return this.m_type};p.prototype.SetBullet=function(b){b?this.m_flags|=p.e_bulletFlag:this.m_flags&=
~p.e_bulletFlag};p.prototype.IsBullet=function(){return(this.m_flags&p.e_bulletFlag)==p.e_bulletFlag};p.prototype.SetSleepingAllowed=function(b){b?this.m_flags|=p.e_allowSleepFlag:(this.m_flags&=~p.e_allowSleepFlag,this.SetAwake(!0))};p.prototype.SetAwake=function(b){b?(this.m_flags|=p.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~p.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};p.prototype.IsAwake=function(){return(this.m_flags&
p.e_awakeFlag)==p.e_awakeFlag};p.prototype.SetFixedRotation=function(b){b?this.m_flags|=p.e_fixedRotationFlag:this.m_flags&=~p.e_fixedRotationFlag;this.ResetMassData()};p.prototype.IsFixedRotation=function(){return(this.m_flags&p.e_fixedRotationFlag)==p.e_fixedRotationFlag};p.prototype.SetActive=function(b){if(b!=this.IsActive()){var c;if(b){this.m_flags|=p.e_activeFlag;b=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(b,this.m_xf)}else{this.m_flags&=
~p.e_activeFlag;b=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(b);for(b=this.m_contactList;b;)c=b,b=b.next,this.m_world.m_contactManager.Destroy(c.contact);this.m_contactList=null}}};p.prototype.IsActive=function(){return(this.m_flags&p.e_activeFlag)==p.e_activeFlag};p.prototype.IsSleepingAllowed=function(){return(this.m_flags&p.e_allowSleepFlag)==p.e_allowSleepFlag};p.prototype.GetFixtureList=function(){return this.m_fixtureList};p.prototype.GetJointList=
function(){return this.m_jointList};p.prototype.GetControllerList=function(){return this.m_controllerList};p.prototype.GetContactList=function(){return this.m_contactList};p.prototype.GetNext=function(){return this.m_next};p.prototype.GetUserData=function(){return this.m_userData};p.prototype.SetUserData=function(b){this.m_userData=b};p.prototype.GetWorld=function(){return this.m_world};p.prototype.b2Body=function(b,c){this.m_flags=0;b.bullet&&(this.m_flags|=p.e_bulletFlag);b.fixedRotation&&(this.m_flags|=
p.e_fixedRotationFlag);b.allowSleep&&(this.m_flags|=p.e_allowSleepFlag);b.awake&&(this.m_flags|=p.e_awakeFlag);b.active&&(this.m_flags|=p.e_activeFlag);this.m_world=c;this.m_xf.position.SetV(b.position);this.m_xf.R.Set(b.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=b.angle;var d=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y;this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=
this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(b.linearVelocity);this.m_angularVelocity=b.angularVelocity;this.m_linearDamping=b.linearDamping;this.m_angularDamping=b.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=b.type;this.m_invMass=this.m_type==p.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=
0;this.m_inertiaScale=b.inertiaScale;this.m_userData=b.userData;this.m_fixtureList=null;this.m_fixtureCount=0};p.prototype.SynchronizeFixtures=function(){var b=p.s_xf1;b.R.Set(this.m_sweep.a0);var c=b.R,d=this.m_sweep.localCenter;b.position.x=this.m_sweep.c0.x-(c.col1.x*d.x+c.col2.x*d.y);b.position.y=this.m_sweep.c0.y-(c.col1.y*d.x+c.col2.y*d.y);d=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(d,b,this.m_xf)};p.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);
var b=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(b.col1.x*c.x+b.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(b.col1.y*c.x+b.col2.y*c.y)};p.prototype.ShouldCollide=function(b){if(this.m_type!=p.b2_dynamicBody&&b.m_type!=p.b2_dynamicBody)return!1;for(var c=this.m_jointList;c;c=c.next)if(c.other==b&&c.joint.m_collideConnected==!1)return!1;return!0};p.prototype.Advance=function(b){b===void 0&&(b=0);this.m_sweep.Advance(b);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=
this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new d;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});x.b2BodyDef=function(){this.position=
new e;this.linearVelocity=new e};x.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=p.b2_staticBody;this.active=!0;this.inertiaScale=1};H.b2ContactFilter=function(){};H.prototype.ShouldCollide=function(b,c){var d=b.GetFilterData(),e=c.GetFilterData();if(d.groupIndex==e.groupIndex&&d.groupIndex!=0)return d.groupIndex>
0;return!0};H.prototype.RayCollide=function(b,c){if(!b)return!0;return this.ShouldCollide(b instanceof M?b:null,c)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new H});B.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(g.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(g.b2_maxManifoldPoints)};I.b2ContactListener=function(){};I.prototype.BeginContact=function(){};I.prototype.EndContact=function(){};I.prototype.PreSolve=function(){};
I.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new I});D.b2ContactManager=function(){};D.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=H.b2_defaultFilter;this.m_contactListener=I.b2_defaultListener;this.m_contactFactory=new P(this.m_allocator);this.m_broadPhase=new m};D.prototype.AddPair=function(b,c){var d=b instanceof M?b:null,e=c instanceof M?c:null,f=d.GetBody(),g=e.GetBody();
if(f!=g){for(var k=g.GetContactList();k;){if(k.other==f){var h=k.contact.GetFixtureA(),j=k.contact.GetFixtureB();if(h==d&&j==e)return;if(h==e&&j==d)return}k=k.next}if(g.ShouldCollide(f)!=!1&&this.m_contactFilter.ShouldCollide(d,e)!=!1){k=this.m_contactFactory.Create(d,e);d=k.GetFixtureA();e=k.GetFixtureB();f=d.m_body;g=e.m_body;k.m_prev=null;k.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=k;this.m_world.m_contactList=k;k.m_nodeA.contact=k;
k.m_nodeA.other=g;k.m_nodeA.prev=null;k.m_nodeA.next=f.m_contactList;if(f.m_contactList!=null)f.m_contactList.prev=k.m_nodeA;f.m_contactList=k.m_nodeA;k.m_nodeB.contact=k;k.m_nodeB.other=f;k.m_nodeB.prev=null;k.m_nodeB.next=g.m_contactList;if(g.m_contactList!=null)g.m_contactList.prev=k.m_nodeB;g.m_contactList=k.m_nodeB;++this.m_world.m_contactCount}}};D.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};D.prototype.Destroy=function(b){var c=
b.GetFixtureA(),d=b.GetFixtureB(),c=c.GetBody(),d=d.GetBody();b.IsTouching()&&this.m_contactListener.EndContact(b);if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_world.m_contactList)this.m_world.m_contactList=b.m_next;if(b.m_nodeA.prev)b.m_nodeA.prev.next=b.m_nodeA.next;if(b.m_nodeA.next)b.m_nodeA.next.prev=b.m_nodeA.prev;if(b.m_nodeA==c.m_contactList)c.m_contactList=b.m_nodeA.next;if(b.m_nodeB.prev)b.m_nodeB.prev.next=b.m_nodeB.next;if(b.m_nodeB.next)b.m_nodeB.next.prev=
b.m_nodeB.prev;if(b.m_nodeB==d.m_contactList)d.m_contactList=b.m_nodeB.next;this.m_contactFactory.Destroy(b);--this.m_contactCount};D.prototype.Collide=function(){for(var b=this.m_world.m_contactList;b;){var c=b.GetFixtureA(),d=b.GetFixtureB(),e=c.GetBody(),f=d.GetBody();if(e.IsAwake()==!1&&f.IsAwake()==!1)b=b.GetNext();else{if(b.m_flags&k.e_filterFlag){if(f.ShouldCollide(e)==!1){c=b;b=c.GetNext();this.Destroy(c);continue}if(this.m_contactFilter.ShouldCollide(c,d)==!1){c=b;b=c.GetNext();this.Destroy(c);
continue}b.m_flags&=~k.e_filterFlag}this.m_broadPhase.TestOverlap(c.m_proxy,d.m_proxy)==!1?(c=b,b=c.GetNext(),this.Destroy(c)):(b.Update(this.m_contactListener),b=b.GetNext())}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new j});F.b2DebugDraw=function(){};F.prototype.b2DebugDraw=function(){};F.prototype.SetFlags=function(){};F.prototype.GetFlags=function(){};F.prototype.AppendFlags=function(){};F.prototype.ClearFlags=function(){};F.prototype.SetSprite=function(){};F.prototype.GetSprite=
function(){};F.prototype.SetDrawScale=function(){};F.prototype.GetDrawScale=function(){};F.prototype.SetLineThickness=function(){};F.prototype.GetLineThickness=function(){};F.prototype.SetAlpha=function(){};F.prototype.GetAlpha=function(){};F.prototype.SetFillAlpha=function(){};F.prototype.GetFillAlpha=function(){};F.prototype.SetXFormScale=function(){};F.prototype.GetXFormScale=function(){};F.prototype.DrawPolygon=function(){};F.prototype.DrawSolidPolygon=function(){};F.prototype.DrawCircle=function(){};
F.prototype.DrawSolidCircle=function(){};F.prototype.DrawSegment=function(){};F.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});T.b2DestructionListener=function(){};T.prototype.SayGoodbyeJoint=function(){};T.prototype.SayGoodbyeFixture=
function(){};L.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};L.prototype.Copy=function(){var b=new L;b.categoryBits=this.categoryBits;b.maskBits=this.maskBits;b.groupIndex=this.groupIndex;return b};M.b2Fixture=function(){this.m_filter=new L};M.prototype.GetType=function(){return this.m_shape.GetType()};M.prototype.GetShape=function(){return this.m_shape};M.prototype.SetSensor=function(b){if(this.m_isSensor!=b&&(this.m_isSensor=b,this.m_body!=null))for(b=this.m_body.GetContactList();b;){var c=
b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();if(d==this||e==this)c.SetSensor(d.IsSensor()||e.IsSensor());b=b.next}};M.prototype.IsSensor=function(){return this.m_isSensor};M.prototype.SetFilterData=function(b){this.m_filter=b.Copy();if(!this.m_body)for(b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d==this||e==this)&&c.FlagForFiltering();b=b.next}};M.prototype.GetFilterData=function(){return this.m_filter.Copy()};M.prototype.GetBody=function(){return this.m_body};
M.prototype.GetNext=function(){return this.m_next};M.prototype.GetUserData=function(){return this.m_userData};M.prototype.SetUserData=function(b){this.m_userData=b};M.prototype.TestPoint=function(b){return this.m_shape.TestPoint(this.m_body.GetTransform(),b)};M.prototype.RayCast=function(b,c){return this.m_shape.RayCast(b,c,this.m_body.GetTransform())};M.prototype.GetMassData=function(b){b===void 0&&(b=null);b==null&&(b=new u);this.m_shape.ComputeMass(b,this.m_density);return b};M.prototype.SetDensity=
function(b){b===void 0&&(b=0);this.m_density=b};M.prototype.GetDensity=function(){return this.m_density};M.prototype.GetFriction=function(){return this.m_friction};M.prototype.SetFriction=function(b){b===void 0&&(b=0);this.m_friction=b};M.prototype.GetRestitution=function(){return this.m_restitution};M.prototype.SetRestitution=function(b){b===void 0&&(b=0);this.m_restitution=b};M.prototype.GetAABB=function(){return this.m_aabb};M.prototype.b2Fixture=function(){this.m_aabb=new h;this.m_shape=this.m_next=
this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};M.prototype.Create=function(b,c,d){this.m_userData=d.userData;this.m_friction=d.friction;this.m_restitution=d.restitution;this.m_body=b;this.m_next=null;this.m_filter=d.filter.Copy();this.m_isSensor=d.isSensor;this.m_shape=d.shape.Copy();this.m_density=d.density};M.prototype.Destroy=function(){this.m_shape=null};M.prototype.CreateProxy=function(b,c){this.m_shape.ComputeAABB(this.m_aabb,c);this.m_proxy=b.CreateProxy(this.m_aabb,
this)};M.prototype.DestroyProxy=function(b){if(this.m_proxy!=null)b.DestroyProxy(this.m_proxy),this.m_proxy=null};M.prototype.Synchronize=function(c,d,e){if(this.m_proxy){var f=new h,g=new h;this.m_shape.ComputeAABB(f,d);this.m_shape.ComputeAABB(g,e);this.m_aabb.Combine(f,g);d=b.SubtractVV(e.position,d.position);c.MoveProxy(this.m_proxy,this.m_aabb,d)}};N.b2FixtureDef=function(){this.filter=new L};N.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=
0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};S.b2Island=function(){};S.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};S.prototype.Initialize=function(b,c,d,e,f,g){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=0);var k=0;this.m_bodyCapacity=b;this.m_contactCapacity=c;this.m_jointCapacity=d;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=e;this.m_listener=
f;this.m_contactSolver=g;for(k=this.m_bodies.length;k<b;k++)this.m_bodies[k]=null;for(k=this.m_contacts.length;k<c;k++)this.m_contacts[k]=null;for(k=this.m_joints.length;k<d;k++)this.m_joints[k]=null};S.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};S.prototype.Solve=function(c,d,e){for(var f=0,k=0,h,f=0;f<this.m_bodyCount;++f)k=this.m_bodies[f],k.GetType()==p.b2_dynamicBody&&(k.m_linearVelocity.x+=c.dt*(d.x+k.m_invMass*k.m_force.x),k.m_linearVelocity.y+=c.dt*
(d.y+k.m_invMass*k.m_force.y),k.m_angularVelocity+=c.dt*k.m_invI*k.m_torque,k.m_linearVelocity.Multiply(b.Clamp(1-c.dt*k.m_linearDamping,0,1)),k.m_angularVelocity*=b.Clamp(1-c.dt*k.m_angularDamping,0,1));this.m_contactSolver.Initialize(c,this.m_contacts,this.m_contactCount,this.m_allocator);d=this.m_contactSolver;d.InitVelocityConstraints(c);for(f=0;f<this.m_jointCount;++f)h=this.m_joints[f],h.InitVelocityConstraints(c);for(f=0;f<c.velocityIterations;++f){for(k=0;k<this.m_jointCount;++k)h=this.m_joints[k],
h.SolveVelocityConstraints(c);d.SolveVelocityConstraints()}for(f=0;f<this.m_jointCount;++f)h=this.m_joints[f],h.FinalizeVelocityConstraints();d.FinalizeVelocityConstraints();for(f=0;f<this.m_bodyCount;++f)if(k=this.m_bodies[f],k.GetType()!=p.b2_staticBody){var j=c.dt*k.m_linearVelocity.x,v=c.dt*k.m_linearVelocity.y;j*j+v*v>g.b2_maxTranslationSquared&&(k.m_linearVelocity.Normalize(),k.m_linearVelocity.x*=g.b2_maxTranslation*c.inv_dt,k.m_linearVelocity.y*=g.b2_maxTranslation*c.inv_dt);j=c.dt*k.m_angularVelocity;
if(j*j>g.b2_maxRotationSquared)k.m_angularVelocity=k.m_angularVelocity<0?-g.b2_maxRotation*c.inv_dt:g.b2_maxRotation*c.inv_dt;k.m_sweep.c0.SetV(k.m_sweep.c);k.m_sweep.a0=k.m_sweep.a;k.m_sweep.c.x+=c.dt*k.m_linearVelocity.x;k.m_sweep.c.y+=c.dt*k.m_linearVelocity.y;k.m_sweep.a+=c.dt*k.m_angularVelocity;k.SynchronizeTransform()}for(f=0;f<c.positionIterations;++f){j=d.SolvePositionConstraints(g.b2_contactBaumgarte);v=!0;for(k=0;k<this.m_jointCount;++k)h=this.m_joints[k],h=h.SolvePositionConstraints(g.b2_contactBaumgarte),
v=v&&h;if(j&&v)break}this.Report(d.m_constraints);if(e){e=Number.MAX_VALUE;d=g.b2_linearSleepTolerance*g.b2_linearSleepTolerance;j=g.b2_angularSleepTolerance*g.b2_angularSleepTolerance;for(f=0;f<this.m_bodyCount;++f)if(k=this.m_bodies[f],k.GetType()!=p.b2_staticBody){if((k.m_flags&p.e_allowSleepFlag)==0)e=k.m_sleepTime=0;(k.m_flags&p.e_allowSleepFlag)==0||k.m_angularVelocity*k.m_angularVelocity>j||b.Dot(k.m_linearVelocity,k.m_linearVelocity)>d?e=k.m_sleepTime=0:(k.m_sleepTime+=c.dt,e=b.Min(e,k.m_sleepTime))}if(e>=
g.b2_timeToSleep)for(f=0;f<this.m_bodyCount;++f)k=this.m_bodies[f],k.SetAwake(!1)}};S.prototype.SolveTOI=function(b){var c=0,d=0;this.m_contactSolver.Initialize(b,this.m_contacts,this.m_contactCount,this.m_allocator);for(var e=this.m_contactSolver,c=0;c<this.m_jointCount;++c)this.m_joints[c].InitVelocityConstraints(b);for(c=0;c<b.velocityIterations;++c){e.SolveVelocityConstraints();for(d=0;d<this.m_jointCount;++d)this.m_joints[d].SolveVelocityConstraints(b)}for(c=0;c<this.m_bodyCount;++c)if(d=this.m_bodies[c],
d.GetType()!=p.b2_staticBody){var f=b.dt*d.m_linearVelocity.x,k=b.dt*d.m_linearVelocity.y;f*f+k*k>g.b2_maxTranslationSquared&&(d.m_linearVelocity.Normalize(),d.m_linearVelocity.x*=g.b2_maxTranslation*b.inv_dt,d.m_linearVelocity.y*=g.b2_maxTranslation*b.inv_dt);f=b.dt*d.m_angularVelocity;if(f*f>g.b2_maxRotationSquared)d.m_angularVelocity=d.m_angularVelocity<0?-g.b2_maxRotation*b.inv_dt:g.b2_maxRotation*b.inv_dt;d.m_sweep.c0.SetV(d.m_sweep.c);d.m_sweep.a0=d.m_sweep.a;d.m_sweep.c.x+=b.dt*d.m_linearVelocity.x;
d.m_sweep.c.y+=b.dt*d.m_linearVelocity.y;d.m_sweep.a+=b.dt*d.m_angularVelocity;d.SynchronizeTransform()}for(c=0;c<b.positionIterations;++c){f=e.SolvePositionConstraints(0.75);k=!0;for(d=0;d<this.m_jointCount;++d)var h=this.m_joints[d].SolvePositionConstraints(g.b2_contactBaumgarte),k=k&&h;if(f&&k)break}this.Report(e.m_constraints)};S.prototype.Report=function(b){if(this.m_listener!=null)for(var c=0;c<this.m_contactCount;++c){for(var d=this.m_contacts[c],e=b[c],f=0;f<e.pointCount;++f)S.s_impulse.normalImpulses[f]=
e.points[f].normalImpulse,S.s_impulse.tangentImpulses[f]=e.points[f].tangentImpulse;this.m_listener.PostSolve(d,S.s_impulse)}};S.prototype.AddBody=function(b){b.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=b};S.prototype.AddContact=function(b){this.m_contacts[this.m_contactCount++]=b};S.prototype.AddJoint=function(b){this.m_joints[this.m_jointCount++]=b};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new B});v.b2TimeStep=function(){};v.prototype.Set=function(b){this.dt=
b.dt;this.inv_dt=b.inv_dt;this.positionIterations=b.positionIterations;this.velocityIterations=b.velocityIterations;this.warmStarting=b.warmStarting};J.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new D;this.m_contactSolver=new K;this.m_island=new S};J.prototype.b2World=function(b,c){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=
0;J.m_warmStarting=!0;J.m_continuousPhysics=!0;this.m_allowSleep=c;this.m_gravity=b;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new x)};J.prototype.SetDestructionListener=function(b){this.m_destructionListener=b};J.prototype.SetContactFilter=function(b){this.m_contactManager.m_contactFilter=b};J.prototype.SetContactListener=function(b){this.m_contactManager.m_contactListener=b};J.prototype.SetDebugDraw=function(b){this.m_debugDraw=b};J.prototype.SetBroadPhase=
function(b){var c=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=b;for(var d=this.m_bodyList;d;d=d.m_next)for(var e=d.m_fixtureList;e;e=e.m_next)e.m_proxy=b.CreateProxy(c.GetFatAABB(e.m_proxy),e)};J.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};J.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};J.prototype.CreateBody=function(b){if(this.IsLocked()==!0)return null;b=new p(b,this);b.m_prev=null;if(b.m_next=
this.m_bodyList)this.m_bodyList.m_prev=b;this.m_bodyList=b;++this.m_bodyCount;return b};J.prototype.DestroyBody=function(b){if(this.IsLocked()!=!0){for(var c=b.m_jointList;c;){var d=c,c=c.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(d.joint);this.DestroyJoint(d.joint)}for(c=b.m_controllerList;c;)d=c,c=c.nextController,d.controller.RemoveBody(b);for(c=b.m_contactList;c;)d=c,c=c.next,this.m_contactManager.Destroy(d.contact);b.m_contactList=null;for(c=b.m_fixtureList;c;)d=
c,c=c.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(d),d.DestroyProxy(this.m_contactManager.m_broadPhase),d.Destroy();b.m_fixtureList=null;b.m_fixtureCount=0;if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_bodyList)this.m_bodyList=b.m_next;--this.m_bodyCount}};J.prototype.CreateJoint=function(b){var c=U.Create(b,null);c.m_prev=null;if(c.m_next=this.m_jointList)this.m_jointList.m_prev=c;this.m_jointList=c;++this.m_jointCount;
c.m_edgeA.joint=c;c.m_edgeA.other=c.m_bodyB;c.m_edgeA.prev=null;if(c.m_edgeA.next=c.m_bodyA.m_jointList)c.m_bodyA.m_jointList.prev=c.m_edgeA;c.m_bodyA.m_jointList=c.m_edgeA;c.m_edgeB.joint=c;c.m_edgeB.other=c.m_bodyA;c.m_edgeB.prev=null;if(c.m_edgeB.next=c.m_bodyB.m_jointList)c.m_bodyB.m_jointList.prev=c.m_edgeB;c.m_bodyB.m_jointList=c.m_edgeB;var d=b.bodyA,e=b.bodyB;if(b.collideConnected==!1)for(b=e.GetContactList();b;)b.other==d&&b.contact.FlagForFiltering(),b=b.next;return c};J.prototype.DestroyJoint=
function(b){var c=b.m_collideConnected;if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=b.m_prev;if(b==this.m_jointList)this.m_jointList=b.m_next;var d=b.m_bodyA,e=b.m_bodyB;d.SetAwake(!0);e.SetAwake(!0);if(b.m_edgeA.prev)b.m_edgeA.prev.next=b.m_edgeA.next;if(b.m_edgeA.next)b.m_edgeA.next.prev=b.m_edgeA.prev;if(b.m_edgeA==d.m_jointList)d.m_jointList=b.m_edgeA.next;b.m_edgeA.prev=null;b.m_edgeA.next=null;if(b.m_edgeB.prev)b.m_edgeB.prev.next=b.m_edgeB.next;if(b.m_edgeB.next)b.m_edgeB.next.prev=
b.m_edgeB.prev;if(b.m_edgeB==e.m_jointList)e.m_jointList=b.m_edgeB.next;b.m_edgeB.prev=null;b.m_edgeB.next=null;U.Destroy(b,null);--this.m_jointCount;if(c==!1)for(b=e.GetContactList();b;)b.other==d&&b.contact.FlagForFiltering(),b=b.next};J.prototype.AddController=function(b){b.m_next=this.m_controllerList;b.m_prev=null;this.m_controllerList=b;b.m_world=this;this.m_controllerCount++;return b};J.prototype.RemoveController=function(b){if(b.m_prev)b.m_prev.m_next=b.m_next;if(b.m_next)b.m_next.m_prev=
b.m_prev;if(this.m_controllerList==b)this.m_controllerList=b.m_next;this.m_controllerCount--};J.prototype.CreateController=function(b){if(b.m_world!=this)throw Error("Controller can only be a member of one world");b.m_next=this.m_controllerList;b.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=b;this.m_controllerList=b;++this.m_controllerCount;b.m_world=this;return b};J.prototype.DestroyController=function(b){b.Clear();if(b.m_next)b.m_next.m_prev=b.m_prev;if(b.m_prev)b.m_prev.m_next=
b.m_next;if(b==this.m_controllerList)this.m_controllerList=b.m_next;--this.m_controllerCount};J.prototype.SetWarmStarting=function(b){J.m_warmStarting=b};J.prototype.SetContinuousPhysics=function(b){J.m_continuousPhysics=b};J.prototype.GetBodyCount=function(){return this.m_bodyCount};J.prototype.GetJointCount=function(){return this.m_jointCount};J.prototype.GetContactCount=function(){return this.m_contactCount};J.prototype.SetGravity=function(b){this.m_gravity=b};J.prototype.GetGravity=function(){return this.m_gravity};
J.prototype.GetGroundBody=function(){return this.m_groundBody};J.prototype.Step=function(b,c,d){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=0);this.m_flags&J.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~J.e_newFixture);this.m_flags|=J.e_locked;var e=J.s_timestep2;e.dt=b;e.velocityIterations=c;e.positionIterations=d;e.inv_dt=b>0?1/b:0;e.dtRatio=this.m_inv_dt0*b;e.warmStarting=J.m_warmStarting;this.m_contactManager.Collide();e.dt>0&&this.Solve(e);J.m_continuousPhysics&&
e.dt>0&&this.SolveTOI(e);if(e.dt>0)this.m_inv_dt0=e.inv_dt;this.m_flags&=~J.e_locked};J.prototype.ClearForces=function(){for(var b=this.m_bodyList;b;b=b.m_next)b.m_force.SetZero(),b.m_torque=0};J.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var b=this.m_debugDraw.GetFlags(),c,d,g;new e;new e;new e;var k;new h;new h;k=[new e,new e,new e,new e];var j=new f(0,0,0);if(b&F.e_shapeBit)for(c=this.m_bodyList;c;c=c.m_next){k=c.m_xf;for(d=c.GetFixtureList();d;d=
d.m_next)g=d.GetShape(),c.IsActive()==!1?j.Set(0.5,0.5,0.3):c.GetType()==p.b2_staticBody?j.Set(0.5,0.9,0.5):c.GetType()==p.b2_kinematicBody?j.Set(0.5,0.5,0.9):c.IsAwake()==!1?j.Set(0.6,0.6,0.6):j.Set(0.9,0.7,0.7),this.DrawShape(g,k,j)}if(b&F.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(b&F.e_controllerBit)for(c=this.m_controllerList;c;c=c.m_next)c.Draw(this.m_debugDraw);if(b&F.e_pairBit){j.Set(0.3,0.9,0.9);for(c=this.m_contactManager.m_contactList;c;c=c.GetNext())g=c.GetFixtureA(),
d=c.GetFixtureB(),g=g.GetAABB().GetCenter(),d=d.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(g,d,j)}if(b&F.e_aabbBit){g=this.m_contactManager.m_broadPhase;k=[new e,new e,new e,new e];for(c=this.m_bodyList;c;c=c.GetNext())if(c.IsActive()!=!1)for(d=c.GetFixtureList();d;d=d.GetNext()){var v=g.GetFatAABB(d.m_proxy);k[0].Set(v.lowerBound.x,v.lowerBound.y);k[1].Set(v.upperBound.x,v.lowerBound.y);k[2].Set(v.upperBound.x,v.upperBound.y);k[3].Set(v.lowerBound.x,v.upperBound.y);this.m_debugDraw.DrawPolygon(k,
4,j)}}if(b&F.e_centerOfMassBit)for(c=this.m_bodyList;c;c=c.m_next)k=J.s_xf,k.R=c.m_xf.R,k.position=c.GetWorldCenter(),this.m_debugDraw.DrawTransform(k);for(c=this.m_bodyList;c;c=c.m_next)c.m_userData&&c.m_userData.drawCustom&&c.m_userData.drawCustom(this)}};J.prototype.QueryAABB=function(b,c){var d=this.m_contactManager.m_broadPhase;d.Query(function(c){return b(d.GetUserData(c))},c)};J.prototype.QueryShape=function(b,c,e){e===void 0&&(e=null);e==null&&(e=new d,e.SetIdentity());var f=this.m_contactManager.m_broadPhase,
g=new h;c.ComputeAABB(g,e);f.Query(function(d){d=f.GetUserData(d)instanceof M?f.GetUserData(d):null;if(C.TestOverlap(c,e,d.GetShape(),d.GetBody().GetTransform()))return b(d);return!0},g)};J.prototype.QueryPoint=function(b,c){var d=this.m_contactManager.m_broadPhase,e=new h;e.lowerBound.Set(c.x-g.b2_linearSlop,c.y-g.b2_linearSlop);e.upperBound.Set(c.x+g.b2_linearSlop,c.y+g.b2_linearSlop);d.Query(function(e){e=d.GetUserData(e)instanceof M?d.GetUserData(e):null;if(e.TestPoint(c))return b(e);return!0},
e)};J.prototype.RayCast=function(b,c,d){var f=this.m_contactManager.m_broadPhase,g=new t,k=new n(c,d);f.RayCast(function(k,h){var j=f.GetUserData(h),j=j instanceof M?j:null;if(j.RayCast(g,k)){var v=g.fraction,m=new e((1-v)*c.x+v*d.x,(1-v)*c.y+v*d.y);return b(j,m,g.normal,v)}return k.maxFraction},k)};J.prototype.RayCastOne=function(b,c){var d;this.RayCast(function(b,c,e,f){f===void 0&&(f=0);d=b;return f},b,c);return d};J.prototype.RayCastAll=function(b,c){var d=new Vector;this.RayCast(function(b){d[d.length]=
b;return 1},b,c);return d};J.prototype.GetBodyList=function(){return this.m_bodyList};J.prototype.GetJointList=function(){return this.m_jointList};J.prototype.GetContactList=function(){return this.m_contactList};J.prototype.IsLocked=function(){return(this.m_flags&J.e_locked)>0};J.prototype.Solve=function(b){for(var c,d=this.m_controllerList;d;d=d.m_next)d.Step(b);d=this.m_island;d.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);
for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~p.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~k.e_islandFlag;for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var e=this.s_stack,f=this.m_bodyList;f;f=f.m_next)if(!(f.m_flags&p.e_islandFlag)&&!(f.IsAwake()==!1||f.IsActive()==!1)&&f.GetType()!=p.b2_staticBody){d.Clear();var g=0;e[g++]=f;for(f.m_flags|=p.e_islandFlag;g>0;)if(c=e[--g],d.AddBody(c),c.IsAwake()==!1&&c.SetAwake(!0),c.GetType()!=p.b2_staticBody){for(var h,
j=c.m_contactList;j;j=j.next)if(!(j.contact.m_flags&k.e_islandFlag)&&!(j.contact.IsSensor()==!0||j.contact.IsEnabled()==!1||j.contact.IsTouching()==!1))d.AddContact(j.contact),j.contact.m_flags|=k.e_islandFlag,h=j.other,h.m_flags&p.e_islandFlag||(e[g++]=h,h.m_flags|=p.e_islandFlag);for(c=c.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=!0&&(h=c.other,h.IsActive()!=!1))d.AddJoint(c.joint),c.joint.m_islandFlag=!0,h.m_flags&p.e_islandFlag||(e[g++]=h,h.m_flags|=p.e_islandFlag)}d.Solve(b,this.m_gravity,
this.m_allowSleep);for(g=0;g<d.m_bodyCount;++g)c=d.m_bodies[g],c.GetType()==p.b2_staticBody&&(c.m_flags&=~p.e_islandFlag)}for(g=0;g<e.length;++g){if(!e[g])break;e[g]=null}for(c=this.m_bodyList;c;c=c.m_next)c.IsAwake()==!1||c.IsActive()==!1||c.GetType()!=p.b2_staticBody&&c.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};J.prototype.SolveTOI=function(b){var c,d,e,f=this.m_island;f.Initialize(this.m_bodyCount,g.b2_maxTOIContactsPerIsland,g.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,
this.m_contactSolver);var h=J.s_queue;for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~p.e_islandFlag,c.m_sweep.t0=0;for(e=this.m_contactList;e;e=e.m_next)e.m_flags&=~(k.e_toiFlag|k.e_islandFlag);for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=!1;for(;;){var j=null,v=1;for(e=this.m_contactList;e;e=e.m_next)if(!(e.IsSensor()==!0||e.IsEnabled()==!1||e.IsContinuous()==!1)){c=1;if(e.m_flags&k.e_toiFlag)c=e.m_toi;else{c=e.m_fixtureA;d=e.m_fixtureB;c=c.m_body;d=d.m_body;if((c.GetType()!=p.b2_dynamicBody||
c.IsAwake()==!1)&&(d.GetType()!=p.b2_dynamicBody||d.IsAwake()==!1))continue;var m=c.m_sweep.t0;if(c.m_sweep.t0<d.m_sweep.t0)m=d.m_sweep.t0,c.m_sweep.Advance(m);else if(d.m_sweep.t0<c.m_sweep.t0)m=c.m_sweep.t0,d.m_sweep.Advance(m);c=e.ComputeTOI(c.m_sweep,d.m_sweep);g.b2Assert(0<=c&&c<=1);c>0&&c<1&&(c=(1-c)*m+c,c>1&&(c=1));e.m_toi=c;e.m_flags|=k.e_toiFlag}Number.MIN_VALUE<c&&c<v&&(j=e,v=c)}if(j==null||1-100*Number.MIN_VALUE<v)break;c=j.m_fixtureA;d=j.m_fixtureB;c=c.m_body;d=d.m_body;J.s_backupA.Set(c.m_sweep);
J.s_backupB.Set(d.m_sweep);c.Advance(v);d.Advance(v);j.Update(this.m_contactManager.m_contactListener);j.m_flags&=~k.e_toiFlag;if(j.IsSensor()==!0||j.IsEnabled()==!1)c.m_sweep.Set(J.s_backupA),d.m_sweep.Set(J.s_backupB),c.SynchronizeTransform(),d.SynchronizeTransform();else if(j.IsTouching()!=!1){c.GetType()!=p.b2_dynamicBody&&(c=d);f.Clear();j=e=0;h[e+j++]=c;for(c.m_flags|=p.e_islandFlag;j>0;)if(c=h[e++],--j,f.AddBody(c),c.IsAwake()==!1&&c.SetAwake(!0),c.GetType()==p.b2_dynamicBody){for(d=c.m_contactList;d;d=
d.next){if(f.m_contactCount==f.m_contactCapacity)break;if(!(d.contact.m_flags&k.e_islandFlag)&&!(d.contact.IsSensor()==!0||d.contact.IsEnabled()==!1||d.contact.IsTouching()==!1))f.AddContact(d.contact),d.contact.m_flags|=k.e_islandFlag,m=d.other,m.m_flags&p.e_islandFlag||(m.GetType()!=p.b2_staticBody&&(m.Advance(v),m.SetAwake(!0)),h[e+j]=m,++j,m.m_flags|=p.e_islandFlag)}for(c=c.m_jointList;c;c=c.next)if(f.m_jointCount!=f.m_jointCapacity&&c.joint.m_islandFlag!=!0&&(m=c.other,m.IsActive()!=!1))f.AddJoint(c.joint),
c.joint.m_islandFlag=!0,m.m_flags&p.e_islandFlag||(m.GetType()!=p.b2_staticBody&&(m.Advance(v),m.SetAwake(!0)),h[e+j]=m,++j,m.m_flags|=p.e_islandFlag)}e=J.s_timestep;e.warmStarting=!1;e.dt=(1-v)*b.dt;e.inv_dt=1/e.dt;e.dtRatio=0;e.velocityIterations=b.velocityIterations;e.positionIterations=b.positionIterations;f.SolveTOI(e);for(v=v=0;v<f.m_bodyCount;++v)if(c=f.m_bodies[v],c.m_flags&=~p.e_islandFlag,c.IsAwake()!=!1&&c.GetType()==p.b2_dynamicBody){c.SynchronizeFixtures();for(d=c.m_contactList;d;d=d.next)d.contact.m_flags&=
~k.e_toiFlag}for(v=0;v<f.m_contactCount;++v)e=f.m_contacts[v],e.m_flags&=~(k.e_toiFlag|k.e_islandFlag);for(v=0;v<f.m_jointCount;++v)e=f.m_joints[v],e.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};J.prototype.DrawJoint=function(b){var c=b.GetBodyA(),d=b.GetBodyB(),e=c.m_xf.position,f=d.m_xf.position,g=b.GetAnchorA(),k=b.GetAnchorB(),h=J.s_jointColor;switch(b.m_type){case U.e_distanceJoint:this.m_debugDraw.DrawSegment(g,k,h);break;case U.e_pulleyJoint:c=b instanceof O?b:null;b=c.GetGroundAnchorA();
c=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(b,g,h);this.m_debugDraw.DrawSegment(c,k,h);this.m_debugDraw.DrawSegment(b,c,h);break;case U.e_mouseJoint:this.m_debugDraw.DrawSegment(g,k,h);break;default:c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e,g,h),this.m_debugDraw.DrawSegment(g,k,h),d!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,k,h)}};J.prototype.DrawShape=function(c,d,e){switch(c.m_type){case C.e_circleShape:var f=c instanceof o?c:null;this.m_debugDraw.DrawSolidCircle(b.MulX(d,
f.m_p),f.m_radius,d.R.col1,e);break;case C.e_polygonShape:for(var f=0,f=c instanceof A?c:null,c=parseInt(f.GetVertexCount()),g=f.GetVertices(),k=new Vector(c),f=0;f<c;++f)k[f]=b.MulX(d,g[f]);this.m_debugDraw.DrawSolidPolygon(k,c,e);break;case C.e_edgeShape:f=c instanceof w?c:null,this.m_debugDraw.DrawSegment(b.MulX(d,f.GetVertex1()),b.MulX(d,f.GetVertex2()),e)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new v;Box2D.Dynamics.b2World.s_xf=new d;Box2D.Dynamics.b2World.s_backupA=
new c;Box2D.Dynamics.b2World.s_backupB=new c;Box2D.Dynamics.b2World.s_timestep=new v;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new f(0.5,0.8,0.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();
(function(){var b=Box2D.Collision.Shapes.b2CircleShape,c=Box2D.Collision.Shapes.b2EdgeShape,d=Box2D.Collision.Shapes.b2PolygonShape,e=Box2D.Collision.Shapes.b2Shape,f=Box2D.Dynamics.Contacts.b2CircleContact,g=Box2D.Dynamics.Contacts.b2Contact,h=Box2D.Dynamics.Contacts.b2ContactConstraint,j=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,m=Box2D.Dynamics.Contacts.b2ContactEdge,n=Box2D.Dynamics.Contacts.b2ContactFactory,t=Box2D.Dynamics.Contacts.b2ContactRegister,o=Box2D.Dynamics.Contacts.b2ContactResult,
w=Box2D.Dynamics.Contacts.b2ContactSolver,u=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,A=Box2D.Dynamics.Contacts.b2NullContact,C=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,p=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,x=Box2D.Dynamics.Contacts.b2PolygonContact,H=Box2D.Dynamics.Contacts.b2PositionSolverManifold,B=Box2D.Dynamics.b2Body,I=Box2D.Dynamics.b2TimeStep,D=Box2D.Common.b2Settings,F=Box2D.Common.Math.b2Mat22,T=Box2D.Common.Math.b2Math,L=Box2D.Common.Math.b2Vec2,M=Box2D.Collision.b2Collision,
N=Box2D.Collision.b2ContactID,S=Box2D.Collision.b2Manifold,v=Box2D.Collision.b2TimeOfImpact,J=Box2D.Collision.b2TOIInput,k=Box2D.Collision.b2WorldManifold;Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact);f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;f.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};f.Create=function(){return new f};f.Destroy=function(){};f.prototype.Reset=function(b,c){this.__super.Reset.call(this,b,c)};f.prototype.Evaluate=
function(){var c=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody();M.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof b?this.m_fixtureA.GetShape():null,c.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,d.m_xf)};g.b2Contact=function(){this.m_nodeA=new m;this.m_nodeB=new m;this.m_manifold=new S;this.m_oldManifold=new S};g.prototype.GetManifold=function(){return this.m_manifold};g.prototype.GetWorldManifold=function(b){var c=this.m_fixtureA.GetBody(),
d=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape();b.Initialize(this.m_manifold,c.GetTransform(),e.m_radius,d.GetTransform(),f.m_radius)};g.prototype.IsTouching=function(){return(this.m_flags&g.e_touchingFlag)==g.e_touchingFlag};g.prototype.IsContinuous=function(){return(this.m_flags&g.e_continuousFlag)==g.e_continuousFlag};g.prototype.SetSensor=function(b){b?this.m_flags|=g.e_sensorFlag:this.m_flags&=~g.e_sensorFlag};g.prototype.IsSensor=function(){return(this.m_flags&
g.e_sensorFlag)==g.e_sensorFlag};g.prototype.SetEnabled=function(b){b?this.m_flags|=g.e_enabledFlag:this.m_flags&=~g.e_enabledFlag};g.prototype.IsEnabled=function(){return(this.m_flags&g.e_enabledFlag)==g.e_enabledFlag};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetFixtureA=function(){return this.m_fixtureA};g.prototype.GetFixtureB=function(){return this.m_fixtureB};g.prototype.FlagForFiltering=function(){this.m_flags|=g.e_filterFlag};g.prototype.b2Contact=function(){};g.prototype.Reset=
function(b,c){b===void 0&&(b=null);c===void 0&&(c=null);this.m_flags=g.e_enabledFlag;if(!b||!c)this.m_fixtureB=this.m_fixtureA=null;else{if(b.IsSensor()||c.IsSensor())this.m_flags|=g.e_sensorFlag;var d=b.GetBody(),e=c.GetBody();if(d.GetType()!=B.b2_dynamicBody||d.IsBullet()||e.GetType()!=B.b2_dynamicBody||e.IsBullet())this.m_flags|=g.e_continuousFlag;this.m_fixtureA=b;this.m_fixtureB=c;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=
null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};g.prototype.Update=function(b){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=g.e_enabledFlag;var d=!1,c=(this.m_flags&g.e_touchingFlag)==g.e_touchingFlag,f=this.m_fixtureA.m_body,k=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&g.e_sensorFlag)h&&(d=this.m_fixtureA.GetShape(),
h=this.m_fixtureB.GetShape(),f=f.GetTransform(),k=k.GetTransform(),d=e.TestOverlap(d,f,h,k)),this.m_manifold.m_pointCount=0;else{f.GetType()!=B.b2_dynamicBody||f.IsBullet()||k.GetType()!=B.b2_dynamicBody||k.IsBullet()?this.m_flags|=g.e_continuousFlag:this.m_flags&=~g.e_continuousFlag;if(h){this.Evaluate();d=this.m_manifold.m_pointCount>0;for(h=0;h<this.m_manifold.m_pointCount;++h){var j=this.m_manifold.m_points[h];j.m_normalImpulse=0;j.m_tangentImpulse=0;for(var v=j.m_id,m=0;m<this.m_oldManifold.m_pointCount;++m){var o=
this.m_oldManifold.m_points[m];if(o.m_id.key==v.key){j.m_normalImpulse=o.m_normalImpulse;j.m_tangentImpulse=o.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;d!=c&&(f.SetAwake(!0),k.SetAwake(!0))}d?this.m_flags|=g.e_touchingFlag:this.m_flags&=~g.e_touchingFlag;c==!1&&d==!0&&b.BeginContact(this);c==!0&&d==!1&&b.EndContact(this);(this.m_flags&g.e_sensorFlag)==0&&b.PreSolve(this,this.m_oldManifold)};g.prototype.Evaluate=function(){};g.prototype.ComputeTOI=function(b,c){g.s_input.proxyA.Set(this.m_fixtureA.GetShape());
g.s_input.proxyB.Set(this.m_fixtureB.GetShape());g.s_input.sweepA=b;g.s_input.sweepB=c;g.s_input.tolerance=D.b2_linearSlop;return v.TimeOfImpact(g.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=
64;Box2D.Dynamics.Contacts.b2Contact.s_input=new J});h.b2ContactConstraint=function(){this.localPlaneNormal=new L;this.localPoint=new L;this.normal=new L;this.normalMass=new F;this.K=new F};h.prototype.b2ContactConstraint=function(){this.points=new Vector(D.b2_maxManifoldPoints);for(var b=0;b<D.b2_maxManifoldPoints;b++)this.points[b]=new j};j.b2ContactConstraintPoint=function(){this.localPoint=new L;this.rA=new L;this.rB=new L};m.b2ContactEdge=function(){};n.b2ContactFactory=function(){};n.prototype.b2ContactFactory=
function(b){this.m_allocator=b;this.InitializeRegisters()};n.prototype.AddType=function(b,c,d,e){d===void 0&&(d=0);e===void 0&&(e=0);this.m_registers[d][e].createFcn=b;this.m_registers[d][e].destroyFcn=c;this.m_registers[d][e].primary=!0;if(d!=e)this.m_registers[e][d].createFcn=b,this.m_registers[e][d].destroyFcn=c,this.m_registers[e][d].primary=!1};n.prototype.InitializeRegisters=function(){this.m_registers=new Vector(e.e_shapeTypeCount);for(var b=0;b<e.e_shapeTypeCount;b++){this.m_registers[b]=
new Vector(e.e_shapeTypeCount);for(var c=0;c<e.e_shapeTypeCount;c++)this.m_registers[b][c]=new t}this.AddType(f.Create,f.Destroy,e.e_circleShape,e.e_circleShape);this.AddType(C.Create,C.Destroy,e.e_polygonShape,e.e_circleShape);this.AddType(x.Create,x.Destroy,e.e_polygonShape,e.e_polygonShape);this.AddType(u.Create,u.Destroy,e.e_edgeShape,e.e_circleShape);this.AddType(p.Create,p.Destroy,e.e_polygonShape,e.e_edgeShape)};n.prototype.Create=function(b,c){var d=parseInt(b.GetType()),e=parseInt(c.GetType()),
d=this.m_registers[d][e];if(d.pool)return e=d.pool,d.pool=e.m_next,d.poolCount--,e.Reset(b,c),e;e=d.createFcn;return e!=null?(d.primary?(e=e(this.m_allocator),e.Reset(b,c)):(e=e(this.m_allocator),e.Reset(c,b)),e):null};n.prototype.Destroy=function(b){b.m_manifold.m_pointCount>0&&(b.m_fixtureA.m_body.SetAwake(!0),b.m_fixtureB.m_body.SetAwake(!0));var c=parseInt(b.m_fixtureA.GetType()),d=parseInt(b.m_fixtureB.GetType()),c=this.m_registers[c][d];c.poolCount++;b.m_next=c.pool;c.pool=b;c=c.destroyFcn;
c(b,this.m_allocator)};t.b2ContactRegister=function(){};o.b2ContactResult=function(){this.position=new L;this.normal=new L;this.id=new N};w.b2ContactSolver=function(){this.m_step=new I;this.m_constraints=new Vector};w.prototype.b2ContactSolver=function(){};w.prototype.Initialize=function(b,c,d,e){d===void 0&&(d=0);var f;this.m_step.Set(b);this.m_allocator=e;b=0;for(this.m_constraintCount=d;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new h;for(b=
0;b<d;++b){f=c[b];var e=f.m_fixtureA,g=f.m_fixtureB,k=e.m_shape.m_radius,j=g.m_shape.m_radius,v=e.m_body,m=g.m_body,o=f.GetManifold(),n=D.b2MixFriction(e.GetFriction(),g.GetFriction()),p=D.b2MixRestitution(e.GetRestitution(),g.GetRestitution()),u=v.m_linearVelocity.x,J=v.m_linearVelocity.y,t=m.m_linearVelocity.x,x=m.m_linearVelocity.y,A=v.m_angularVelocity,C=m.m_angularVelocity;D.b2Assert(o.m_pointCount>0);w.s_worldManifold.Initialize(o,v.m_xf,k,m.m_xf,j);g=w.s_worldManifold.m_normal.x;f=w.s_worldManifold.m_normal.y;
e=this.m_constraints[b];e.bodyA=v;e.bodyB=m;e.manifold=o;e.normal.x=g;e.normal.y=f;e.pointCount=o.m_pointCount;e.friction=n;e.restitution=p;e.localPlaneNormal.x=o.m_localPlaneNormal.x;e.localPlaneNormal.y=o.m_localPlaneNormal.y;e.localPoint.x=o.m_localPoint.x;e.localPoint.y=o.m_localPoint.y;e.radius=k+j;e.type=o.m_type;for(k=0;k<e.pointCount;++k){n=o.m_points[k];j=e.points[k];j.normalImpulse=n.m_normalImpulse;j.tangentImpulse=n.m_tangentImpulse;j.localPoint.SetV(n.m_localPoint);var n=j.rA.x=w.s_worldManifold.m_points[k].x-
v.m_sweep.c.x,p=j.rA.y=w.s_worldManifold.m_points[k].y-v.m_sweep.c.y,B=j.rB.x=w.s_worldManifold.m_points[k].x-m.m_sweep.c.x,H=j.rB.y=w.s_worldManifold.m_points[k].y-m.m_sweep.c.y,F=n*f-p*g,I=B*f-H*g;F*=F;I*=I;j.normalMass=1/(v.m_invMass+m.m_invMass+v.m_invI*F+m.m_invI*I);var L=v.m_mass*v.m_invMass+m.m_mass*m.m_invMass;L+=v.m_mass*v.m_invI*F+m.m_mass*m.m_invI*I;j.equalizedMass=1/L;I=f;L=-g;F=n*L-p*I;I=B*L-H*I;F*=F;I*=I;j.tangentMass=1/(v.m_invMass+m.m_invMass+v.m_invI*F+m.m_invI*I);j.velocityBias=
0;n=e.normal.x*(t+-C*H-u- -A*p)+e.normal.y*(x+C*B-J-A*n);n<-D.b2_velocityThreshold&&(j.velocityBias+=-e.restitution*n)}if(e.pointCount==2)x=e.points[0],t=e.points[1],o=v.m_invMass,v=v.m_invI,u=m.m_invMass,m=m.m_invI,J=x.rA.x*f-x.rA.y*g,x=x.rB.x*f-x.rB.y*g,A=t.rA.x*f-t.rA.y*g,t=t.rB.x*f-t.rB.y*g,g=o+u+v*J*J+m*x*x,f=o+u+v*A*A+m*t*t,m=o+u+v*J*A+m*x*t,g*g<100*(g*f-m*m)?(e.K.col1.Set(g,m),e.K.col2.Set(m,f),e.K.GetInverse(e.normalMass)):e.pointCount=1}};w.prototype.InitVelocityConstraints=function(b){for(var c=
0;c<this.m_constraintCount;++c){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_invMass,k=e.m_invI,h=f.m_invMass,j=f.m_invI,v=d.normal.x,m=d.normal.y,o=m,n=-v,p=0,u=0;if(b.warmStarting){u=d.pointCount;for(p=0;p<u;++p){var J=d.points[p];J.normalImpulse*=b.dtRatio;J.tangentImpulse*=b.dtRatio;var w=J.normalImpulse*v+J.tangentImpulse*o,t=J.normalImpulse*m+J.tangentImpulse*n;e.m_angularVelocity-=k*(J.rA.x*t-J.rA.y*w);e.m_linearVelocity.x-=g*w;e.m_linearVelocity.y-=g*t;f.m_angularVelocity+=j*(J.rB.x*
t-J.rB.y*w);f.m_linearVelocity.x+=h*w;f.m_linearVelocity.y+=h*t}}else{u=d.pointCount;for(p=0;p<u;++p)e=d.points[p],e.normalImpulse=0,e.tangentImpulse=0}}};w.prototype.SolveVelocityConstraints=function(){for(var b=0,c,d=0,e=0,f=0,g=e=e=d=d=0,k=d=d=0,h=d=f=0,j=0,v,m=0;m<this.m_constraintCount;++m){var f=this.m_constraints[m],o=f.bodyA,n=f.bodyB,p=o.m_angularVelocity,J=n.m_angularVelocity,u=o.m_linearVelocity,w=n.m_linearVelocity,t=o.m_invMass,x=o.m_invI,A=n.m_invMass,C=n.m_invI,h=f.normal.x,B=j=f.normal.y;
v=-h;k=f.friction;for(b=0;b<f.pointCount;b++)c=f.points[b],d=w.x-J*c.rB.y-u.x+p*c.rA.y,e=w.y+J*c.rB.x-u.y-p*c.rA.x,d=d*B+e*v,d=c.tangentMass*-d,e=k*c.normalImpulse,e=T.Clamp(c.tangentImpulse+d,-e,e),d=e-c.tangentImpulse,g=d*B,d*=v,u.x-=t*g,u.y-=t*d,p-=x*(c.rA.x*d-c.rA.y*g),w.x+=A*g,w.y+=A*d,J+=C*(c.rB.x*d-c.rB.y*g),c.tangentImpulse=e;parseInt(f.pointCount);if(f.pointCount==1)c=f.points[0],d=w.x+-J*c.rB.y-u.x- -p*c.rA.y,e=w.y+J*c.rB.x-u.y-p*c.rA.x,f=d*h+e*j,d=-c.normalMass*(f-c.velocityBias),e=c.normalImpulse+
d,e=e>0?e:0,d=e-c.normalImpulse,g=d*h,d*=j,u.x-=t*g,u.y-=t*d,p-=x*(c.rA.x*d-c.rA.y*g),w.x+=A*g,w.y+=A*d,J+=C*(c.rB.x*d-c.rB.y*g),c.normalImpulse=e;else{c=f.points[0];var b=f.points[1],d=c.normalImpulse,k=b.normalImpulse,D=(w.x-J*c.rB.y-u.x+p*c.rA.y)*h+(w.y+J*c.rB.x-u.y-p*c.rA.x)*j,F=(w.x-J*b.rB.y-u.x+p*b.rA.y)*h+(w.y+J*b.rB.x-u.y-p*b.rA.x)*j,e=D-c.velocityBias,g=F-b.velocityBias;v=f.K;e-=v.col1.x*d+v.col2.x*k;for(g-=v.col1.y*d+v.col2.y*k;;){v=f.normalMass;B=-(v.col1.x*e+v.col2.x*g);v=-(v.col1.y*e+
v.col2.y*g);if(B>=0&&v>=0){d=B-d;k=v-k;f=d*h;d*=j;h*=k;j*=k;u.x-=t*(f+h);u.y-=t*(d+j);p-=x*(c.rA.x*d-c.rA.y*f+b.rA.x*j-b.rA.y*h);w.x+=A*(f+h);w.y+=A*(d+j);J+=C*(c.rB.x*d-c.rB.y*f+b.rB.x*j-b.rB.y*h);c.normalImpulse=B;b.normalImpulse=v;break}B=-c.normalMass*e;v=0;F=f.K.col1.y*B+g;if(B>=0&&F>=0){d=B-d;k=v-k;f=d*h;d*=j;h*=k;j*=k;u.x-=t*(f+h);u.y-=t*(d+j);p-=x*(c.rA.x*d-c.rA.y*f+b.rA.x*j-b.rA.y*h);w.x+=A*(f+h);w.y+=A*(d+j);J+=C*(c.rB.x*d-c.rB.y*f+b.rB.x*j-b.rB.y*h);c.normalImpulse=B;b.normalImpulse=v;
break}B=0;v=-b.normalMass*g;D=f.K.col2.x*v+e;if(v>=0&&D>=0){d=B-d;k=v-k;f=d*h;d*=j;h*=k;j*=k;u.x-=t*(f+h);u.y-=t*(d+j);p-=x*(c.rA.x*d-c.rA.y*f+b.rA.x*j-b.rA.y*h);w.x+=A*(f+h);w.y+=A*(d+j);J+=C*(c.rB.x*d-c.rB.y*f+b.rB.x*j-b.rB.y*h);c.normalImpulse=B;b.normalImpulse=v;break}v=B=0;D=e;F=g;if(D>=0&&F>=0){d=B-d;k=v-k;f=d*h;d*=j;h*=k;j*=k;u.x-=t*(f+h);u.y-=t*(d+j);p-=x*(c.rA.x*d-c.rA.y*f+b.rA.x*j-b.rA.y*h);w.x+=A*(f+h);w.y+=A*(d+j);J+=C*(c.rB.x*d-c.rB.y*f+b.rB.x*j-b.rB.y*h);c.normalImpulse=B;b.normalImpulse=
v;break}break}}o.m_angularVelocity=p;n.m_angularVelocity=J}};w.prototype.FinalizeVelocityConstraints=function(){for(var b=0;b<this.m_constraintCount;++b)for(var c=this.m_constraints[b],d=c.manifold,e=0;e<c.pointCount;++e){var f=d.m_points[e],g=c.points[e];f.m_normalImpulse=g.normalImpulse;f.m_tangentImpulse=g.tangentImpulse}};w.prototype.SolvePositionConstraints=function(b){b===void 0&&(b=0);for(var c=0,d=0;d<this.m_constraintCount;d++){var e=this.m_constraints[d],f=e.bodyA,g=e.bodyB,k=f.m_mass*f.m_invMass,
h=f.m_mass*f.m_invI,j=g.m_mass*g.m_invMass,v=g.m_mass*g.m_invI;w.s_psm.Initialize(e);for(var m=w.s_psm.m_normal,o=0;o<e.pointCount;o++){var n=e.points[o],p=w.s_psm.m_points[o],J=w.s_psm.m_separations[o],u=p.x-f.m_sweep.c.x,t=p.y-f.m_sweep.c.y,x=p.x-g.m_sweep.c.x,p=p.y-g.m_sweep.c.y,c=c<J?c:J,J=T.Clamp(b*(J+D.b2_linearSlop),-D.b2_maxLinearCorrection,0);J*=-n.equalizedMass;n=J*m.x;J*=m.y;f.m_sweep.c.x-=k*n;f.m_sweep.c.y-=k*J;f.m_sweep.a-=h*(u*J-t*n);f.SynchronizeTransform();g.m_sweep.c.x+=j*n;g.m_sweep.c.y+=
j*J;g.m_sweep.a+=v*(x*J-p*n);g.SynchronizeTransform()}}return c>-1.5*D.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new k;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new H});Box2D.inherit(u,Box2D.Dynamics.Contacts.b2Contact);u.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;u.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};u.Create=function(){return new u};u.Destroy=function(){};
u.prototype.Reset=function(b,c){this.__super.Reset.call(this,b,c)};u.prototype.Evaluate=function(){var d=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,d.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,e.m_xf)};u.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(A,Box2D.Dynamics.Contacts.b2Contact);A.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
A.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};A.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};A.prototype.Evaluate=function(){};Box2D.inherit(C,Box2D.Dynamics.Contacts.b2Contact);C.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;C.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};C.Create=function(){return new C};C.Destroy=function(){};C.prototype.Reset=function(b,
c){this.__super.Reset.call(this,b,c);D.b2Assert(b.GetType()==e.e_polygonShape);D.b2Assert(c.GetType()==e.e_circleShape)};C.prototype.Evaluate=function(){var c=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body;M.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,c.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,e.m_xf)};Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact);p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
p.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};p.Create=function(){return new p};p.Destroy=function(){};p.prototype.Reset=function(b,c){this.__super.Reset.call(this,b,c);D.b2Assert(b.GetType()==e.e_polygonShape);D.b2Assert(c.GetType()==e.e_edgeShape)};p.prototype.Evaluate=function(){var b=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():
null,b.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,e.m_xf)};p.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(x,Box2D.Dynamics.Contacts.b2Contact);x.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;x.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};x.Create=function(){return new x};x.Destroy=function(){};x.prototype.Reset=function(b,c){this.__super.Reset.call(this,b,c)};x.prototype.Evaluate=function(){var b=
this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();M.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof d?this.m_fixtureB.GetShape():null,c.m_xf)};H.b2PositionSolverManifold=function(){};H.prototype.b2PositionSolverManifold=function(){this.m_normal=new L;this.m_separations=new Vector_a2j_Number(D.b2_maxManifoldPoints);this.m_points=new Vector(D.b2_maxManifoldPoints);for(var b=0;b<D.b2_maxManifoldPoints;b++)this.m_points[b]=
new L};H.prototype.Initialize=function(b){D.b2Assert(b.pointCount>0);var c=0,d=0,e=0,f,g=0,k=0;switch(b.type){case S.e_circles:f=b.bodyA.m_xf.R;e=b.localPoint;c=b.bodyA.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);d=b.bodyA.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);f=b.bodyB.m_xf.R;e=b.points[0].localPoint;g=b.bodyB.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);f=b.bodyB.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);var e=g-c,k=f-d,h=e*e+k*k;h>Number.MIN_VALUE*Number.MIN_VALUE?(h=Math.sqrt(h),this.m_normal.x=
e/h,this.m_normal.y=k/h):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=0.5*(c+g);this.m_points[0].y=0.5*(d+f);this.m_separations[0]=e*this.m_normal.x+k*this.m_normal.y-b.radius;break;case S.e_faceA:f=b.bodyA.m_xf.R;e=b.localPlaneNormal;this.m_normal.x=f.col1.x*e.x+f.col2.x*e.y;this.m_normal.y=f.col1.y*e.x+f.col2.y*e.y;f=b.bodyA.m_xf.R;e=b.localPoint;g=b.bodyA.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);k=b.bodyA.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);f=b.bodyB.m_xf.R;for(c=0;c<b.pointCount;++c)e=
b.points[c].localPoint,d=b.bodyB.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y),e=b.bodyB.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y),this.m_separations[c]=(d-g)*this.m_normal.x+(e-k)*this.m_normal.y-b.radius,this.m_points[c].x=d,this.m_points[c].y=e;break;case S.e_faceB:f=b.bodyB.m_xf.R;e=b.localPlaneNormal;this.m_normal.x=f.col1.x*e.x+f.col2.x*e.y;this.m_normal.y=f.col1.y*e.x+f.col2.y*e.y;f=b.bodyB.m_xf.R;e=b.localPoint;g=b.bodyB.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);k=b.bodyB.m_xf.position.y+
(f.col1.y*e.x+f.col2.y*e.y);f=b.bodyA.m_xf.R;for(c=0;c<b.pointCount;++c)e=b.points[c].localPoint,d=b.bodyA.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y),e=b.bodyA.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y),this.m_separations[c]=(d-g)*this.m_normal.x+(e-k)*this.m_normal.y-b.radius,this.m_points[c].Set(d,e);this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new L;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=
new L})})();
(function(){var b=Box2D.Common.Math.b2Mat22,c=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Vec2,e=Box2D.Common.b2Color,f=Box2D.Dynamics.Controllers.b2BuoyancyController,g=Box2D.Dynamics.Controllers.b2ConstantAccelController,h=Box2D.Dynamics.Controllers.b2ConstantForceController,j=Box2D.Dynamics.Controllers.b2Controller,m=Box2D.Dynamics.Controllers.b2ControllerEdge,n=Box2D.Dynamics.Controllers.b2GravityController,t=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller);
f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;f.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new d(0,-1);this.density=this.offset=0;this.velocity=new d(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};f.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity)this.gravity=this.GetWorld().GetGravity().Copy();for(var b=this.m_bodyList;b;b=
b.nextBody){var c=b.body;if(c.IsAwake()!=!1){for(var e=new d,f=new d,g=0,h=0,j=c.GetFixtureList();j;j=j.GetNext()){var m=new d,n=j.GetShape().ComputeSubmergedArea(this.normal,this.offset,c.GetTransform(),m);g+=n;e.x+=n*m.x;e.y+=n*m.y;var t=0,t=1;h+=n*t;f.x+=n*m.x*t;f.y+=n*m.y*t}e.x/=g;e.y/=g;f.x/=h;f.y/=h;g<Number.MIN_VALUE||(h=this.gravity.GetNegative(),h.Multiply(this.density*g),c.ApplyForce(h,f),f=c.GetLinearVelocityFromWorldPoint(e),f.Subtract(this.velocity),f.Multiply(-this.linearDrag*g),c.ApplyForce(f,
e),c.ApplyTorque(-c.GetInertia()/c.GetMass()*g*c.GetAngularVelocity()*this.angularDrag))}}}};f.prototype.Draw=function(b){var c=new d,f=new d;c.x=this.normal.x*this.offset+this.normal.y*1E3;c.y=this.normal.y*this.offset-this.normal.x*1E3;f.x=this.normal.x*this.offset-this.normal.y*1E3;f.y=this.normal.y*this.offset+this.normal.x*1E3;var g=new e(0,0,1);b.DrawSegment(c,f,g)};Box2D.inherit(g,Box2D.Dynamics.Controllers.b2Controller);g.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
g.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new d(0,0)};g.prototype.Step=function(b){for(var b=new d(this.A.x*b.dt,this.A.y*b.dt),c=this.m_bodyList;c;c=c.nextBody){var e=c.body;e.IsAwake()&&e.SetLinearVelocity(new d(e.GetLinearVelocity().x+b.x,e.GetLinearVelocity().y+b.y))}};Box2D.inherit(h,Box2D.Dynamics.Controllers.b2Controller);h.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;h.b2ConstantForceController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new d(0,0)};h.prototype.Step=function(){for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.ApplyForce(this.F,c.GetWorldCenter())}};j.b2Controller=function(){};j.prototype.Step=function(){};j.prototype.Draw=function(){};j.prototype.AddBody=function(b){var c=new m;c.controller=this;c.body=b;c.nextBody=this.m_bodyList;c.prevBody=null;this.m_bodyList=c;if(c.nextBody)c.nextBody.prevBody=c;this.m_bodyCount++;
c.nextController=b.m_controllerList;c.prevController=null;b.m_controllerList=c;if(c.nextController)c.nextController.prevController=c;b.m_controllerCount++};j.prototype.RemoveBody=function(b){for(var c=b.m_controllerList;c&&c.controller!=this;)c=c.nextController;if(c.prevBody)c.prevBody.nextBody=c.nextBody;if(c.nextBody)c.nextBody.prevBody=c.prevBody;if(c.nextController)c.nextController.prevController=c.prevController;if(c.prevController)c.prevController.nextController=c.nextController;if(this.m_bodyList==
c)this.m_bodyList=c.nextBody;if(b.m_controllerList==c)b.m_controllerList=c.nextController;b.m_controllerCount--;this.m_bodyCount--};j.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};j.prototype.GetNext=function(){return this.m_next};j.prototype.GetWorld=function(){return this.m_world};j.prototype.GetBodyList=function(){return this.m_bodyList};m.b2ControllerEdge=function(){};Box2D.inherit(n,Box2D.Dynamics.Controllers.b2Controller);n.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
n.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};n.prototype.Step=function(){var b=null,c=null,e=null,f=0,g=null,h=null,j=null,m=0,n=0,t=0,m=null;if(this.invSqr)for(b=this.m_bodyList;b;b=b.nextBody){c=b.body;e=c.GetWorldCenter();f=c.GetMass();for(g=this.m_bodyList;g!=b;g=g.nextBody)h=g.body,j=h.GetWorldCenter(),m=j.x-e.x,n=j.y-e.y,t=m*m+n*n,t<Number.MIN_VALUE||(m=new d(m,n),m.Multiply(this.G/t/Math.sqrt(t)*f*h.GetMass()),
c.IsAwake()&&c.ApplyForce(m,e),m.Multiply(-1),h.IsAwake()&&h.ApplyForce(m,j))}else for(b=this.m_bodyList;b;b=b.nextBody){c=b.body;e=c.GetWorldCenter();f=c.GetMass();for(g=this.m_bodyList;g!=b;g=g.nextBody)h=g.body,j=h.GetWorldCenter(),m=j.x-e.x,n=j.y-e.y,t=m*m+n*n,t<Number.MIN_VALUE||(m=new d(m,n),m.Multiply(this.G/t*f*h.GetMass()),c.IsAwake()&&c.ApplyForce(m,e),m.Multiply(-1),h.IsAwake()&&h.ApplyForce(m,j))}};Box2D.inherit(t,Box2D.Dynamics.Controllers.b2Controller);t.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
t.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new b;this.maxTimestep=0};t.prototype.SetAxisAligned=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);this.T.col1.x=-b;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-c;this.maxTimestep=b>0||c>0?1/Math.max(b,c):0};t.prototype.Step=function(b){b=b.dt;if(!(b<=Number.MIN_VALUE)){if(b>this.maxTimestep&&this.maxTimestep>0)b=this.maxTimestep;for(var e=this.m_bodyList;e;e=e.nextBody){var f=
e.body;if(f.IsAwake()){var g=f.GetWorldVector(c.MulMV(this.T,f.GetLocalVector(f.GetLinearVelocity())));f.SetLinearVelocity(new d(f.GetLinearVelocity().x+g.x*b,f.GetLinearVelocity().y+g.y*b))}}}}})();
(function(){var b=Box2D.Common.b2Settings,c=Box2D.Common.Math.b2Mat22,d=Box2D.Common.Math.b2Mat33,e=Box2D.Common.Math.b2Math,f=Box2D.Common.Math.b2Vec2,g=Box2D.Common.Math.b2Vec3,h=Box2D.Dynamics.Joints.b2DistanceJoint,j=Box2D.Dynamics.Joints.b2DistanceJointDef,m=Box2D.Dynamics.Joints.b2FrictionJoint,n=Box2D.Dynamics.Joints.b2FrictionJointDef,t=Box2D.Dynamics.Joints.b2GearJoint,o=Box2D.Dynamics.Joints.b2GearJointDef,w=Box2D.Dynamics.Joints.b2Jacobian,u=Box2D.Dynamics.Joints.b2Joint,A=Box2D.Dynamics.Joints.b2JointDef,
C=Box2D.Dynamics.Joints.b2JointEdge,p=Box2D.Dynamics.Joints.b2LineJoint,x=Box2D.Dynamics.Joints.b2LineJointDef,H=Box2D.Dynamics.Joints.b2MouseJoint,B=Box2D.Dynamics.Joints.b2MouseJointDef,I=Box2D.Dynamics.Joints.b2PrismaticJoint,D=Box2D.Dynamics.Joints.b2PrismaticJointDef,F=Box2D.Dynamics.Joints.b2PulleyJoint,T=Box2D.Dynamics.Joints.b2PulleyJointDef,L=Box2D.Dynamics.Joints.b2RevoluteJoint,M=Box2D.Dynamics.Joints.b2RevoluteJointDef,N=Box2D.Dynamics.Joints.b2WeldJoint,S=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new f;this.m_localAnchor2=new f;this.m_u=new f};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};h.prototype.GetReactionForce=function(b){b===void 0&&(b=0);
return new f(b*this.m_impulse*this.m_u.x,b*this.m_impulse*this.m_u.y)};h.prototype.GetReactionTorque=function(){return 0};h.prototype.GetLength=function(){return this.m_length};h.prototype.SetLength=function(b){b===void 0&&(b=0);this.m_length=b};h.prototype.GetFrequency=function(){return this.m_frequencyHz};h.prototype.SetFrequency=function(b){b===void 0&&(b=0);this.m_frequencyHz=b};h.prototype.GetDampingRatio=function(){return this.m_dampingRatio};h.prototype.SetDampingRatio=function(b){b===void 0&&
(b=0);this.m_dampingRatio=b};h.prototype.b2DistanceJoint=function(b){this.__super.b2Joint.call(this,b);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_length=b.length;this.m_frequencyHz=b.frequencyHz;this.m_dampingRatio=b.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};h.prototype.InitVelocityConstraints=function(c){var d,e=0,f=this.m_bodyA,g=this.m_bodyB;d=f.m_xf.R;var h=this.m_localAnchor1.x-f.m_sweep.localCenter.x,j=this.m_localAnchor1.y-f.m_sweep.localCenter.y,
e=d.col1.x*h+d.col2.x*j,j=d.col1.y*h+d.col2.y*j,h=e;d=g.m_xf.R;var m=this.m_localAnchor2.x-g.m_sweep.localCenter.x,n=this.m_localAnchor2.y-g.m_sweep.localCenter.y,e=d.col1.x*m+d.col2.x*n,n=d.col1.y*m+d.col2.y*n,m=e;this.m_u.x=g.m_sweep.c.x+m-f.m_sweep.c.x-h;this.m_u.y=g.m_sweep.c.y+n-f.m_sweep.c.y-j;e=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);e>b.b2_linearSlop?this.m_u.Multiply(1/e):this.m_u.SetZero();d=h*this.m_u.y-j*this.m_u.x;var o=m*this.m_u.y-n*this.m_u.x;d=f.m_invMass+f.m_invI*
d*d+g.m_invMass+g.m_invI*o*o;this.m_mass=d!=0?1/d:0;if(this.m_frequencyHz>0){e-=this.m_length;var o=2*Math.PI*this.m_frequencyHz,p=this.m_mass*o*o;this.m_gamma=c.dt*(2*this.m_mass*this.m_dampingRatio*o+c.dt*p);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=e*c.dt*p*this.m_gamma;this.m_mass=d+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}c.warmStarting?(this.m_impulse*=c.dtRatio,c=this.m_impulse*this.m_u.x,d=this.m_impulse*this.m_u.y,f.m_linearVelocity.x-=f.m_invMass*c,f.m_linearVelocity.y-=
f.m_invMass*d,f.m_angularVelocity-=f.m_invI*(h*d-j*c),g.m_linearVelocity.x+=g.m_invMass*c,g.m_linearVelocity.y+=g.m_invMass*d,g.m_angularVelocity+=g.m_invI*(m*d-n*c)):this.m_impulse=0};h.prototype.SolveVelocityConstraints=function(){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=g;b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-
d.m_sweep.localCenter.y,g=b.col1.x*h+b.col2.x*j,j=b.col1.y*h+b.col2.y*j,h=g,g=-this.m_mass*(this.m_u.x*(d.m_linearVelocity.x+-d.m_angularVelocity*j-(c.m_linearVelocity.x+-c.m_angularVelocity*f))+this.m_u.y*(d.m_linearVelocity.y+d.m_angularVelocity*h-(c.m_linearVelocity.y+c.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=g;b=g*this.m_u.x;g*=this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*b;c.m_linearVelocity.y-=c.m_invMass*g;c.m_angularVelocity-=c.m_invI*(e*g-f*b);d.m_linearVelocity.x+=
d.m_invMass*b;d.m_linearVelocity.y+=d.m_invMass*g;d.m_angularVelocity+=d.m_invI*(h*g-j*b)};h.prototype.SolvePositionConstraints=function(){var c;if(this.m_frequencyHz>0)return!0;var d=this.m_bodyA,f=this.m_bodyB;c=d.m_xf.R;var g=this.m_localAnchor1.x-d.m_sweep.localCenter.x,h=this.m_localAnchor1.y-d.m_sweep.localCenter.y,j=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=j;c=f.m_xf.R;var m=this.m_localAnchor2.x-f.m_sweep.localCenter.x,n=this.m_localAnchor2.y-f.m_sweep.localCenter.y,j=c.col1.x*m+c.col2.x*
n,n=c.col1.y*m+c.col2.y*n,m=j,j=f.m_sweep.c.x+m-d.m_sweep.c.x-g,o=f.m_sweep.c.y+n-d.m_sweep.c.y-h;c=Math.sqrt(j*j+o*o);j/=c;o/=c;c-=this.m_length;c=e.Clamp(c,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection);var p=-this.m_mass*c;this.m_u.Set(j,o);j=p*this.m_u.x;o=p*this.m_u.y;d.m_sweep.c.x-=d.m_invMass*j;d.m_sweep.c.y-=d.m_invMass*o;d.m_sweep.a-=d.m_invI*(g*o-h*j);f.m_sweep.c.x+=f.m_invMass*j;f.m_sweep.c.y+=f.m_invMass*o;f.m_sweep.a+=f.m_invI*(m*o-n*j);d.SynchronizeTransform();f.SynchronizeTransform();
return e.Abs(c)<b.b2_linearSlop};Box2D.inherit(j,Box2D.Dynamics.Joints.b2JointDef);j.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;j.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new f;this.localAnchorB=new f};j.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};j.prototype.Initialize=function(b,c,d,e){this.bodyA=
b;this.bodyB=c;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));b=e.x-d.x;d=e.y-d.y;this.length=Math.sqrt(b*b+d*d);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint);m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;m.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new f;this.m_localAnchorB=new f;this.m_linearMass=new c;this.m_linearImpulse=
new f};m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};m.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*this.m_linearImpulse.x,b*this.m_linearImpulse.y)};m.prototype.GetReactionTorque=function(b){b===void 0&&(b=0);return b*this.m_angularImpulse};m.prototype.SetMaxForce=function(b){b===void 0&&(b=0);this.m_maxForce=b};m.prototype.GetMaxForce=function(){return this.m_maxForce};
m.prototype.SetMaxTorque=function(b){b===void 0&&(b=0);this.m_maxTorque=b};m.prototype.GetMaxTorque=function(){return this.m_maxTorque};m.prototype.b2FrictionJoint=function(b){this.__super.b2Joint.call(this,b);this.m_localAnchorA.SetV(b.localAnchorA);this.m_localAnchorB.SetV(b.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=b.maxForce;this.m_maxTorque=b.maxTorque};m.prototype.InitVelocityConstraints=function(b){var d,
e=0,f=this.m_bodyA,g=this.m_bodyB;d=f.m_xf.R;var h=this.m_localAnchorA.x-f.m_sweep.localCenter.x,j=this.m_localAnchorA.y-f.m_sweep.localCenter.y,e=d.col1.x*h+d.col2.x*j,j=d.col1.y*h+d.col2.y*j,h=e;d=g.m_xf.R;var m=this.m_localAnchorB.x-g.m_sweep.localCenter.x,n=this.m_localAnchorB.y-g.m_sweep.localCenter.y,e=d.col1.x*m+d.col2.x*n,n=d.col1.y*m+d.col2.y*n,m=e;d=f.m_invMass;var e=g.m_invMass,o=f.m_invI,p=g.m_invI,u=new c;u.col1.x=d+e;u.col2.x=0;u.col1.y=0;u.col2.y=d+e;u.col1.x+=o*j*j;u.col2.x+=-o*h*
j;u.col1.y+=-o*h*j;u.col2.y+=o*h*h;u.col1.x+=p*n*n;u.col2.x+=-p*m*n;u.col1.y+=-p*m*n;u.col2.y+=p*m*m;u.GetInverse(this.m_linearMass);this.m_angularMass=o+p;if(this.m_angularMass>0)this.m_angularMass=1/this.m_angularMass;b.warmStarting?(this.m_linearImpulse.x*=b.dtRatio,this.m_linearImpulse.y*=b.dtRatio,this.m_angularImpulse*=b.dtRatio,b=this.m_linearImpulse,f.m_linearVelocity.x-=d*b.x,f.m_linearVelocity.y-=d*b.y,f.m_angularVelocity-=o*(h*b.y-j*b.x+this.m_angularImpulse),g.m_linearVelocity.x+=e*b.x,
g.m_linearVelocity.y+=e*b.y,g.m_angularVelocity+=p*(m*b.y-n*b.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};m.prototype.SolveVelocityConstraints=function(b){var c,d=0,g=this.m_bodyA,h=this.m_bodyB,j=g.m_linearVelocity,m=g.m_angularVelocity,n=h.m_linearVelocity,o=h.m_angularVelocity,p=g.m_invMass,u=h.m_invMass,t=g.m_invI,w=h.m_invI;c=g.m_xf.R;var x=this.m_localAnchorA.x-g.m_sweep.localCenter.x,y=this.m_localAnchorA.y-g.m_sweep.localCenter.y,d=c.col1.x*x+c.col2.x*
y,y=c.col1.y*x+c.col2.y*y,x=d;c=h.m_xf.R;var A=this.m_localAnchorB.x-h.m_sweep.localCenter.x,B=this.m_localAnchorB.y-h.m_sweep.localCenter.y,d=c.col1.x*A+c.col2.x*B,B=c.col1.y*A+c.col2.y*B,A=d;c=0;var d=-this.m_angularMass*(o-m),C=this.m_angularImpulse;c=b.dt*this.m_maxTorque;this.m_angularImpulse=e.Clamp(this.m_angularImpulse+d,-c,c);d=this.m_angularImpulse-C;m-=t*d;o+=w*d;c=e.MulMV(this.m_linearMass,new f(-(n.x-o*B-j.x+m*y),-(n.y+o*A-j.y-m*x)));d=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(c);
c=b.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>c*c&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(c));c=e.SubtractVV(this.m_linearImpulse,d);j.x-=p*c.x;j.y-=p*c.y;m-=t*(x*c.y-y*c.x);n.x+=u*c.x;n.y+=u*c.y;o+=w*(A*c.y-B*c.x);g.m_angularVelocity=m;h.m_angularVelocity=o};m.prototype.SolvePositionConstraints=function(){return!0};Box2D.inherit(n,Box2D.Dynamics.Joints.b2JointDef);n.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;n.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new f;this.localAnchorB=new f};n.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_frictionJoint;this.maxTorque=this.maxForce=0};n.prototype.Initialize=function(b,c,d){this.bodyA=b;this.bodyB=c;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d))};Box2D.inherit(t,Box2D.Dynamics.Joints.b2Joint);t.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;t.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new f;this.m_groundAnchor2=new f;this.m_localAnchor1=new f;this.m_localAnchor2=new f;this.m_J=new w};t.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};t.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};t.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*this.m_impulse*this.m_J.linearB.x,b*this.m_impulse*this.m_J.linearB.y)};t.prototype.GetReactionTorque=function(b){b===
void 0&&(b=0);var c=this.m_bodyB.m_xf.R,d=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,f=c.col1.x*d+c.col2.x*e,e=c.col1.y*d+c.col2.y*e;return b*(this.m_impulse*this.m_J.angularB-f*this.m_impulse*this.m_J.linearB.y+e*this.m_impulse*this.m_J.linearB.x)};t.prototype.GetRatio=function(){return this.m_ratio};t.prototype.SetRatio=function(b){b===void 0&&(b=0);this.m_ratio=b};t.prototype.b2GearJoint=function(b){this.__super.b2Joint.call(this,
b);var c=parseInt(b.joint1.m_type),d=parseInt(b.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var e=0,f=0;this.m_ground1=b.joint1.GetBodyA();this.m_bodyA=b.joint1.GetBodyB();c==u.e_revoluteJoint?(this.m_revolute1=b.joint1 instanceof L?b.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),e=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=b.joint1 instanceof I?b.joint1:null,
this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),e=this.m_prismatic1.GetJointTranslation());this.m_ground2=b.joint2.GetBodyA();this.m_bodyB=b.joint2.GetBodyB();d==u.e_revoluteJoint?(this.m_revolute2=b.joint2 instanceof L?b.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),f=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=b.joint2 instanceof I?b.joint2:
null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),f=this.m_prismatic2.GetJointTranslation());this.m_ratio=b.ratio;this.m_constant=e+this.m_ratio*f;this.m_impulse=0};t.prototype.InitVelocityConstraints=function(b){var c=this.m_ground1,d=this.m_ground2,e=this.m_bodyA,f=this.m_bodyB,g=0,h=0,j=0,m=0,n=j=0,o=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,o+=e.m_invI):(c=c.m_xf.R,h=this.m_prismatic1.m_localXAxis1,g=c.col1.x*
h.x+c.col2.x*h.y,h=c.col1.y*h.x+c.col2.y*h.y,c=e.m_xf.R,j=this.m_localAnchor1.x-e.m_sweep.localCenter.x,m=this.m_localAnchor1.y-e.m_sweep.localCenter.y,n=c.col1.x*j+c.col2.x*m,m=c.col1.y*j+c.col2.y*m,j=n*h-m*g,this.m_J.linearA.Set(-g,-h),this.m_J.angularA=-j,o+=e.m_invMass+e.m_invI*j*j);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,o+=this.m_ratio*this.m_ratio*f.m_invI):(c=d.m_xf.R,h=this.m_prismatic2.m_localXAxis1,g=c.col1.x*h.x+c.col2.x*h.y,h=c.col1.y*h.x+c.col2.y*h.y,c=f.m_xf.R,j=this.m_localAnchor2.x-
f.m_sweep.localCenter.x,m=this.m_localAnchor2.y-f.m_sweep.localCenter.y,n=c.col1.x*j+c.col2.x*m,m=c.col1.y*j+c.col2.y*m,j=n*h-m*g,this.m_J.linearB.Set(-this.m_ratio*g,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*j,o+=this.m_ratio*this.m_ratio*(f.m_invMass+f.m_invI*j*j));this.m_mass=o>0?1/o:0;b.warmStarting?(e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularA,
f.m_linearVelocity.x+=f.m_invMass*this.m_impulse*this.m_J.linearB.x,f.m_linearVelocity.y+=f.m_invMass*this.m_impulse*this.m_J.linearB.y,f.m_angularVelocity+=f.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};t.prototype.SolveVelocityConstraints=function(){var b=this.m_bodyA,c=this.m_bodyB,d=-this.m_mass*this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity);this.m_impulse+=d;b.m_linearVelocity.x+=b.m_invMass*d*this.m_J.linearA.x;b.m_linearVelocity.y+=
b.m_invMass*d*this.m_J.linearA.y;b.m_angularVelocity+=b.m_invI*d*this.m_J.angularA;c.m_linearVelocity.x+=c.m_invMass*d*this.m_J.linearB.x;c.m_linearVelocity.y+=c.m_invMass*d*this.m_J.linearB.y;c.m_angularVelocity+=c.m_invI*d*this.m_J.angularB};t.prototype.SolvePositionConstraints=function(){var c=this.m_bodyA,d=this.m_bodyB,e=0,f=0,e=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),f=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),
e=-this.m_mass*(this.m_constant-(e+this.m_ratio*f));c.m_sweep.c.x+=c.m_invMass*e*this.m_J.linearA.x;c.m_sweep.c.y+=c.m_invMass*e*this.m_J.linearA.y;c.m_sweep.a+=c.m_invI*e*this.m_J.angularA;d.m_sweep.c.x+=d.m_invMass*e*this.m_J.linearB.x;d.m_sweep.c.y+=d.m_invMass*e*this.m_J.linearB.y;d.m_sweep.a+=d.m_invI*e*this.m_J.angularB;c.SynchronizeTransform();d.SynchronizeTransform();return 0<b.b2_linearSlop};Box2D.inherit(o,Box2D.Dynamics.Joints.b2JointDef);o.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;
o.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};o.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};w.b2Jacobian=function(){this.linearA=new f;this.linearB=new f};w.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};w.prototype.Set=function(b,c,d,e){c===void 0&&(c=0);e===void 0&&(e=0);this.linearA.SetV(b);this.angularA=
c;this.linearB.SetV(d);this.angularB=e};w.prototype.Compute=function(b,c,d,e){c===void 0&&(c=0);e===void 0&&(e=0);return this.linearA.x*b.x+this.linearA.y*b.y+this.angularA*c+(this.linearB.x*d.x+this.linearB.y*d.y)+this.angularB*e};u.b2Joint=function(){this.m_edgeA=new C;this.m_edgeB=new C;this.m_localCenterA=new f;this.m_localCenterB=new f};u.prototype.GetType=function(){return this.m_type};u.prototype.GetAnchorA=function(){return null};u.prototype.GetAnchorB=function(){return null};u.prototype.GetReactionForce=
function(){return null};u.prototype.GetReactionTorque=function(){return 0};u.prototype.GetBodyA=function(){return this.m_bodyA};u.prototype.GetBodyB=function(){return this.m_bodyB};u.prototype.GetNext=function(){return this.m_next};u.prototype.GetUserData=function(){return this.m_userData};u.prototype.SetUserData=function(b){this.m_userData=b};u.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};u.Create=function(b){var c=null;switch(b.type){case u.e_distanceJoint:c=
new h(b instanceof j?b:null);break;case u.e_mouseJoint:c=new H(b instanceof B?b:null);break;case u.e_prismaticJoint:c=new I(b instanceof D?b:null);break;case u.e_revoluteJoint:c=new L(b instanceof M?b:null);break;case u.e_pulleyJoint:c=new F(b instanceof T?b:null);break;case u.e_gearJoint:c=new t(b instanceof o?b:null);break;case u.e_lineJoint:c=new p(b instanceof x?b:null);break;case u.e_weldJoint:c=new N(b instanceof S?b:null);break;case u.e_frictionJoint:c=new m(b instanceof n?b:null)}return c};
u.Destroy=function(){};u.prototype.b2Joint=function(c){b.b2Assert(c.bodyA!=c.bodyB);this.m_type=c.type;this.m_next=this.m_prev=null;this.m_bodyA=c.bodyA;this.m_bodyB=c.bodyB;this.m_collideConnected=c.collideConnected;this.m_islandFlag=!1;this.m_userData=c.userData};u.prototype.InitVelocityConstraints=function(){};u.prototype.SolveVelocityConstraints=function(){};u.prototype.FinalizeVelocityConstraints=function(){};u.prototype.SolvePositionConstraints=function(){return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=
0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=
1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});A.b2JointDef=function(){};A.prototype.b2JointDef=function(){this.type=u.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};C.b2JointEdge=function(){};Box2D.inherit(p,Box2D.Dynamics.Joints.b2Joint);p.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;p.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new f;this.m_localAnchor2=
new f;this.m_localXAxis1=new f;this.m_localYAxis1=new f;this.m_axis=new f;this.m_perp=new f;this.m_K=new c;this.m_impulse=new f};p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};p.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),b*(this.m_impulse.x*this.m_perp.y+
(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};p.prototype.GetReactionTorque=function(b){b===void 0&&(b=0);return b*this.m_impulse.y};p.prototype.GetJointTranslation=function(){var b=this.m_bodyA,c=this.m_bodyB,d=b.GetWorldPoint(this.m_localAnchor1),e=c.GetWorldPoint(this.m_localAnchor2),c=e.x-d.x,d=e.y-d.y,b=b.GetWorldVector(this.m_localXAxis1);return b.x*c+b.y*d};p.prototype.GetJointSpeed=function(){var b=this.m_bodyA,c=this.m_bodyB,d;d=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,
f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=g;d=c.m_xf.R;var h=this.m_localAnchor2.x-c.m_sweep.localCenter.x,j=this.m_localAnchor2.y-c.m_sweep.localCenter.y,g=d.col1.x*h+d.col2.x*j,j=d.col1.y*h+d.col2.y*j,h=g;d=c.m_sweep.c.x+h-(b.m_sweep.c.x+e);var g=c.m_sweep.c.y+j-(b.m_sweep.c.y+f),m=b.GetWorldVector(this.m_localXAxis1),n=b.m_linearVelocity,o=c.m_linearVelocity,b=b.m_angularVelocity,c=c.m_angularVelocity;return d*-b*m.y+g*b*m.x+(m.x*(o.x+-c*
j-n.x- -b*f)+m.y*(o.y+c*h-n.y-b*e))};p.prototype.IsLimitEnabled=function(){return this.m_enableLimit};p.prototype.EnableLimit=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=b};p.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};p.prototype.GetUpperLimit=function(){return this.m_upperTranslation};p.prototype.SetLimits=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=b;this.m_upperTranslation=
c};p.prototype.IsMotorEnabled=function(){return this.m_enableMotor};p.prototype.EnableMotor=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=b};p.prototype.SetMotorSpeed=function(b){b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=b};p.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};p.prototype.SetMaxMotorForce=function(b){b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=
b};p.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};p.prototype.GetMotorForce=function(){return this.m_motorImpulse};p.prototype.b2LineJoint=function(b){this.__super.b2Joint.call(this,b);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_localXAxis1.SetV(b.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=b.lowerTranslation;
this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor;this.m_limitState=u.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};p.prototype.InitVelocityConstraints=function(c){var d=this.m_bodyA,f=this.m_bodyB,g,h=0;this.m_localCenterA.SetV(d.GetLocalCenter());this.m_localCenterB.SetV(f.GetLocalCenter());var j=d.GetTransform();f.GetTransform();g=d.m_xf.R;var m=this.m_localAnchor1.x-
this.m_localCenterA.x,n=this.m_localAnchor1.y-this.m_localCenterA.y,h=g.col1.x*m+g.col2.x*n,n=g.col1.y*m+g.col2.y*n,m=h;g=f.m_xf.R;var o=this.m_localAnchor2.x-this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y,h=g.col1.x*o+g.col2.x*p,p=g.col1.y*o+g.col2.y*p,o=h;g=f.m_sweep.c.x+o-d.m_sweep.c.x-m;h=f.m_sweep.c.y+p-d.m_sweep.c.y-n;this.m_invMassA=d.m_invMass;this.m_invMassB=f.m_invMass;this.m_invIA=d.m_invI;this.m_invIB=f.m_invI;this.m_axis.SetV(e.MulMV(j.R,this.m_localXAxis1));this.m_a1=
(g+m)*this.m_axis.y-(h+n)*this.m_axis.x;this.m_a2=o*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(e.MulMV(j.R,this.m_localYAxis1));this.m_s1=(g+m)*this.m_perp.y-(h+n)*this.m_perp.x;this.m_s2=o*this.m_perp.y-p*this.m_perp.x;j=this.m_invMassA;m=this.m_invMassB;n=this.m_invIA;o=this.m_invIB;this.m_K.col1.x=j+m+n*this.m_s1*
this.m_s1+o*this.m_s2*this.m_s2;this.m_K.col1.y=n*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=j+m+n*this.m_a1*this.m_a1+o*this.m_a2*this.m_a2;if(this.m_enableLimit)if(g=this.m_axis.x*g+this.m_axis.y*h,e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop)this.m_limitState=u.e_equalLimits;else if(g<=this.m_lowerTranslation){if(this.m_limitState!=u.e_atLowerLimit)this.m_limitState=u.e_atLowerLimit,this.m_impulse.y=0}else if(g>=this.m_upperTranslation){if(this.m_limitState!=
u.e_atUpperLimit)this.m_limitState=u.e_atUpperLimit,this.m_impulse.y=0}else this.m_limitState=u.e_inactiveLimit,this.m_impulse.y=0;else this.m_limitState=u.e_inactiveLimit;if(this.m_enableMotor==!1)this.m_motorImpulse=0;c.warmStarting?(this.m_impulse.x*=c.dtRatio,this.m_impulse.y*=c.dtRatio,this.m_motorImpulse*=c.dtRatio,c=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,h=this.m_impulse.x*
this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,j=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*c,d.m_linearVelocity.y-=this.m_invMassA*g,d.m_angularVelocity-=this.m_invIA*h,f.m_linearVelocity.x+=this.m_invMassB*c,f.m_linearVelocity.y+=this.m_invMassB*g,f.m_angularVelocity+=this.m_invIB*j):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};p.prototype.SolveVelocityConstraints=function(b){var c=this.m_bodyA,d=this.m_bodyB,
g=c.m_linearVelocity,h=c.m_angularVelocity,j=d.m_linearVelocity,m=d.m_angularVelocity,n=0,o=0,p=0,t=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits)t=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(j.x-g.x)+this.m_axis.y*(j.y-g.y)+this.m_a2*m-this.m_a1*h)),n=this.m_motorImpulse,o=b.dt*this.m_maxMotorForce,this.m_motorImpulse=e.Clamp(this.m_motorImpulse+t,-o,o),t=this.m_motorImpulse-n,n=t*this.m_axis.x,o=t*this.m_axis.y,p=t*this.m_a1,t*=this.m_a2,g.x-=this.m_invMassA*n,g.y-=this.m_invMassA*
o,h-=this.m_invIA*p,j.x+=this.m_invMassB*n,j.y+=this.m_invMassB*o,m+=this.m_invIB*t;o=this.m_perp.x*(j.x-g.x)+this.m_perp.y*(j.y-g.y)+this.m_s2*m-this.m_s1*h;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){p=this.m_axis.x*(j.x-g.x)+this.m_axis.y*(j.y-g.y)+this.m_a2*m-this.m_a1*h;n=this.m_impulse.Copy();b=this.m_K.Solve(new f,-o,-p);this.m_impulse.Add(b);if(this.m_limitState==u.e_atLowerLimit)this.m_impulse.y=e.Max(this.m_impulse.y,0);else if(this.m_limitState==u.e_atUpperLimit)this.m_impulse.y=
e.Min(this.m_impulse.y,0);o=-o-(this.m_impulse.y-n.y)*this.m_K.col2.x;p=0;p=this.m_K.col1.x!=0?o/this.m_K.col1.x+n.x:n.x;this.m_impulse.x=p;b.x=this.m_impulse.x-n.x;b.y=this.m_impulse.y-n.y;n=b.x*this.m_perp.x+b.y*this.m_axis.x;o=b.x*this.m_perp.y+b.y*this.m_axis.y;p=b.x*this.m_s1+b.y*this.m_a1;t=b.x*this.m_s2+b.y*this.m_a2}else b=0,b=this.m_K.col1.x!=0?-o/this.m_K.col1.x:0,this.m_impulse.x+=b,n=b*this.m_perp.x,o=b*this.m_perp.y,p=b*this.m_s1,t=b*this.m_s2;g.x-=this.m_invMassA*n;g.y-=this.m_invMassA*
o;h-=this.m_invIA*p;j.x+=this.m_invMassB*n;j.y+=this.m_invMassB*o;m+=this.m_invIB*t;c.m_linearVelocity.SetV(g);c.m_angularVelocity=h;d.m_linearVelocity.SetV(j);d.m_angularVelocity=m};p.prototype.SolvePositionConstraints=function(){var d=this.m_bodyA,g=this.m_bodyB,k=d.m_sweep.c,h=d.m_sweep.a,j=g.m_sweep.c,m=g.m_sweep.a,n,o=0,p=0,u=0,t=0,w=n=0,x=0,p=!1,A=0,y=c.FromAngle(h),u=c.FromAngle(m);n=y;var x=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y,o=n.col1.x*
x+n.col2.x*B,B=n.col1.y*x+n.col2.y*B,x=o;n=u;u=this.m_localAnchor2.x-this.m_localCenterB.x;t=this.m_localAnchor2.y-this.m_localCenterB.y;o=n.col1.x*u+n.col2.x*t;t=n.col1.y*u+n.col2.y*t;u=o;n=j.x+u-k.x-x;o=j.y+t-k.y-B;if(this.m_enableLimit){this.m_axis=e.MulMV(y,this.m_localXAxis1);this.m_a1=(n+x)*this.m_axis.y-(o+B)*this.m_axis.x;this.m_a2=u*this.m_axis.y-t*this.m_axis.x;var C=this.m_axis.x*n+this.m_axis.y*o;e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(A=e.Clamp(C,-b.b2_maxLinearCorrection,
b.b2_maxLinearCorrection),w=e.Abs(C),p=!0):C<=this.m_lowerTranslation?(A=e.Clamp(C-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),w=this.m_lowerTranslation-C,p=!0):C>=this.m_upperTranslation&&(A=e.Clamp(C-this.m_upperTranslation+b.b2_linearSlop,0,b.b2_maxLinearCorrection),w=C-this.m_upperTranslation,p=!0)}this.m_perp=e.MulMV(y,this.m_localYAxis1);this.m_s1=(n+x)*this.m_perp.y-(o+B)*this.m_perp.x;this.m_s2=u*this.m_perp.y-t*this.m_perp.x;y=new f;B=this.m_perp.x*n+this.m_perp.y*
o;w=e.Max(w,e.Abs(B));x=0;p?(p=this.m_invMassA,u=this.m_invMassB,t=this.m_invIA,n=this.m_invIB,this.m_K.col1.x=p+u+t*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2,this.m_K.col1.y=t*this.m_s1*this.m_a1+n*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+u+t*this.m_a1*this.m_a1+n*this.m_a2*this.m_a2,this.m_K.Solve(y,-B,-A)):(p=this.m_invMassA,u=this.m_invMassB,t=this.m_invIA,n=this.m_invIB,A=p+u+t*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2,p=0,y.x=A!=0?-B/A:0,y.y=0);A=y.x*this.m_perp.x+
y.y*this.m_axis.x;p=y.x*this.m_perp.y+y.y*this.m_axis.y;B=y.x*this.m_s1+y.y*this.m_a1;y=y.x*this.m_s2+y.y*this.m_a2;k.x-=this.m_invMassA*A;k.y-=this.m_invMassA*p;h-=this.m_invIA*B;j.x+=this.m_invMassB*A;j.y+=this.m_invMassB*p;m+=this.m_invIB*y;d.m_sweep.a=h;g.m_sweep.a=m;d.SynchronizeTransform();g.SynchronizeTransform();return w<=b.b2_linearSlop&&x<=b.b2_angularSlop};Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef);x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;x.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new f;this.localAnchorB=new f;this.localAxisA=new f};x.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};x.prototype.Initialize=function(b,c,d,e){this.bodyA=b;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=
this.bodyA.GetLocalVector(e)};Box2D.inherit(H,Box2D.Dynamics.Joints.b2Joint);H.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;H.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new c;this.K1=new c;this.K2=new c;this.m_localAnchor=new f;this.m_target=new f;this.m_impulse=new f;this.m_mass=new c;this.m_C=new f};H.prototype.GetAnchorA=function(){return this.m_target};H.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};
H.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*this.m_impulse.x,b*this.m_impulse.y)};H.prototype.GetReactionTorque=function(){return 0};H.prototype.GetTarget=function(){return this.m_target};H.prototype.SetTarget=function(b){this.m_bodyB.IsAwake()==!1&&this.m_bodyB.SetAwake(!0);this.m_target=b};H.prototype.GetMaxForce=function(){return this.m_maxForce};H.prototype.SetMaxForce=function(b){b===void 0&&(b=0);this.m_maxForce=b};H.prototype.GetFrequency=function(){return this.m_frequencyHz};
H.prototype.SetFrequency=function(b){b===void 0&&(b=0);this.m_frequencyHz=b};H.prototype.GetDampingRatio=function(){return this.m_dampingRatio};H.prototype.SetDampingRatio=function(b){b===void 0&&(b=0);this.m_dampingRatio=b};H.prototype.b2MouseJoint=function(b){this.__super.b2Joint.call(this,b);this.m_target.SetV(b.target);var c=this.m_target.x-this.m_bodyB.m_xf.position.x,d=this.m_target.y-this.m_bodyB.m_xf.position.y,e=this.m_bodyB.m_xf.R;this.m_localAnchor.x=c*e.col1.x+d*e.col1.y;this.m_localAnchor.y=
c*e.col2.x+d*e.col2.y;this.m_maxForce=b.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=b.frequencyHz;this.m_dampingRatio=b.dampingRatio;this.m_gamma=this.m_beta=0};H.prototype.InitVelocityConstraints=function(b){var c=this.m_bodyB,d=c.GetMass(),e=2*Math.PI*this.m_frequencyHz,f=d*e*e;this.m_gamma=b.dt*(2*d*this.m_dampingRatio*e+b.dt*f);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=b.dt*f*this.m_gamma;var f=c.m_xf.R,d=this.m_localAnchor.x-c.m_sweep.localCenter.x,e=this.m_localAnchor.y-
c.m_sweep.localCenter.y,g=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=g,f=c.m_invMass,g=c.m_invI;this.K1.col1.x=f;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=f;this.K2.col1.x=g*e*e;this.K2.col2.x=-g*d*e;this.K2.col1.y=-g*d*e;this.K2.col2.y=g*d*d;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=c.m_sweep.c.x+d-this.m_target.x;this.m_C.y=c.m_sweep.c.y+e-this.m_target.y;c.m_angularVelocity*=0.98;this.m_impulse.x*=
b.dtRatio;this.m_impulse.y*=b.dtRatio;c.m_linearVelocity.x+=f*this.m_impulse.x;c.m_linearVelocity.y+=f*this.m_impulse.y;c.m_angularVelocity+=g*(d*this.m_impulse.y-e*this.m_impulse.x)};H.prototype.SolveVelocityConstraints=function(b){var c=this.m_bodyB,d,e=0,f=0;d=c.m_xf.R;var g=this.m_localAnchor.x-c.m_sweep.localCenter.x,h=this.m_localAnchor.y-c.m_sweep.localCenter.y,e=d.col1.x*g+d.col2.x*h,h=d.col1.y*g+d.col2.y*h,g=e,e=c.m_linearVelocity.x+-c.m_angularVelocity*h,j=c.m_linearVelocity.y+c.m_angularVelocity*
g;d=this.m_mass;e=e+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;f=j+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;j=-(d.col1.x*e+d.col2.x*f);f=-(d.col1.y*e+d.col2.y*f);d=this.m_impulse.x;e=this.m_impulse.y;this.m_impulse.x+=j;this.m_impulse.y+=f;b=b.dt*this.m_maxForce;this.m_impulse.LengthSquared()>b*b&&this.m_impulse.Multiply(b/this.m_impulse.Length());j=this.m_impulse.x-d;f=this.m_impulse.y-e;c.m_linearVelocity.x+=c.m_invMass*j;c.m_linearVelocity.y+=c.m_invMass*f;c.m_angularVelocity+=
c.m_invI*(g*f-h*j)};H.prototype.SolvePositionConstraints=function(){return!0};Box2D.inherit(B,Box2D.Dynamics.Joints.b2JointDef);B.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;B.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new f};B.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};Box2D.inherit(I,Box2D.Dynamics.Joints.b2Joint);
I.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;I.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new f;this.m_localAnchor2=new f;this.m_localXAxis1=new f;this.m_localYAxis1=new f;this.m_axis=new f;this.m_perp=new f;this.m_K=new d;this.m_impulse=new g};I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
I.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),b*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};I.prototype.GetReactionTorque=function(b){b===void 0&&(b=0);return b*this.m_impulse.y};I.prototype.GetJointTranslation=function(){var b=this.m_bodyA,c=this.m_bodyB,d=b.GetWorldPoint(this.m_localAnchor1),e=c.GetWorldPoint(this.m_localAnchor2),c=e.x-d.x,
d=e.y-d.y,b=b.GetWorldVector(this.m_localXAxis1);return b.x*c+b.y*d};I.prototype.GetJointSpeed=function(){var b=this.m_bodyA,c=this.m_bodyB,d;d=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,g=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=g;d=c.m_xf.R;var h=this.m_localAnchor2.x-c.m_sweep.localCenter.x,j=this.m_localAnchor2.y-c.m_sweep.localCenter.y,g=d.col1.x*h+d.col2.x*j,j=d.col1.y*h+d.col2.y*j,h=g;d=c.m_sweep.c.x+h-(b.m_sweep.c.x+
e);var g=c.m_sweep.c.y+j-(b.m_sweep.c.y+f),m=b.GetWorldVector(this.m_localXAxis1),n=b.m_linearVelocity,o=c.m_linearVelocity,b=b.m_angularVelocity,c=c.m_angularVelocity;return d*-b*m.y+g*b*m.x+(m.x*(o.x+-c*j-n.x- -b*f)+m.y*(o.y+c*h-n.y-b*e))};I.prototype.IsLimitEnabled=function(){return this.m_enableLimit};I.prototype.EnableLimit=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=b};I.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};I.prototype.GetUpperLimit=
function(){return this.m_upperTranslation};I.prototype.SetLimits=function(b,c){b===void 0&&(b=0);c===void 0&&(c=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=b;this.m_upperTranslation=c};I.prototype.IsMotorEnabled=function(){return this.m_enableMotor};I.prototype.EnableMotor=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=b};I.prototype.SetMotorSpeed=function(b){b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=b};I.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};I.prototype.SetMaxMotorForce=function(b){b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=b};I.prototype.GetMotorForce=function(){return this.m_motorImpulse};I.prototype.b2PrismaticJoint=function(b){this.__super.b2Joint.call(this,b);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_localXAxis1.SetV(b.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;
this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor;this.m_limitState=u.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};I.prototype.InitVelocityConstraints=function(c){var d=this.m_bodyA,
f=this.m_bodyB,g,h=0;this.m_localCenterA.SetV(d.GetLocalCenter());this.m_localCenterB.SetV(f.GetLocalCenter());var j=d.GetTransform();f.GetTransform();g=d.m_xf.R;var m=this.m_localAnchor1.x-this.m_localCenterA.x,n=this.m_localAnchor1.y-this.m_localCenterA.y,h=g.col1.x*m+g.col2.x*n,n=g.col1.y*m+g.col2.y*n,m=h;g=f.m_xf.R;var o=this.m_localAnchor2.x-this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y,h=g.col1.x*o+g.col2.x*p,p=g.col1.y*o+g.col2.y*p,o=h;g=f.m_sweep.c.x+o-d.m_sweep.c.x-
m;h=f.m_sweep.c.y+p-d.m_sweep.c.y-n;this.m_invMassA=d.m_invMass;this.m_invMassB=f.m_invMass;this.m_invIA=d.m_invI;this.m_invIB=f.m_invI;this.m_axis.SetV(e.MulMV(j.R,this.m_localXAxis1));this.m_a1=(g+m)*this.m_axis.y-(h+n)*this.m_axis.x;this.m_a2=o*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass;this.m_perp.SetV(e.MulMV(j.R,this.m_localYAxis1));
this.m_s1=(g+m)*this.m_perp.y-(h+n)*this.m_perp.x;this.m_s2=o*this.m_perp.y-p*this.m_perp.x;j=this.m_invMassA;m=this.m_invMassB;n=this.m_invIA;o=this.m_invIB;this.m_K.col1.x=j+m+n*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2;this.m_K.col1.y=n*this.m_s1+o*this.m_s2;this.m_K.col1.z=n*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=n+o;this.m_K.col2.z=n*this.m_a1+o*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=j+m+n*this.m_a1*
this.m_a1+o*this.m_a2*this.m_a2;if(this.m_enableLimit)if(g=this.m_axis.x*g+this.m_axis.y*h,e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop)this.m_limitState=u.e_equalLimits;else if(g<=this.m_lowerTranslation){if(this.m_limitState!=u.e_atLowerLimit)this.m_limitState=u.e_atLowerLimit,this.m_impulse.z=0}else if(g>=this.m_upperTranslation){if(this.m_limitState!=u.e_atUpperLimit)this.m_limitState=u.e_atUpperLimit,this.m_impulse.z=0}else this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=
0;else this.m_limitState=u.e_inactiveLimit;if(this.m_enableMotor==!1)this.m_motorImpulse=0;c.warmStarting?(this.m_impulse.x*=c.dtRatio,this.m_impulse.y*=c.dtRatio,this.m_motorImpulse*=c.dtRatio,c=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,h=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,j=this.m_impulse.x*this.m_s2+this.m_impulse.y+
(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*c,d.m_linearVelocity.y-=this.m_invMassA*g,d.m_angularVelocity-=this.m_invIA*h,f.m_linearVelocity.x+=this.m_invMassB*c,f.m_linearVelocity.y+=this.m_invMassB*g,f.m_angularVelocity+=this.m_invIB*j):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};I.prototype.SolveVelocityConstraints=function(b){var c=this.m_bodyA,d=this.m_bodyB,h=c.m_linearVelocity,j=c.m_angularVelocity,m=d.m_linearVelocity,n=d.m_angularVelocity,
o=0,p=0,t=0,w=0;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits)w=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(m.x-h.x)+this.m_axis.y*(m.y-h.y)+this.m_a2*n-this.m_a1*j)),o=this.m_motorImpulse,b=b.dt*this.m_maxMotorForce,this.m_motorImpulse=e.Clamp(this.m_motorImpulse+w,-b,b),w=this.m_motorImpulse-o,o=w*this.m_axis.x,p=w*this.m_axis.y,t=w*this.m_a1,w*=this.m_a2,h.x-=this.m_invMassA*o,h.y-=this.m_invMassA*p,j-=this.m_invIA*t,m.x+=this.m_invMassB*o,m.y+=this.m_invMassB*p,n+=this.m_invIB*
w;t=this.m_perp.x*(m.x-h.x)+this.m_perp.y*(m.y-h.y)+this.m_s2*n-this.m_s1*j;p=n-j;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){b=this.m_axis.x*(m.x-h.x)+this.m_axis.y*(m.y-h.y)+this.m_a2*n-this.m_a1*j;o=this.m_impulse.Copy();b=this.m_K.Solve33(new g,-t,-p,-b);this.m_impulse.Add(b);if(this.m_limitState==u.e_atLowerLimit)this.m_impulse.z=e.Max(this.m_impulse.z,0);else if(this.m_limitState==u.e_atUpperLimit)this.m_impulse.z=e.Min(this.m_impulse.z,0);t=-t-(this.m_impulse.z-o.z)*this.m_K.col3.x;
p=-p-(this.m_impulse.z-o.z)*this.m_K.col3.y;p=this.m_K.Solve22(new f,t,p);p.x+=o.x;p.y+=o.y;this.m_impulse.x=p.x;this.m_impulse.y=p.y;b.x=this.m_impulse.x-o.x;b.y=this.m_impulse.y-o.y;b.z=this.m_impulse.z-o.z;o=b.x*this.m_perp.x+b.z*this.m_axis.x;p=b.x*this.m_perp.y+b.z*this.m_axis.y;t=b.x*this.m_s1+b.y+b.z*this.m_a1;w=b.x*this.m_s2+b.y+b.z*this.m_a2}else b=this.m_K.Solve22(new f,-t,-p),this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,o=b.x*this.m_perp.x,p=b.x*this.m_perp.y,t=b.x*this.m_s1+b.y,w=b.x*this.m_s2+
b.y;h.x-=this.m_invMassA*o;h.y-=this.m_invMassA*p;j-=this.m_invIA*t;m.x+=this.m_invMassB*o;m.y+=this.m_invMassB*p;n+=this.m_invIB*w;c.m_linearVelocity.SetV(h);c.m_angularVelocity=j;d.m_linearVelocity.SetV(m);d.m_angularVelocity=n};I.prototype.SolvePositionConstraints=function(){var d=this.m_bodyA,h=this.m_bodyB,k=d.m_sweep.c,j=d.m_sweep.a,m=h.m_sweep.c,n=h.m_sweep.a,o,p=0,u=0,t=0,w=p=o=0,x=0,u=!1,A=0,B=c.FromAngle(j),y=c.FromAngle(n);o=B;var x=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-
this.m_localCenterA.y,p=o.col1.x*x+o.col2.x*C,C=o.col1.y*x+o.col2.y*C,x=p;o=y;y=this.m_localAnchor2.x-this.m_localCenterB.x;t=this.m_localAnchor2.y-this.m_localCenterB.y;p=o.col1.x*y+o.col2.x*t;t=o.col1.y*y+o.col2.y*t;y=p;o=m.x+y-k.x-x;p=m.y+t-k.y-C;if(this.m_enableLimit){this.m_axis=e.MulMV(B,this.m_localXAxis1);this.m_a1=(o+x)*this.m_axis.y-(p+C)*this.m_axis.x;this.m_a2=y*this.m_axis.y-t*this.m_axis.x;var D=this.m_axis.x*o+this.m_axis.y*p;e.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*
b.b2_linearSlop?(A=e.Clamp(D,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),w=e.Abs(D),u=!0):D<=this.m_lowerTranslation?(A=e.Clamp(D-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),w=this.m_lowerTranslation-D,u=!0):D>=this.m_upperTranslation&&(A=e.Clamp(D-this.m_upperTranslation+b.b2_linearSlop,0,b.b2_maxLinearCorrection),w=D-this.m_upperTranslation,u=!0)}this.m_perp=e.MulMV(B,this.m_localYAxis1);this.m_s1=(o+x)*this.m_perp.y-(p+C)*this.m_perp.x;this.m_s2=y*this.m_perp.y-
t*this.m_perp.x;B=new g;C=this.m_perp.x*o+this.m_perp.y*p;y=n-j-this.m_refAngle;w=e.Max(w,e.Abs(C));x=e.Abs(y);u?(u=this.m_invMassA,t=this.m_invMassB,o=this.m_invIA,p=this.m_invIB,this.m_K.col1.x=u+t+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+p*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+p,this.m_K.col2.z=o*this.m_a1+p*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=
u+t+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_K.Solve33(B,-C,-y,-A)):(u=this.m_invMassA,t=this.m_invMassB,o=this.m_invIA,p=this.m_invIB,A=o*this.m_s1+p*this.m_s2,D=o+p,this.m_K.col1.Set(u+t+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,A,0),this.m_K.col2.Set(A,D,0),A=this.m_K.Solve22(new f,-C,-y),B.x=A.x,B.y=A.y,B.z=0);A=B.x*this.m_perp.x+B.z*this.m_axis.x;u=B.x*this.m_perp.y+B.z*this.m_axis.y;C=B.x*this.m_s1+B.y+B.z*this.m_a1;B=B.x*this.m_s2+B.y+B.z*this.m_a2;k.x-=this.m_invMassA*A;k.y-=this.m_invMassA*
u;j-=this.m_invIA*C;m.x+=this.m_invMassB*A;m.y+=this.m_invMassB*u;n+=this.m_invIB*B;d.m_sweep.a=j;h.m_sweep.a=n;d.SynchronizeTransform();h.SynchronizeTransform();return w<=b.b2_linearSlop&&x<=b.b2_angularSlop};Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new f;this.localAnchorB=new f;this.localAxisA=new f};D.prototype.b2PrismaticJointDef=
function(){this.__super.b2JointDef.call(this);this.type=u.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};D.prototype.Initialize=function(b,c,d,e){this.bodyA=b;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};
Box2D.inherit(F,Box2D.Dynamics.Joints.b2Joint);F.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;F.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new f;this.m_groundAnchor2=new f;this.m_localAnchor1=new f;this.m_localAnchor2=new f;this.m_u1=new f;this.m_u2=new f};F.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};F.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
F.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*this.m_impulse*this.m_u2.x,b*this.m_impulse*this.m_u2.y)};F.prototype.GetReactionTorque=function(){return 0};F.prototype.GetGroundAnchorA=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor1);return b};F.prototype.GetGroundAnchorB=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor2);return b};F.prototype.GetLength1=function(){var b=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),
c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+b*b)};F.prototype.GetLength2=function(){var b=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),c=b.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),b=b.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+b*b)};F.prototype.GetRatio=function(){return this.m_ratio};F.prototype.b2PulleyJoint=function(b){this.__super.b2Joint.call(this,
b);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=b.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=b.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=b.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=b.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_ratio=b.ratio;this.m_constant=b.lengthA+this.m_ratio*b.lengthB;this.m_maxLength1=
e.Min(b.maxLengthA,this.m_constant-this.m_ratio*F.b2_minPulleyLength);this.m_maxLength2=e.Min(b.maxLengthB,(this.m_constant-F.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};F.prototype.InitVelocityConstraints=function(c){var d=this.m_bodyA,e=this.m_bodyB,f;f=d.m_xf.R;var g=this.m_localAnchor1.x-d.m_sweep.localCenter.x,h=this.m_localAnchor1.y-d.m_sweep.localCenter.y,j=f.col1.x*g+f.col2.x*h,h=f.col1.y*g+f.col2.y*h,g=j;f=e.m_xf.R;var m=this.m_localAnchor2.x-
e.m_sweep.localCenter.x,n=this.m_localAnchor2.y-e.m_sweep.localCenter.y,j=f.col1.x*m+f.col2.x*n,n=f.col1.y*m+f.col2.y*n,m=j;f=e.m_sweep.c.x+m;var j=e.m_sweep.c.y+n,o=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,p=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(d.m_sweep.c.x+g-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),d.m_sweep.c.y+h-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(f-o,j-p);f=this.m_u1.Length();j=this.m_u2.Length();f>b.b2_linearSlop?
this.m_u1.Multiply(1/f):this.m_u1.SetZero();j>b.b2_linearSlop?this.m_u2.Multiply(1/j):this.m_u2.SetZero();this.m_constant-f-this.m_ratio*j>0?(this.m_state=u.e_inactiveLimit,this.m_impulse=0):this.m_state=u.e_atUpperLimit;f<this.m_maxLength1?(this.m_limitState1=u.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=u.e_atUpperLimit;j<this.m_maxLength2?(this.m_limitState2=u.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=u.e_atUpperLimit;f=g*this.m_u1.y-h*this.m_u1.x;j=m*this.m_u2.y-
n*this.m_u2.x;this.m_limitMass1=d.m_invMass+d.m_invI*f*f;this.m_limitMass2=e.m_invMass+e.m_invI*j*j;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;c.warmStarting?(this.m_impulse*=c.dtRatio,this.m_limitImpulse1*=c.dtRatio,this.m_limitImpulse2*=c.dtRatio,c=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,f=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,
j=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,o=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*c,d.m_linearVelocity.y+=d.m_invMass*f,d.m_angularVelocity+=d.m_invI*(g*f-h*c),e.m_linearVelocity.x+=e.m_invMass*j,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(m*o-n*j)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};F.prototype.SolveVelocityConstraints=function(){var b=this.m_bodyA,c=this.m_bodyB,d;
d=b.m_xf.R;var f=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=d.col1.x*f+d.col2.x*g,g=d.col1.y*f+d.col2.y*g,f=h;d=c.m_xf.R;var j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,m=this.m_localAnchor2.y-c.m_sweep.localCenter.y,h=d.col1.x*j+d.col2.x*m,m=d.col1.y*j+d.col2.y*m,j=h,n=h=d=0,o=0;d=o=d=o=n=h=d=0;if(this.m_state==u.e_atUpperLimit)d=b.m_linearVelocity.x+-b.m_angularVelocity*g,h=b.m_linearVelocity.y+b.m_angularVelocity*f,n=c.m_linearVelocity.x+
-c.m_angularVelocity*m,o=c.m_linearVelocity.y+c.m_angularVelocity*j,d=-(this.m_u1.x*d+this.m_u1.y*h)-this.m_ratio*(this.m_u2.x*n+this.m_u2.y*o),o=this.m_pulleyMass*-d,d=this.m_impulse,this.m_impulse=e.Max(0,this.m_impulse+o),o=this.m_impulse-d,d=-o*this.m_u1.x,h=-o*this.m_u1.y,n=-this.m_ratio*o*this.m_u2.x,o=-this.m_ratio*o*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*d,b.m_linearVelocity.y+=b.m_invMass*h,b.m_angularVelocity+=b.m_invI*(f*h-g*d),c.m_linearVelocity.x+=c.m_invMass*n,c.m_linearVelocity.y+=
c.m_invMass*o,c.m_angularVelocity+=c.m_invI*(j*o-m*n);if(this.m_limitState1==u.e_atUpperLimit)d=b.m_linearVelocity.x+-b.m_angularVelocity*g,h=b.m_linearVelocity.y+b.m_angularVelocity*f,d=-(this.m_u1.x*d+this.m_u1.y*h),o=-this.m_limitMass1*d,d=this.m_limitImpulse1,this.m_limitImpulse1=e.Max(0,this.m_limitImpulse1+o),o=this.m_limitImpulse1-d,d=-o*this.m_u1.x,h=-o*this.m_u1.y,b.m_linearVelocity.x+=b.m_invMass*d,b.m_linearVelocity.y+=b.m_invMass*h,b.m_angularVelocity+=b.m_invI*(f*h-g*d);if(this.m_limitState2==
u.e_atUpperLimit)n=c.m_linearVelocity.x+-c.m_angularVelocity*m,o=c.m_linearVelocity.y+c.m_angularVelocity*j,d=-(this.m_u2.x*n+this.m_u2.y*o),o=-this.m_limitMass2*d,d=this.m_limitImpulse2,this.m_limitImpulse2=e.Max(0,this.m_limitImpulse2+o),o=this.m_limitImpulse2-d,n=-o*this.m_u2.x,o=-o*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*n,c.m_linearVelocity.y+=c.m_invMass*o,c.m_angularVelocity+=c.m_invI*(j*o-m*n)};F.prototype.SolvePositionConstraints=function(){var c=this.m_bodyA,d=this.m_bodyB,f,g=this.m_ground.m_xf.position.x+
this.m_groundAnchor1.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,j=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,m=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,o=0,n=0,p=0,t=0,w=f=0,x=0,A=0,y=w=A=f=w=f=0;if(this.m_state==u.e_atUpperLimit)f=c.m_xf.R,o=this.m_localAnchor1.x-c.m_sweep.localCenter.x,n=this.m_localAnchor1.y-c.m_sweep.localCenter.y,w=f.col1.x*o+f.col2.x*n,n=f.col1.y*o+f.col2.y*n,o=w,f=d.m_xf.R,p=this.m_localAnchor2.x-d.m_sweep.localCenter.x,t=this.m_localAnchor2.y-
d.m_sweep.localCenter.y,w=f.col1.x*p+f.col2.x*t,t=f.col1.y*p+f.col2.y*t,p=w,f=c.m_sweep.c.x+o,w=c.m_sweep.c.y+n,x=d.m_sweep.c.x+p,A=d.m_sweep.c.y+t,this.m_u1.Set(f-g,w-h),this.m_u2.Set(x-j,A-m),f=this.m_u1.Length(),w=this.m_u2.Length(),f>b.b2_linearSlop?this.m_u1.Multiply(1/f):this.m_u1.SetZero(),w>b.b2_linearSlop?this.m_u2.Multiply(1/w):this.m_u2.SetZero(),f=this.m_constant-f-this.m_ratio*w,y=e.Max(y,-f),f=e.Clamp(f+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),A=-this.m_pulleyMass*f,f=-A*this.m_u1.x,
w=-A*this.m_u1.y,x=-this.m_ratio*A*this.m_u2.x,A=-this.m_ratio*A*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*f,c.m_sweep.c.y+=c.m_invMass*w,c.m_sweep.a+=c.m_invI*(o*w-n*f),d.m_sweep.c.x+=d.m_invMass*x,d.m_sweep.c.y+=d.m_invMass*A,d.m_sweep.a+=d.m_invI*(p*A-t*x),c.SynchronizeTransform(),d.SynchronizeTransform();if(this.m_limitState1==u.e_atUpperLimit)f=c.m_xf.R,o=this.m_localAnchor1.x-c.m_sweep.localCenter.x,n=this.m_localAnchor1.y-c.m_sweep.localCenter.y,w=f.col1.x*o+f.col2.x*n,n=f.col1.y*o+f.col2.y*n,
o=w,f=c.m_sweep.c.x+o,w=c.m_sweep.c.y+n,this.m_u1.Set(f-g,w-h),f=this.m_u1.Length(),f>b.b2_linearSlop?(this.m_u1.x*=1/f,this.m_u1.y*=1/f):this.m_u1.SetZero(),f=this.m_maxLength1-f,y=e.Max(y,-f),f=e.Clamp(f+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),A=-this.m_limitMass1*f,f=-A*this.m_u1.x,w=-A*this.m_u1.y,c.m_sweep.c.x+=c.m_invMass*f,c.m_sweep.c.y+=c.m_invMass*w,c.m_sweep.a+=c.m_invI*(o*w-n*f),c.SynchronizeTransform();if(this.m_limitState2==u.e_atUpperLimit)f=d.m_xf.R,p=this.m_localAnchor2.x-d.m_sweep.localCenter.x,
t=this.m_localAnchor2.y-d.m_sweep.localCenter.y,w=f.col1.x*p+f.col2.x*t,t=f.col1.y*p+f.col2.y*t,p=w,x=d.m_sweep.c.x+p,A=d.m_sweep.c.y+t,this.m_u2.Set(x-j,A-m),w=this.m_u2.Length(),w>b.b2_linearSlop?(this.m_u2.x*=1/w,this.m_u2.y*=1/w):this.m_u2.SetZero(),f=this.m_maxLength2-w,y=e.Max(y,-f),f=e.Clamp(f+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),A=-this.m_limitMass2*f,x=-A*this.m_u2.x,A=-A*this.m_u2.y,d.m_sweep.c.x+=d.m_invMass*x,d.m_sweep.c.y+=d.m_invMass*A,d.m_sweep.a+=d.m_invI*(p*A-t*x),d.SynchronizeTransform();
return y<b.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(T,Box2D.Dynamics.Joints.b2JointDef);T.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;T.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new f;this.groundAnchorB=new f;this.localAnchorA=new f;this.localAnchorB=new f};T.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=
u.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};T.prototype.Initialize=function(b,c,d,e,f,g,h){h===void 0&&(h=0);this.bodyA=b;this.bodyB=c;this.groundAnchorA.SetV(d);this.groundAnchorB.SetV(e);this.localAnchorA=this.bodyA.GetLocalPoint(f);this.localAnchorB=this.bodyB.GetLocalPoint(g);b=f.x-d.x;d=f.y-d.y;this.lengthA=Math.sqrt(b*
b+d*d);d=g.x-e.x;e=g.y-e.y;this.lengthB=Math.sqrt(d*d+e*e);this.ratio=h;h=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=h-this.ratio*F.b2_minPulleyLength;this.maxLengthB=(h-F.b2_minPulleyLength)/this.ratio};Box2D.inherit(L,Box2D.Dynamics.Joints.b2Joint);L.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;L.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new c;this.K1=new c;this.K2=new c;this.K3=new c;this.impulse3=new g;this.impulse2=new f;
this.reduced=new f;this.m_localAnchor1=new f;this.m_localAnchor2=new f;this.m_impulse=new g;this.m_mass=new d};L.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};L.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};L.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*this.m_impulse.x,b*this.m_impulse.y)};L.prototype.GetReactionTorque=function(b){b===void 0&&(b=0);return b*this.m_impulse.z};L.prototype.GetJointAngle=
function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};L.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};L.prototype.IsLimitEnabled=function(){return this.m_enableLimit};L.prototype.EnableLimit=function(b){this.m_enableLimit=b};L.prototype.GetLowerLimit=function(){return this.m_lowerAngle};L.prototype.GetUpperLimit=function(){return this.m_upperAngle};L.prototype.SetLimits=function(b,c){b===void 0&&(b=0);c===
void 0&&(c=0);this.m_lowerAngle=b;this.m_upperAngle=c};L.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};L.prototype.EnableMotor=function(b){this.m_enableMotor=b};L.prototype.SetMotorSpeed=function(b){b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=b};L.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};L.prototype.SetMaxMotorTorque=function(b){b===void 0&&(b=0);this.m_maxMotorTorque=
b};L.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};L.prototype.b2RevoluteJoint=function(b){this.__super.b2Joint.call(this,b);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_referenceAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=b.lowerAngle;this.m_upperAngle=b.upperAngle;this.m_maxMotorTorque=b.maxMotorTorque;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor;
this.m_limitState=u.e_inactiveLimit};L.prototype.InitVelocityConstraints=function(c){var d=this.m_bodyA,f=this.m_bodyB,g,h=0;g=d.m_xf.R;var j=this.m_localAnchor1.x-d.m_sweep.localCenter.x,m=this.m_localAnchor1.y-d.m_sweep.localCenter.y,h=g.col1.x*j+g.col2.x*m,m=g.col1.y*j+g.col2.y*m,j=h;g=f.m_xf.R;var o=this.m_localAnchor2.x-f.m_sweep.localCenter.x,n=this.m_localAnchor2.y-f.m_sweep.localCenter.y,h=g.col1.x*o+g.col2.x*n,n=g.col1.y*o+g.col2.y*n,o=h;g=d.m_invMass;var h=f.m_invMass,p=d.m_invI,t=f.m_invI;
this.m_mass.col1.x=g+h+m*m*p+n*n*t;this.m_mass.col2.x=-m*j*p-n*o*t;this.m_mass.col3.x=-m*p-n*t;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=g+h+j*j*p+o*o*t;this.m_mass.col3.y=j*p+o*t;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+t;this.m_motorMass=1/(p+t);if(this.m_enableMotor==!1)this.m_motorImpulse=0;if(this.m_enableLimit){var w=f.m_sweep.a-d.m_sweep.a-this.m_referenceAngle;if(e.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b.b2_angularSlop)this.m_limitState=
u.e_equalLimits;else if(w<=this.m_lowerAngle){if(this.m_limitState!=u.e_atLowerLimit)this.m_impulse.z=0;this.m_limitState=u.e_atLowerLimit}else if(w>=this.m_upperAngle){if(this.m_limitState!=u.e_atUpperLimit)this.m_impulse.z=0;this.m_limitState=u.e_atUpperLimit}else this.m_limitState=u.e_inactiveLimit,this.m_impulse.z=0}else this.m_limitState=u.e_inactiveLimit;c.warmStarting?(this.m_impulse.x*=c.dtRatio,this.m_impulse.y*=c.dtRatio,this.m_motorImpulse*=c.dtRatio,c=this.m_impulse.x,w=this.m_impulse.y,
d.m_linearVelocity.x-=g*c,d.m_linearVelocity.y-=g*w,d.m_angularVelocity-=p*(j*w-m*c+this.m_motorImpulse+this.m_impulse.z),f.m_linearVelocity.x+=h*c,f.m_linearVelocity.y+=h*w,f.m_angularVelocity+=t*(o*w-n*c+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};L.prototype.SolveVelocityConstraints=function(b){var c=this.m_bodyA,d=this.m_bodyB,f=0,g=f=0,h=0,j=0,m=0,o=c.m_linearVelocity,n=c.m_angularVelocity,p=d.m_linearVelocity,t=d.m_angularVelocity,w=c.m_invMass,x=
d.m_invMass,y=c.m_invI,A=d.m_invI;if(this.m_enableMotor&&this.m_limitState!=u.e_equalLimits)g=this.m_motorMass*-(t-n-this.m_motorSpeed),h=this.m_motorImpulse,j=b.dt*this.m_maxMotorTorque,this.m_motorImpulse=e.Clamp(this.m_motorImpulse+g,-j,j),g=this.m_motorImpulse-h,n-=y*g,t+=A*g;if(this.m_enableLimit&&this.m_limitState!=u.e_inactiveLimit){var b=c.m_xf.R,g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,
g=f,b=d.m_xf.R,j=this.m_localAnchor2.x-d.m_sweep.localCenter.x,m=this.m_localAnchor2.y-d.m_sweep.localCenter.y,f=b.col1.x*j+b.col2.x*m,m=b.col1.y*j+b.col2.y*m,j=f,b=p.x+-t*m-o.x- -n*h,B=p.y+t*j-o.y-n*g;this.m_mass.Solve33(this.impulse3,-b,-B,-(t-n));if(this.m_limitState==u.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==u.e_atLowerLimit){if(f=this.m_impulse.z+this.impulse3.z,f<0)this.m_mass.Solve22(this.reduced,-b,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,
this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0}else if(this.m_limitState==u.e_atUpperLimit&&(f=this.m_impulse.z+this.impulse3.z,f>0))this.m_mass.Solve22(this.reduced,-b,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0;o.x-=w*this.impulse3.x;o.y-=w*this.impulse3.y;n-=y*(g*this.impulse3.y-h*this.impulse3.x+
this.impulse3.z);p.x+=x*this.impulse3.x;p.y+=x*this.impulse3.y;t+=A*(j*this.impulse3.y-m*this.impulse3.x+this.impulse3.z)}else b=c.m_xf.R,g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=f,b=d.m_xf.R,j=this.m_localAnchor2.x-d.m_sweep.localCenter.x,m=this.m_localAnchor2.y-d.m_sweep.localCenter.y,f=b.col1.x*j+b.col2.x*m,m=b.col1.y*j+b.col2.y*m,j=f,this.m_mass.Solve22(this.impulse2,-(p.x+-t*m-o.x- -n*h),
-(p.y+t*j-o.y-n*g)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,o.x-=w*this.impulse2.x,o.y-=w*this.impulse2.y,n-=y*(g*this.impulse2.y-h*this.impulse2.x),p.x+=x*this.impulse2.x,p.y+=x*this.impulse2.y,t+=A*(j*this.impulse2.y-m*this.impulse2.x);c.m_linearVelocity.SetV(o);c.m_angularVelocity=n;d.m_linearVelocity.SetV(p);d.m_angularVelocity=t};L.prototype.SolvePositionConstraints=function(){var c=0,d,f=this.m_bodyA,g=this.m_bodyB,h=0,j=d=0,m=0,o=0;if(this.m_enableLimit&&this.m_limitState!=
u.e_inactiveLimit){var c=g.m_sweep.a-f.m_sweep.a-this.m_referenceAngle,n=0;this.m_limitState==u.e_equalLimits?(c=e.Clamp(c-this.m_lowerAngle,-b.b2_maxAngularCorrection,b.b2_maxAngularCorrection),n=-this.m_motorMass*c,h=e.Abs(c)):this.m_limitState==u.e_atLowerLimit?(c-=this.m_lowerAngle,h=-c,c=e.Clamp(c+b.b2_angularSlop,-b.b2_maxAngularCorrection,0),n=-this.m_motorMass*c):this.m_limitState==u.e_atUpperLimit&&(c-=this.m_upperAngle,h=c,c=e.Clamp(c-b.b2_angularSlop,0,b.b2_maxAngularCorrection),n=-this.m_motorMass*
c);f.m_sweep.a-=f.m_invI*n;g.m_sweep.a+=g.m_invI*n;f.SynchronizeTransform();g.SynchronizeTransform()}d=f.m_xf.R;n=this.m_localAnchor1.x-f.m_sweep.localCenter.x;c=this.m_localAnchor1.y-f.m_sweep.localCenter.y;j=d.col1.x*n+d.col2.x*c;c=d.col1.y*n+d.col2.y*c;n=j;d=g.m_xf.R;var p=this.m_localAnchor2.x-g.m_sweep.localCenter.x,t=this.m_localAnchor2.y-g.m_sweep.localCenter.y,j=d.col1.x*p+d.col2.x*t,t=d.col1.y*p+d.col2.y*t,p=j,m=g.m_sweep.c.x+p-f.m_sweep.c.x-n,o=g.m_sweep.c.y+t-f.m_sweep.c.y-c,w=m*m+o*o;
d=Math.sqrt(w);var j=f.m_invMass,x=g.m_invMass,A=f.m_invI,y=g.m_invI,B=10*b.b2_linearSlop;w>B*B&&(w=1/(j+x),m=w*-m,o=w*-o,f.m_sweep.c.x-=0.5*j*m,f.m_sweep.c.y-=0.5*j*o,g.m_sweep.c.x+=0.5*x*m,g.m_sweep.c.y+=0.5*x*o,m=g.m_sweep.c.x+p-f.m_sweep.c.x-n,o=g.m_sweep.c.y+t-f.m_sweep.c.y-c);this.K1.col1.x=j+x;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=j+x;this.K2.col1.x=A*c*c;this.K2.col2.x=-A*n*c;this.K2.col1.y=-A*n*c;this.K2.col2.y=A*n*n;this.K3.col1.x=y*t*t;this.K3.col2.x=-y*p*t;this.K3.col1.y=-y*
p*t;this.K3.col2.y=y*p*p;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(L.tImpulse,-m,-o);m=L.tImpulse.x;o=L.tImpulse.y;f.m_sweep.c.x-=f.m_invMass*m;f.m_sweep.c.y-=f.m_invMass*o;f.m_sweep.a-=f.m_invI*(n*o-c*m);g.m_sweep.c.x+=g.m_invMass*m;g.m_sweep.c.y+=g.m_invMass*o;g.m_sweep.a+=g.m_invI*(p*o-t*m);f.SynchronizeTransform();g.SynchronizeTransform();return d<=b.b2_linearSlop&&h<=b.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=
new f});Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new f;this.localAnchorB=new f};M.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=
0;this.enableMotor=this.enableLimit=!1};M.prototype.Initialize=function(b,c,d){this.bodyA=b;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(N,Box2D.Dynamics.Joints.b2Joint);N.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;N.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new f;this.m_localAnchorB=new f;
this.m_impulse=new g;this.m_mass=new d};N.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};N.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};N.prototype.GetReactionForce=function(b){b===void 0&&(b=0);return new f(b*this.m_impulse.x,b*this.m_impulse.y)};N.prototype.GetReactionTorque=function(b){b===void 0&&(b=0);return b*this.m_impulse.z};N.prototype.b2WeldJoint=function(b){this.__super.b2Joint.call(this,b);this.m_localAnchorA.SetV(b.localAnchorA);
this.m_localAnchorB.SetV(b.localAnchorB);this.m_referenceAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_mass=new d};N.prototype.InitVelocityConstraints=function(b){var c,d=0,e=this.m_bodyA,f=this.m_bodyB;c=e.m_xf.R;var g=this.m_localAnchorA.x-e.m_sweep.localCenter.x,h=this.m_localAnchorA.y-e.m_sweep.localCenter.y,d=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=d;c=f.m_xf.R;var j=this.m_localAnchorB.x-f.m_sweep.localCenter.x,m=this.m_localAnchorB.y-f.m_sweep.localCenter.y,d=c.col1.x*j+c.col2.x*
m,m=c.col1.y*j+c.col2.y*m,j=d;c=e.m_invMass;var d=f.m_invMass,o=e.m_invI,n=f.m_invI;this.m_mass.col1.x=c+d+h*h*o+m*m*n;this.m_mass.col2.x=-h*g*o-m*j*n;this.m_mass.col3.x=-h*o-m*n;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+d+g*g*o+j*j*n;this.m_mass.col3.y=g*o+j*n;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=o+n;b.warmStarting?(this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_impulse.z*=b.dtRatio,e.m_linearVelocity.x-=c*
this.m_impulse.x,e.m_linearVelocity.y-=c*this.m_impulse.y,e.m_angularVelocity-=o*(g*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z),f.m_linearVelocity.x+=d*this.m_impulse.x,f.m_linearVelocity.y+=d*this.m_impulse.y,f.m_angularVelocity+=n*(j*this.m_impulse.y-m*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};N.prototype.SolveVelocityConstraints=function(){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,h=d.m_angularVelocity,j=e.m_linearVelocity,m=e.m_angularVelocity,
o=d.m_invMass,n=e.m_invMass,p=d.m_invI,u=e.m_invI;b=d.m_xf.R;var t=this.m_localAnchorA.x-d.m_sweep.localCenter.x,w=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*t+b.col2.x*w,w=b.col1.y*t+b.col2.y*w,t=c;b=e.m_xf.R;var x=this.m_localAnchorB.x-e.m_sweep.localCenter.x,A=this.m_localAnchorB.y-e.m_sweep.localCenter.y,c=b.col1.x*x+b.col2.x*A,A=b.col1.y*x+b.col2.y*A,x=c;b=j.x-m*A-f.x+h*w;var c=j.y+m*x-f.y-h*t,B=m-h,C=new g;this.m_mass.Solve33(C,-b,-c,-B);this.m_impulse.Add(C);f.x-=o*C.x;f.y-=o*
C.y;h-=p*(t*C.y-w*C.x+C.z);j.x+=n*C.x;j.y+=n*C.y;m+=u*(x*C.y-A*C.x+C.z);d.m_angularVelocity=h;e.m_angularVelocity=m};N.prototype.SolvePositionConstraints=function(){var c,d=0,f=this.m_bodyA,h=this.m_bodyB;c=f.m_xf.R;var j=this.m_localAnchorA.x-f.m_sweep.localCenter.x,m=this.m_localAnchorA.y-f.m_sweep.localCenter.y,d=c.col1.x*j+c.col2.x*m,m=c.col1.y*j+c.col2.y*m,j=d;c=h.m_xf.R;var o=this.m_localAnchorB.x-h.m_sweep.localCenter.x,n=this.m_localAnchorB.y-h.m_sweep.localCenter.y,d=c.col1.x*o+c.col2.x*
n,n=c.col1.y*o+c.col2.y*n,o=d;c=f.m_invMass;var d=h.m_invMass,p=f.m_invI,t=h.m_invI,u=h.m_sweep.c.x+o-f.m_sweep.c.x-j,w=h.m_sweep.c.y+n-f.m_sweep.c.y-m,x=h.m_sweep.a-f.m_sweep.a-this.m_referenceAngle,A=10*b.b2_linearSlop,y=Math.sqrt(u*u+w*w),B=e.Abs(x);y>A&&(p*=1,t*=1);this.m_mass.col1.x=c+d+m*m*p+n*n*t;this.m_mass.col2.x=-m*j*p-n*o*t;this.m_mass.col3.x=-m*p-n*t;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+d+j*j*p+o*o*t;this.m_mass.col3.y=j*p+o*t;this.m_mass.col1.z=this.m_mass.col3.x;
this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+t;A=new g;this.m_mass.Solve33(A,-u,-w,-x);f.m_sweep.c.x-=c*A.x;f.m_sweep.c.y-=c*A.y;f.m_sweep.a-=p*(j*A.y-m*A.x+A.z);h.m_sweep.c.x+=d*A.x;h.m_sweep.c.y+=d*A.y;h.m_sweep.a+=t*(o*A.y-n*A.x+A.z);f.SynchronizeTransform();h.SynchronizeTransform();return y<=b.b2_linearSlop&&B<=b.b2_angularSlop};Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef);S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;S.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new f;this.localAnchorB=new f};S.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=u.e_weldJoint;this.referenceAngle=0};S.prototype.Initialize=function(b,c,d){this.bodyA=b;this.bodyB=c;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var b=Box2D.Dynamics.b2DebugDraw;b.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var b=this;this.m_sprite={graphics:{clear:function(){b.m_ctx.clearRect(0,0,b.m_ctx.canvas.width,b.m_ctx.canvas.height)}}}};b.prototype._color=function(b,d){return"rgba("+((b&16711680)>>16)+","+((b&65280)>>8)+","+(b&255)+","+d+")"};b.prototype.b2DebugDraw=function(){this.m_drawFlags=0};b.prototype.SetFlags=function(b){b===void 0&&(b=0);this.m_drawFlags=
b};b.prototype.GetFlags=function(){return this.m_drawFlags};b.prototype.AppendFlags=function(b){b===void 0&&(b=0);this.m_drawFlags|=b};b.prototype.ClearFlags=function(b){b===void 0&&(b=0);this.m_drawFlags&=~b};b.prototype.SetSprite=function(b){this.m_ctx=b};b.prototype.GetSprite=function(){return this.m_ctx};b.prototype.SetDrawScale=function(b){b===void 0&&(b=0);this.m_drawScale=b};b.prototype.GetDrawScale=function(){return this.m_drawScale};b.prototype.SetLineThickness=function(b){b===void 0&&(b=
0);this.m_lineThickness=b;this.m_ctx.strokeWidth=b};b.prototype.GetLineThickness=function(){return this.m_lineThickness};b.prototype.SetAlpha=function(b){b===void 0&&(b=0);this.m_alpha=b};b.prototype.GetAlpha=function(){return this.m_alpha};b.prototype.SetFillAlpha=function(b){b===void 0&&(b=0);this.m_fillAlpha=b};b.prototype.GetFillAlpha=function(){return this.m_fillAlpha};b.prototype.SetXFormScale=function(b){b===void 0&&(b=0);this.m_xformScale=b};b.prototype.GetXFormScale=function(){return this.m_xformScale};
b.prototype.DrawPolygon=function(b,d,e){if(d){var f=this.m_ctx,g=this.m_drawScale;f.beginPath();f.strokeStyle=this._color(e.color,this.m_alpha);f.moveTo((b[0].x+this.offsetX)*g,(b[0].y+this.offsetY)*g);for(e=1;e<d;e++)f.lineTo((b[e].x+this.offsetX)*g,(b[e].y+this.offsetY)*g);f.lineTo((b[0].x+this.offsetX)*g,(b[0].y+this.offsetY)*g);f.closePath();f.stroke()}};b.prototype.DrawSolidPolygon=function(b,d,e){if(d){var f=this.m_ctx,g=this.m_drawScale;f.beginPath();f.strokeStyle=this._color(e.color,this.m_alpha);
f.fillStyle=this._color(e.color,this.m_fillAlpha);f.moveTo((b[0].x+this.offsetX)*g,(b[0].y+this.offsetY)*g);for(e=1;e<d;e++)f.lineTo((b[e].x+this.offsetX)*g,(b[e].y+this.offsetY)*g);f.lineTo((b[0].x+this.offsetX)*g,(b[0].y+this.offsetY)*g);f.closePath();f.fill();f.stroke()}};b.prototype.DrawCircle=function(b,d,e){if(d){var f=this.m_ctx,g=this.m_drawScale;f.beginPath();f.strokeStyle=this._color(e.color,this.m_alpha);f.arc((b.x+this.offsetX)*g,(b.y+this.offsetY)*g,d*g,0,Math.PI*2,!0);f.closePath();
f.stroke()}};b.prototype.DrawSolidCircle=function(b,d,e,f){if(d){var g=this.m_ctx,h=this.m_drawScale,j=(b.x+this.offsetX)*h,m=(b.y+this.offsetY)*h;g.moveTo(0,0);g.beginPath();g.strokeStyle=this._color(f.color,this.m_alpha);g.fillStyle=this._color(f.color,this.m_fillAlpha);g.arc(j,m,d*h,0,Math.PI*2,!0);g.moveTo(j,m);g.lineTo((b.x+this.offsetX+e.x*d)*h,(b.y+this.offsetY+e.y*d)*h);g.closePath();g.fill();g.stroke()}};b.prototype.DrawSegment=function(b,d,e){var f=this.m_ctx,g=this.m_drawScale;f.strokeStyle=
this._color(e.color,this.m_alpha);f.beginPath();f.moveTo((b.x+this.offsetX)*g,(b.y+this.offsetY)*g);f.lineTo((d.x+this.offsetX)*g,(d.y+this.offsetY)*g);f.closePath();f.stroke()};b.prototype.DrawTransform=function(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath();d.strokeStyle=this._color(16711680,this.m_alpha);d.moveTo((b.position.x+this.offsetX)*e,b.position.y*e);d.lineTo((b.position.x+this.offsetX+this.m_xformScale*b.R.col1.x)*e,(b.position.y+this.offsetY+this.m_xformScale*b.R.col1.y)*e);d.strokeStyle=
this._color(65280,this.m_alpha);d.moveTo((b.position.x+this.offsetX)*e,(b.position.y+this.offsetY)*e);d.lineTo((b.position.x+this.offsetX+this.m_xformScale*b.R.col2.x)*e,(b.position.y+this.offsetY+this.m_xformScale*b.R.col2.y)*e);d.closePath();d.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;/*
 EventEmitter v2.0.0

 Copyright 2011, Oliver Caldwell (olivercaldwell.co.uk)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/Wolfy87/EventEmitter
*/
function EventEmitter(){var b=this,c={},d=null,e=null,f=null;b.addListener=function(d,e){c[d]?c[d].push(e):c[d]=[e];b.emit("newListener",d,e);return b};b.emit=function(f){f||console.error("Attempting to dispatch null event, probably an error");if(c[f]){e=Array.prototype.slice.call(arguments,1);for(d=0;d<c[f].length;d+=1)c[f][d].apply(null,e)}return b};b.listeners=function(b){c[b]||(c[b]=[]);return c[b]};b.once=function(c,d){function e(){d.apply(null,arguments);b.removeListener(c,e)}b.addListener(c,
e);return b};b.removeListener=function(e,h){if(c[e]){a:{var j=c[e];if(j.indexOf)f=j.indexOf(h);else{for(d=0;d<j.length;d+=1)if(j[d]===h){f=d;break a}f=-1}}f!==-1&&c[e].splice(f,1)}else c[e]=[];return b};b.removeAllListeners=function(d){c[d]=[];return b}};(function(){ChuClone=typeof ChuClone==="undefined"?{}:ChuClone;ChuClone.namespace=function(b){var b=b.split("."),c=ChuClone,d=0;b[0]==="ChuClone"&&(b=b.slice(1));for(var e=b.length,d=0;d<e;d+=1){var f=b[d];typeof c[f]==="undefined"&&(c[f]={});c=c[f]}return c};ChuClone.extend=function(b,c){var d=b.prototype,e=function(){};e.prototype=c.prototype;b.prototype=new e;b.superclass=c.prototype;b.prototype.constructor=b;if(c.prototype.constructor===Object.prototype.constructor)c.prototype.constructor=c;for(var f in d)d.hasOwnProperty(f)&&
(b.prototype[f]=d[f])}})();(function(){ChuClone.namespace("ChuClone.model");ChuClone.model.Constants={GAME_WIDTH:1E3,GAME_HEIGHT:500,PTM_RATIO:64,DOM_ELEMENT:null,INITIAL_STATE:"PlayLevel",IS_EDIT_MODE:function(){return window.location.href.toLowerCase().indexOf("edit")!=-1},IS_BLOOM:!1,MAX_LEVEL_AREA:4E8,SERVER:{ASSET_PREFIX:"",LEVEL_LOAD_LOCATION:"/levels/",USER_LEVELS_LOCATION:"/levels/data.json",USER_SUBMIT_LOCATION:"/levels/create_from_editor.js",SCORE_SUBMIT_LOCATION:"/levels/#/highscores.json",SCORE_LOAD_LOCATION:"/levels/#/highscores"},
TIMINGS:{TUTORIAL_FADE_OUT_TIME:3500},JOYSTICK:{ENABLED:!1,SERVER_LOCATION:"localhost",SERVER_PORT:"8081"},KEYS:{A:65,W:87,D:68,S:83,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39},EDITOR:{PANEL_DOMELEMENT:document.getElementById("guiContainer"),PANEL_WIDTH:190,PATH_SERVER_LOCAL_SAVE:"assets/levels/save.php"},ENTITY_TYPES:{PLAYER:2,PLATFORM:4},PLAYER:{WIDTH:30,HEIGHT:30,DEPTH:30,MATERIAL:new THREE.MeshPhongMaterial({ambient:255,color:6710886,specular:14540253,shininess:1,shading:THREE.FlatShading})}}})();(function(){ChuClone.namespace("ChuClone.model");var b=null;ChuClone.model.AchievementTracker=function(){b!=null&&console.error("AchievementTracker should never be instantiated twice! - Use getInstance()");b=this;this.reset()};ChuClone.model.AchievementTracker.prototype={_timerJump:null,_counterTotalJumps:0,_counterMaxAirtime:0,_counterTotalAirtime:0,_counterTotalDeaths:0,startTrackingJump:function(){this._timerJump?this.log("Already tracking a jump"):(this.log("Begin jump tracking"),this._timerJump=
Date.now(),this._counterTotalJumps++)},stopTrackingJump:function(){if(this._timerJump){var b=Date.now()-this._timerJump;if(b>this._counterMaxAirtime)this._counterMaxAirtime=b;this._counterTotalAirtime+=b;this._timerJump=null;this.log("AchievementTracker: Jump tracked:"+b/1E3+" secs")}},incrimentDeathCount:function(){this._counterTotalDeaths++},reset:function(){this._timerJump=null;this._counterTotalAirtime=this._counterMaxAirtime=this._counterTotalJumps=0;this._counterTotalDeaths=-1},log:function(){}};
ChuClone.model.AchievementTracker.getInstance=function(){if(b)return b;return new ChuClone.model.AchievementTracker}})();(function(){ChuClone.namespace("ChuClone");ChuClone.utils={getCWD:function(){return window.location.href.replace(/[^\/]*$/i,"")},getAssetPrefix:function(){return""},getLevelIDFromURL:function(){var b=window.location.href.match(/[\/](\d+)/);return b?b[1]:null},randFloat:function(b,c){return Math.random()*(c-b)+b},augmentCamera:function(b){if(b.hasOwnProperty("components"))console.error("CameraGUI.augmentCamera - Attempting to augment camera that already contains 'components' property ");else{b.components=
[];for(var c in ChuClone.GameEntity.prototype){if(!ChuClone.GameEntity.prototype.hasOwnProperty(c))return;c.toLowerCase().indexOf("component")!==-1&&ChuClone.GameEntity.prototype[c]instanceof Function&&(b[c]=ChuClone.GameEntity.prototype[c])}b.superUpdate=b.update;b.update=function(){for(var b=this.components.length,c=0;c<b;++c)this.components[c].requiresUpdate&&this.components[c].update();this.superUpdate.call(this)}}},repopulateOptionsGUI:function(b,c,d){d||(d|=function(b,c,d){b.value=d;b.innerText=
c.displayName;b.label=c.displayName.replace("Component","")});for(b=b.domElement.lastChild;b.firstChild;)b.removeChild(b.firstChild);for(var e=c.length,f=0;f<e;++f){var g=c[f],h=document.createElement("option");d(h,g,f);b.options[b.options.length]=h}},getValidationErrors:function(b){var c=null,c=/<pre>(.*?)<\/pre>/ig.exec(b);return c[1].substring(String("Validation failed: ").length).split(",")},getValidationErrorsFromJSON:function(b){var c=[],d;for(d in b)for(var e=0;e<b[d].length;e++)c.push(d+" "+
b[d][e]);return c},constructURLForLevelWithID:function(b){return ChuClone.model.Constants.SERVER.LEVEL_LOAD_LOCATION+b+".js?r="+Math.floor(Math.random()*1E3)},displayFlash:function(b,c){if(c===void 0)throw"Must suply level - either 1 or 0";var d=document.getElementById("flash_notice");if(d){var e=b;if(b instanceof Array)for(var e="",f=0;f<b.length;f++)e+=b[f]+"<br>";d.innerHTML=e;(new TWEEN.Tween([{r:255,g:128,b:128},{r:79,g:213,b:101}][c])).to({r:255,g:255,b:255},2E3).easing(TWEEN.Easing.Quadratic.EaseInOut).onUpdate(function(){d.style.backgroundColor=
"rgb("+(this.r<<0)+","+(this.g<<0)+","+(this.b<<0)+")"}).start()}else c==1?console.info("ChuClone.Utils.displayFlash",b):c==0&&console.error("ChuClone.Utils.displayFlash",b)},hideAllChildren:function(b,c){for(var d=0;d<b.children.length;d++)if(c.indexOf(b.children[d])===-1)b.children[d].style.display="none"},unhideAllChildren:function(b,c){for(var d=0;d<b.children.length;d++)if(!c||c.indexOf(b.children[d])!=-1)b.children[d].style.display=""},animateChildrenInFromBelow:function(b,c){for(var d=0;d<
b.children.length;d++){var e=b.children[d];e.style.top="0px";e.style.position="relative";(new TWEEN.Tween({target:e,pos:c||150,original:parseInt(e.style.top)})).to({pos:0},d*20+500).easing(TWEEN.Easing.Sinusoidal.EaseInOut).onUpdate(function(){this.target.style.top=Math.round(this.original+this.pos)+"px"}).start()}}}})();(function(){ChuClone.namespace("ChuClone.utils");var b={};ChuClone.utils.TextureUtils={GET_TEXTURE:function(c){if(b[c])return b[c];b[c]=THREE.ImageUtils.loadTexture(c);return b[c]}}})();(function(){ChuClone.namespace("ChuClone.utils");var b=["z-index","position","top","left","display","visibility"],c={};ChuClone.utils.StyleMemoizer={rememberStyle:function(d){c[d]={};for(var e=document.getElementById(d),f=0;f<b.length;f++){var g=b[f];c[d][g]=window.getComputedStyle(e).getPropertyValue(g)}},restoreStyle:function(d){if(c[d])for(var e=document.getElementById(d),f=0;f<b.length;f++){var g=b[f];e.style[g]=c[d][g]}else console.error("ChuClone.utils.styleMemoizer - Cannot restore style, none found!")}}})();(function(){var b=null,c=null;ChuClone.namespace("ChuClone.gui");ChuClone.gui.LevelListing=function(){};ChuClone.gui.LevelListing.getInstance=function(){b==null&&(b=new ChuClone.gui.LevelListing,window.addEventListener("DOMContentLoaded",function e(){window.removeEventListener("DOMContentLoaded",e,!1);b.onReady()},!1));return b};ChuClone.gui.LevelListing.prototype={EVENTS:{SHOULD_CHANGE_LEVEL:"ChuClone.gui.LevelListing.shouldChangeLevel"},onReady:function(){this.setupDivs()},setupDivs:function(){var b=
document.getElementById("levellisting");if(b)for(var c=0;c<b.children.length;++c){var f=b.children[c];f.addEventListener("click",this.onLevelClicked,!1);f.addEventListener("mouseover",this.onLevelRollover,!1)}else console.info("Could not find levellisting element. Aborting...")},onLevelRollover:function(){if(c!=this)c&&ChuClone.gui.LevelListing.prototype.onLevelRollout.call(c),c=this,this.rollOver=(new TWEEN.Tween({target:this,size:0})).to({size:3},150).easing(TWEEN.Easing.Quadratic.EaseInOut).onUpdate(function(){this.target.style["box-shadow"]=
"inset 0 0 0 "+(this.size<<0)+"px #888"}).start()},onLevelRollout:function(){this.rollOut=(new TWEEN.Tween({target:this,size:3})).to({size:0},150).easing(TWEEN.Easing.Quadratic.EaseInOut).onUpdate(function(){this.target.style["box-shadow"]="inset 0 0 0 "+(this.size<<0)+"px #888"}).start()},onLevelClicked:function(){var b=ChuClone.utils.constructURLForLevelWithID(this.getAttribute("data-id"));ChuClone.Events.Dispatcher.emit(ChuClone.gui.LevelListing.prototype.EVENTS.SHOULD_CHANGE_LEVEL,b);history.pushState(null,
null,"/game/"+this.getAttribute("data-id"))},dealloc:function(){}};ChuClone.gui.LevelListing.getInstance()})();(function(){ChuClone.namespace("ChuClone.gui");var b=null,c=null,d=Date.now();ChuClone.gui.HUDController={onDomReady:function(){window.removeEventListener("DOMContentLoaded",ChuClone.gui.HUDController.onDomReady,!1);ChuClone.gui.HUDController.createTimeCanvas();ChuClone.gui.HUDController.setupEvents();setTimeout(ChuClone.gui.HUDController.setTimeInSeconds,2E3)},setupEvents:function(){var b=this;ChuClone.Events.Dispatcher.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_CREATED,function(c){if(document.getElementById("leveltitle"))document.getElementById("leveltitle").innerHTML=
c._levelModel.levelName;document.getElementById("score_container")&&b.updateScores()});if(document.getElementById("fullscreen_toggle"))document.getElementById("fullscreen_toggle").style.cursor="pointer",document.getElementById("fullscreen_toggle").addEventListener("click",function(){ChuClone.gui.HUDController.toggleFullscreen()},!1);if(document.getElementById("instructions_toggle"))document.getElementById("instructions_toggle").style.cursor="pointer",document.getElementById("instructions_toggle").addEventListener("click",
function(){ChuClone.gui.HUDController.toggleInstructions()},!1)},createTimeCanvas:function(){var d=document.getElementById("HUDTime");if(d){d.style.height="43px";d.style.width="300px";d.textContent="";b=document.createElement("canvas");b.width=d.offsetWidth;b.height=d.offsetHeight;d.appendChild(b);var f=b.getContext("2d");f.font="48px Jura";f.textAlign="center";f.textBaseline="middle";f.fillStyle="rgba(45, 45, 45, 1)";c=f;c.width=d.offsetWidth;c.height=d.offsetHeight}else console.log("Could not create HUDTime... aborting")},
setTimeInSeconds:function(b){c&&(b|=0,b=Math.round(b/1E3*10)/10,b+=b%1?" secs":".0 secs",c.clearRect(0,0,c.width,c.height),c.fillText(b,150,Math.round(c.height*0.4)))},toggleFullscreen:function(){var b=document.getElementById("fullscreen_toggle"),c=document.getElementById("gameContainer"),d=document.getElementById("HUDTime");ChuClone.GameViewController.INSTANCE.getFullscreen()?(ChuClone.GameViewController.INSTANCE.setFullscreen(!1),ChuClone.utils.unhideAllChildren(document.getElementsByTagName("body")[0],
null),ChuClone.utils.unhideAllChildren(c.parentNode,null),ChuClone.utils.StyleMemoizer.restoreStyle(b.id),b.innerHTML='<p class="grayBorder"> Full Screen</p>',ChuClone.utils.StyleMemoizer.restoreStyle("HUDTime")):(ChuClone.GameViewController.INSTANCE.setFullscreen(!0),ChuClone.utils.StyleMemoizer.rememberStyle(b.id),b.style.position="absolute",b.style.top="47px",b.style.left="165px",b.style.zIndex="2",b.innerHTML='<p class="grayBorder"> Exit Fullscreen</p>',ChuClone.utils.StyleMemoizer.rememberStyle(d.id),
d.style.position="absolute",d.style.zIndex="2",ChuClone.utils.hideAllChildren(document.getElementsByTagName("body")[0],[c.parentNode]),ChuClone.utils.hideAllChildren(c.parentNode,[c]),b.style.display="block",d.style.display="")},toggleInstructions:function(){var b=document.getElementById("instructions"),c=b!=null,d=document.getElementById("gameContainer");c?(new TWEEN.Tween({opacity:1})).to({opacity:0},150).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){b.style.opacity=this.opacity}).onComplete(function(){d.parentNode.removeChild(b)}).start():
(b=document.createElement("div"),b.id="instructions",b.setAttribute("class","grid_12"),b.innerHTML='<img src="/game/assets/images/page/instructions.png" alt="">',b.style.position="absolute",b.style.zIndex="2",b.style.top=d.offsetTop+1+"px",b.style.left=d.offsetLeft-9+"px",b.style.opacity=0,b.style.cursor="pointer",(new TWEEN.Tween({opacity:0})).to({opacity:1},500).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){b.style.opacity=this.opacity}).start(),b.addEventListener("click",function(){ChuClone.gui.HUDController.toggleInstructions()},
!1),d.parentNode.insertBefore(b,d))},showTutorialNote:function(){var b=document.getElementById("instructions"),c=b!=null,d=document.getElementById("gameContainer");c?(new TWEEN.Tween({opacity:1})).to({opacity:0},150).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){b.style.opacity=this.opacity}).onComplete(function(){d.parentNode.removeChild(b)}).start():(b=document.createElement("div"),b.id="instructions",b.setAttribute("class","grid_12"),b.innerHTML='<img src="/game/assets/images/page/instructions.png" alt="">',
b.style.position="absolute",b.style.zIndex="2",b.style.top=d.offsetTop+1+"px",b.style.left=d.offsetLeft-9+"px",b.style.opacity=0,b.style.cursor="pointer",(new TWEEN.Tween({opacity:0})).to({opacity:1},500).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){b.style.opacity=this.opacity}).start(),b.addEventListener("click",function(){ChuClone.gui.HUDController.toggleInstructions()},!1),d.parentNode.insertBefore(b,d))},updateScores:function(b){var c=ChuClone.utils.getLevelIDFromURL();if(c){var g=
document.getElementById("score_container");if(!b&&g.getAttribute("data-id")==c&&Date.now()-d<6E4)console.log("Same id ");else{d=Date.now();g.innerHTML="";g.setAttribute("data-id",c);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==4)g.innerHTML=h.responseText,ChuClone.utils.animateChildrenInFromBelow(g,400)};h.open("GET",ChuClone.model.Constants.SERVER.SCORE_LOAD_LOCATION.replace("#",c));h.send(null)}}}};window.addEventListener("DOMContentLoaded",ChuClone.gui.HUDController.onDomReady,
!1)})();(function(){ChuClone.namespace("ChuClone.gui");var b=null;ChuClone.gui.LevelRecap={show:function(c,d){if(b)console.error(" Already have an HTMLElement. Aborting...");else{var e=ChuClone.model.AchievementTracker.getInstance(),e="<div class='push_3 grid_6' style='margin-left: 20px; margin-top:30px;'>  \t\t\t\t\t\t\t\t\t\t\t\t<p class='jura_48' style='color:#01b0ee; text-align:center;'>LEVEL COMPLETE</p>                                  \t\t\t\t\t\t<div class='clear'></div>                                                                      \t\t\t\t\t\t\t\t\t\t\t<div class='grid_6'>&nbsp;</div>                                                                \t\t\t\t\t\t\t\t\t\t<p class='level_recap_rectangle grayBorder jura_36' style='margin-top:50px;'>#{leveltitle}</p>                         \t\t\t\t\t<div class='clear'></div>                                                                         \t\t\t\t\t\t\t\t\t\t<div class='grid_6'>&nbsp;</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class='clear'></div>                                                        \t\t\t\t\t\t\t                   \t\t\t<p class='level_recap_rectangle grayBorder jura_24' id='flash_notice' style='background-color:#98fb98; margin-top:-35px;margin-bottom:30px'>#{notice}</p>\t\t<div id='levelstats' class='grid_6'>                                                                                            \t\t\t<div class='level_recap_rectangle alpha grid_2 grayBorder jura_12 ' style='margin-left:-10px;'>Total Time</div>             \t\t\t<div class='level_recap_rectangle omega grid_4 grayBorder jura_12'>#{totaltime}</div>                                       \t\t\t <div class='grid_6' style='margin-bottom:-10px;'>&nbsp;</div>                                                   \t\t\t\t\t<div class='clear'></div>                                                                           \t\t\t\t\t\t\t                                                                                                                              \t\t\t\t\t\t<div class='level_recap_rectangle alpha grid_2 grayBorder jura_12' style='margin-left:-10px;'>Total Airtime</div>           \t\t\t<div class='level_recap_rectangle omega grid_4 grayBorder jura_12'>#{totalAirtime}</div>                                    \t\t\t<div class='grid_6' style='margin-bottom:-10px;'>&nbsp;</div>                                                                                                                                                                                                       \t\t\t<div class='level_recap_rectangle alpha grid_2 grayBorder jura_12' style='margin-left:-10px;'>Max Airtime</div>             \t\t\t<div class='level_recap_rectangle omega grid_4 grayBorder jura_12'>#{maxAirtime}</div>                                      \t\t\t<div class='grid_6' style='margin-bottom:-10px;'>&nbsp;</div>                                                                                                                                                                                                       \t\t\t<div class='level_recap_rectangle alpha grid_2 grayBorder jura_12' style='margin-left:-10px;'>Number of Jumps</div>         \t\t\t<div class='level_recap_rectangle omega grid_4 grayBorder jura_12'>#{totalJumps}</div>                                      \t\t\t<div class='grid_6' style='margin-bottom:-10px;'>&nbsp;</div>                                                               \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class='level_recap_rectangle alpha grid_2 grayBorder jura_12' style='margin-left:-10px;'>Number of Deaths</div>        \t\t\t<div class='level_recap_rectangle omega grid_4 grayBorder jura_12'>#{totalDeaths}</div>                                     \t\t\t<div class='grid_6' style='margin-bottom:-10px;'>&nbsp;</div>                                                               \t\t</div>\t</div>".replace("#{leveltitle}",
d).replace("#{totaltime}",this.convertToTime(c)).replace("#{totalAirtime}",this.convertToTime(e._counterTotalAirtime)).replace("#{maxAirtime}",this.convertToTime(e._counterMaxAirtime)).replace("#{totalJumps}",e._counterTotalJumps).replace("#{totalDeaths}",e._counterTotalDeaths),f=document.getElementById("gameContainer");b=document.createElement("div");b.innerHTML=e;b.id="level_recap";b.setAttribute("class","container_12");b.setAttribute("style","margin-left:20px");b.style.position="absolute";b.style.zIndex=
"2";ChuClone.GameViewController.INSTANCE.getFullscreen()?(b.style.top=f.offsetTop+150+"px",b.style.left=f.offsetLeft+f.clientWidth/2-290+"px"):(b.style.top=f.offsetTop+"px",b.style.left=f.offsetLeft+"px");b.style.opacity=0;b.style.cursor="pointer";if(f.parentNode.tagName==="BODY")b.style.left=f.parentNode.offsetWidth/2-480+"px",b.style.marginLeft="0px",b.firstChild.removeChild(b.firstChild.children[7]);(new TWEEN.Tween({opacity:0})).to({opacity:1},800).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){b.style.opacity=
this.opacity}).start();ChuClone.utils.animateChildrenInFromBelow(b.firstChild);ChuClone.utils.animateChildrenInFromBelow(b.firstChild.lastChild.previousSibling);f.parentNode.insertBefore(b,f)}},destroy:function(){b&&(b.parentNode.removeChild(b),b=null)},convertToTime:function(b){return Math.round(b/1E3*1E3)/1E3+" Seconds"}}})();(function(){ChuClone.namespace("ChuClone.gui");var b=null,c=null;ChuClone.gui.TutorialNoteDisplay={noteText:null,show:function(d){this.noteText=d;b&&this.destroy(!0);var e="<div class='push_3 grid_6' style='margin-left: 20px; margin-top:30px;'>  \t\t\t\t\t\t\t\t\t\t\t\t<p class='jura_48' style='color:#01b0ee; text-align:center;'>Tutorial</p>                                  \t\t\t\t\t\t<div class='clear'></div>                                                                      \t\t\t\t\t\t\t\t\t\t\t<div class='grid_6 grayBorder jura_24' style='background-color: rgba(255,255,255, 0.75);'>#{note}</div>                                                                \t\t\t\t\t\t\t\t\t</div>".replace("#{note}",
d);c=document.getElementById("gameContainer");b=document.createElement("div");b.innerHTML=e;b.id="level_recap";b.setAttribute("class","container_12");b.setAttribute("style","margin-left:20px");b.style.position="absolute";b.style.zIndex="2";b.tabIndex=1;ChuClone.GameViewController.INSTANCE.getFullscreen()?(b.style.top=c.offsetTop+150+"px",b.style.left=c.offsetLeft+c.clientWidth/2-290+"px"):(b.style.top=c.offsetTop+"px",b.style.left=c.offsetLeft+"px");b.style.opacity=0;b.style.cursor="pointer";if(c.parentNode.tagName===
"BODY")b.style.left=c.parentNode.offsetWidth/2-480+"px",b.style.marginLeft="0px",b.firstChild.removeChild(b.firstChild.children[7]);(new TWEEN.Tween({opacity:0})).to({opacity:1},800).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){if(b)b.style.opacity=this.opacity}).start();ChuClone.utils.animateChildrenInFromBelow(b.firstChild);ChuClone.utils.animateChildrenInFromBelow(b.firstChild.lastChild.previousSibling);c.parentNode.insertBefore(b,c);b.focus();var f=this;this._callback=function(b){b.type==
"mousedown"&&f.fadeOutAndDestroy(d);b.stopPropagation()};window.addEventListener("mousedown",this._callback,!1);ChuClone.DOM_ELEMENT.tabIndex=0;ChuClone.DOM_ELEMENT.focus()},fadeOutAndDestroy:function(c){var e=this;if(this.tween)TWEEN.remove(this.tween),this.tween=null;this.tween=(new TWEEN.Tween({opacity:1})).to({opacity:0},200).easing(TWEEN.Easing.Sinusoidal.EaseIn).onUpdate(function(){if(b)b.style.opacity=this.opacity}).onComplete(function(){e.destroy(c)}).start()},destroy:function(c){if(b){window.removeEventListener("mousedown",
this._callback);if(c==this.noteText)this.noteText=null;this._callback=null;b.parentNode.removeChild(b);b=null;setTimeout(function(){ChuClone.DOM_ELEMENT.tabIndex=0;ChuClone.DOM_ELEMENT.focus()},100)}}}})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.BaseComponent=function(){this.interceptedProperties={};this.setupEditableProperties();return this};ChuClone.components.BaseComponent.prototype={interceptedProperties:null,attachedEntity:null,detachTimeout:0,displayName:"BaseComponent",canStack:!1,requiresUpdate:!1,_editableProperties:{},setupEditableProperties:function(){},attach:function(b){this.attachedEntity=b},execute:function(){},update:function(){throw Error("BaseComponent update method has been called. Overwrite!");
},detach:function(){clearTimeout(this.detachTimeout);this.restore();this.attachedEntity=this.interceptedProperties=null},detachAfterDelay:function(b){var c=this;this.detachTimeout=setTimeout(function(){c.attachedEntity.removeComponentWithName(c.displayName)},b)},intercept:function(b){for(var c=b.length,d=this;c--;){var e=b[c];this.interceptedProperties[e]=this.attachedEntity[e];this.attachedEntity[e]=this[e];this.attachedEntity[e]=this.attachedEntity[e]instanceof Function?function(){var b=e;return function(){return d[b].apply(d,
arguments)}}():this[e]}},restore:function(){for(var b in this.interceptedProperties)this.interceptedProperties.hasOwnProperty(b)&&(this.attachedEntity[b]=this.interceptedProperties[b])},onEditablePropertyWasChanged:function(){throw Error("BaseComponent 'onEditablePropertyWasChanged' method has been called. Overwrite!");},onEditorDidDragAttachedEntity:function(){},getModel:function(){return{displayName:this.displayName}},fromModel:function(){}}})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.JumpPadComponent=function(){ChuClone.components.JumpPadComponent.superclass.constructor.call(this);this._textureSource=ChuClone.components.JumpPadComponent.prototype._textureSource+"right.png"};ChuClone.components.JumpPadComponent.prototype={displayName:"JumpPadComponent",_textureSource:"assets/images/game/jumppad_",_textureOrientation:1,_force:1500,_previousMaterial:null,_inactiveDelay:500,_isReady:!0,_isReadyTimeout:null,
_editableProperties:{orientation:{value:1,min:-1,max:1,step:1}},ORIENTATION:{"-1":"left",1:"right"},attach:function(b){ChuClone.components.JumpPadComponent.superclass.attach.call(this,b);this.intercept(["onCollision"])},execute:function(){ChuClone.components.JumpPadComponent.superclass.execute.call(this);var b=this.attachedEntity.getView();this.attachedEntity.getBody();this._previousMaterial=b.materials[0];b.materials[0]=new THREE.MeshLambertMaterial({color:16777215,shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+
this._textureSource)})},onCollision:function(b){if(b._type==ChuClone.model.Constants.ENTITY_TYPES.PLAYER&&(this.interceptedProperties.onCollision.call(this.attachedEntity,b),this._isReady)){b.getComponentWithName(ChuClone.components.player.CheckIsJumpingComponent.prototype.displayName).forceAllowJump();var c=b.getBody().GetLinearVelocity();c.y-=Math.abs(c.y)+this._force/ChuClone.model.Constants.PTM_RATIO;var c=this.attachedEntity.getBody().GetPosition().x-b.getBody().GetPosition().x,d=Math.min(c/
(this.attachedEntity.getDimensions().width/ChuClone.model.Constants.PTM_RATIO),1)*Math.PI*1.5;setTimeout(function(){b.getBody().SetAngularVelocity(b.getBody().GetAngularVelocity()-d);ChuClone.model.AchievementTracker.getInstance().startTrackingJump()},16);this.startWaitingForIsReady()}},startWaitingForIsReady:function(){var b=this;this._isReady=!1;clearTimeout(this._isReadyTimeout);this._isReadyTimeout=setTimeout(function(){b._isReady=!0},this._inactiveDelay)},setEditableProps:function(){this._editableProperties.orientation.value=
this._textureOrientation},onEditablePropertyWasChanged:function(){var b;this._editableProperties.orientation.value>=0?(b=1,this._textureSource=ChuClone.components.JumpPadComponent.prototype._textureSource+"right.png"):(b=-1,this._textureSource=ChuClone.components.JumpPadComponent.prototype._textureSource+"left.png");if(b!=this._textureOrientation){this.getOrientationFromTexture(this._textureSource);var c=this.attachedEntity.getView().materials[0];b=new Image;b.src=ChuClone.model.Constants.SERVER.ASSET_PREFIX+
this._textureSource;b.onload=function(){c.map.needsUpdate=!0;c.map.image=this}}},detach:function(){this.attachedEntity.getView().materials[0]=this._previousMaterial;ChuClone.components.JumpPadComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.JumpPadComponent.superclass.getModel.call(this);b.textureSource=this._textureSource;b.inactiveDelay=this._inactiveDelay;return b},fromModel:function(b){ChuClone.components.JumpPadComponent.superclass.fromModel.call(this,b);
this._textureSource=this.fixTextureSource(b.textureSource);this._inactiveDelay=b.inactiveDelay;this.getOrientationFromTexture(this._textureSource)},getOrientationFromTexture:function(b){if(b.indexOf("right")!=-1)this._textureOrientation=1;else if(b.indexOf("left")!=-1)this._textureOrientation=-1},fixTextureSource:function(b){if(b.indexOf("_")==-1)return console.log("BAD SOURCE: "+b),this._textureOrientation=1,ChuClone.components.JumpPadComponent.prototype._textureSource+"right.png";return b},getIsReady:function(){return this._isReady}};
ChuClone.extend(ChuClone.components.JumpPadComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.FrictionPadComponent=function(){ChuClone.components.FrictionPadComponent.superclass.constructor.call(this)};ChuClone.components.FrictionPadComponent.prototype={displayName:"FrictionPadComponent",_textureSource:"assets/images/game/floorred.png",_previousMaterial:null,_damping:0.25,_inactiveDelay:250,_isReady:!0,_isReadyTimeout:null,EVENTS:{ON_COLLISION:"FrictionPadComponent.events.onCollision"},attach:function(b){ChuClone.components.FrictionPadComponent.superclass.attach.call(this,
b);this.intercept(["onCollision"])},execute:function(){ChuClone.components.FrictionPadComponent.superclass.execute.call(this);var b=this.attachedEntity.getView();this.attachedEntity.getBody();this._previousMaterial=b.materials[0];b.materials[0]=new THREE.MeshLambertMaterial({color:16777215,shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+this._textureSource)})},onCollision:function(b){b._type==ChuClone.model.Constants.ENTITY_TYPES.PLAYER&&
(this.interceptedProperties.onCollision.call(this.attachedEntity,b),this._isReady&&(b=b.getBody().GetLinearVelocity(),b.x*=this._damping,b.y*=this._damping,ChuClone.Events.Dispatcher.emit(ChuClone.components.FrictionPadComponent.prototype.EVENTS.ON_COLLISION,this),this.startWaitingForIsReady()))},startWaitingForIsReady:function(){var b=this;this._isReady=!1;clearTimeout(this._isReadyTimeout);this._isReadyTimeout=setTimeout(function(){b._isReady=!0},this._inactiveDelay)},getIsReady:function(){return this._isReady},
detach:function(){this.attachedEntity.getView().materials[0]=this._previousMaterial;ChuClone.components.FrictionPadComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.FrictionPadComponent.superclass.getModel.call(this);b.textureSource=this._textureSource;b.inactiveDelay=this._inactiveDelay;b.damping=this._damping;return b},fromModel:function(b){ChuClone.components.FrictionPadComponent.superclass.fromModel.call(this,b);this._textureSource=ChuClone.components.FrictionPadComponent.prototype._textureSource;
this._inactiveDelay=b.inactiveDelay||ChuClone.components.FrictionPadComponent.prototype._inactiveDelay;this._damping=b.damping||ChuClone.components.FrictionPadComponent.prototype._damping}};ChuClone.extend(ChuClone.components.FrictionPadComponent,ChuClone.components.BaseComponent)})();(function(){var b=Box2D.Common.Math.b2Vec2;ChuClone.namespace("ChuClone.components");ChuClone.components.MovingPlatformComponent=function(){ChuClone.components.MovingPlatformComponent.superclass.constructor.call(this);this._initialPosition=new b(0,0);this._velocity=new b(0,0);this._direction=new b(1,1);this._speed=new b(0,0);this.requiresUpdate=!0};ChuClone.components.MovingPlatformComponent.prototype={displayName:"MovingPlatformComponent",_range:null,_speed:null,_direction:null,_offset:0,_initialPosition:null,
_velocity:null,_editableProperties:{rangeX:{value:0,min:0,max:30},rangeY:{value:0,min:0,max:30},speed:{value:1,min:0,max:30},offset:{value:0,min:-0.99,max:0.99}},attach:function(c){ChuClone.components.MovingPlatformComponent.superclass.attach.call(this,c);this._initialPosition=this.attachedEntity.getBody().GetPosition().Copy();this._range=this._range||new b(this._editableProperties.rangeX.value,this._editableProperties.rangeY.value);this.reset();if(ChuClone.model.Constants.IS_EDIT_MODE()){var d=this;
this.attachedEntity.drawCustom=function(b){d.drawPlatformForEditor(b)}}},update:function(){var b,d=this._velocity.Copy();d.x=this._range.x>1?this._speed.x*this._direction.x:0;d.y=this._range.y>1?this._speed.y*this._direction.y:0;var e=this.attachedEntity.getBody().GetPosition(),f=function(b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c};if(this._range.x>1){var g=Math.abs(e.x-this._initialPosition.x);b=g/this._range.x;if(g>this._range.x)e.x=this._initialPosition.x+this._direction.x*this._range.x,this._direction.x*=
-1,d.x=this._speed.x*this._direction.x;else if(b>0.1)g=this._speed.x*this._direction.x,d.x=f(1-b,0,g*0.9,1)+g*0.1}if(this._range.y>1)if(g=Math.abs(e.y-this._initialPosition.y),b=g/this._range.y,g>this._range.y)e.y=this._initialPosition.y+this._direction.y*this._range.y,this._direction.y*=-1,d.y=this._speed.y*this._direction.y;else if(b>0.1)g=this._speed.y*this._direction.y,d.y=f(1-b,0,g*0.9,1)+g*0.1;this.attachedEntity.getBody().SetLinearVelocity(d)},drawPlatformForEditor:function(b){var d=this._initialPosition,
e=ChuClone.model.Constants.PTM_RATIO,f=d.Copy(),g=(this.attachedEntity.width/e+this._range.x)*b.m_debugDraw.m_drawScale,e=(this.attachedEntity.height/e+this._range.y)*b.m_debugDraw.m_drawScale;f.x=(d.x+b.m_debugDraw.offsetX)*b.m_debugDraw.m_drawScale;f.y=(d.y+b.m_debugDraw.offsetY)*b.m_debugDraw.m_drawScale;f.x-=g;f.y-=e;b.m_debugDraw.m_ctx.fillRect(f.x,f.y,g*2,e*2)},detach:function(){this.attachedEntity.getBody().SetPosition(this._initialPosition.Copy());this.attachedEntity.drawCustom=null;this.attachedEntity.getBody().SetLinearVelocity(new b(0,
0));this._velocity=this._range=this._initialPosition=null;ChuClone.components.MovingPlatformComponent.superclass.detach.call(this)},setEditableProps:function(){this._editableProperties.rangeX.value=this._range.x;this._editableProperties.rangeY.value=this._range.y;this._editableProperties.speed.value=this._speed.x;this._editableProperties.offset.value=this._offset},onEditablePropertyWasChanged:function(){this._editableProperties.rangeX.value&&this._editableProperties.rangeY.value?(ChuClone.utils.displayFlash("Moving platform does not support simultaneous X and Y axis movement.<br>Set one of them to zero",
0),this.setEditableProps()):(this._range.x=this._editableProperties.rangeX.value,this._range.y=this._editableProperties.rangeY.value,this._speed.x=this._editableProperties.speed.value,this._speed.y=this._editableProperties.speed.value,this._offset=this._editableProperties.offset.value,this.reset())},onEditorDidDragAttachedEntity:function(){this._initialPosition=this.attachedEntity.getBody().GetPosition().Copy();this.reset()},reset:function(){var c=this._initialPosition.Copy();c.x+=this._range.x*this._offset;
c.y+=this._range.y*this._offset;this.attachedEntity.getBody().SetAwake(!0);this.attachedEntity.getBody().SetPosition(c);c=new b(0,0);c.x=this._range.x>1?this._speed.x*this._direction.x:0;c.y=this._range.y>1?this._speed.y*this._direction.y:0;this._velocity=c;this.attachedEntity.getBody().SetLinearVelocity(c.Copy())},getModel:function(){var b=ChuClone.components.MovingPlatformComponent.superclass.getModel.call(this);b.initialPosition={x:this._initialPosition.x,y:this._initialPosition.y};b.range={x:this._range.x,
y:this._range.y};b.offset=this._offset;b.speed=this._speed.x;return b},fromModel:function(c,d){ChuClone.components.MovingPlatformComponent.superclass.fromModel.call(this,c);d.getBody().SetPosition(new b(c.initialPosition.x,c.initialPosition.y));this._range=new b(c.range.x,c.range.y);this._offset=c.offset;if(this._offset==0)this._offset=0.01;if(this._offset==1)this._offset=0.99;this._speed=new b(c.speed,c.speed)}};ChuClone.extend(ChuClone.components.MovingPlatformComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");var b=[],c=null,d=function(c){b.push(c);b.sort(function(b,c){var d=b.attachedEntity.getBody().GetPosition().x,e=c.attachedEntity.getBody().GetPosition().x;return d<e?-1:d>e?1:0})};ChuClone.components.RespawnComponent=function(){ChuClone.components.RespawnComponent.superclass.constructor.call(this)};ChuClone.components.RespawnComponent.prototype={displayName:"RespawnComponent",_textureSource:"assets/images/game/flooraqua.png",_respawnState:0,EVENTS:{CREATED:"ChuClone.components.RespawnComponent.events.CREATED",
DESTROYED:"ChuClone.components.RespawnComponent.events.DESTROYED"},attach:function(b){ChuClone.components.RespawnComponent.superclass.attach.call(this,b);d(this);this.attachedEntity.getBody().GetFixtureList().SetSensor(!0);this.intercept(["onCollision","setBody"]);ChuClone.Events.Dispatcher.emit(ChuClone.components.RespawnComponent.prototype.EVENTS.CREATED,this)},setSpawnedEntityPosition:function(b){ChuClone.model.AchievementTracker.getInstance().incrimentDeathCount();b.getBody().SetPosition(new Box2D.Common.Math.b2Vec2(this.attachedEntity.getBody().GetPosition().x,
this.attachedEntity.getBody().GetPosition().y-1))},execute:function(){ChuClone.components.RespawnComponent.superclass.execute.call(this);var b=this.attachedEntity.getView();this.attachedEntity.getBody();this._previousMaterial=b.materials[0];b.materials[0]=new THREE.MeshLambertMaterial({opacity:0.75,transparent:!0,shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+this._textureSource)})},onCollision:function(b){b._type==ChuClone.model.Constants.ENTITY_TYPES.PLAYER&&
(this.interceptedProperties.onCollision.call(this.attachedEntity,b),c=this)},setBody:function(b){this.interceptedProperties.setBody.call(this.attachedEntity,b);this.attachedEntity.getBody().GetFixtureList().SetSensor(!0)},detach:function(){c==this&&(c=null);for(var d=b.length,f=0;f<d;++f)if(b[f]===this){b.splice(f,1);break}this.attachedEntity.getView().materials[0]=this._previousMaterial;ChuClone.Events.Dispatcher.emit(ChuClone.components.RespawnComponent.prototype.EVENTS.DESTROYED,this);ChuClone.components.RespawnComponent.superclass.detach.call(this)},
getModel:function(){var b=ChuClone.components.RespawnComponent.superclass.getModel.call(this);b.textureSource=this._textureSource;return b},fromModel:function(b){ChuClone.components.RespawnComponent.superclass.fromModel.call(this,b);this._textureSource=b.textureSource},GET_ALL_RESPAWNPOINTS:function(){return b},GET_CURRENT_RESPAWNPOINT:function(){if(!c)return b[0];return c}};ChuClone.extend(ChuClone.components.RespawnComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.GoalPadComponent=function(){ChuClone.components.GoalPadComponent.superclass.constructor.call(this)};ChuClone.components.GoalPadComponent.prototype={displayName:"GoalPadComponent",_textureSource:"assets/images/game/floorgreen.png",_previousMaterial:null,_isReady:!0,_playerCallback:Function,EVENTS:{GOAL_REACHED:"GoalPadComponent.events.goalReached"},attach:function(b){ChuClone.components.GoalPadComponent.superclass.attach.call(this,
b);this.intercept(["onCollision"]);var c=this;this.playerCallback=function(){c._isReady=!0;console.log("Goalpad - resetting status")};ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,this.playerCallback)},execute:function(){ChuClone.components.GoalPadComponent.superclass.execute.call(this);var b=this.attachedEntity.getView();this.attachedEntity.getBody();this._previousMaterial=b.materials[0];b.materials[0]=new THREE.MeshLambertMaterial({color:16777215,
shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+this._textureSource)})},onCollision:function(b){if(b._type==ChuClone.model.Constants.ENTITY_TYPES.PLAYER&&(this.interceptedProperties.onCollision.call(this.attachedEntity,b),this._isReady))this._isReady=!1,ChuClone.Events.Dispatcher.emit(ChuClone.components.GoalPadComponent.prototype.EVENTS.GOAL_REACHED,this)},detach:function(){this.attachedEntity.getView().materials[0]=this._previousMaterial;
if(this.playerCallback)ChuClone.Events.Dispatcher.removeListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,this.playerCallback),this.playerCallback=null;ChuClone.components.GoalPadComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.GoalPadComponent.superclass.getModel.call(this);b.textureSource=this._textureSource;return b},fromModel:function(b){ChuClone.components.GoalPadComponent.superclass.fromModel.call(this,b);this._textureSource=
b.textureSource}};ChuClone.extend(ChuClone.components.GoalPadComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.DeathPadComponent=function(){ChuClone.components.DeathPadComponent.superclass.constructor.call(this)};ChuClone.components.DeathPadComponent.prototype={displayName:"DeathPadComponent",_textureSource:"assets/images/game/floordark.png",_previousMaterial:null,_inactiveDelay:1E3,_isReady:!0,_isReadyTimeout:null,EVENTS:{ACTIVATED:"DeathPadComponent.events.activated"},attach:function(b){ChuClone.components.DeathPadComponent.superclass.attach.call(this,
b);this.intercept(["onCollision"])},execute:function(){ChuClone.components.DeathPadComponent.superclass.execute.call(this);var b=this.attachedEntity.getView();this.attachedEntity.getBody();this._previousMaterial=b.materials[0];b.materials[0]=new THREE.MeshLambertMaterial({color:16777215,shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+this._textureSource)})},onCollision:function(b){b._type==ChuClone.model.Constants.ENTITY_TYPES.PLAYER&&
(this.interceptedProperties.onCollision.call(this.attachedEntity,b),this._isReady&&(setTimeout(function(){ChuClone.components.RespawnComponent.prototype.GET_CURRENT_RESPAWNPOINT().setSpawnedEntityPosition(b);b.getBody().SetLinearVelocity(new Box2D.Common.Math.b2Vec2(0,0))},1),ChuClone.Events.Dispatcher.emit(ChuClone.components.DeathPadComponent.prototype.EVENTS.ACTIVATED,this),this.startWaitingForIsReady()))},startWaitingForIsReady:function(){var b=this;this._isReady=!1;clearTimeout(this._isReadyTimeout);
this._isReadyTimeout=setTimeout(function(){b._isReady=!0},this._inactiveDelay)},getIsReady:function(){return this._isReady},detach:function(){this.attachedEntity.getView().materials[0]=this._previousMaterial;ChuClone.components.DeathPadComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.DeathPadComponent.superclass.getModel.call(this);b.textureSource=this._textureSource;b.inactiveDelay=this._inactiveDelay;return b},fromModel:function(b){ChuClone.components.DeathPadComponent.superclass.fromModel.call(this,
b);this._textureSource=b.textureSource;this._inactiveDelay=b.inactiveDelay}};ChuClone.extend(ChuClone.components.DeathPadComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");var b=0;ChuClone.components.AutoRotationComponent=function(){ChuClone.components.AutoRotationComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.AutoRotationComponent.prototype={displayName:"AutoRotationComponent",_previousRotation:0,_rotationSpeed:0.0060,_editableProperties:{rotationSpeed:{min:-0.15,max:0.15,value:0}},update:function(){b+=this._rotationSpeed;this.attachedEntity.getBody().SetAngle(b)},onEditablePropertyWasChanged:function(){if(this._editableProperties.rotationSpeed.value!==
this._editableProperties.rotationSpeed.value)debugger;this._rotationSpeed=this._editableProperties.rotationSpeed.value},detach:function(){this.attachedEntity.getBody().SetAngle(this._previousRotation);ChuClone.components.AutoRotationComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.AutoRotationComponent.superclass.getModel.call(this);b.rotationSpeed=this._rotationSpeed;return b},fromModel:function(b){ChuClone.components.AutoRotationComponent.superclass.fromModel.call(this,
b);this._rotationSpeed=b.rotationSpeed}};ChuClone.extend(ChuClone.components.AutoRotationComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.effect");ChuClone.components.effect.ParticleEmitterComponent=function(){ChuClone.components.effect.ParticleEmitterComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.effect.ParticleEmitterComponent.prototype={displayName:"ParticleEmitterComponent",_count:200,_color:null,_sizeMin:4,_sizeMax:12,_geometry:null,_system:null,_parent:null,attach:function(b){ChuClone.components.effect.ParticleEmitterComponent.superclass.attach.call(this,
b);this._parent=this.attachedEntity.getView().parent;this._geometry=new THREE.Geometry;for(b=0;b<this._count;b++){var c=new THREE.Vector3(this.attachedEntity.getView().position.x+Math.random()*this.attachedEntity.getDimensions().width*2-this.attachedEntity.getDimensions().width,-this.attachedEntity.getView().position.y+this.attachedEntity.getDimensions().height+Math.random()*600,this.attachedEntity.getView().position.z+Math.random()*this.attachedEntity.getDimensions().depth*2-this.attachedEntity.getDimensions().depth);
this._geometry.vertices.push(new THREE.Vertex(c))}this._color=new THREE.Color;this._color.setHSV(Math.random()*0.2+0.8,0.5,1);b=new THREE.ParticleBasicMaterial({size:ChuClone.utils.randFloat(this._sizeMin,this._sizeMax)});b.color.setRGB(this._color.r,this._color.g,this._color.b);this._system=new THREE.ParticleSystem(this._geometry,b);this._parent.addObject(this._system)},update:function(){for(var b=0;b<this._count;b++)if(this._geometry.vertices[b].position.y+=Math.random()*4,this._geometry.vertices[b].position.y>
1E3)this._geometry.vertices[b].position.y=0;this._geometry.__dirtyVertices=!0},detach:function(){this._parent.removeChild(this._system);this._system=this._color=this._geometry=this._parent=null;ChuClone.components.effect.ParticleEmitterComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.effect.ParticleEmitterComponent.superclass.getModel.call(this);b.count=this._count;b.color={r:this._color.r,g:this._color.g,b:this._color.b};return b},fromModel:function(b){ChuClone.components.effect.ParticleEmitterComponent.superclass.fromModel.call(this,
b);this._count=b.count;this._color=(new THREE.Color).setRGB(b.color.r,b.color.g,b.color.b)}};ChuClone.extend(ChuClone.components.effect.ParticleEmitterComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.effect");ChuClone.components.effect.BirdEmitterComponent=function(){ChuClone.components.effect.BirdEmitterComponent.superclass.constructor.call(this)};ChuClone.components.effect.BirdEmitterComponent.prototype={displayName:"BirdEmitterComponent",canStack:!0,requiresUpdate:!0,_count:80,_color:null,_sizeMin:5,_sizeMax:5,_birds:null,_parent:null,attach:function(b){ChuClone.components.effect.BirdEmitterComponent.superclass.attach.call(this,b);this._parent=
this.attachedEntity.getView().parent;this._birds=[];for(var b=this.attachedEntity.getView().position.clone(),c=0;c<this._count;c++){var d=this._birds[c]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:Math.random()*2236962+14540253}));d.phase=Math.floor(Math.random()*62.83);d.position=new THREE.Vector3(b.x+Math.random()*-1200,b.y+Math.random()*600,b.z+(Math.random()*2-1)*1200);d.speed=8+Math.random()*8;d.doubleSided=!0;d.dynamic=!0;(new TWEEN.Tween({target:d,scale:0})).to({scale:Math.random()*
this._sizeMax+this._sizeMin},Math.random()*9E3+200).onUpdate(function(){this.target.scale.x=this.target.scale.y=this.target.scale.z=this.scale}).easing(TWEEN.Easing.Sinusoidal.EaseInOut).start();d.scale.x=d.scale.y=d.scale.z=0;this._parent.addObject(d)}},update:function(){for(var b=0,c=this._birds.length;b<c;b++){var d=this._birds[b];d.position.x+=d.speed;d.position.y+=Math.sin(d.phase)*4+1;if(d.position.x>this.attachedEntity.getView().position.x+6E3)d.position.x=this.attachedEntity.getView().position.x-
Math.random()*2E3,d.position.y=this.attachedEntity.getView().position.y+Math.random()*1E3,d.position.z=(Math.random()*2-1)*1200;d.phase=(d.phase+(Math.max(0,d.rotation.z)+0.05))%62.83;d.geometry.vertices[5].position.y=d.geometry.vertices[4].position.y=Math.sin(d.phase*3);d.geometry.__dirtyVertices=!0}},detach:function(){for(var b=0,c=this._birds.length;b<c;b++)this._parent.removeObject(this._birds[b]);this._parent=this._birds=null;ChuClone.components.effect.BirdEmitterComponent.superclass.detach.call(this)}};
ChuClone.extend(ChuClone.components.effect.BirdEmitterComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.player");ChuClone.components.player.CharacterControllerComponent=function(){ChuClone.components.player.CharacterControllerComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.player.CharacterControllerComponent.prototype={displayName:"CharacterControllerComponent",_moveSpeed:new Box2D.Common.Math.b2Vec2(0.0090,0.15),EVENTS:{CREATED:"PlayerEntity.event.created",REMOVED:"PlayerEntity.event.removed"},GROUP:-1,_type:ChuClone.model.Constants.ENTITY_TYPES.PLAYER,
attach:function(b){ChuClone.components.player.CharacterControllerComponent.superclass.attach.call(this,b);this.intercept(["_type"]);this.attachedEntity.getBody().SetBullet(!0);this._input=ChuClone.model.Constants.JOYSTICK.ENABLED?new ChuClone.components.player.RemoteJoystickInputComponent:new ChuClone.components.player.KeyboardInputComponent;this.attachedEntity.addComponentAndExecute(this._input);this._jumpCheckComponent=new ChuClone.components.player.CheckIsJumpingComponent;this.attachedEntity.addComponentAndExecute(this._jumpCheckComponent);
this.attachedEntity.addComponentAndExecute(new ChuClone.components.BoundsYCheckComponent);b=this.attachedEntity.getView();this._previousMaterial=b.materials[0];b.materials[0]=new THREE.MeshLambertMaterial({color:16777215,shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+"assets/images/game/crate.png")});this.dispatchCreatedEvent()},update:function(){var b=new Box2D.Common.Math.b2Vec2(0,0),c=ChuClone.model.Constants.PTM_RATIO,d=this.attachedEntity.getBody();
if(this._input._keyStates.left)b.x=-1;else if(this._input._keyStates.right)b.x=1;if(this._input._keyStates.up&&this._jumpCheckComponent._canJump)b.y=-1,this._jumpCheckComponent._canJump=!1,ChuClone.model.AchievementTracker.getInstance().startTrackingJump();else if(this._input._keyStates.down)b.y=0.25;var e=d.GetWorldCenter(),b=new Box2D.Common.Math.b2Vec2(this._moveSpeed.x*c*d.GetMass()*b.x,this._moveSpeed.y*c*d.GetMass()*b.y);d.ApplyImpulse(b,e)},dispatchCreatedEvent:function(){var b=this;setTimeout(function(){ChuClone.Events.Dispatcher.emit(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,
b.attachedEntity)},16)},setBody:function(b){this.interceptedProperties.setBody.call(this.attachedEntity,b);b.GetFixtureList().m_filter.groupIndex=ChuClone.components.player.CharacterControllerComponent.prototype.GROUP},detach:function(){this.attachedEntity.removeComponentWithName(ChuClone.components.player.KeyboardInputComponent.prototype.displayName);this._jumpCheckComponent=this._input=null;ChuClone.Events.Dispatcher.emit(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,
this.attachedEntity);ChuClone.components.player.CharacterControllerComponent.superclass.detach.call(this)}};ChuClone.extend(ChuClone.components.player.CharacterControllerComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.player");var b=ChuClone.model.Constants.PTM_RATIO;ChuClone.components.player.CheckIsJumpingComponent=function(){ChuClone.components.player.CheckIsJumpingComponent.superclass.constructor.call(this)};ChuClone.components.player.CheckIsJumpingComponent.prototype={displayName:"CheckIsJumpingComponent",_sensor:null,_canJump:!1,attach:function(c){ChuClone.components.player.CheckIsJumpingComponent.superclass.attach.call(this,c);var d=c.getBody();d.GetPosition();
d.GetPosition();var e=c.getDimensions().width/b,c=c.getDimensions().height/b,f=new Box2D.Dynamics.b2FixtureDef;f.shape=new Box2D.Collision.Shapes.b2PolygonShape;f.shape.SetAsBox(e+0.1,c+0.1);d=d.CreateFixture(f);d.SetSensor(!0);d.m_filter.groupIndex=ChuClone.components.player.CharacterControllerComponent.prototype.GROUP;this._sensor=d;this._sensor.SetUserData(this)},onCollision:function(){ChuClone.model.AchievementTracker.getInstance().stopTrackingJump();this._canJump=!0},forceAllowJump:function(){this.onCollision()},
detach:function(){this.attachedEntity.getBody().DestroyFixture(this._sensor);this._sensor=null;ChuClone.components.player.CheckIsJumpingComponent.superclass.detach.call(this)}};ChuClone.extend(ChuClone.components.player.CheckIsJumpingComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.player");ChuClone.components.player.KeyboardInputComponent=function(){this._callback=null;this._keyStates={left:!1,right:!1,up:!1,down:!1};ChuClone.components.player.KeyboardInputComponent.superclass.constructor.call(this)};ChuClone.components.player.KeyboardInputComponent.prototype={displayName:"KeyboardInputComponent",_callback:null,_keyStates:{left:!1,right:!1,up:!1,down:!1},attach:function(b){ChuClone.components.player.KeyboardInputComponent.superclass.attach.call(this,
b)},execute:function(){ChuClone.components.player.KeyboardInputComponent.superclass.execute.call(this);var b=this;this._callback=function(c){c.type=="keyup"?b.handleKeyUp(c):c.type==="keydown"&&b.handleKeyDown(c)};ChuClone.DOM_ELEMENT.addEventListener("keydown",this._callback,!1);ChuClone.DOM_ELEMENT.addEventListener("keyup",this._callback,!1)},handleKeyDown:function(b){var c=!1;if(b.keyCode==ChuClone.model.Constants.KEYS.A)c=this._keyStates.left=!0;else if(b.keyCode==ChuClone.model.Constants.KEYS.D)c=
this._keyStates.right=!0;if(b.keyCode==ChuClone.model.Constants.KEYS.W)c=this._keyStates.up=!0;else if(b.keyCode==ChuClone.model.Constants.KEYS.S)c=this._keyStates.down=!0;c&&b.preventDefault()},handleKeyUp:function(b){var c=!1;if(b.keyCode==ChuClone.model.Constants.KEYS.A)this._keyStates.left=!1,c=!0;else if(b.keyCode==ChuClone.model.Constants.KEYS.D)this._keyStates.right=!1,c=!0;if(b.keyCode==ChuClone.model.Constants.KEYS.W)this._keyStates.up=!1,c=!0;else if(b.keyCode==ChuClone.model.Constants.KEYS.S)this._keyStates.down=
!1,c=!0;c&&b.preventDefault()},resetState:function(){this._keyStates.left=this._keyStates.right=this._keyStates.up=this._keyStates.down=!1},detach:function(){ChuClone.DOM_ELEMENT.removeEventListener("keydown",this._callback,!1);ChuClone.DOM_ELEMENT.removeEventListener("keyup",this._callback,!1);this._callback=null;ChuClone.components.player.KeyboardInputComponent.superclass.detach.call(this)}};ChuClone.extend(ChuClone.components.player.KeyboardInputComponent,ChuClone.components.BaseComponent)})();(function(){var b={UP:2,DOWN:4,LEFT:8,RIGHT:16};ChuClone.namespace("ChuClone.components.player");ChuClone.components.player.PlayerRecordComponent=function(){ChuClone.components.player.PlayerRecordComponent.superclass.constructor.call(this);this._record=[]};ChuClone.components.player.PlayerRecordComponent.prototype={displayName:"PlayerRecordComponent",_player:null,_clockDelegate:null,_callback:null,_record:null,_currentState:0,attach:function(b){ChuClone.components.player.PlayerRecordComponent.superclass.attach.call(this,
b)},execute:function(){ChuClone.components.player.PlayerRecordComponent.superclass.execute.call(this);if(this._clockDelegate)if(this.attachedEntity.getComponentWithName(ChuClone.components.player.PlayerRecordComponent.prototype.displayName)){var b=this;this._callback=function(d){d.type=="keyup"?b.handleKeyUp(d):d.type==="keydown"&&b.handleKeyDown(d)};ChuClone.DOM_ELEMENT.addEventListener("keydown",this._callback,!1);ChuClone.DOM_ELEMENT.addEventListener("keyup",this._callback,!1)}else console.error("Cannot attach PlayerInputComponent. Cannot find 'PlayerRecordComponent' in attachedEntity");
else console.error("Cannot attach PlayerRecordComponent without valid clock delegate")},handleKeyDown:function(c){var d=this._currentState,e=!1;c.keyCode==ChuClone.model.Constants.KEYS.A?(d|=b.LEFT,e=!0):c.keyCode==ChuClone.model.Constants.KEYS.D&&(d|=b.RIGHT,e=!0);c.keyCode==ChuClone.model.Constants.KEYS.W?(d|=b.UP,e=!0):c.keyCode==ChuClone.model.Constants.KEYS.S&&(d|=b.DOWN,e=!0);if(e&&d!==this._currentState)this.onStateHasChanged(d)},handleKeyUp:function(c){var d=this._currentState,e=!1;c.keyCode==
ChuClone.model.Constants.KEYS.A?(d&=~b.LEFT,e=!0):c.keyCode==ChuClone.model.Constants.KEYS.D&&(d&=~b.RIGHT,e=!0);c.keyCode==ChuClone.model.Constants.KEYS.W?(d&=~b.UP,e=!0):c.keyCode==ChuClone.model.Constants.KEYS.S&&(d&=~b.DOWN,e=!0);if(e&&d!==this._currentState)this.onStateHasChanged(d)},onStateHasChanged:function(b){this._currentState=b;this._record.push({t:this._clockDelegate.getCurrentTime(),s:this._currentState})},detach:function(){ChuClone.DOM_ELEMENT.removeEventListener("keydown",this._callback,
!1);ChuClone.DOM_ELEMENT.removeEventListener("keyup",this._callback,!1);this._callback=null;ChuClone.components.player.PlayerRecordComponent.superclass.detach.call(this)},setClockDelegate:function(b){if(typeof b.getCurrentTime==="function")this._clockDelegate=b},getRecord:function(){console.log(this._record);return this._record}};ChuClone.extend(ChuClone.components.player.PlayerRecordComponent,ChuClone.components.BaseComponent)})();(function(){var b={UP:2,DOWN:4,LEFT:8,RIGHT:16};ChuClone.namespace("ChuClone.components.player");ChuClone.components.player.PlayerPlaybackComponent=function(){ChuClone.components.player.PlayerPlaybackComponent.superclass.constructor.call(this);this.requiresUpdate=!0;this._record=JSON.parse('[{"t":107,"s":16},{"t":199,"s":18},{"t":206,"s":16},{"t":265,"s":18},{"t":297,"s":16},{"t":338,"s":18},{"t":346,"s":16},{"t":406,"s":18},{"t":430,"s":16},{"t":476,"s":0},{"t":485,"s":8},{"t":503,"s":10},{"t":514,"s":2},{"t":519,"s":18},{"t":520,"s":16},{"t":598,"s":0},{"t":610,"s":8},{"t":613,"s":10},{"t":631,"s":8},{"t":633,"s":0},{"t":650,"s":16},{"t":686,"s":0},{"t":703,"s":16},{"t":715,"s":18},{"t":722,"s":16},{"t":798,"s":0},{"t":805,"s":8},{"t":828,"s":0},{"t":835,"s":16},{"t":998,"s":0},{"t":1003,"s":2},{"t":1012,"s":0},{"t":1022,"s":8},{"t":1050,"s":10},{"t":1059,"s":2},{"t":1062,"s":0},{"t":1064,"s":8},{"t":1072,"s":0},{"t":1083,"s":16},{"t":1095,"s":0},{"t":1105,"s":8},{"t":1117,"s":10},{"t":1129,"s":8},{"t":1131,"s":0},{"t":1149,"s":16},{"t":1151,"s":0},{"t":1172,"s":16},{"t":1217,"s":18},{"t":1224,"s":16},{"t":1265,"s":20},{"t":1283,"s":16},{"t":1320,"s":18},{"t":1327,"s":16},{"t":1357,"s":20},{"t":1371,"s":16},{"t":1452,"s":0},{"t":1462,"s":16},{"t":1486,"s":18},{"t":1522,"s":16},{"t":1594,"s":18},{"t":1599,"s":16},{"t":1602,"s":0},{"t":1611,"s":4},{"t":1617,"s":12},{"t":1621,"s":8},{"t":1624,"s":0},{"t":1632,"s":8},{"t":1642,"s":10},{"t":1727,"s":2},{"t":1729,"s":0},{"t":1729,"s":16},{"t":1734,"s":20},{"t":1760,"s":16},{"t":1836,"s":18},{"t":1844,"s":16},{"t":1913,"s":18},{"t":2080,"s":2},{"t":2084,"s":0},{"t":2085,"s":8},{"t":2098,"s":10},{"t":2109,"s":8},{"t":2114,"s":0},{"t":2123,"s":16},{"t":2129,"s":20},{"t":2138,"s":16},{"t":2160,"s":18},{"t":2257,"s":16},{"t":2263,"s":20},{"t":2265,"s":4},{"t":2273,"s":20},{"t":2283,"s":16},{"t":2324,"s":18},{"t":2424,"s":16},{"t":2426,"s":0},{"t":2432,"s":8},{"t":2454,"s":0},{"t":2463,"s":16},{"t":2479,"s":0},{"t":2484,"s":8},{"t":2488,"s":0},{"t":2505,"s":16},{"t":2524,"s":0},{"t":2527,"s":8},{"t":2534,"s":10},{"t":2553,"s":8},{"t":2571,"s":0},{"t":2586,"s":16},{"t":2591,"s":0},{"t":2619,"s":16},{"t":2633,"s":0},{"t":2646,"s":16},{"t":2660,"s":0},{"t":2667,"s":16},{"t":2755,"s":20},{"t":2763,"s":16},{"t":2790,"s":18},{"t":2796,"s":16},{"t":2832,"s":20},{"t":2846,"s":16},{"t":2931,"s":0},{"t":2952,"s":16},{"t":2965,"s":18},{"t":2974,"s":16},{"t":3072,"s":0},{"t":3112,"s":16},{"t":3136,"s":0},{"t":3141,"s":8},{"t":3152,"s":10},{"t":3167,"s":8},{"t":3178,"s":0},{"t":3198,"s":16},{"t":3268,"s":18},{"t":3332,"s":16},{"t":3337,"s":20},{"t":3348,"s":16},{"t":3386,"s":18},{"t":3392,"s":16},{"t":3432,"s":18},{"t":3438,"s":16},{"t":3444,"s":18},{"t":3449,"s":16},{"t":3455,"s":18},{"t":3460,"s":16},{"t":3558,"s":0},{"t":3569,"s":8},{"t":3583,"s":0},{"t":3596,"s":8},{"t":3605,"s":0},{"t":3614,"s":16},{"t":3620,"s":18},{"t":3632,"s":16},{"t":3678,"s":0},{"t":3689,"s":8},{"t":3694,"s":0},{"t":3699,"s":16},{"t":3707,"s":18},{"t":3719,"s":16},{"t":3794,"s":0}]');
this._record.reverse()};ChuClone.components.player.PlayerPlaybackComponent.prototype={displayName:"PlayerPlaybackComponent",_player:null,_clockDelegate:null,_record:null,_currentState:0,attach:function(b){ChuClone.components.player.PlayerPlaybackComponent.superclass.attach.call(this,b)},execute:function(){ChuClone.components.player.PlayerPlaybackComponent.superclass.execute.call(this);this._clockDelegate?(this._keyboardComponent=this.attachedEntity.getComponentWithName(ChuClone.components.player.KeyboardInputComponent.prototype.displayName))?
this._keyboardComponent.handleKeyDown=this._keyboardComponent.handleKeyUp=function(){}:console.error("Cannot attach PlayerInputComponent. Cannot find 'PlayerPlaybackComponent' in attachedEntity"):console.error("Cannot attach PlayerPlaybackComponent without valid clock delegate")},update:function(){var c=this._clockDelegate.getCurrentTime();c+=4;for(var d=this._record.length,e=!1,f=0;f<d;){var g=this._record[f];if(g.t==c){this._currentState=g.s;this._record.pop();e=!0;break}f++}if(e)this._keyboardComponent._keyStates.up=
this._currentState&b.UP,this._keyboardComponent._keyStates.down=this._currentState&b.DOWN,this._keyboardComponent._keyStates.left=this._currentState&b.LEFT,this._keyboardComponent._keyStates.right=this._currentState&b.RIGHT},detach:function(){ChuClone.components.player.PlayerPlaybackComponent.superclass.detach.call(this)},setClockDelegate:function(b){if(typeof b.getCurrentTime==="function")this._clockDelegate=b},getRecord:function(){return this._record}};ChuClone.extend(ChuClone.components.player.PlayerPlaybackComponent,
ChuClone.components.BaseComponent)})();(function(){ChuClone.model.Constants.JOYSTICK.ENABLED?(document.write('<script src="/game/js/lib/NoBarrierOSC/socket.io.js"><\/script>'),document.write('<script src="/game/js/lib/NoBarrierOSC/SortedLookupTable.js"><\/script>'),document.write('<script src="/game/js/lib/NoBarrierOSC/RealtimeMutliplayerGame.js"><\/script>'),document.write('<script src="/game/js/lib/NoBarrierOSC/Point.js"><\/script>'),document.write('<script src="/game/js/lib/NoBarrierOSC/Constants.js"><\/script>'),document.write('<script src="/game/js/lib/NoBarrierOSC/NetChannelMessage.js"><\/script>'),
document.write('<script src="/game/js/lib/NoBarrierOSC/ClientNetChannel.js"><\/script>'),document.write('<script src="/game/js/lib/NoBarrierOSC/GameEntity.js"><\/script>'),ChuClone.namespace("ChuClone.components"),ChuClone.components.player.RemoteJoystickInputComponent=function(){ChuClone.components.player.RemoteJoystickInputComponent.superclass.constructor.call(this);this.requiresUpdate=!0;this.cmdMap[RealtimeMultiplayerGame.Constants.CMDS.JOYSTICK_UPDATE]=this.joystickUpdate;this.cmdMap[RealtimeMultiplayerGame.Constants.CMDS.JOYSTICK_SELECT_LEVEL]=
this.joystickSelectLevel;this.netChannel=new RealtimeMultiplayerGame.ClientNetChannel(this,ChuClone.model.Constants.JOYSTICK.SERVER_LOCATION,ChuClone.model.Constants.JOYSTICK.SERVER_PORT,["xhr-polling","websocket"],!1)},ChuClone.components.player.RemoteJoystickInputComponent.prototype={displayName:"RemoteJoystickInputComponent",gameClockReal:0,gameClock:0,gameTick:0,_focusComponent:null,_keyStates:{left:!1,right:!1,up:!1,down:!1,angle:0},cmdMap:{},_idleTimeout:null,attach:function(b){ChuClone.components.player.RemoteJoystickInputComponent.superclass.attach.call(this,
b)},execute:function(){ChuClone.components.player.RemoteJoystickInputComponent.superclass.execute.call(this)},netChannelDidConnect:function(){this.netChannel.addMessageToQueue(!0,RealtimeMultiplayerGame.Constants.CMDS.PLAYER_JOINED,{type:"cabinet"})},netChannelDidReceiveMessage:function(b){this.log("RecievedMessage",b)},netChannelDidDisconnect:function(){this.log("netChannelDidDisconnect",arguments)},update:function(){if(this.netChannel){if(!this._focusComponent)this._focusComponent=ChuClone.GameViewController.INSTANCE.getCamera().getComponentWithName(ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName);
this.updateClock();this.netChannel.tick()}},updateClock:function(){var b=this.gameClockReal;this.gameClockReal=(new Date).getTime();b=this.gameClockReal-b;this.gameClock+=b;this.gameTick++;this.speedFactor=b/(1E3/this.targetFramerate);if(this.speedFactor<=0)this.speedFactor=1},joystickUpdate:function(b){var c=+b.payload.analog;this._keyStates.left=c!=0&&c<360&&c>180;this._keyStates.right=c>0&&c<180;this._keyStates.up=b.payload.button;this.resetIdleTimer();if(this._focusComponent)this._focusComponent._mousePosition.x=
b.payload.accelY/10,this._focusComponent._mousePosition.x*=0.5,this._focusComponent._mousePosition.x+=0.5,this._focusComponent._mousePosition.y=b.payload.accelX/10,this._focusComponent._mousePosition.y*=0.5,this._focusComponent._mousePosition.y+=0.6},joystickSelectLevel:function(b){if(b.payload.level_id)this.netChannel.dealloc(),this.netChannel=null,ChuClone.Events.Dispatcher.emit(ChuClone.gui.LevelListing.prototype.EVENTS.SHOULD_CHANGE_LEVEL,ChuClone.model.Constants.SERVER.LEVEL_LOAD_LOCATION+b.payload.level_id+
".js?r"+Math.floor(Math.random()*9999))},resetIdleTimer:function(){var b=this;clearTimeout(this._idleTimeout);setTimeout(function(){b.onIdleTimerWasHit()},1E4)},onIdleTimerWasHit:function(){console.log("Idle for too long!")},parseEntityDescriptionArray:function(){console.error("RemoteJoystickComponent.parseEntityDescriptionArray - Should never be called")},getGameClock:function(){return this.gameClock},log:function(){console.log(arguments)},detach:function(){this.netChannel&&this.netChannel.dealloc();
clearTimeout(this._idleTimeout);this._focusComponent=this.netChannel=null;ChuClone.components.player.RemoteJoystickInputComponent.superclass.detach.call(this)}},ChuClone.extend(ChuClone.components.player.RemoteJoystickInputComponent,ChuClone.components.BaseComponent)):console.warn("RemoteJoystickInputComponent - Joystick ChuClone.model.Constants.JOYSTICK.ENABLED == false. Aborting...")})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.PhysicsVelocityLimitComponent=function(){ChuClone.components.PhysicsVelocityLimitComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.PhysicsVelocityLimitComponent.prototype={displayName:"PhysicsVelocityLimitComponent",_maxSpeed:new Box2D.Common.Math.b2Vec2(22,0.36),update:function(){var b=ChuClone.model.Constants.PTM_RATIO,c=this.attachedEntity.getBody();if(Math.abs(c.m_linearVelocity.x)>
this._maxSpeed.x)c.m_linearVelocity.x=this._maxSpeed.x*(c.m_linearVelocity.x<0?-1:1);if(c.m_linearVelocity.y<-this._maxSpeed.y*b)c.m_linearVelocity.y=-this._maxSpeed.y*b},setMaxSpeedXY:function(b,c){this._maxSpeed=new Box2D.Common.Math.b2Vec2(b,c)}};ChuClone.extend(ChuClone.components.PhysicsVelocityLimitComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");ChuClone.components.BoundsYCheckComponent=function(){ChuClone.components.BoundsYCheckComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.BoundsYCheckComponent.prototype={displayName:"BoundsYCheckComponent",MINIMUM_Y:5,update:function(){this.attachedEntity.getBody().GetPosition().y>this.MINIMUM_Y&&(ChuClone.components.RespawnComponent.prototype.GET_CURRENT_RESPAWNPOINT().setSpawnedEntityPosition(this.attachedEntity),
this.attachedEntity.getBody().SetLinearVelocity(new Box2D.Common.Math.b2Vec2(0,0)))}};ChuClone.extend(ChuClone.components.BoundsYCheckComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.camera");ChuClone.components.camera.CameraFocusRadiusComponent=function(){ChuClone.components.camera.CameraFocusRadiusComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.camera.CameraFocusRadiusComponent.prototype={displayName:"CameraFocusRadiusComponent",_offset:new THREE.Vector3(0,0,0),_mousePosition:new THREE.Vector2(3.05,1),_radius:new THREE.Vector3(0,0,0),_mouseCallback:null,attach:function(b){ChuClone.components.camera.CameraFocusRadiusComponent.superclass.attach.call(this,
b);var c=this;this._mouseCallback=function(b){c.onDocumentMouseMove(b)};document.addEventListener("mousemove",this._mouseCallback,!1)},update:function(){this.attachedEntity.position.x+=Math.cos(this._mousePosition.x*Math.PI)*this._radius.x;this.attachedEntity.position.y+=(this._mousePosition.y*2-1)*this._radius.y;this.attachedEntity.position.z+=this._radius.z},onDocumentMouseMove:function(b){b.preventDefault();this._mousePosition.x=b.clientX/ChuClone.DOM_ELEMENT.offsetWidth;this._mousePosition.y=
b.clientY/ChuClone.DOM_ELEMENT.offsetHeight},detach:function(){ChuClone.components.camera.CameraFocusRadiusComponent.superclass.detach.call(this);document.removeEventListener("mousemove",this._mouseCallback,!1)},getModel:function(){var b=ChuClone.components.JumpPadComponent.superclass.getModel.call(this);b.offset=this._offset;b.radius=this._radius;return b},fromModel:function(b){ChuClone.components.JumpPadComponent.superclass.fromModel.call(this,b);this._offset=new THREE.Vector3(b._offset.x,b._offset.y,
b._offset.z);this._radius=b.radius},setRadius:function(b){this._radius=b},getRadius:function(){return this._radius}};ChuClone.extend(ChuClone.components.camera.CameraFocusRadiusComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.camera");ChuClone.components.camera.CameraFollowEditorComponent=function(){ChuClone.components.camera.CameraFollowEditorComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.camera.CameraFollowEditorComponent.prototype={displayName:"CameraFollowEditorComponent",_debugDraw:null,_offset:null,_maxSpeed:new Box2D.Common.Math.b2Vec2(0.5,0.5),update:function(){var b=ChuClone.model.Constants.PTM_RATIO,c=new Box2D.Common.Math.b2Vec2(this._debugDraw.m_ctx.canvas.width/
2,this._debugDraw.m_ctx.canvas.height/2);c.Multiply(1/this._debugDraw.GetDrawScale());c.Multiply(b);this.attachedEntity.position.x=this._debugDraw.offsetX*-b;this.attachedEntity.position.x+=c.x;this.attachedEntity.position.y=this._debugDraw.offsetY*b;this.attachedEntity.position.y-=c.y;this.attachedEntity.position.z=1E4*(1/this._debugDraw.GetDrawScale());this.attachedEntity.target.position=this.attachedEntity.position.clone();this.attachedEntity.target.position.z=-1E3},detach:function(){ChuClone.components.camera.CameraFollowEditorComponent.superclass.detach.call(this);
this._debugDraw=null},setDebugDraw:function(b){this._debugDraw=b},getDebugDraw:function(){return this._debugDraw}};ChuClone.extend(ChuClone.components.camera.CameraFollowEditorComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.camera");ChuClone.components.camera.CameraFollowPlayerComponent=function(){ChuClone.components.camera.CameraFollowPlayerComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.camera.CameraFollowPlayerComponent.prototype={displayName:"CameraFollowPlayerComponent",_player:null,_offset:null,_damping:0.05,attach:function(b){ChuClone.components.camera.CameraFollowPlayerComponent.superclass.attach.call(this,b);var c=this;
ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,function(b){b==c._player&&c.detach()})},update:function(){if(this._player)this.attachedEntity.target.position.x-=(this.attachedEntity.target.position.x-(this._player.view.position.x+700))*this._damping,this.attachedEntity.target.position.y-=(this.attachedEntity.target.position.y-(this._player.view.position.y-700))*this._damping,this.attachedEntity.target.position.z=this._player.view.position.z,
this.attachedEntity.position.x-=(this.attachedEntity.position.x-(this._player.view.position.x+400))*this._damping,this.attachedEntity.position.y-=(this.attachedEntity.position.y-this._player.view.position.y)*this._damping,this.attachedEntity.position.z=0},getModel:function(){var b=ChuClone.components.camera.CameraFollowPlayerComponent.superclass.getModel.call(this);b.damping=this._damping;return b},fromModel:function(b){ChuClone.components.camera.CameraFollowPlayerComponent.superclass.fromModel.call(this,
b);this._damping=b.damping},detach:function(){ChuClone.components.camera.CameraFollowPlayerComponent.superclass.detach.call(this);this._debugDraw=this._player=null},onPlayerCreated:function(b){this.setPlayer(b)},onPlayerDestroyed:function(b){console.log("PLAYA:",b)},setPlayer:function(b){this._player=b}};ChuClone.extend(ChuClone.components.camera.CameraFollowPlayerComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.camera");ChuClone.components.camera.CameraOrbitRadiusComponent=function(){ChuClone.components.camera.CameraOrbitRadiusComponent.superclass.constructor.call(this);this.requiresUpdate=!0};ChuClone.components.camera.CameraOrbitRadiusComponent.prototype={displayName:"CameraOrbitRadiusComponent",_offset:new THREE.Vector3(0,0,0),_target:null,_rotationSpeed:new THREE.Vector3(0.0030,0.0050,0.0030),_mousePosition:new THREE.Vector2(3.05,1),_radius:new THREE.Vector3(0,
0,0),_mouseCallback:null,attach:function(b){ChuClone.components.camera.CameraOrbitRadiusComponent.superclass.attach.call(this,b);var c=this;this._mouseCallback=function(b){c.onDocumentMouseMove(b)};document.addEventListener("mousemove",this._mouseCallback,!1)},update:function(){var b=this._target.y+(this._mousePosition.y*2-1)*this._radius.y+500+Math.sin(this._offset.y)*this._radius.y,c=this._target.z+Math.sin(this._offset.z)*this._radius.z;this.attachedEntity.position.x-=(this.attachedEntity.position.x-
(this._target.x+Math.cos(this._offset.x)*this._radius.x))*0.04;this.attachedEntity.position.y-=(this.attachedEntity.position.y-b)*0.04;this.attachedEntity.position.z-=(this.attachedEntity.position.z-c)*0.04;this._offset.addSelf(this._rotationSpeed)},onDocumentMouseMove:function(b){b.preventDefault();this._mousePosition.x=b.clientX/ChuClone.DOM_ELEMENT.offsetWidth;this._mousePosition.y=b.clientY/ChuClone.DOM_ELEMENT.offsetHeight},detach:function(){ChuClone.components.camera.CameraOrbitRadiusComponent.superclass.detach.call(this);
document.removeEventListener("mousemove",this._mouseCallback,!1)},setRadius:function(b){this._radius=b},getRadius:function(){return this._radius},setTarget:function(b){this._target=b}};ChuClone.extend(ChuClone.components.camera.CameraOrbitRadiusComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components.misc");ChuClone.components.misc.TutorialNoteComponent=function(){ChuClone.components.misc.TutorialNoteComponent.superclass.constructor.call(this)};ChuClone.components.misc.TutorialNoteComponent.prototype={displayName:"TutorialNoteComponent",_message:"",_isReady:!0,_destroyNoteTimeout:null,_editableProperties:{message:""},attach:function(b){ChuClone.components.misc.TutorialNoteComponent.superclass.attach.call(this,b);this.intercept(["onCollision"])},
onCollision:function(b){if(b._type==ChuClone.model.Constants.ENTITY_TYPES.PLAYER&&(this.interceptedProperties.onCollision.call(this.attachedEntity,b),this._isReady&&!ChuClone.model.Constants.IS_EDIT_MODE())){this._isReady=!1;b.getComponentWithName(ChuClone.components.player.KeyboardInputComponent.prototype.displayName);var c=b.getBody().GetLinearVelocity();c.Multiply(0.2);b.getBody().SetLinearVelocity(c);ChuClone.gui.TutorialNoteDisplay.show(this._message);var d=this;this._destroyNoteTimeout=setTimeout(function(){ChuClone.gui.TutorialNoteDisplay.noteText==
d._message&&ChuClone.gui.TutorialNoteDisplay.fadeOutAndDestroy()},ChuClone.model.Constants.TIMINGS.TUTORIAL_FADE_OUT_TIME)}},setEditableProps:function(){this._editableProperties.message=this._message},onEditablePropertyWasChanged:function(){this._message=this._editableProperties.message},detach:function(){ChuClone.components.misc.TutorialNoteComponent.superclass.detach.call(this)},getModel:function(){var b=ChuClone.components.misc.TutorialNoteComponent.superclass.getModel.call(this);b.message=this._message;
return b},fromModel:function(b){ChuClone.components.misc.TutorialNoteComponent.superclass.fromModel.call(this,b);this._message=b.message}};ChuClone.extend(ChuClone.components.misc.TutorialNoteComponent,ChuClone.components.BaseComponent)})();(function(){ChuClone.namespace("ChuClone.components");var b={};b[ChuClone.components.player.CharacterControllerComponent.prototype.displayName]=ChuClone.components.player.CharacterControllerComponent;b[ChuClone.components.JumpPadComponent.prototype.displayName]=ChuClone.components.JumpPadComponent;b[ChuClone.components.RespawnComponent.prototype.displayName]=ChuClone.components.RespawnComponent;b[ChuClone.components.GoalPadComponent.prototype.displayName]=ChuClone.components.GoalPadComponent;b[ChuClone.components.FrictionPadComponent.prototype.displayName]=
ChuClone.components.FrictionPadComponent;b[ChuClone.components.MovingPlatformComponent.prototype.displayName]=ChuClone.components.MovingPlatformComponent;b[ChuClone.components.AutoRotationComponent.prototype.displayName]=ChuClone.components.AutoRotationComponent;b[ChuClone.components.DeathPadComponent.prototype.displayName]=ChuClone.components.DeathPadComponent;b[ChuClone.components.player.KeyboardInputComponent.prototype.displayName]=ChuClone.components.player.KeyboardInputComponent;b[ChuClone.components.player.PlayerRecordComponent.prototype.displayName]=
ChuClone.components.player.PlayerRecordComponent;b[ChuClone.components.player.PlayerPlaybackComponent.prototype.displayName]=ChuClone.components.player.PlayerPlaybackComponent;b[ChuClone.components.PhysicsVelocityLimitComponent.prototype.displayName]=ChuClone.components.PhysicsVelocityLimitComponent;b[ChuClone.components.player.CheckIsJumpingComponent.prototype.displayName]=ChuClone.components.player.CheckIsJumpingComponent;b[ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName]=
ChuClone.components.camera.CameraFocusRadiusComponent;b[ChuClone.components.camera.CameraFollowEditorComponent.prototype.displayName]=ChuClone.components.camera.CameraFollowEditorComponent;b[ChuClone.components.camera.CameraFollowPlayerComponent.prototype.displayName]=ChuClone.components.camera.CameraFollowPlayerComponent;b[ChuClone.components.effect.ParticleEmitterComponent.prototype.displayName]=ChuClone.components.effect.ParticleEmitterComponent;b[ChuClone.components.misc.TutorialNoteComponent.prototype.displayName]=
ChuClone.components.misc.TutorialNoteComponent;ChuClone.components.ComponentFactory={getComponentByName:function(c){if(b[c])return new b[c];return null}}})();(function(){ChuClone.namespace("ChuClone.model.FSM");ChuClone.model.FSM.State=function(){this._closures={}};ChuClone.model.FSM.State.prototype={_closures:null,enter:function(){},update:function(){},exit:function(){this.removeAllListeners()},addListener:function(b,c){console.log("Adding Listener:",b);c.eventName=b;this._closures[b]=c;ChuClone.Events.Dispatcher.addListener(b,c)},removeListener:function(b){ChuClone.Events.Dispatcher.removeListener(b,this._closures[b])},removeAllListeners:function(){for(var b in this._closures)console.log("Removing Listener:",
b),this.removeListener(b);this._closures={}}}})();(function(){ChuClone.namespace("ChuClone.model.FSM");var b=null;ChuClone.model.FSM.StateMachine=function(){b==null?b=this:console.error("ChuClone.model.FSM.StateMachine - Instance already exist!")};ChuClone.model.FSM.StateMachine.prototype={_currentState:null,_previousState:null,_nextState:null,setInitialState:function(b){this._currentState=b;this._currentState.enter()},changeState:function(b){this._currentState.exit();this._previousState=this._currentState;this._currentState=b;this._currentState.enter()},
gotoPreviousState:function(){this.changeState(this._previousState)},gotoNextState:function(){this.changeState(this._nextState)},update:function(){this._currentState&&this._currentState.update()}};ChuClone.model.FSM.StateMachine.getInstance=function(){if(b==null){debugger;throw Error("ChuClone.model.FSM.StateMachine - No instance!");}return b}})();(function(){ChuClone.namespace("ChuClone.Events.Dispatcher");ChuClone.Events.Dispatcher=new EventEmitter})();(function(){var b;ChuClone.namespace("ChuClone.editor");ChuClone.editor.LevelModel=function(){b==null&&(b=this);this.setupEvents()};ChuClone.editor.LevelModel.getInstance=function(){return b};ChuClone.editor.LevelModel.prototype={author:null,creationDate:null,modificationDate:null,ptmRatio:1,levelName:null,bodyList:null,levelJSONString:null,setupEvents:function(){},parseLevel:function(b,d){var e={};e.editingInfo={author:"#{user_name}",levelName:d,creationDate:this.creationDate||(new Date).getTime(),
modificationDate:(new Date).getTime()};e.worldSettings={PTM_RATIO:ChuClone.model.Constants.PTM_RATIO};e.playerInfo=null;e.bodyList=[];for(var f=b.getWorld().GetBodyList();f;){var g=f,f=f.GetNext();if(g.GetFixtureList()){var h={density:g.GetFixtureList().GetDensity(),friction:g.GetFixtureList().GetDensity(),restitution:g.GetFixtureList().GetRestitution(),bodyType:g.GetType()},j=g.GetUserData();if(j){g={x:g.GetPosition().x,y:g.GetPosition().y,dimensions:j.getDimensions(),angle:g.GetAngle(),physicsInfo:h,
entityType:j.getType(),components:[]};for(h=j.components.length;h--;)g.components.push(j.components[h].getModel());e.bodyList.push(g)}}}this.levelJSONString=JSON.stringify(e,null,"\t");this.levelName=e.editingInfo.levelName;return this.levelJSONString},fromJsonString:function(b,d,e){this.levelJSONString=b;b=JSON.parse(b);this.levelName=b.editingInfo.levelName;this.creationDate=b.editingInfo.creationDate;this.modificationDate=b.editingInfo.modificationDate;this.ptmRatio=b.worldSettings.PTM_RATIO;this.bodyList=
[];ChuClone.model.Constants.PTM_RATIO=b.worldSettings.PTM_RATIO;for(var f=b.bodyList.length,g=0;g<f;g++){var h=b.bodyList[g];if(this.checkLevelEntityInfoIsValid(h)){var j=d.createRect(h.x*this.ptmRatio,h.y*this.ptmRatio,h.angle,h.dimensions.width,h.dimensions.height,h.physicsInfo.bodyType==Box2D.Dynamics.b2Body.b2_kinematicBody),m=e.createEntityView(h.x*this.ptmRatio,h.y*this.ptmRatio,h.dimensions.width*2,h.dimensions.height*2,h.dimensions.depth*2),n=new ChuClone.GameEntity;n.setBody(j);n.setView(m);
n.setDimensions(h.dimensions.width,h.dimensions.height,h.dimensions.depth);for(m=h.components.length-1;m>=0;m--){var t=ChuClone.components.ComponentFactory.getComponentByName(h.components[m].displayName);t&&(t.fromModel(h.components[m],n),n.addComponentAndExecute(t))}this.bodyList.push(j)}}},checkLevelEntityInfoIsValid:function(b){var d=!0;b.dimensions.width==0&&(d=!1);return d}}})();(function(){ChuClone.namespace("ChuClone.editor");ChuClone.editor.LevelManager=function(){ChuClone.editor.LevelManager.INSTANCE=this};ChuClone.editor.LevelManager.prototype={_levelModel:null,_controllers:{},_currentSlot:0,_currentName:"Untitled",_userLevels:0,EVENTS:{LEVEL_CREATED:"LevelManager.Events.WorldCreated",LEVEL_DESTROYED:"LevelManager.Events.LevelDestroyed"},setupGui:function(){var b=this;this._gui=new DAT.GUI({width:ChuClone.model.Constants.EDITOR.PANEL_WIDTH+50});this._gui.name("LevelManager");
this._gui.autoListen=!1;this._controllers.name=this._gui.add(this,"_currentName").name("Level Name").onFinishChange(function(b){document.getElementById("levelName").innerText=b});this._controllers.slot=this._gui.add(this,"_currentSlot").options([0,1,2,3,4,5,6,7,8,9,10]).name("Active Save Slot");var c=parseInt(localStorage.getItem("lastSlot"));this._controllers.slot.domElement.childNodes[1].selectedIndex=c;this._controllers.slot.setValue(c);this._controllers.saveLevelToSlot=this._gui.add(this,"saveLevelToSlot").name("Save To Slot");
this._controllers.loadLevelFromSlot=this._gui.add(this,"loadLevelFromSlot").name("Load From Slot");this._controllers.saveToServer=this._gui.add(this,"onShouldSaveToServer").name("Save To Server");b._controllers.level=b._gui.add(b,"_userLevels");b._controllers.level.domElement.lastChild.style.width="120px";b._controllers.level.options([]);b._controllers.level.onChange(function(){b.onLevelDropDownItemSelected(this.domElement.childNodes[1].selectedIndex)});b._controllers.level.name("Load From Server");
this.loadServerLeveList();this.setupEvents();b._gui.close();b._gui.open()},setupEvents:function(){var b=this;ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,function(c){b._player=c});ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,function(c){b._player==c?b._player=null:console.log("Removing player but our player is different!")})},loadServerLeveList:function(){var b=
this,c=new XMLHttpRequest;c.onreadystatechange=function(){c.readyState==4&&b.populateServerLevelList(c)};c.open("GET",ChuClone.model.Constants.SERVER.USER_LEVELS_LOCATION,!0);c.send(null)},populateServerLevelList:function(b){b=JSON.parse(b.responseText);ChuClone.utils.repopulateOptionsGUI(this._controllers.level,b,function(b,d){b.value=d.level.id;b.innerText=d.level.title;b.label=d.level.title})},onLevelDropDownItemSelected:function(b){var b=this._controllers.level.domElement.lastChild.children[b].value,
c=ChuClone.editor.WorldEditor.getInstance().getWorldController(),d=ChuClone.editor.WorldEditor.getInstance().getViewController();this.loadLevelFromURL(c,d,ChuClone.model.Constants.SERVER.LEVEL_LOAD_LOCATION+b+".js?r"+Math.floor(Math.random()*9999));document.getElementsByTagName("canvas")[0].focus()},loadLatestLevel:function(){try{this._currentSlot=parseInt(localStorage.getItem("lastSlot")),this.loadLevelFromSlot(null,null)}catch(b){ChuClone.utils.displayFlash("LevelManager.loadLatestLevel - Load failed",
0)}},saveLevelToSlot:function(b){b||(b=ChuClone.editor.WorldEditor.getInstance().getWorldController());if(window.confirm("Save will overwrite existin data.\nAre you sure?")){var c=new ChuClone.editor.LevelModel,b=c.parseLevel(b,this._currentName),d="slot"+this._currentSlot;localStorage.setItem(d,b);localStorage.setItem("lastSlot",this._currentSlot);ChuClone.utils.displayFlash("Level Saved at slot:"+d,1);this._levelModel=c}},onShouldSaveToServer:function(){if(window.confirm("No take backs!\nAre you sure?")){ChuClone.editor.WorldEditor.getInstance()._guiPlayer.restartPlayer();
var b=new ChuClone.editor.LevelModel;b.parseLevel(ChuClone.editor.WorldEditor.getInstance().getWorldController(),this._currentName);var c=new window.FormData;c.append("level_json",b.levelJSONString);c.append("levelName",b.levelName);c.append("levelName",b.levelName);var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4){try{var b=JSON.parse(d.responseText)[0]}catch(c){ChuClone.utils.displayFlash(ChuClone.utils.getValidationErrors(d.responseText),0);return}b.status==!1?ChuClone.utils.displayFlash(ChuClone.utils.getValidationErrorsFromJSON(b.notice),
0):ChuClone.utils.displayFlash("Save To Server Success:",1)}};d.open("POST",ChuClone.model.Constants.SERVER.USER_SUBMIT_LOCATION);d.send(c)}},loadLevelFromSlot:function(b,c){if(!b||c)b=ChuClone.editor.WorldEditor.getInstance().getWorldController(),c=ChuClone.editor.WorldEditor.getInstance().getViewController();this.clearLevel(b,c);var d=localStorage.getItem("slot"+this._currentSlot);this.loadLevelFromJSONString(b,c,d)},loadLevelFromURL:function(b,c,d){this.clearLevel(b,c);var e=new XMLHttpRequest,
f=this;e.onreadystatechange=function(){e.readyState==4&&f.loadLevelFromJSONString(b,c,e.responseText)};e.open("GET",d);e.send(null)},loadLevelFromJSONString:function(b,c,d){var e=new ChuClone.editor.LevelModel;e.fromJsonString(d,b,c);if(this._controllers.hasOwnProperty("name"))this._controllers.name.setValue(e.levelName),document.getElementById("levelName").innerText=e.levelName;this._levelModel=e;ChuClone.Events.Dispatcher.emit(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_CREATED,this);return e},
playtestLevel:function(){var b=ChuClone.model.FSM.StateMachine.getInstance();if(b._currentState instanceof ChuClone.states.PlayLevelState)b.gotoPreviousState(),this._controllers.playtestLevel.name("PLAYTEST");else{try{var c=new ChuClone.states.PlayLevelState(this._world);c._levelManager=this;c._gameView=ChuClone.editor.WorldEditor.getInstance().getViewController();c._worldController=ChuClone.editor.WorldEditor.getInstance().getWorldController();c.onPlayerCreated(this._player);b.changeState(c);c.removeListener(ChuClone.components.GoalPadComponent.EVENTS.GOAL_REACHED)}catch(d){ChuClone.utils.displayFlash("Error setting up level.<br> Make sure you have a player, and goal",
0);b._currentState&&!(b._currentState instanceof ChuClone.states.EditState)?b.gotoPreviousState():c._backgroundElements&&c.removeBackgroundElements();this._player&&(ChuClone.editor.WorldEditor.getInstance()._guiPlayer.destroyPlayer(),ChuClone.editor.WorldEditor.getInstance()._guiPlayer.createPlayer());return}for(b=0;b<DAT.GUI.allGuis.length;b++)DAT.GUI.allGuis[b].close();this._controllers.playtestLevel.name("STOP")}},clearLevel:function(b,c){for(var d=b.getWorld().GetBodyList();d;){var e=d,d=d.GetNext(),
f=e.GetUserData();f&&("getView"in f&&c.removeObjectFromScene(f.getView()),"dealloc"in f&&f.dealloc());b.getWorld().DestroyBody(e)}c.getCamera().removeAllComponents();ChuClone.Events.Dispatcher.emit(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,this)},getModel:function(){return this._levelModel}}})();(function(){ChuClone.namespace("ChuClone.editor.CameraGUI");ChuClone.editor.CameraGUI=function(b){this._camera=b;this.setupGUI();this.setupEvents()};ChuClone.editor.CameraGUI.prototype={_camera:null,_player:null,_debugDraw:null,_gui:null,_controls:[],_isFullScreen:!1,_propProxy:{x:5,y:5,z:3,radius:new THREE.Vector3(1E3,1E3,3E3),fullscreen:!1},_type:0,_camTypes:[null,ChuClone.components.camera.CameraFollowEditorComponent,ChuClone.components.camera.CameraFollowPlayerComponent],setupGUI:function(){var b=
this;this._fullScreen=!1;this._gui=new DAT.GUI({width:ChuClone.model.Constants.EDITOR.PANEL_WIDTH});this._gui.name("Camera");this._gui.autoListen=!1;this._controls.type=this._gui.add(this,"_type");this._controls.type.options({None:0,"Follow Editor":1,"Follow Player":2});this._controls.type.onChange(function(){var c=this.domElement.lastChild.selectedIndex;document.getElementsByTagName("canvas")[0].focus();document.getElementsByTagName("canvas")[1].focus();b.onCamTypeChange(c)});this._gui.add(this._propProxy.radius,
"x").onChange(function(){b.onRadiusChange(this)}).min(-7E3).max(7E3);this._gui.add(this._propProxy.radius,"y").onChange(function(){b.onRadiusChange(this)}).min(-3500).max(3500);this._gui.add(this._propProxy.radius,"z").onChange(function(){b.onRadiusChange(this)}).min(0).max(14E3);this.setupFullscreenToggle();this._gui.close();this._gui.open()},setupEvents:function(){var b=this;ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,function(c){b._player=
c});ChuClone.Events.Dispatcher.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,function(){b._controls.type.domElement.childNodes[1].selectedIndex=0})},setupFullscreenToggle:function(){ChuClone.utils.StyleMemoizer.rememberStyle("flash_notice");ChuClone.utils.StyleMemoizer.rememberStyle("editorContainer");ChuClone.utils.StyleMemoizer.rememberStyle("levelName");ChuClone.utils.StyleMemoizer.rememberStyle("HUDTime");this._controls.fullscreen=this._gui.add(this._propProxy,"fullscreen").name("Fullscreen").onChange(function(b){ChuClone.editor.WorldEditor.getInstance().getViewController().setFullscreen(b);
var c=document.getElementById("editorContainer"),d=document.getElementById("levelName"),e=document.getElementById("HUDTime"),f=document.getElementById("flash_notice");b?(b=Math.round(window.innerWidth/2-c.clientWidth/2),c.style.position="absolute",c.style.top=window.innerHeight-ChuClone.model.Constants.GAME_HEIGHT-10+"px",c.style.left=b+"px",d.style.position="absolute",d.style.width="240px",d.style.top=window.innerHeight-d.offsetHeight-6+"px",d.style.left=b-d.clientWidth-25+"px",e.style.position=
"absolute",e.style.top=window.innerHeight-d.offsetHeight-e.offsetHeight-10+"px",e.style.left=b-e.offsetWidth-33+"px",f.style["z-index"]=1,f.style.backgroundColor="#FFFFFF",f.style.opacity=0.75,f.style.top=parseInt(c.style.top)-f.clientHeight-10+"px"):(ChuClone.utils.StyleMemoizer.restoreStyle("flash_notice"),ChuClone.utils.StyleMemoizer.restoreStyle("editorContainer"),ChuClone.utils.StyleMemoizer.restoreStyle("levelName"),ChuClone.utils.StyleMemoizer.restoreStyle("HUDTime"))})},onCamTypeChange:function(b){this._camera.removeAllComponents();
if(this._camTypes[b]){var c=new this._camTypes[b];this._camera.addComponentAndExecute(c);if(this._camTypes[b]==ChuClone.components.camera.CameraFollowEditorComponent)c.setDebugDraw(this._debugDraw);else if(this._camTypes[b]==ChuClone.components.camera.CameraFollowPlayerComponent)c._damping=0.25,c.setPlayer(this._player);b=new ChuClone.components.camera.CameraFocusRadiusComponent;this._camera.addComponentAndExecute(b);b.getRadius().x=this._propProxy.radius.x;b.getRadius().y=this._propProxy.radius.y;
b.getRadius().z=this._propProxy.radius.z;if(this._player)this._camera.position=this._player.getView().position.clone()}},onRadiusChange:function(b){this._camera.getComponentWithName(ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName).getRadius()[b.propertyName]=b.getValue()},dealloc:function(){this._camera.removeAllComponents();this._camera=this._camera.components=null},setDebugDraw:function(b){this._debugDraw=b}}})();(function(){ChuClone.namespace("ChuClone.editor.PlayerGUI");ChuClone.editor.PlayerGUI=function(){this.setupEvents();this.setupGUI()};ChuClone.editor.PlayerGUI.prototype={_player:null,_gui:null,_controls:[],setupGUI:function(){this._gui=new DAT.GUI({width:ChuClone.model.Constants.EDITOR.PANEL_WIDTH});this._gui.name("Player");this._gui.autoListen=!1;this._controls.Create=this._gui.add(this,"createPlayer").name("Create");this._controls.Destroy=this._gui.add(this,"destroyPlayer").name("Destroy");this._controls.Reset=
this._gui.add(this,"resetPlayer").name("Reset");this._gui.close();this._gui.open()},setupEvents:function(){var b=this;ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,function(c){b.destroyPlayer();b._player=c});ChuClone.Events.Dispatcher.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,function(c){if(c==b._player)b._player=null})},createPlayer:function(){var b=ChuClone.editor.WorldEditor.getInstance();
if(!b)return console.error("ChuClone.editor.PlayerGUI.createPlayer should only be called in editing mode!"),null;var c=ChuClone.components.RespawnComponent.prototype.GET_CURRENT_RESPAWNPOINT();if(!c)return console.error("ChuClone.editor.PlayerGUI.createPlayer Create at least one RespawnComponent first!!"),ChuClone.utils.displayFlash("Cannot create player.<br>Create at least one RespawnComponent first!!",0),null;var d=b.getWorldController().createRect(0,0,0,ChuClone.model.Constants.PLAYER.WIDTH,ChuClone.model.Constants.PLAYER.HEIGHT,
!1),e=b.getViewController().createEntityView(0,0,ChuClone.model.Constants.PLAYER.WIDTH,ChuClone.model.Constants.PLAYER.HEIGHT,ChuClone.model.Constants.PLAYER.DEPTH),f=new ChuClone.GameEntity;f.setBody(d);f.setView(e);d.SetPosition(new Box2D.Common.Math.b2Vec2(c.attachedEntity.getBody().GetPosition().x,c.attachedEntity.getBody().GetPosition().y-1));e.materials[0]=ChuClone.model.Constants.PLAYER.MATERIAL;f.setDimensions(ChuClone.model.Constants.PLAYER.WIDTH,ChuClone.model.Constants.PLAYER.HEIGHT,ChuClone.model.Constants.PLAYER.DEPTH);
f.addComponentAndExecute(new ChuClone.components.player.CharacterControllerComponent);f.addComponentAndExecute(new ChuClone.components.PhysicsVelocityLimitComponent);f.addComponentAndExecute(new ChuClone.components.BoundsYCheckComponent);b.getViewController().addObjectToScene(f.view)},destroyPlayer:function(){console.log("UPO");if(this._player){ChuClone.editor.WorldEditor.getInstance().getViewController().removeObjectFromScene(this._player.getView());var b=this._player.getBody();this._player.dealloc();
ChuClone.editor.WorldEditor.getInstance().getWorldController().getWorld().DestroyBody(b);this._player=null}},resetPlayer:function(){if(!this._player)return ChuClone.utils.displayFlash("ChuClone.editor.PlayerGUI.resetPlayer<br>There is no player!!",0),null;var b=ChuClone.components.RespawnComponent.prototype.GET_CURRENT_RESPAWNPOINT();if(!b)return ChuClone.utils.displayFlash("ChuClone.editor.PlayerGUI.resetPlayer<br>Create at least one RespawnComponent first!",0),console.error("resetPlayer failed<br>Create at least one RespawnComponent first!"),
null;this._player.getBody().SetPosition(new Box2D.Common.Math.b2Vec2(b.attachedEntity.getBody().GetPosition().x,b.attachedEntity.getBody().GetPosition().y-1))},restartPlayer:function(){if(!this._player)return ChuClone.utils.displayFlash("There is no player!",0),null;var b=ChuClone.components.RespawnComponent.prototype.GET_ALL_RESPAWNPOINTS()[0];if(!b)return ChuClone.utils.displayFlash("restartPlayer failed<br>Create at least one RespawnComponent first!",0),null;this._player.getBody().SetPosition(new Box2D.Common.Math.b2Vec2(b.attachedEntity.getBody().GetPosition().x,
b.attachedEntity.getBody().GetPosition().y-1))},dealloc:function(){this._player=null}}})();(function(){ChuClone.namespace("ChuClone.editor");ChuClone.editor.ShiftDragHelper=function(b){this._mouseStartPosition=b.Copy()};ChuClone.editor.ShiftDragHelper.prototype={_mouseStartPosition:null,_delta:null,_axis:null,MIN_DISTANCE:20,adjustPosition:function(b){if(!this._axis){var c=Math.abs(b.x-this._mouseStartPosition.x),d=Math.abs(b.y-this._mouseStartPosition.y);if(Math.sqrt(c*c+d*d)>ChuClone.editor.ShiftDragHelper.prototype.MIN_DISTANCE)this._axis=c>d?"x":"y";return b}b.x=this._axis=="x"?b.x:
this._mouseStartPosition.x;b.y=this._axis=="y"?b.y:this._mouseStartPosition.y;return b},dealloc:function(){this._delta=this._mouseStartPosition=null}}})();(function(){var b=ChuClone.model.Constants.PTM_RATIO,c=0,d=null;ChuClone.namespace("ChuClone.editor");ChuClone.editor.WorldEditor=function(b,c){this._worldController=b;this._gameView=c;d==null?d=this:console.error("ChuClone.editor.WorldEditor - Instance already exist!");this._mousePosition=new Box2D.Common.Math.b2Vec2(0,0);this.setupGui();this.setupEvents();window.onbeforeunload=function(){return"Exiting page will lose unsaved changes!"}};ChuClone.editor.WorldEditor.prototype={_worldController:null,
_gameView:null,_mousePosition:null,_shiftDragHelper:null,_dragOffset:null,_currentBody:null,_guiModification:null,_guiCreation:null,_guiCamera:null,_guiPlayer:null,_guiComponent:null,_propProxy:{x:5,y:5,width:3,height:3,depth:3},_currentEditedComponent:0,_toggableComponents:{},_controllers:{},_closures:{mousemove:null,mouseup:null,mousedown:null},setupMouseEvents:function(){var b=this;this._closures.mousedown=function(c){b.onMouseDown(c)};this._closures.mousemove=function(c){b.onDraggingPiece(c)};
this._closures.mouseup=function(c){b.onMouseUp(c)};this._worldController.getDebugDraw().GetSprite().canvas.addEventListener("mousedown",this._closures.mousedown,!1);window.addEventListener("mouseup",this._closures.mouseup,!1);this._closures.mousewheel=function(c){var d=(c.wheelDelta||-c.detail)<0?-1:1;d*=0.1;var h=b._worldController.getDebugDraw().GetDrawScale();h+=d;h>0&&b._worldController.getDebugDraw().SetDrawScale(h);c.preventDefault()};this._worldController.getDebugDraw().GetSprite().canvas.addEventListener("mousewheel",
this._closures.mousewheel,!1);this._worldController.getDebugDraw().GetSprite().canvas.addEventListener("DOMMouseScroll",this._closures.mousewheel,!1)},setupKeyboardEvents:function(){var b=this;this._closures.keydown=function(c){b.onKeyDown(c)};this._closures.keyup=function(c){b.onKeyUp(c)};this._closures.keypress=function(c){b.handleKeyboardShortcuts(c)};document.addEventListener("keydown",this._closures.keydown,!1);document.addEventListener("keypress",this._closures.keypress,!1);document.addEventListener("keyup",
this._closures.keyup,!1)},setupEvents:function(){this.setupMouseEvents();this.setupKeyboardEvents()},setupGui:function(){var c=this;this._guiModification=new DAT.GUI({width:ChuClone.model.Constants.EDITOR.PANEL_WIDTH+20});this._guiModification.name("Modification");this._guiModification.autoListen=!1;this.addControllerWithTimeout(this._guiModification,"x",this._propProxy.x).step(0.1);this.addControllerWithTimeout(this._guiModification,"y",this._propProxy.y).step(0.1);this.addControllerWithTimeout(this._guiModification,
"width",this._propProxy.width).min(0.01).max(Math.round(3E3/b)).step(0.01);this.addControllerWithTimeout(this._guiModification,"height",this._propProxy.height).min(0.01).max(Math.round(3E3/b)).step(0.01);this.addControllerWithTimeout(this._guiModification,"depth",this._propProxy.depth).min(0.01).max(3E3/b).step(0.025);this._controllers.currentComponent=this._guiModification.add(this,"_currentEditedComponent").name("Components");this._controllers.currentComponent.options.apply(this._controllers.currentComponent,
[]);this._controllers.currentComponent.onChange(function(b){c._controllers.currentComponent.domElement.lastChild.children.length===0?c._guiComponent.hideAll():(b=c._controllers.currentComponent.domElement.lastChild.children[b].innerText,c._guiComponent.setupGUIForComponent(c._currentBody.GetUserData().getComponentWithName(b)))});this.addComponentsToGui();this._guiModification.close();this._guiModification.open();this._guiCreation=new DAT.GUI({width:ChuClone.model.Constants.EDITOR.PANEL_WIDTH});this._guiCreation.name("Creation");
this._guiCreation.autoListen=!1;this._controllers.onShouldCreate=this._guiCreation.add(this,"onShouldCreate").name("Create Entity");this._controllers.onShouldClone=this._guiCreation.add(this,"onShouldCloneEntity").name("Clone Entity");this._controllers.onShouldDelete=this._guiCreation.add(this,"onShouldDelete").name("Destroy Entity");this._controllers.resetLevel=this._guiCreation.add(this,"onShouldClearLevel").name("Clear Level");this._guiCreation.close();this._guiCreation.open();this._guiCamera=
new ChuClone.editor.CameraGUI(this._gameView.getCamera());this._guiCamera.setDebugDraw(this._worldController.getDebugDraw());this._guiPlayer=new ChuClone.editor.PlayerGUI;this._guiComponent=new ChuClone.editor.ComponentGUIController},addComponentsToGui:function(){var b=this;this._toggableComponents[ChuClone.components.JumpPadComponent.prototype.displayName]=ChuClone.components.JumpPadComponent;this._toggableComponents[ChuClone.components.FrictionPadComponent.prototype.displayName]=ChuClone.components.FrictionPadComponent;
this._toggableComponents[ChuClone.components.RespawnComponent.prototype.displayName]=ChuClone.components.RespawnComponent;this._toggableComponents[ChuClone.components.GoalPadComponent.prototype.displayName]=ChuClone.components.GoalPadComponent;this._toggableComponents[ChuClone.components.MovingPlatformComponent.prototype.displayName]=ChuClone.components.MovingPlatformComponent;this._toggableComponents[ChuClone.components.DeathPadComponent.prototype.displayName]=ChuClone.components.DeathPadComponent;
for(var c in this._toggableComponents)this._toggableComponents.hasOwnProperty(c)&&(this._propProxy[c]=!1,this._controllers[c]=this._guiModification.add(this._propProxy,c),this._controllers[c].onChange(function(c){b.toggleComponent(this,c)}))},toggleComponent:function(b,c){var d=b.propertyName;if(this._currentBody){var h=this._currentBody.GetUserData(),j=h.getComponentWithName(d)!=null;c!==j&&(c?h.getComponentWithName(d)||h.addComponentAndExecute(ChuClone.components.ComponentFactory.getComponentByName(d)):
h.removeComponentWithName(d),this.populateComponentGUI())}else console.error("ChuClone.WorldEditor.toggleComponent - _currentBody is null!")},onShouldCreate:function(){var c=this._propProxy.width*b,d=this._propProxy.height*b,g=this._propProxy.depth*b,h=new Box2D.Common.Math.b2Vec2(this._mousePosition.x,this._mousePosition.y);h.Multiply(1/this._worldController.getDebugDraw().GetDrawScale()*b);var h=this._worldController.createRect(h.x,h.y,0,c,d,!0),j=this._gameView.createEntityView(this._mousePosition.x,
this._mousePosition.x,c,d,g),m=new ChuClone.GameEntity;m.setBody(h);m.setView(j);m.setDimensions(c,d,g);this._currentBody=h;this.populateInfoWithB2Body(this._currentBody)},onShouldDelete:function(){if(this._currentBody)if(this._currentBody.GetUserData()){var b=this._currentBody.GetUserData();this._gameView.removeObjectFromScene(b.getView());b.dealloc();this._worldController.getWorld().DestroyBody(this._currentBody);this._currentBody=null}else console.error("WorldEditor::onShouldDelete - _currentBody.GetUserData() returns null!");
else console.error("WorldEditor::onShouldDelete - _currentBody is null!")},onShouldClearLevel:function(){window.confirm("Clear all level data?")&&ChuClone.editor.LevelManager.INSTANCE.clearLevel(this._worldController,this._gameView)},onShouldCloneEntity:function(){if(this._currentBody){var b=this._currentBody.GetUserData();this._mousePosition.x=this._currentBody.GetPosition().x;this._mousePosition.y=this._currentBody.GetPosition().y;this._mousePosition.Multiply(this._worldController.getDebugDraw().GetDrawScale());
this.onShouldCreate(null);for(var c=b.components.length-1;c>=0;c--){var d=ChuClone.components.ComponentFactory.getComponentByName(b.components[c].displayName);d?(d.fromModel(b.components[c].getModel(),b),this._currentBody.GetUserData().addComponentAndExecute(d)):console.log("ComponentFactory does not contain '"+b.components[c].displayName+"'")}}else console.error("WorldEditor::onShouldCloneEntity - _currentBody is null!")},onMouseDown:function(b){b.preventDefault();this.updateMousePosition(b);if(b.shiftKey)this._shiftDragHelper=
new ChuClone.editor.ShiftDragHelper(this._mousePosition);b=new Box2D.Common.Math.b2Vec2(this._mousePosition.x,this._mousePosition.y);b.Multiply(1/this._worldController.getDebugDraw().GetDrawScale());var c=this.getBodyAtPosition(b);if(this._currentBody=c)this._worldController.getDebugDraw().GetSprite().canvas.removeEventListener("mousemove",this._closures.mousemove,!1),this._worldController.getDebugDraw().GetSprite().canvas.addEventListener("mousemove",this._closures.mousemove,!1),this._dragOffset=
new Box2D.Common.Math.b2Vec2(b.x-this._currentBody.GetPosition().x,b.y-this._currentBody.GetPosition().y),this.populateComponentGUI()},onDraggingPiece:function(b){if(this._currentBody){this.updateMousePosition(b);if(b.shiftKey&&!this._shiftDragHelper)this._shiftDragHelper=new ChuClone.editor.ShiftDragHelper(this._mousePosition);b=new Box2D.Common.Math.b2Vec2(this._mousePosition.x,this._mousePosition.y);b.Multiply(1/this._worldController.getDebugDraw().GetDrawScale());b.Subtract(this._dragOffset);
this._currentBody.SetPosition(b);this._currentBody.GetUserData().onEditorDidDragEntity();this.populateInfoWithB2Body(this._currentBody)}},onMouseUp:function(){this._worldController.getDebugDraw().GetSprite().canvas.removeEventListener("mousemove",this._closures.mousemove,!1);if(this._shiftDragHelper)this._shiftDragHelper.dealloc(),this._shiftDragHelper=null},onKeyDown:function(b){var c=this;console.log(b.keyCode);if(b.keyCode==32){b.preventDefault();if(this._closures.pan)return;this._worldController.getDebugDraw().GetSprite().canvas.removeEventListener("mousemove",
this._closures.pan,!1);this._worldController.getDebugDraw().GetSprite().canvas.style.cursor="move";var d=null,h=new Box2D.Common.Math.b2Vec2(this._worldController.getDebugDraw().offsetX,this._worldController.getDebugDraw().offsetY);this._closures.pan=function(b){c.updateMousePosition(b);d||(d=new Box2D.Common.Math.b2Vec2(c._mousePosition.x,c._mousePosition.y));b=c._worldController.getDebugDraw().GetDrawScale()*1.5;c._worldController.getDebugDraw().offsetX=h.x+(d.x-c._mousePosition.x)/b;c._worldController.getDebugDraw().offsetY=
h.y+(d.y-c._mousePosition.y)/b};this._worldController.getDebugDraw().GetSprite().canvas.addEventListener("mousemove",this._closures.pan,!1)}this.handleKeyboardShortcuts(b)},onKeyUp:function(b){if(b.keyCode==32)this._worldController.getDebugDraw().GetSprite().canvas.removeEventListener("mousemove",this._closures.pan,!1),this._worldController.getDebugDraw().GetSprite().canvas.style.cursor="default",this._closures.pan=null},handleKeyboardShortcuts:function(b){if(b.target.nodeName!="INPUT"){if(b.shiftKey&&
b.type=="keydown"){if(b.keyCode==68)this.onShouldDelete();else if(b.keyCode==67)this.onShouldCloneEntity();b.keyCode==70&&this._controllers.depth.setValue(this._controllers.depth.getValue()+ChuClone.utils.randFloat(-1,1))}if(!(b.keyCode<ChuClone.model.Constants.KEYS.LEFT_ARROW||b.keyCode>ChuClone.model.Constants.KEYS.DOWN_ARROW))if(b.altKey){if(b.keyCode==ChuClone.model.Constants.KEYS.UP_ARROW||b.keyCode==ChuClone.model.Constants.KEYS.DOWN_ARROW){var c=b.keyCode==ChuClone.model.Constants.KEYS.UP_ARROW?
0.25:-0.25;b.shiftKey&&(c*=4);this._controllers.height.setValue(this._controllers.height.getValue()+c);this.onControllerWasChanged(null)}if(b.keyCode==ChuClone.model.Constants.KEYS.LEFT_ARROW||b.keyCode==ChuClone.model.Constants.KEYS.RIGHT_ARROW)c=b.keyCode==ChuClone.model.Constants.KEYS.RIGHT_ARROW?0.25:-0.25,b.shiftKey&&(c*=4),this._controllers.width.setValue(this._controllers.width.getValue()+c),this.onControllerWasChanged(null)}else if(b.ctrlKey){if(b.keyCode==ChuClone.model.Constants.KEYS.UP_ARROW||
b.keyCode==ChuClone.model.Constants.KEYS.DOWN_ARROW)c=b.keyCode==ChuClone.model.Constants.KEYS.DOWN_ARROW?0.25:-0.25,b.shiftKey&&(c*=4),this._controllers.y.setValue(this._controllers.y.getValue()+c),this.onControllerWasChanged(null);if(b.keyCode==ChuClone.model.Constants.KEYS.LEFT_ARROW||b.keyCode==ChuClone.model.Constants.KEYS.RIGHT_ARROW)c=b.keyCode==ChuClone.model.Constants.KEYS.RIGHT_ARROW?0.25:-0.25,b.shiftKey&&(c*=4),this._controllers.x.setValue(this._controllers.x.getValue()+c),this.onControllerWasChanged(null)}}},
onControllerWasChanged:function(){if(this._currentBody!=null&&this.entityNeedsUpdate(this._currentBody.GetUserData())){var c=this._worldController.createRect(this._controllers.x.getValue()*b,this._controllers.y.getValue()*b,this._currentBody.GetAngle(),this._controllers.width.getValue()*b,this._controllers.height.getValue()*b,this._currentBody.GetType()==Box2D.Dynamics.b2Body.b2_kinematicBody),d=this._currentBody.GetUserData();this._worldController.getWorld().DestroyBody(this._currentBody);d.setBody(c);
d.setDimensions(this._controllers.width.getValue()*b,this._controllers.height.getValue()*b,this._controllers.depth.getValue()*b);this._currentBody=c}},entityNeedsUpdate:function(){var c=!1,d=null,g=null;(g=this._currentBody.GetUserData().getComponentWithName(ChuClone.components.MovingPlatformComponent.prototype.displayName))?(d=g._initialPosition.x,g=g._initialPosition.y):(d=this._currentBody.GetPosition().x,g=this._currentBody.GetPosition().y);d!=this._controllers.x.getValue()&&(c=!0);g!=this._controllers.y.getValue()&&
(c=!0);d=this._currentBody.GetUserData().getDimensions();d.width/b!=this._controllers.width.getValue()&&(c=!0);d.height/b!=this._controllers.height.getValue()&&(c=!0);d.depth/b!=this._controllers.depth.getValue()&&(c=!0);return c},populateInfoWithB2Body:function(c){this._controllers.x.setValue(c.GetPosition().x);this._controllers.y.setValue(c.GetPosition().y);this._controllers.width.setValue(this._currentBody.GetUserData().getDimensions().width/b);this._controllers.height.setValue(this._currentBody.GetUserData().getDimensions().height/
b);this._controllers.depth.setValue(this._currentBody.GetUserData().getDimensions().depth/b);for(var d in this._toggableComponents)this._controllers[d].setValue(this._currentBody.GetUserData().getComponentWithName(d)!=null)},populateComponentGUI:function(){var b=0;ChuClone.utils.repopulateOptionsGUI(this._controllers.currentComponent,this._currentBody.GetUserData().components,function(c,d,h){c.value=h;c.innerText=d.displayName;c.label=d.displayName.replace("Component","");if(Object.keys(d._editableProperties).length!==
0)b=h,c.selected=!0});this._controllers.currentComponent.setValue(b)},updateMousePosition:function(b){var c=0,d=0;if(b.layerX||b.layerX==0)c=b.layerX,d=b.layerY;else if(b.offsetX||b.offsetX==0)c=b.offsetX,d=b.offsetY;this._mousePosition.x=c-this._worldController.getDebugDraw().GetSprite().canvas.offsetLeft;this._mousePosition.y=d-this._worldController.getDebugDraw().GetSprite().canvas.offsetTop;this._mousePosition.x-=this._worldController.getDebugDraw().offsetX*this._worldController.getDebugDraw().GetDrawScale();
this._mousePosition.y-=this._worldController.getDebugDraw().offsetY*this._worldController.getDebugDraw().GetDrawScale();if(this._shiftDragHelper)this._mousePosition=this._shiftDragHelper.adjustPosition(this._mousePosition)},getBodyAtPosition:function(b){var c=new Box2D.Collision.b2AABB;c.lowerBound.Set(b.x-0.1,b.y-0.1);c.upperBound.Set(b.x+0.1,b.y+0.1);var d=null;this._worldController.getWorld().QueryAABB(function(b){if(b.GetBody().GetUserData()instanceof ChuClone.GameEntity&&b.GetBody().GetUserData().getType()!=
ChuClone.model.Constants.ENTITY_TYPES.PLAYER)return d=b.GetBody(),!0;return!1},c);if(d)this._currentBody=d,this.populateInfoWithB2Body(d);return d},addControllerWithTimeout:function(b,d,g){var h=this;this._propProxy[d]=g;b=b.add(this._propProxy,d);this._controllers[d]=b;b.onChange(function(b){clearTimeout(c);c=setTimeout(function(){h.onControllerWasChanged(b)},600)});return b},dealloc:function(){this._worldController.getDebugDraw().GetSprite().canvas.removeEventListener("mousedown",this._closures.mousedown,
!1);this._worldController.getDebugDraw().GetSprite().canvas.removeEventListener("mousemove",this._closures.mousemove,!1);window.removeEventListener("mouseup",this._closures.mouseup,!1);document.removeEventListener("keydown",this._closures.keydown,!1);document.removeEventListener("keypress",this._closures.keypress,!1);document.removeEventListener("keyup",this._closures.keyup,!1);this._guiPlayer=this._guiCamera=this._worldController=this._mousePosition=this._currentBody=this._gameView=this._worldController=
this._closures=null},getWorldController:function(){return this._worldController},getViewController:function(){return this._gameView}};ChuClone.editor.WorldEditor.getInstance=function(){if(d==null){debugger;throw Error("ChuClone.editor.WorldEditor.getInstance - No instance!");}return d}})();(function(){ChuClone.namespace("ChuClone.editor");ChuClone.editor.ComponentGUIController=function(){this.setupEvents()};ChuClone.editor.ComponentGUIController.prototype={_activeComponent:null,_allGuis:{},setupEvents:function(){var b=this;ChuClone.Events.Dispatcher.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,function(){b._activeComponent=null;b.hideAll()})},setupGUIForComponent:function(b){var c=this;this._activeComponent=b;this.hideAll();if(Object.keys(b._editableProperties).length===
0)console.log("ChuClone.editor.ComponentGUIController - Component has no _editableProperties. Aborting");else{var d=b.displayName;this._activeComponent.setEditableProps();var e=this._allGuis[d];if(e)this.prepareAndShowGUI(e);else{e=new DAT.GUI({width:ChuClone.model.Constants.EDITOR.PANEL_WIDTH+10});e.componentControllers={};e.name(d);e.autoListen=!1;this._allGuis[d]=e;for(var f in b._editableProperties){var d=null,g;b._editableProperties[f].hasOwnProperty("value")?(d=e.add(b._editableProperties[f],
"value"),d.min(b._editableProperties[f].min),d.max(b._editableProperties[f].max),b._editableProperties[f].step?d.step(b._editableProperties[f].step):console.warn("ComponentGUI - No step property found for slider '"+b.displayName+"'"),d.name(f),g=b._editableProperties[f].value):(d=e.add(b._editableProperties,f),g=b._editableProperties[f]);d.setValue(g);e.componentControllers[f]=d;d.onChange(function(){console.log(this.getValue());c._activeComponent.onEditablePropertyWasChanged()})}e.close();e.open()}}},
prepareAndShowGUI:function(b){b.domElement.style.display="block";for(var c in this._activeComponent._editableProperties){var d;d=this._activeComponent._editableProperties[c].hasOwnProperty("value")?this._activeComponent._editableProperties[c].value:this._activeComponent._editableProperties[c];var e=b.componentControllers[c].changeFunction;b.componentControllers[c].changeFunction=null;b.componentControllers[c].setValue(d);b.componentControllers[c].changeFunction=e}},hideAll:function(){for(var b in this._allGuis)this._allGuis[b].domElement.style.display=
"none"},dealloc:function(){for(var b in this._allGuis)this._allGuis[b].domElement.parentNode.removeChild(this._allGuis[b].domElement)}}})();(function(){ChuClone.namespace("ChuClone.physics");ChuClone.physics.ContactListener=function(){};ChuClone.physics.ContactListener.prototype.BeginContact=function(b){var c=b.GetFixtureA(),b=b.GetFixtureB(),d=c.GetBody().GetUserData(),e=b.GetBody().GetUserData();if(c.GetUserData()&&c.GetUserData().onCollision)c.GetUserData().onCollision(e);if(d&&d.onCollision)d.onCollision(e);if(e&&e.onCollision)e.onCollision(d);if(b.GetUserData()&&b.GetUserData().onCollision)b.GetUserData().onCollision(d)};ChuClone.extend(ChuClone.physics.ContactListener,
Box2D.Dynamics.b2ContactListener)})();(function(){ChuClone.namespace("ChuClone.physics");ChuClone.physics.DestructionListener=function(){ChuClone.physics.DestructionListener.superclass.constructor.call(this)};ChuClone.physics.DestructionListener.prototype={SayGoodbyeJoint:function(b){ChuClone.physics.DestructionListener.superclass.SayGoodbyeJoint.call(this,b)},SayGoodbyeFixture:function(b){debugger;ChuClone.physics.DestructionListener.superclass.SayGoodbyeFixture.call(this,b)}};ChuClone.extend(ChuClone.physics.DestructionListener,Box2D.Dynamics.b2DestructionListener)})();(function(){var b=ChuClone.model.Constants.PTM_RATIO,c=Box2D.Common.Math.b2Vec2,d=Box2D.Dynamics.b2BodyDef,e=Box2D.Dynamics.b2Body,f=Box2D.Dynamics.b2FixtureDef,g=Box2D.Dynamics.b2World,h=Box2D.Collision.Shapes.b2PolygonShape,j=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Dynamics.b2DebugDraw,n=Math.ceil(1/60*1E3)/1E3,t=0;ChuClone.physics.WorldController=function(){Date.now();this.setupBox2d()};ChuClone.physics.WorldController.prototype={_world:null,_editor:null,_debugDraw:null,_velocityIterationsPerSecond:500,
_positionIterationsPerSecond:1E3,_closures:{},EVENTS:{CREATED:"WorldController.events.created"},setupBox2d:function(){this.modifySettings();this.createBox2dWorld()},setupEvents:function(){},setupEditor:function(b){this._editor=new ChuClone.editor.WorldEditor(this,b)},modifySettings:function(){Box2D.Common.b2Settings.b2_maxRotation=0},createBox2dWorld:function(){var b=this._world==null;this._world=this._world||new g(new c(0,30),!0);b&&this._world.SetContactListener(new ChuClone.physics.ContactListener);
this.createWorldBoundary();this._world.DestroyBody(this._wallRight);this._world.DestroyBody(this._wallTop)},createWorldBoundary:function(){var c=new h,e=new d;e.position.Set(-1.5,ChuClone.model.Constants.GAME_HEIGHT/2);c.SetAsBox(1,ChuClone.model.Constants.GAME_HEIGHT*10);this._wallLeft=this._world.CreateBody(e);this._wallLeft.CreateFixture2(c);e.position.Set(ChuClone.model.Constants.GAME_WIDTH+0.55,ChuClone.model.Constants.GAME_HEIGHT/2);c.SetAsBox(1,ChuClone.model.Constants.GAME_HEIGHT*10);this._wallRight=
this._world.CreateBody(e);this._wallRight.CreateFixture2(c);c=new h;e=new d;e.position.Set(ChuClone.model.Constants.GAME_WIDTH/2,1);c.SetAsBox(ChuClone.model.Constants.GAME_WIDTH/b*8,1/b);this._wallTop=this._world.CreateBody(e);this._wallTop.CreateFixture2(c);c=new h;e=new d;e.position.Set(ChuClone.model.Constants.GAME_WIDTH/2/b,ChuClone.model.Constants.GAME_HEIGHT/b);c.SetAsBox(ChuClone.model.Constants.GAME_WIDTH/2*100,1/b);this._wallBottom=this._world.CreateBody(e);this._wallBottom.CreateFixture2(c);
this._wallBottom.GetFixtureList().SetFriction(1.2)},createBall:function(b,c,g){var h=new f;h.shape=new j(g);h.friction=0.4;h.restitution=0;h.density=2;g=new d;g.type=e.b2_dynamicBody;g.position.Set(b,c);b=this._world.CreateBody(g);b.CreateFixture(h);return b},createRect:function(c,d,e,f,g,h){c/=b;d/=b;f/=b;g/=b;var j=new Box2D.Dynamics.b2FixtureDef;j.density=1;j.friction=1;j.restitution=0.1;var m=new Box2D.Dynamics.b2BodyDef;m.type=h?Box2D.Dynamics.b2Body.b2_kinematicBody:Box2D.Dynamics.b2Body.b2_dynamicBody;
j.shape=new Box2D.Collision.Shapes.b2PolygonShape;j.shape.SetAsBox(f,g);f=this._world.CreateBody(m);f.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(c,d),e);f.CreateFixture(j);return f},update:function(){t=1;this._world.Step(n,5,3);this._world.ClearForces();this._debugDraw&&this._world.DrawDebugData()},setDebugDraw:function(b){if(!b){var b=null,c=document.createElement("canvas");document.getElementById("editorContainer")?(b=document.getElementById("editorContainer"),c.width=ChuClone.model.Constants.GAME_WIDTH,
c.height=parseInt(document.getElementById("editorContainer").style.height)):(b=document.createElement("div"),b.style.position="absolute",b.style.top=ChuClone.model.Constants.GAME_HEIGHT+55+"px",b.style.backgroundColor="#000000",b.style.opacity=0.75,document.body.appendChild(b),c.width=ChuClone.model.Constants.GAME_WIDTH,c.height=ChuClone.model.Constants.GAME_HEIGHT-100);b.appendChild(c)}b=new m;b.SetSprite(c.getContext("2d"));b.SetDrawScale(10);b.SetFillAlpha(0.3);b.SetLineThickness(0.5);b.SetFlags(m.e_shapeBit|
m.e_jointBit);b.offsetX=0;b.offsetY=15;this._world.SetDebugDraw(b);this._debugDraw=b},setDebugDrawOffset:function(b,c){if(this._debugDraw)this._debugDraw.offsetX=b,this._debugDraw.offsetY=c},getWorld:function(){return this._world},getFixedTimestepAccumulatorRatio:function(){return t},getDebugDraw:function(){return this._debugDraw}}})();(function(){var b={enabled:!1};ChuClone.namespace("ChuClone");ChuClone.GameViewController=function(){this.setDimensions(ChuClone.model.Constants.GAME_WIDTH,ChuClone.model.Constants.GAME_HEIGHT);this.setupContainer();this.setupScene();this.setupRenderer();this.setupCamera();this.setupLights();this.setupEvents();this.onSetupComplete();ChuClone.GameViewController.INSTANCE=this};ChuClone.GameViewController.prototype={_domElement:null,_scene:null,_sceneEditor:null,_camera:null,_renderer:null,_ambientLight:null,
_backgroundParticleManager:null,_mousePosition:new THREE.Vector2(0,0),_dimensions:null,_isFullScreen:!1,NEXT_VIEW_UUID:0,setupContainer:function(){document.getElementById("gameContainer")?this._domElement=document.getElementById("gameContainer"):(this._domElement=document.createElement("div"),document.body.appendChild(this._domElement));ChuClone.DOM_ELEMENT=this._domElement;ChuClone.DOM_ELEMENT.tabIndex=1},setupScene:function(){this._scene=new THREE.Scene},setupRenderer:function(){this._renderer=
new THREE.WebGLRenderer({antialias:!0});this._renderer.autoClear=!1;this._renderer.sortObjects=!1;this._renderer.setClearColor(new THREE.Color(16777215),1);this._renderer.setSize(this.getDimensions().x,this.getDimensions().y);this._renderer.domElement.tabIndex="1";this._domElement.appendChild(this._renderer.domElement)},startPostProcessing:function(){if(!b.enabled){var c=ChuClone.model.Constants.SERVER.ASSET_PREFIX+"assets/sounds/fx/secrettone.wav",d=document.createElement("div");d.innerHTML='<video controls="" autoplay="" style="margin: auto; position: absolute; top: -1000px;" name="media" src="'+
c+'"></video>';document.getElementsByTagName("body")[0].appendChild(d);b.scene=new THREE.Scene;b.camera=new THREE.Camera;b.camera.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);b.camera.position.z=100;c={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};b.rtTexture1=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,c);b.rtTexture2=new THREE.WebGLRenderTarget(256,256,
c);b.rtTexture3=new THREE.WebGLRenderTarget(256,256,c);c=THREE.ShaderUtils.lib.screen;d=THREE.UniformsUtils.clone(c.uniforms);d.tDiffuse.texture=b.rtTexture1;d.opacity.value=1;b.materialScreen=new THREE.MeshShaderMaterial({uniforms:d,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});c=THREE.ShaderUtils.lib.convolution;d=THREE.UniformsUtils.clone(c.uniforms);b.blurx=new THREE.Vector2(0.0010,0);b.blury=new THREE.Vector2(0,0.0020);d.tDiffuse.texture=
b.rtTexture1;d.uImageIncrement.value=b.blurx;d.cKernel.value=THREE.ShaderUtils.buildKernel(4);b.materialConvolution=new THREE.MeshShaderMaterial({uniforms:d,vertexShader:"#define KERNEL_SIZE 15.0\n"+c.vertexShader,fragmentShader:"#define KERNEL_SIZE 15\n"+c.fragmentShader});b.quad=new THREE.Mesh(new THREE.PlaneGeometry(window.innerWidth,window.innerHeight),b.materialConvolution);b.quad.position.z=-500;b.scene.addObject(b.quad);ChuClone.model.Constants.IS_BLOOM=!0;b.enabled=!0;this._renderer.setClearColor(new THREE.Color(394758),
1)}},setupCamera:function(){this._camera=new THREE.Camera(65,2.25,1,22E3);this._camera.position.y=100;this._camera.position.z=1300;this._camera.name="camera"},setupLights:function(){this._ambientLight=new THREE.AmbientLight(6324368);this._directionalLight=new THREE.DirectionalLight(6324368,1.6,0,!1);this._directionalLight.position.set(0,2,1);this._scene.addLight(this._ambientLight);this._scene.addLight(this._directionalLight)},setupEvents:function(){var b=this;window.addEventListener("resize",function(d){b.onResize(d)},
!1)},setupBackgroundParticleManager:function(){this._backgroundParticleManager=new ChuClone.view.BackgroundParticleManager;for(var b=0;b<this._backgroundParticleManager.getSystems().length;b++)this._scene.addObject(this._backgroundParticleManager.getSystems()[b])},setupStats:function(){var b=document.createElement("div");this.stats=new Stats;this.stats.domElement.style.position="absolute";this.stats.domElement.style.top="0px";b.appendChild(this.stats.domElement);document.body.appendChild(b)},onSetupComplete:function(){this._domElement.firstChild.focus()},
setupSceneEditor:function(){var b=document.createElement("div");b.style.position="absolute";b.style.top="0px";document.body.appendChild(b);var d=document.createElement("canvas");d.width=500;d.height=400;b.appendChild(d);b=new THREE.SceneEditor;b.setCanvas(d);b.create();b.setWorldOffset(this.camera.position);for(var d=["xy","xz","zy"],e=[0.11,0.11,0.11],f=0;f<d.length;f++)b.addScenePlotter(d[f],e[f],150).setPosition(f*150+0,0);this._sceneEditor=b},update:function(){this.updateCameraPosition();this.updateSceneEditor();
this.stats&&this.stats.update();this.render()},render:function(){var c=this._renderer,d=this._camera,e=this._scene;b.enabled?(c.clear(),c.render(e,d,b.rtTexture1,!0),b.quad.materials=[b.materialConvolution],b.materialConvolution.uniforms.tDiffuse.texture=b.rtTexture1,b.materialConvolution.uniforms.uImageIncrement.value=b.blurx,c.render(b.scene,b.camera,b.rtTexture2,!0),b.materialConvolution.uniforms.tDiffuse.texture=b.rtTexture2,b.materialConvolution.uniforms.uImageIncrement.value=b.blury,c.render(b.scene,
b.camera,b.rtTexture3,!0),b.quad.materials=[b.materialScreen],b.materialScreen.uniforms.tDiffuse.texture=b.rtTexture3,b.materialScreen.uniforms.opacity.value=1.25,c.render(b.scene,b.camera,b.rtTexture1,!1),b.materialScreen.uniforms.tDiffuse.texture=b.rtTexture1,c.render(b.scene,b.camera)):(c.clear(),c.render(e,d))},updateCameraPosition:function(){this._camera.update()},updateSceneEditor:function(){this._sceneEditor&&this._sceneEditor.update()},createEntityView:function(b,d,e,f,g){e=new THREE.CubeGeometry(e,
f,g);e=new THREE.Mesh(e,[new THREE.MeshLambertMaterial({color:16777215,shading:THREE.SmoothShading,map:ChuClone.utils.TextureUtils.GET_TEXTURE(ChuClone.model.Constants.SERVER.ASSET_PREFIX+"assets/images/game/floor.png")})]);e.dynamic=!1;f=ChuClone.GameViewController.prototype.GET_NEXT_VIEW_ID();e.name=f;e.position.x=b;e.position.y=d;e.position.z=0;this.addObjectToScene(e);return e},addObjectToScene:function(b){b.dynamic=!0;this._sceneEditor&&this._sceneEditor.startPlottingObject(b,THREE.SceneEditor.ScenePlotterDot.prototype.TYPES.SQUARE,
!1,!1);this._scene.addObject(b)},removeObjectFromScene:function(b){this._sceneEditor&&this._sceneEditor.stopPlottingObject(b,THREE.SceneEditor.ScenePlotterDot.prototype.TYPES.SQUARE,!1,!1);this._scene.removeObject(b)},onDocumentMouseMove:function(b){b.preventDefault();this._mousePosition.x=b.clientX/this.getDimensions().x*2-1;this._mousePosition.y=-(b.clientY/this.getDimensions().y)*2+1},onResize:function(){this._renderer.setSize(this.getDimensions().x,this.getDimensions().y);this._camera.aspect=
this.getDimensions().x/this.getDimensions().y;this._camera.updateProjectionMatrix()},dealloc:function(){},setDimensions:function(b,d){return this._dimensions=new THREE.Vector2(b,d)},getDimensions:function(){if(this._isFullScreen)return new THREE.Vector2(window.innerWidth,window.innerHeight-10);return this._dimensions},getFullscreen:function(){return this._isFullScreen},setFullscreen:function(b){(this._isFullScreen=b)?(this._domElement.style.position="absolute",this._domElement.style.top=0,this._domElement.style.left=
0):(this._domElement.style.top="",this._domElement.style.left="",this._domElement.style.position="relative");this._renderer.setSize(this.getDimensions().x,this.getDimensions().y);this.onResize()},getCamera:function(){return this._camera},GET_NEXT_VIEW_ID:function(){return ChuClone.GameViewController.prototype.NEXT_VIEW_UUID++}}})();(function(){var b=ChuClone.model.Constants.PTM_RATIO,c=Box2D.Dynamics.b2Body;ChuClone.GameEntity=function(){this.components=[]};ChuClone.GameEntity.prototype={view:null,body:null,components:null,width:0,height:0,_type:ChuClone.model.Constants.ENTITY_TYPES.PLATFORM,update:function(d){var e=this.body.GetPosition();if(this.body.GetType()===c.b2_kinematicBody)this.view.position.x=e.x*b,this.view.position.y=e.y*-b,this.view.rotation.z=-this.body.GetAngle();else{var f=1-d,g=e.x*b,e=e.y*-b,h=-this.body.GetAngle();
this.view.position.x=g*d+this.view.position.x*f;this.view.position.y=e*d+this.view.position.y*f;this.view.rotation.z=h*d+this.view.rotation.z*f}d=this.components.length;for(f=0;f<d;++f)this.components[f].requiresUpdate&&this.components[f].update()},onCollision:function(){},addComponent:function(b,c){var f=this.getComponentWithName(b.displayName);if(f&&!f.canStack)return!1;f&&this.removeComponentWithName(b.displayName);c?this.components.unshift(b):this.components.push(b);b.attach(this);return b},addComponentAndExecute:function(b){if(this.addComponent(b))return b.execute(),
b;return null},getComponentWithName:function(b){for(var c=this.components.length,f=null,g=0;g<c;++g)if(this.components[g].displayName===b){f=this.components[g];break}return f},removeComponentWithName:function(b){for(var c=this.components.length,f=[],g=0;g<c;++g)if(this.components[g].displayName===b){f.push(this.components.splice(g,1)[0]);break}if(f)for(g=f.length;g--;)f[g].detach()},getComponents:function(){return this.components},removeAllComponents:function(){for(var b=this.components.length;b;)b-=
1,this.components[b].detach(),this.components.splice(b,1);this.components=[]},onEditorDidDragEntity:function(){for(var b=this.components.length,c=0;c<b;++c)this.components[c].onEditorDidDragAttachedEntity()},dealloc:function(){this.removeAllComponents();this.view=null;this.body&&this.body.userData==this&&this.body.SetUserData(null);this.body=this.components=null},getBody:function(){return this.body},setBody:function(b){this.body&&this.body.userData==this&&this.body.SetUserData(null);this.body=b;this.body.SetUserData(this)},
setView:function(b){this.view=b;this.view.geometry.computeBoundingBox()},getView:function(){return this.view},getDimensions:function(){return{width:this.width,height:this.height,depth:this.depth}},setDimensions:function(b,c,f){this.width=b;this.height=c;this.depth=f;this.view.dynamic=!0;this.view.geometry.vertices[0].position=new THREE.Vector3(-b,c,-f);this.view.geometry.vertices[1].position=new THREE.Vector3(-b,c,f);this.view.geometry.vertices[2].position=new THREE.Vector3(-b,-c,-f);this.view.geometry.vertices[3].position=
new THREE.Vector3(-b,-c,f);this.view.geometry.vertices[4].position=new THREE.Vector3(b,c,f);this.view.geometry.vertices[5].position=new THREE.Vector3(b,c,-f);this.view.geometry.vertices[6].position=new THREE.Vector3(b,-c,f);this.view.geometry.vertices[7].position=new THREE.Vector3(b,-c,-f);this.view.geometry.__dirtyVertices=!0;this.view.geometry.computeBoundingBox()},getType:function(){return this._type}}})();(function(){ChuClone.namespace("ChuClone.states");ChuClone.states.ChuCloneBaseState=function(){ChuClone.states.ChuCloneBaseState.superclass.constructor.call(this);this._levelManager=this._worldController=this._gameView=null};ChuClone.states.ChuCloneBaseState.prototype={_gameView:null,_worldController:null,_levelManager:null,enter:function(){if(!this._levelManager||!this._worldController||!this._gameView)debugger;ChuClone.states.ChuCloneBaseState.superclass.enter.call(this);this.setupEvents()},setupEvents:function(){console.log("setting up events")},
update:function(){ChuClone.states.ChuCloneBaseState.superclass.update.call(this)},updatePhysics:function(){for(var b=this._worldController.getFixedTimestepAccumulatorRatio(),c=this._worldController.getWorld().GetBodyList();c;){var d=c,c=c.GetNext();(d=d.GetUserData())&&d.update(b)}},createBackgroundElements:function(b,c,d,e){for(var f=[],g=0;g<b;g++){var h=new THREE.CubeGeometry(Math.random()*e.x,Math.random()*e.y,Math.random()*e.z),h=new THREE.Mesh(h,[new THREE.MeshLambertMaterial({color:16777215,
shading:THREE.SmoothShading,map:THREE.ImageUtils.loadTexture(ChuClone.model.Constants.SERVER.ASSET_PREFIX+"assets/images/game/floor.png")})]);h.dynamic=!1;h.position.x=ChuClone.utils.randFloat(d.left,d.right);h.position.y=ChuClone.utils.randFloat(d.bottom,d.top);h.position.z=ChuClone.utils.randFloat(-1E3,-2E3);f.push(h);c&&this._gameView.addObjectToScene(h)}return f},setupParticles:function(b,c,d){b=Math.min((d.right-d.left)*(d.top-d.bottom)/ChuClone.model.Constants.MAX_LEVEL_AREA,1)*1E3;console.log("Creating "+
b+" background particles");for(var c=new THREE.Geometry,e=new THREE.ImageUtils.loadTexture(ChuClone.model.Constants.SERVER.ASSET_PREFIX+"assets/images/game/particle.png"),f=[],g=0;g<b;g++){var h=ChuClone.utils.randFloat(d.left,d.right),j=ChuClone.utils.randFloat(d.bottom,d.top),m=ChuClone.utils.randFloat(-3E3,3E3),h=new THREE.Vector3(h,j,m);c.vertices.push(new THREE.Vertex(h));f[g]=new THREE.Color(16777215);f[g].setHSV(ChuClone.utils.randFloat(0.7,1),1,1)}c.colors=f;b=new THREE.ParticleBasicMaterial({size:185,
map:e,vertexColors:!0});b.transparent=ChuClone.model.Constants.IS_BLOOM?!1:!0;b.blending=ChuClone.model.Constants.IS_BLOOM?THREE.AdditiveBlending:THREE.NormalBlending;b=new THREE.ParticleSystem(c,b);b.sortParticles=!ChuClone.model.Constants.IS_BLOOM;b.updateMatrix();this.backgroundParticles=b;this._gameView.addObjectToScene(this.backgroundParticles)},exit:function(){if(this.backgroundParticles)this._gameView.removeObjectFromScene(this.backgroundParticles),this.backgroundParticles=null;ChuClone.states.ChuCloneBaseState.superclass.exit.call(this);
this.dealloc()},remoteEntity:function(b){var c=b.getBody();"getView"in b&&this._gameView.removeObjectFromScene(b.getView());"dealloc"in b&&b.dealloc();this._worldController.getWorld().DestroyBody(c)},dealloc:function(){}};ChuClone.extend(ChuClone.states.ChuCloneBaseState,ChuClone.model.FSM.State)})();(function(){ChuClone.namespace("ChuClone.states");ChuClone.states.EditState=function(){ChuClone.states.EditState.superclass.constructor.call(this);this._hasEntered=!1};ChuClone.states.EditState.prototype={_player:null,_hasEntered:!1,enter:function(){ChuClone.states.EditState.superclass.enter.call(this);if(!this._hasEntered){this._hasEntered=!0;this._worldController.setDebugDraw();var b=this;setTimeout(function(){b._worldController.setupEditor(b._gameView);b._levelManager.setupGui()},100)}},setupEvents:function(){var b=
this;this.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,function(c){b.onPlayerCreated(c)});this.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,function(c){b.onPlayerDestroyed(c)});this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_CREATED,function(c){b.onLevelCreated(c)});this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,function(c){b.onLevelDestroyed(c)})},update:function(){ChuClone.states.EditState.superclass.update.call(this);
this.updatePhysics();this._worldController.update();this._gameView.update(Date.now())},exit:function(){ChuClone.states.EditState.superclass.exit.call(this)},onPlayerCreated:function(b){console.log("ChuCloneGame.onPlayerCreated:",b)},onPlayerDestroyed:function(b){console.log("ChuCloneGame.onPlayerDestroyed:",b)},onLevelCreated:function(b){this._worldController.createBox2dWorld();console.log("ChuCloneGame.onLevelCreated:",b)},onLevelDestroyed:function(b){console.log("ChuCloneGame.onLevelDestroyed:",
b);this._gameView.getCamera().removeAllComponents();this._worldController.createBox2dWorld()},dealloc:function(){ChuClone.states.EditState.superclass.dealloc.call(this);this._player=null}};ChuClone.extend(ChuClone.states.EditState,ChuClone.states.ChuCloneBaseState)})();(function(){ChuClone.namespace("ChuClone.states");ChuClone.states.EndLevelState=function(){ChuClone.states.EndLevelState.superclass.constructor.call(this)};ChuClone.states.EndLevelState.prototype={_player:null,_completionTime:0,_record:null,enter:function(){ChuClone.states.EndLevelState.superclass.enter.call(this);var b=this._gameView.getCamera();b.removeAllComponents();for(var c=this._worldController.getWorld().GetBodyList();c;)c=c.GetNext();c=new ChuClone.components.camera.CameraOrbitRadiusComponent;
c.setTarget(this._player.getView().position);c.getRadius().x=4E3;c.getRadius().y=2E3;c.getRadius().z=4E3;b.addComponentAndExecute(c);this._player.removeComponentWithName(ChuClone.components.player.CharacterControllerComponent.prototype.displayName)},setupEvents:function(){var b=this;this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,function(){console.log("EndLevelState >> LeveLDestroyed!");ChuClone.gui.LevelRecap.destroy();b._gameView.getCamera().removeComponentWithName(ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName);
var c=new ChuClone.states.PlayLevelState;c._gameView=b._gameView;c._worldController=b._worldController;c._levelManager=b._levelManager;ChuClone.model.FSM.StateMachine.getInstance().changeState(c)})},update:function(){ChuClone.states.EndLevelState.superclass.update.call(this);this.updatePhysics();this._worldController.update();this._gameView.update(Date.now())},submitScore:function(){var b=new XMLHttpRequest,c=this,d=new window.FormData;d.append("score",this._completionTime);d.append("record",this._record);
b.onreadystatechange=function(){if(b.readyState==4){ChuClone.gui.LevelRecap.show(c._completionTime,c._levelManager.getModel().levelName);try{var d=JSON.parse(b.responseText)[0]}catch(e){ChuClone.utils.displayFlash(ChuClone.utils.getValidationErrors(b.responseText),0);return}d.status==!1?ChuClone.utils.displayFlash(d.notice+" - Score not saved",0):(ChuClone.utils.displayFlash("Highscore Saved",1),ChuClone.gui.HUDController.updateScores(!0))}};var e=ChuClone.model.Constants.SERVER.SCORE_SUBMIT_LOCATION.replace("#",
ChuClone.utils.getLevelIDFromURL());b.open("POST",e);b.send(d)},exit:function(){ChuClone.states.EndLevelState.superclass.exit.call(this)},dealloc:function(){ChuClone.states.EndLevelState.superclass.dealloc.call(this);this._player=null},setPlayer:function(b){this._player=b;this._player.addComponentAndExecute(new ChuClone.components.effect.BirdEmitterComponent)},setTime:function(b){this._completionTime=b},setRecord:function(b){if(b)this._record=b,this.submitScore()}};ChuClone.extend(ChuClone.states.EndLevelState,
ChuClone.states.ChuCloneBaseState)})();(function(){ChuClone.namespace("ChuClone.states");ChuClone.states.PlayLevelState=function(){ChuClone.states.PlayLevelState.superclass.constructor.call(this);this._record=[]};ChuClone.states.PlayLevelState.prototype={_currentTime:0,_previousTime:0,_elapsedTime:0,_elapsedFrames:0,_lastTextUpdate:0,_gameView:null,_worldController:null,_levelManager:null,_player:null,_floorPlane:null,_record:null,_backgroundElements:[],_beatLevel:!1,_didAnimateIn:!1,enter:function(){ChuClone.states.PlayLevelState.superclass.enter.call(this);
this._gameView.getCamera().position=new THREE.Vector3(-1E4,-1E4,-1E4);ChuClone.model.AchievementTracker.getInstance().reset();this._beatLevel=this._didAnimateIn=!1;this._previousTime=Date.now();this.addFloorPlane();ChuClone.DOM_ELEMENT.focus()},addFloorPlane:function(){var b=new THREE.PlaneGeometry(1E5,1E4,10,1),b=new THREE.Mesh(b,[new THREE.MeshBasicMaterial({color:ChuClone.model.Constants.IS_BLOOM?16711935:15658734,shading:THREE.FlatShading,opacity:ChuClone.model.Constants.IS_BLOOM?0.25:1,wireframe:!0})]),
c=new THREE.Vector3(5E4,-500,0);b.dynamic=!1;b.position.x=c.x;b.position.y=c.y;b.position.z=c.z;b.rotation.x=90*Math.PI/180;this._floorPlane=b;this._gameView.addObjectToScene(b)},animateIn:function(){var b=null,c=null,d={left:Number.MAX_VALUE,top:Number.MIN_VALUE,right:Number.MIN_VALUE,bottom:Number.MAX_VALUE},e=this._worldController.getWorld().GetBodyList();this._player.getBody().SetActive(!1);for(var f=0;e;){var g=e,e=e.GetNext(),h=g.GetUserData();if(h instanceof ChuClone.GameEntity)if(h.getComponentWithName(ChuClone.components.player.CharacterControllerComponent.prototype.displayName))b=
h;else if(h.getComponentWithName(ChuClone.components.GoalPadComponent.prototype.displayName))c=h;else{f++;var j=g.GetPosition();if(j.x<d.left)d.left=j.x;else if(j.x>d.right)d.right=j.x;if(-j.y>d.top)d.top=-j.y;else if(-j.y<d.bottom)d.bottom=-j.y;h.getView().visible=!1;var j=g.GetPosition(),m={x:j.x+ChuClone.utils.randFloat(-100,100),y:j.y+ChuClone.utils.randFloat(-100,100),z:ChuClone.utils.randFloat(-1E4,1E4)},j={x:g.GetPosition().x,y:g.GetPosition().y,z:0},n={target:g,entity:h.getView(),x:m.x,y:m.y,
z:m.z};g.SetPosition(new Box2D.Common.Math.b2Vec2(m.x,m.y));h.getView().position.z=m.z;h.getView().visible=!0;var m=1E3,t=200;(new TWEEN.Tween(n)).to({x:j.x,y:j.y,z:j.z},m).delay(Math.random()*t).onUpdate(function(){this.target.SetPosition(new Box2D.Common.Math.b2Vec2(this.x,this.y));this.entity.position.z=this.z}).easing(TWEEN.Easing.Circular.EaseInOut).start()}}d.left*=ChuClone.model.Constants.PTM_RATIO;d.top*=ChuClone.model.Constants.PTM_RATIO;d.right*=ChuClone.model.Constants.PTM_RATIO;d.bottom*=
ChuClone.model.Constants.PTM_RATIO;this.setupParticles(25,!0,d,new THREE.Vector3(200,100,100));this.animateCameraIn(b,c,m+t)},animateCameraIn:function(b,c,d){var e=this,f=new THREE.Vector3;f.add(b.getView().position,c.getView().position);var g=this._gameView.getCamera();f.x+=0;f.z+=0;var c=b.getView().position.clone(),h=g.getComponents();g.components=[];g.position=f.clone();(new TWEEN.Tween({target:g,x:f.x,y:f.y,z:f.z})).to({x:c.x,y:c.y,z:c.z},d).onUpdate(function(){this.target.position.x=this.x;
this.target.position.y=this.y;this.target.position.z=this.z;this.target.target.position=b.getView().position.clone()}).onComplete(function(){g.components=h;e.animateInComplete();g.getComponentWithName(ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName)._mousePosition.x=3.5}).easing(TWEEN.Easing.Quadratic.EaseInOut).start()},animateInComplete:function(){this._elapsedFrames=this._elapsedTime=this._previousTime=this._currentTime=0;this._previousTime=Date.now();this._recording=
[];this._didAnimateIn=!0;this._player.getBody().SetActive(!0)},setupEvents:function(){var b=this;this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_CREATED,function(c){b.onLevelLoaded(c)});this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,function(c){b.onLevelDestroyed(c)});this.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,function(c){b.onPlayerCreated(c)});this.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,
function(c){b.onPlayerDestroyed(c)});this.addListener(ChuClone.components.GoalPadComponent.prototype.EVENTS.GOAL_REACHED,function(c){b.onGoalReached(c)})},update:function(){ChuClone.states.PlayLevelState.superclass.update.call(this);this._elapsedFrames++;this.updateTime();this.updatePhysics();this._gameView.update(this._currentTime);if(this._currentTime-this._lastTextUpdate>128)this._lastTextUpdate=this._currentTime,ChuClone.gui.HUDController.setTimeInSeconds(this._elapsedTime);this._worldController.update()},
updateTime:function(){if(!this._beatLevel&&this._didAnimateIn)this._currentTime=Date.now(),this._elapsedTime+=this._currentTime-this._previousTime,this._previousTime=this._currentTime},resetTime:function(){this._lastTextUpdate=this._elapsedTime=0;this._previousTime=Date.now()},setupCamera:function(){console.log("SETTING UP CAMERA");var b=this._gameView.getCamera(),c=new ChuClone.components.camera.CameraFollowPlayerComponent;this._player&&c.setPlayer(this._player);b.addComponentAndExecute(c);c=new ChuClone.components.camera.CameraFocusRadiusComponent;
b.addComponentAndExecute(c);c.getRadius().x=100;c.getRadius().y=100;c.getRadius().z=2E3},onPlayerCreated:function(b){this._player=b;this._player.addComponentAndExecute(new ChuClone.components.BoundsYCheckComponent);this._gameView.getCamera().getComponentWithName(ChuClone.components.camera.CameraFollowPlayerComponent.prototype.displayName).setPlayer(this._player);ChuClone.components.RespawnComponent.prototype.GET_CURRENT_RESPAWNPOINT().setSpawnedEntityPosition(this._player);this.startRecordingPlayer();
this.animateIn()},onPlayerDestroyed:function(b){if(b===this._player)this._player=null},onLevelLoaded:function(){this._isLevelLoaded=!0;this.resetTime();this.setupCamera();this._worldController.createBox2dWorld()},onLevelDestroyed:function(){if(this._isLevelLoaded){var b=new ChuClone.states.PlayLevelState;b._gameView=this._gameView;b._worldController=this._worldController;b._levelManager=this._levelManager;ChuClone.model.FSM.StateMachine.getInstance().changeState(b)}},onGoalReached:function(){ChuClone.gui.HUDController.setTimeInSeconds(this._elapsedTime);
this._beatLevel=!0;var b=this._player.getComponentWithName(ChuClone.components.player.PlayerRecordComponent.prototype.displayName),c=null;b&&(c=JSON.stringify(b.getRecord()),this._player.removeComponentWithName(ChuClone.components.player.PlayerRecordComponent.prototype.displayName));b=new ChuClone.states.EndLevelState;b._gameView=this._gameView;b._worldController=this._worldController;b._levelManager=this._levelManager;b.setPlayer(this._player);b.setTime(this._elapsedTime);b.setRecord(c);ChuClone.model.FSM.StateMachine.getInstance().changeState(b)},
startRecordingPlayer:function(){var b=new ChuClone.components.player.PlayerRecordComponent;b.setClockDelegate(this);this._player.addComponentAndExecute(b)},startRecordingPlayback:function(){var b=new ChuClone.components.player.PlayerPlaybackComponent;b.setClockDelegate(this);this._player.addComponentAndExecute(b)},exit:function(){clearTimeout(this._animateInTimeout);this.removeBackgroundElements();this._gameView.removeObjectFromScene(this._floorPlane);this._gameView.getCamera().removeComponentWithName(ChuClone.components.camera.CameraFollowPlayerComponent.prototype.displayName);
this._gameView.getCamera().removeComponentWithName(ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName);ChuClone.states.PlayLevelState.superclass.exit.call(this)},removeBackgroundElements:function(){if(this._backgroundElements){for(var b=this._backgroundElements.length,c=0;c<b;c++)this._gameView.removeObjectFromScene(this._backgroundElements[c]);this._backgroundElements=[]}},dealloc:function(){this._floorPlane=this._player=null;ChuClone.states.PlayLevelState.superclass.dealloc.call(this)},
setPlayer:function(b){ChuClone.components.RespawnComponent.prototype.GET_CURRENT_RESPAWNPOINT().setSpawnedEntityPosition(b);this._player=b},getCurrentTime:function(){return this._elapsedFrames}};ChuClone.extend(ChuClone.states.PlayLevelState,ChuClone.states.ChuCloneBaseState)})();(function(){ChuClone.namespace("ChuClone.states");ChuClone.states.TitleScreenState=function(){ChuClone.states.TitleScreenState.superclass.constructor.call(this);this._tweenList=[]};ChuClone.states.TitleScreenState.prototype={_camera:null,_player:null,_tweenList:null,_backgroundElements:[],_hasShown:!1,propProxy:{targetX:6800,targetY:-400,targetZ:-8E3,posX:9E3,posY:4400,posZ:3400},enter:function(){ChuClone.states.TitleScreenState.superclass.enter.call(this)},setupGUI:function(){this._gameView.getCamera()},
setupEvents:function(){var b=this;this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_CREATED,function(c){b.onLevelLoaded(c)});this.addListener(ChuClone.editor.LevelManager.prototype.EVENTS.LEVEL_DESTROYED,function(c){b.onLevelDestroyed(c)});this.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.CREATED,function(c){b.onPlayerCreated(c)});this.addListener(ChuClone.components.player.CharacterControllerComponent.prototype.EVENTS.REMOVED,function(c){b.onPlayerDestroyed(c)});
this._closures.onKeyDown=function(c){b.onKeyDown(c)};document.addEventListener("keydown",this._closures.onKeyDown,!1)},code:[38,38,40,40,37,39,37,39,66,65,13],codeIndex:0,onKeyDown:function(b){b.keyCode==this.code[this.codeIndex]?(this.codeIndex++,this.codeIndex==this.code.length&&(console.log("KonamiCode!"),this._gameView.startPostProcessing())):this.codeIndex=0;ChuClone.model.IS_BLOOM=!0},animateIn:function(){this._backgroundElements=this.createBackgroundElements(50,!0,{left:10,right:15E3,top:4E3,
bottom:-2E3},new THREE.Vector3(100,100,200));for(var b=this._worldController.getWorld().GetBodyList();b;){var c=b,b=b.GetNext(),d=c.GetUserData();if(d instanceof ChuClone.GameEntity&&!d.getComponentWithName(ChuClone.components.player.CharacterControllerComponent.prototype.displayName)){d.getView().visible=!1;var e=new ChuClone.components.effect.BirdEmitterComponent;e._count=1;d.addComponentAndExecute(e);var f=c.GetPosition(),e={x:f.x+ChuClone.utils.randFloat(-100,100),y:f.y+ChuClone.utils.randFloat(-100,
100),z:ChuClone.utils.randFloat(-1E4,1E4)},f={x:c.GetPosition().x,y:c.GetPosition().y,z:0},g={target:c,entity:d.getView(),x:e.x,y:e.y,z:e.z};c.SetPosition(new Box2D.Common.Math.b2Vec2(e.x,e.y));d.getView().position.z=e.z;d.getView().visible=!0;c=(new TWEEN.Tween(g)).to({x:f.x,y:f.y,z:f.z},2E3).delay(Math.random()*1E3+500).onUpdate(function(){this.target.SetPosition(new Box2D.Common.Math.b2Vec2(this.x,this.y));this.entity.position.z=this.z}).easing(TWEEN.Easing.Sinusoidal.EaseInOut).start();d=(new TWEEN.Tween(g)).to({x:e.x,
y:e.y,z:e.z},1E3).delay(6E3+Math.random()*2E4).onUpdate(function(){this.target.SetPosition(new Box2D.Common.Math.b2Vec2(this.x,this.y));this.target.GetUserData().getView().position.z=this.z}).easing(TWEEN.Easing.Back.EaseOut);c.chain(d);d.chain(c);this._tweenList.push(c,d)}}},update:function(){ChuClone.states.TitleScreenState.superclass.update.call(this);if(this._camera)this._camera.target.position=new THREE.Vector3(this.propProxy.targetX,this.propProxy.targetY,this.propProxy.targetZ),this._camera.position=
new THREE.Vector3(this.propProxy.posX,this.propProxy.posY,this.propProxy.posZ);this.updatePhysics();this._gameView.update(this._currentTime);this._worldController.update()},setupCamera:function(){this._camera=this._gameView.getCamera();this._camera.target.position=new THREE.Vector3(0,100,0);var b=new ChuClone.components.camera.CameraFocusRadiusComponent;this._camera.addComponentAndExecute(b);b.getRadius().x=2E3;b.getRadius().y=-1E3;b.getRadius().z=1E3;this.setupGUI()},onLevelLoaded:function(b){this._hasShown?
this.pushPlayLevelState(b):(this._hasShown=!0,this.setupCamera(),this._worldController.createBox2dWorld(),this.animateIn())},onLevelDestroyed:function(){for(var b=this._tweenList.length,c=0;c<b;c++)TWEEN.remove(this._tweenList[c]);this._tweenList=[];b=this._backgroundElements.length;for(c=0;c<b;c++)this._gameView.removeObjectFromScene(this._backgroundElements[c]);this._backgroundElements=[]},onPlayerCreated:function(){},onPlayerDestroyed:function(){},pushPlayLevelState:function(){this._gameView.getCamera().removeComponentWithName(ChuClone.components.camera.CameraFocusRadiusComponent.prototype.displayName);
var b=new ChuClone.states.PlayLevelState;b._gameView=this._gameView;b._worldController=this._worldController;b._levelManager=this._levelManager;b.onLevelLoaded();ChuClone.model.FSM.StateMachine.getInstance().changeState(b)},exit:function(){document.removeEventListener("keydown",this._closures.onKeyDown,!1);if(this._tweenList){for(var b=this._tweenList.length,c=0;c<b;c++)TWEEN.remove(this._tweenList[c]);this._tweenList=null}if(this._backgroundElements){b=this._backgroundElements.length;for(c=0;c<b;c++)this._gameView.removeObjectFromScene(this._backgroundElements[c]);
this._backgroundElements=[]}ChuClone.states.TitleScreenState.superclass.exit.call(this);this.removeAllListeners()},dealloc:function(){this._player=null;ChuClone.states.TitleScreenState.superclass.dealloc.call(this)}};ChuClone.extend(ChuClone.states.TitleScreenState,ChuClone.states.ChuCloneBaseState)})();(function(){var b="";ChuClone.namespace("ChuClone");ChuClone.ChuCloneGame=function(c){b=c;this.listenForReady()};ChuClone.ChuCloneGame.prototype={_hasFocus:!0,_stateMachine:null,_gameView:null,_worldController:null,_levelManager:null,_player:null,_closures:{},listenForReady:function(){var b=this;window.addEventListener("DOMContentLoaded",function e(){window.removeEventListener("DOMContentLoaded",e,!1);b.onReady()},!1)},setupEvents:function(){var b=this;window.addEventListener("focus",function(){b._hasFocus=
!0},!1);window.addEventListener("blur",function(){b._hasFocus=!1},!1);ChuClone.Events.Dispatcher.addListener(ChuClone.gui.LevelListing.prototype.EVENTS.SHOULD_CHANGE_LEVEL,function(d){b._levelManager.loadLevelFromURL(b._worldController,b._gameView,d)})},onReady:function(){this.setupEvents();this.setupView();this.setupWorldController();this.setupLevelManager();this._stateMachine=new ChuClone.model.FSM.StateMachine;var c=new ChuClone.states[ChuClone.model.Constants.INITIAL_STATE+"State"];c._worldController=
this._worldController;c._gameView=this._gameView;c._levelManager=this._levelManager;this._stateMachine.setInitialState(c);b&&this._levelManager.loadLevelFromURL(this._worldController,this._gameView,b);var d=this;(function f(){d.update();TWEEN.update();window.requestAnimationFrame(f)})()},setupLevelManager:function(){this._levelManager=new ChuClone.editor.LevelManager},setupView:function(){this._gameView=new ChuClone.GameViewController;this._gameView.onResize(null);ChuClone.utils.augmentCamera(this._gameView.getCamera())},
setupWorldController:function(){this._worldController=new ChuClone.physics.WorldController},onBeforeStart:function(){debugger;this._worldController.createBox2dWorld()},update:function(){this._hasFocus&&this._stateMachine.update()}}})();
